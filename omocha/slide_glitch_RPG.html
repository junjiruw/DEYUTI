<!DOCTYPE html>
<html lang="ja">
    <head prefix="og: http://ogp.me/ns# website: http://ogp.me/ns/website#">
        <meta charset="UTF-8">
        <!--文字コードは上のほうにないとすべておしまいになるらしい-->
        <meta name="description" content="バグゲーを作ろうと思った">                                                                 <!--入力すること！-->
        <title>JUN汁ｗおもちゃばこ。/おもちゃ/すらいどぐりっちしゅうくんRPG</title>                                                         <!--入力すること！-->
        <!--OGPとかいうの-->
        <meta property="og:site_name" content="JUN汁ｗおもちゃばこ。/omocha/slide_glitch_RPG">                                <!--入力すること！-->
        <meta property="og:title" content="すらいどぐりっちしゅうくんRPG"/>                                                               <!--入力すること！-->
        <meta property="og:type" content="article"> <!--websiteはトップページ、articleが記事だってさ-->
        <meta property="og:url" content="https://junjiruw.github.io/DEYUTI/omocha/slide_glitch_RPG.html"/>                   <!--入力すること！-->
        <meta property="og:image" content="https://github.com/junjiruw/DEYUTI/blob/master/images/site/junjiruw_bako.png?raw=true"/>
        <meta name="twitter:card" content="summary"><!--なにを表示するか-->
        <meta name="twitter:site" content="@junjiruw"><!--フッターに表示されるらしい…どこ？-->
        
        <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><!--ボタン連打してると拡大されることがあるからもう無効で。-->
        
        
        <link rel="stylesheet" href="../css/style.css">
        <link rel="icon" href="../images/site/favicon32.png">
        <style>
            @font-face {
                font-family: "misaki_gothic";
                src: url("../font/misaki_gothic_2nd.ttf") format('truetype');
            }
            html{
                font-family: "misaki_gothic";
            }
            header{
                position: static;/*ついてくるな*/
                top: 0px;
                margin: 10px;
            }
            div#parent_div{
                text-align: center;
                margin: 10px;
            }
            canvas{
                background: #ffffff;
                height: 70vh;/*これ、PCブラウザで横に狭くしたら崩壊せえへん？→勝手に崩壊してろ*/
                image-rendering: pixelated;/*ドット絵を拡大したいなら使え*/
                -webkit-font-smoothing: never;/*アンチアンチエイリアシング。Windowsでは利用不可だけど、MSゴシックが使えるので問題ナシ。*/
            }
            div#buttons{
                display: flex;
            }
            input.key_button{
                background-color: #FFFFFF;
                width: 1.5em;
                height: 1.5em;
                font-size: 2em;
                font-family: "misaki_gothic";
                margin: 0.25em;
                margin-left: 1em;
            }
            input.key_button:active{
                background-color: #656965;
                color: #FFFFFF;
            }
            div#button_left{
                text-align: left;
                width: 50%;
            }
            div#button_left div{
                text-align: center;
            }
            div#button_right{
                text-align: center;
                width: 50%;
            }
            div#kouryaku_div{
                text-align: right;
            }
        </style>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-1MB5XLN4LW"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-1MB5XLN4LW');
        </script>

        <script src="../js/public.js"></script>
        <script>
            //オブジェクトを追加するときは
            //変数宣言　：画像、位置　および初期化
            //表示設定　：アニメ部
            //ワールド移動設定
            //当たり判定設定


            var ctx; 
            //画像
            var taitoru=new Image();
            var taitoru_start=new Image();
            var taitoru_load=new Image();
            var taitoru_cursor=new Image();
            var syuukun_0=new Image();
            var syuukun_1=new Image();
            var pon_0=new Image();
            var pon_1=new Image();
            var map=new Image();
            var map_2=new Image();
            var kanbansan=new Image();
            var zakozakosan_0=new Image();
            var zakozakosan_1=new Image();
            var DEATH=new Image();
            var damage=new Image();
            var moetti_0=new Image();
            var moetti_1=new Image();
            var jirai=new Image();
            var save_0=new Image();
            var save_1=new Image();
            var habanero_0=new Image();
            var habanero_1=new Image();
            var kusokinoko_0=new Image();
            var kusokinoko_1=new Image();
            var torendei_0=new Image();
            var torendei_1=new Image();
            var torendei_doa=new Image();
            var goninsyuu_0=new Image();
            var goninsyuu_1=new Image();
            var akareba_0=new Image();
            var akareba_1=new Image();
            var akablock_0=new Image();
            var akablock_1=new Image();
            var aoreba_0=new Image();
            var aoreba_1=new Image();
            var aoblock_0=new Image();
            var aoblock_1=new Image();
            var lite_0=new Image();
            var lite_1=new Image();
            var lite_2=new Image();
            var lite_3=new Image();
            var deyukabe =new Image();
            var deyu32_0=new Image();
            var deyu32_1=new Image();
            var deyu64_0=new Image();
            var deyu64_1=new Image();
            var deyuhando_0=new Image();
            var deyuhando_1=new Image();
            var kusotori=new Image();
            // 画像読み込み
            var image_url="../images/omocha/slide_glitch_RPG/";
            taitoru.src=image_url+"suraidosyuukuntitle.png";
            taitoru_start.src=image_url+"suraidosyuukuntitle_go.png";
            taitoru_load.src=image_url+"suraidosyuukuntitle_load.png";
            taitoru_cursor.src=image_url+"suraidosyuukuntitle_cursor.png";
            syuukun_0.src = image_url+"syuukun32_0.png";  // 画像のURLを指定
            syuukun_1.src = image_url+"syuukun32_1.png";  // 画像のURLを指定
            map.src=image_url+"32map.png"
            map_2.src=image_url+"32map_2.png"
            pon_0.src = image_url+"mikupon32_0.png";
            pon_1.src = image_url+"mikupon32_1.png";
            kanbansan.src=image_url+"kanbansan.png";
            zakozakosan_0.src = image_url+"zakozakosan32_0.png";
            zakozakosan_1.src = image_url+"zakozakosan32_1.png";
            DEATH.src= image_url+"DEATH_32.png";
            damage.src=image_url+"damage32.png";
            moetti_0.src=image_url+"moetti32_0.png";
            moetti_1.src=image_url+"moetti32_1.png";
            jirai.src=image_url+"jirai.png";
            save_0.src=image_url+"save32_0.png";
            save_1.src=image_url+"save32_1.png";
            habanero_0.src=image_url+"nagekihabanero_0.png";
            habanero_1.src=image_url+"nagekihabanero_1.png";
            kusokinoko_0.src=image_url+"kusokinoko32_0.png";
            kusokinoko_1.src=image_url+"kusokinoko32_1.png";
            torendei_0.src=image_url+"torendei32_0.png";
            torendei_1.src=image_url+"torendei32_1.png";
            torendei_doa.src=image_url+"torendei_doa.png";
            goninsyuu_0.src=image_url+"goninsyuu_0.png";
            goninsyuu_1.src=image_url+"goninsyuu_1.png";
            akareba_0.src=image_url+"akareba32_0.png";
            akareba_1.src=image_url+"akareba32_1.png";
            akablock_0.src=image_url+"akablock32_0.png"
            akablock_1.src=image_url+"akablock32_1.png";
            aoreba_0.src=image_url+"aoreba32_0.png";
            aoreba_1.src=image_url+"aoreba32_1.png";
            aoblock_0.src=image_url+"aoblock32_0.png"
            aoblock_1.src=image_url+"aoblock32_1.png";
            lite_0.src=image_url+"lite32_0.png";
            lite_1.src=image_url+"lite32_1.png";
            lite_2.src=image_url+"lite32_2.png";
            lite_3.src=image_url+"lite32_3.png";
            deyukabe.src=image_url+"deyukabe32.png";
            deyu32_0.src=image_url+"deyu32_0.png";
            deyu32_1.src=image_url+"deyu32_1.png"
            deyu64_0.src=image_url+"deyu64_0.png";
            deyu64_1.src=image_url+"deyu64_1.png";
            deyuhando_0.src=image_url+"deyuhando_0.png";
            deyuhando_1.src=image_url+"deyuhando_1.png";
            kusotori.src=image_url+"kusotori32.png";
            //座標
            var deyu_x;
            var deyu_y;
            var pon_x ;
            var pon_y ;
            var mori_pon_x ;
            var mori_pon_y ;
            var world_x;
            var world_y;
            var kanbansan_1_x;
            var kanbansan_1_y;
            var kanbansan_2_x;
            var kanbansan_2_y;
            var kanbansan_3_x;
            var kanbansan_3_y;
            var kanbansan_4_x;
            var kanbansan_4_y;
            var kanbansan_5_x;
            var kanbansan_5_y;
            var kanbansan_6_x;
            var kanbansan_6_y;
            var kanbansan_7_x;
            var kanbansan_7_y;
            var zakozakosan_x;
            var zakozakosan_y;
            var moetti_x;
            var moetti_y;
            var yadoya_x;
            var yadoya_y;
            var jirai_x;
            var jirai_y;
            var save_1_x;
            var save_1_y;
            var save_2_x;
            var save_2_y;
            var save_3_x;
            var save_3_y;
            var habanero_1_x;
            var habanero_1_y;
            var habanero_2_x;
            var habanero_2_y;
            var kusokinoko_1_x;
            var kusokinoko_1_y;
            var kusokinoko_2_x;
            var kusokinoko_2_y;
            var torendei_x;
            var torendei_y;
            var uketuke_x;
            var uketuke_y;
            var goninsyuu_x;
            var goninsyuu_y;
            var vs_goninsyuu_x;
            var vs_goninsyuu_y;
            var akareba_1_x;
            var akareba_1_y;
            var akablock_1_x;
            var akablock_1_y;
            var akareba_2_x;
            var akareba_2_y;
            var akablock_2_x;
            var akablock_2_y;
            var aoreba_2_x;
            var aoreba_2_y;
            var aoblock_2_x;
            var aoblock_2_y;
            var lite_x;
            var lite_y;
            var pazupazusan_x;
            var pazupazusan_y;
            var deyukabe_x;
            var deyukabe_y;
            var deyu32_x;
            var deyu32_y;
            var kusotori_x;
            var kusotori_y;
            var owapon_x;
            var owapon_y;
            function set_iti(){//ゲームオーバーで初期位置にずらしたいので初期化を関数にしておきます。
                deyu_x=5;//周囲に壁を置くのでずらします。 しゅうくんの座標なのにでゆって変数名で草。おもしろいのでこのままでいいか
                deyu_y=5;
                pon_x =5+3*32+0*170;
                pon_y =5+2*32+0*170;
                mori_pon_x =5+3*32+2*170;
                mori_pon_y =5+3*32+4*170;
                world_x=0*170;
                world_y=0*170;
                kanbansan_1_x=5+1*32+0*170;
                kanbansan_1_y=5+1*32+0*170;
                kanbansan_2_x=5+2*32+0*170;
                kanbansan_2_y=5+2*32+4*170;
                kanbansan_3_x=5+4*32+1*170;
                kanbansan_3_y=5+4*32+4*170;
                kanbansan_4_x=5+1*32+1*170;
                kanbansan_4_y=5+2*32+2*170;
                kanbansan_5_x=5+1*32+2*170;
                kanbansan_5_y=5+2*32+1*170;
                kanbansan_6_x=5+1*32+2*170;
                kanbansan_6_y=5+1*32+0*170;
                kanbansan_7_x=5+1*32+3*170;
                kanbansan_7_y=5+4*32+3*170;
                zakozakosan_x=5+2*32+0*170;
                zakozakosan_y=5+2*32+1*170;
                moetti_x=5+2*32+0*170;
                moetti_y=5+3*32+2*170;
                yadoya_x=5+4*32+0*170;
                yadoya_y=5+1*32+3*170;
                jirai_x=5+0*32+1*170;//左上だけ決めとくわ
                jirai_y=5+1*32+4*170;
                save_1_x=5+2*32+1*170;
                save_1_y=5+4*32+3*170;
                save_2_x=5+2*32+2*170;
                save_2_y=5+4*32+0*170;
                save_3_x=5+4*32+3*170;
                save_3_y=5+4*32+1*170;
                habanero_1_x=5+3*32+1*170;
                habanero_1_y=5+1*32+3*170;
                habanero_2_x=5+2*32+2*170;
                habanero_2_y=5+3*32+2*170;
                kusokinoko_1_x=5+3*32+2*170;
                kusokinoko_1_y=5+2*32+3*170;
                kusokinoko_2_x=5+3*32+2*170;
                kusokinoko_2_y=5+3*32+2*170;
                torendei_x=5+2*32+2*170;
                torendei_y=5+1*32+1*170;
                if(flag>1){//トレンデイ撃破後は横にどいてて。
                    torendei_x=torendei_x+2*32;
                }
                uketuke_x=5+0*32+3*170;
                uketuke_y=5+0*32+0*170;
                goninsyuu_x=5+2*32+1*170;
                goninsyuu_y=5+1*32+1*170;
                vs_goninsyuu_x=5+2*32+1*170;
                vs_goninsyuu_y=5+1*32+0*170;
                akareba_1_x=5+1*32+4*170;
                akareba_1_y=5+2*32+0*170;
                akablock_1_x=5+2*32+4*170;
                akablock_1_y=5+2*32+0*170;
                akareba_2_x=5+4*32+4*170;
                akareba_2_y=5+1*32+1*170;
                akablock_2_x=5+0*32+4*170;
                akablock_2_y=5+3*32+1*170;
                aoreba_2_x=5+4*32+4*170;
                aoreba_2_y=5+0*32+1*170;
                aoblock_2_x=5+0*32+4*170;
                aoblock_2_y=5+4*32+1*170;
                lite_x=5+0*32+3*170;
                lite_y=5+0*32+2*170;
                pazupazusan_x=5+1*32+3*170;
                pazupazusan_y=5+3*32+1*170;
                deyukabe_x=138+3*170;
                deyukabe_y=5+4*32+4*170;
                deyu32_x=5+2*32+3*170;
                deyu32_y=5+4*32+4*170;
                kusotori_x=5+4*32+4*170;
                kusotori_y=5+0*32+3*170;
                owapon_x=5+3*32+4*170;
                owapon_y=5+1*32+2*170;
            }
            set_iti();
            var world_doko_x=0;
            var world_doko_y=0;
            function world_slide(world_dx,world_dy){
                world_x+=world_dx;
                world_y+=world_dy;
                pon_x-=world_dx;
                pon_y-=world_dy;
                mori_pon_x-=world_dx;
                mori_pon_y-=world_dy;
                kanbansan_1_x-=world_dx;
                kanbansan_1_y-=world_dy;
                kanbansan_2_x-=world_dx;
                kanbansan_2_y-=world_dy;
                kanbansan_3_x-=world_dx;
                kanbansan_3_y-=world_dy;
                kanbansan_4_x-=world_dx;
                kanbansan_4_y-=world_dy;
                kanbansan_5_x-=world_dx;
                kanbansan_5_y-=world_dy;
                kanbansan_6_x-=world_dx;
                kanbansan_6_y-=world_dy;
                kanbansan_7_x-=world_dx;
                kanbansan_7_y-=world_dy;
                zakozakosan_x-=world_dx;
                zakozakosan_y-=world_dy;
                moetti_x-=world_dx;
                moetti_y-=world_dy;
                yadoya_x-=world_dx;
                yadoya_y-=world_dy;
                jirai_x-=world_dx;
                jirai_y-=world_dy;
                save_1_x-=world_dx;
                save_1_y-=world_dy;
                save_2_x-=world_dx;
                save_2_y-=world_dy;
                save_3_x-=world_dx;
                save_3_y-=world_dy;
                habanero_1_x-=world_dx;
                habanero_1_y-=world_dy;
                habanero_2_x-=world_dx;
                habanero_2_y-=world_dy;
                kusokinoko_1_x-=world_dx;
                kusokinoko_1_y-=world_dy;
                kusokinoko_2_x-=world_dx;
                kusokinoko_2_y-=world_dy;
                torendei_x-=world_dx;
                torendei_y-=world_dy;
                uketuke_x-=world_dx;
                uketuke_y-=world_dy;
                goninsyuu_x-=world_dx;
                goninsyuu_y-=world_dy;
                vs_goninsyuu_x-=world_dx;
                vs_goninsyuu_y-=world_dy;
                akareba_1_x-=world_dx;
                akareba_1_y-=world_dy;
                akablock_1_x-=world_dx;
                akablock_1_y-=world_dy;
                akareba_2_x-=world_dx;
                akareba_2_y-=world_dy;
                akablock_2_x-=world_dx;
                akablock_2_y-=world_dy;
                aoreba_2_x-=world_dx;
                aoreba_2_y-=world_dy;
                aoblock_2_x-=world_dx;
                aoblock_2_y-=world_dy;
                lite_x-=world_dx;
                lite_y-=world_dy;
                pazupazusan_x-=world_dx;
                pazupazusan_y-=world_dy;
                deyukabe_x-=world_dx;
                deyukabe_y-=world_dy;
                deyu32_x-=world_dx;
                deyu32_y-=world_dy;
                kusotori_x-=world_dx;
                kusotori_y-=world_dy;
                owapon_x-=world_dx;
                owapon_y-=world_dy;

                world_doko_x+=world_dx;
                world_doko_y+=world_dy;
                
            }
            //world_slide(1*170,3*170);//開始地点変更ワープ！
            //キーボードなど、システムの、あの、アレ、アレさ！
            var key_input="";
            var what_input="";//キーボード同時おしに使う
            var key_interval=0;//n*10[s]　長押しの連続入力に使ってる
            var key_owarasete=0;
            var loop_count=-1;//あれです、1秒で100数えます。
            var GAMEOVER=0;//死にやがった！
            var save_point=0;//復活地点に関するアレさ！
            var flag=0;//なんのだよ！そう、全ての。
            var akareba=0;
            var aoreba=0;
            var vs_deyu=0;
            var tweet_suruze=0;
            //しゅうくんのステータスだよ！
            var HP_MAX=10;
            var HP=10;
            var Attack=1;
            var EXP=0;
            var Level=1;
            var damaging=0;
            //一番大事なところだッピ！
            var serihu=[];
             //serihu[serihu.length]={text:"スライドグリッチという、話してても戦ってても動けるバグがあるみたいです。",hyouji_i:0,OK:0,cursor:0};
            var battle=[];//画像2枚,最大HP,現在HP,攻撃,位置x,表示,カーソル位置,経験値,ダメージ描写
            // battle[battle.length]={image:[zakozakosan_0,zakozakosan_1],HP_MAX:3,HP:3,Attack:1,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:1,damaging:0};
            var deyu_battle=[];

            onload = function(){
                onload_functions();
                const cnvs = document.getElementById('cnvs');//IDを指定して変数にぶち込む
                
                if (navigator.userAgent.match(/iPhone|Android.+Mobile/)) {//貴様！スマホで見ているな！？
                    cnvs.style.width=90+"%";
                    cnvs.style.height=cnvs.clientWidth+"px";
                }

                ctx = cnvs.getContext("2d");
                ctx.font = "10px 'ＭＳ Ｐゴシック','misaki_gothic' ";//フォント設定。左のフォントがないと右のフォントを適用するらしい。

                var buttons = document.getElementsByClassName("key_button");//ボタン操作
                if( window.ontouchstart === null ){ // 注：ontouchstartが存在しない時は undefined が返る
                    //ようするにタッチ機能がある端末なら
                    for(let i=0;i<buttons.length;i++){
                        buttons[i].addEventListener("touchstart",function(e){//押すと動く
                            e.preventDefault();//ボタンをもとの状態に戻してください（血涙）
                            key_input=this.value;
                            key_interval=-1;//初回限定モード（1回は動作させたいので。）
                            key_owarasete=0;
                        });
                        buttons[i].addEventListener("touchend",function(e){//離すと動く
                            e.preventDefault();//ボタンをもとの状態に戻してください（血涙）
                            if(key_interval!=-1){//一回も実行されてないのに終了するのはボタンとしておかしいので、はじく
                                key_input="";
                                key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                            }else{
                                key_owarasete=1;//一度も実行されてないけど、ボタンはもう押してないのよ。
                            }
                        });
                    }
                }else{
                    //一般的なPCなら
                    for(let i=0;i<buttons.length;i++){
                        buttons[i].addEventListener("mousedown",function(){//押すと動く
                            key_input=this.value;
                            key_interval=-1;//初回限定モード（1回は動作させたいので。）
                            key_owarasete=0;
                        });
                        buttons[i].addEventListener("mouseup",function(){//離すと動く
                            if(key_interval!=-1){//一回も実行されてないのに終了するのはボタンとしておかしいので、はじく
                                key_input="";
                                key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                            }else{
                                key_owarasete=1;//一度も実行されてないけど、ボタンはもう押してないのよ。
                            }
                        });

                    }
                }
                
                document.addEventListener('keydown', function(key){//キーボード操作

                    what_input="";
                    if(key.key=="w" || key.key=="k" || key.key=="ArrowUp"){
                        what_input="↑";
                    }else if(key.key=="a" || key.key=="h" || key.key=="ArrowLeft"){
                        what_input="←";
                    }else if(key.key=="d" || key.key=="l" || key.key=="ArrowRight"){
                        what_input="→";
                    }else if(key.key=="s" || key.key=="j" || key.key=="ArrowDown"){
                        what_input="↓";
                    }else if(key.key=="Enter"){//AがAで入力できない！？←だってWASDに使ってるんだもん…
                        what_input="〇";
                    }else if(key.key=="Shift"){
                        what_input="×";
                    }
                    if(key_input.indexOf(what_input)==-1){//すでに押されていたら、文字列検索でひっかかる。ひっかからないなら-1が帰ってくる
                        key_input=key_input+what_input;//キーボードは同時押しが可能なので書き換えではなく、追加にします。え？キーボードとボタン同時押しされたら？バ～カ
                    }
                    if (what_input != ""){key.preventDefault();}//矢印キーでの操作時に、画面が上下にスクロールしてしまうことを防ぐ

                    
                });
                document.addEventListener('keyup', function(key){//キーボード操作
                    what_input="";
                    if(key.key=="w" || key.key=="ArrowUp"){
                        what_input="↑";
                    }else if(key.key=="a" || key.key=="ArrowLeft"){
                        what_input="←";
                    }else if(key.key=="d" || key.key=="ArrowRight"){
                        what_input="→";
                    }else if(key.key=="s" || key.key=="ArrowDown"){
                        what_input="↓";
                    }else if(key.key=="Enter"){//AがAで入力できない！？←だってWASDに使ってるんだもん…→Aをやめて〇にしよう（天才）
                        what_input="〇";
                    }else if(key.key=="Shift"){
                        what_input="×";
                    }
                    
                    key_input=key_input.slice(0,key_input.indexOf(what_input))+key_input.slice(key_input.indexOf(what_input)+1);//該当文字を消去
                    if(key_input==""){
                        key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                    }
                });

                var start_gamen=0;
                var start_cursor=0;
                var load_gamen=0;
                
                setInterval(function(){//1秒に100回動くぞ！
                    loop_count=loop_count+1;
                    if(loop_count>99){loop_count=0;}//0-99

                    if(start_gamen==0){
                        ctx.drawImage(taitoru,0,0);
                        if(load_gamen==0){
                            if(start_cursor==0){
                                ctx.drawImage(taitoru_cursor,0,0);
                                ctx.drawImage(taitoru_start,-7,-Math.floor(Math.sin(loop_count*Math.PI))*2);
                                ctx.drawImage(taitoru_load,0,-Math.floor(Math.sin(loop_count*Math.PI/10))*2);
                            }else if(start_cursor==1){
                                ctx.drawImage(taitoru_cursor,0,20);
                                ctx.drawImage(taitoru_start,-3,-Math.floor(Math.sin(loop_count*Math.PI/10))*2);//初期位置があんまよくなかった（笑）
                                ctx.drawImage(taitoru_load,-5,-Math.floor(Math.sin(loop_count*Math.PI))*2);
                            }else if(start_cursor==-1){
                                start_cursor=1;
                            }else if(start_cursor==2){
                                start_cursor=0;
                            }
                        }else if(load_gamen==1){
                            if(start_cursor<0){
                                start_cursor=4;
                            }else if(start_cursor>4){
                                start_cursor=0;
                            } 
                            
                            ctx.fillStyle="rgb(0,80,0)";
                            ctx.fillRect(108,18,49,154);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(110,20,45,150);
                            if(start_cursor==0 && loop_count>50){
                                ctx.drawImage(zakozakosan_0,120,15);
                            }else{
                                ctx.drawImage(zakozakosan_1,120,15);
                            }
                            if(start_cursor==1 && loop_count>50){
                                ctx.drawImage(habanero_0,120,47);
                            }else{
                                ctx.drawImage(habanero_1,120,47);
                            }
                            if(start_cursor==2 && loop_count>50){
                                ctx.drawImage(torendei_0,120,79);
                            }else{
                                ctx.drawImage(torendei_1,120,79);
                            }
                            if(start_cursor==3 && loop_count>50){
                                ctx.drawImage(aoblock_0,120,111);
                            }else{
                                ctx.drawImage(aoblock_1,120,111);
                            }
                            if(start_cursor==4 && loop_count>50){
                                ctx.drawImage(deyu32_0,120,143);
                            }else{
                                ctx.drawImage(deyu32_1,120,143);
                            }
                            ctx.drawImage(taitoru_cursor,-5,-100+start_cursor*32);
                        }
                        
                        if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                            key_interval=100;//1000/1000[s]の間、長押しでの連続入力を無効。
                            for(let i=0;i<key_input.length;i++){
                                if(key_input.charAt(i)=="↑"){
                                    start_cursor=start_cursor-1;
                                }else if(key_input.charAt(i)=="←"){
                                    
                                }else if(key_input.charAt(i)=="→"){
                                    
                                }else if(key_input.charAt(i)=="↓"){
                                    start_cursor=start_cursor+1;
                                }else if(key_input.charAt(i)=="〇"){
                                    if(load_gamen==0){
                                        if(start_cursor==0){
                                            start_gamen=1;//はじめから
                                        }else if(start_cursor==1){
                                            load_gamen=1;//つづきから？
                                            start_cursor=0;
                                        }
                                    }else{
                                        save_point=start_cursor;
                                        if(start_cursor==0){
                                            start_gamen=1;//はじめから
                                        }else if(start_cursor==1){
                                            start_gamen=1;
                                            EXP=20;
                                            level_up();
                                            worp_load();//開始地点変更ワープ！
                                        }else if(start_cursor==2){
                                            start_gamen=1;
                                            EXP=140;
                                            flag=2;//トレンデイ撃破
                                            level_up();
                                            worp_load();//開始地点変更ワープ！
                                        }else if(start_cursor==3){
                                            start_gamen=1;
                                            EXP=990;
                                            flag=2;//トレンデイ撃破
                                            level_up();
                                            worp_load();//開始地点変更ワープ！
                                        }else if(start_cursor==4){
                                            start_gamen=1;
                                            EXP=9999999;
                                            vs_deyu=2;//deyu撃破
                                            level_up();
                                            worp_load();//開始地点変更ワープ！
                                        }
                                    }
                                    
                                }else if(key_input.charAt(i)=="×"){
                                    if(load_gamen==1){
                                        load_gamen=0;//ロード画面解除
                                        start_cursor=1;
                                    }
                                    
                                }
                            }
                            if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                key_input="";
                                key_interval=0;
                            }
                        }else if(key_interval>0){
                            key_interval=key_interval-1;//カウントダウン
                        }
                        kirakira_save_point();//セーブポイントじゃなくても光らせられらぁ！

                    }else{//--------------------------------------------------------------------------------------------------------


                        ctx.drawImage(map,-world_x,-world_y);//世界表示 壁は世界の色を参照するため、先に世界を表示しときます
                        if(flag<2){
                            ctx.drawImage(torendei_doa,torendei_x,torendei_y-37);//トレンデイ撃破後に消滅する壁
                        }
                        if(akareba==0){
                            ctx.drawImage(akareba_0,akareba_1_x,akareba_1_y);
                            ctx.drawImage(akareba_0,akareba_2_x,akareba_2_y);

                            ctx.drawImage(akablock_0,akablock_1_x,akablock_1_y);
                            ctx.drawImage(akablock_1,akablock_1_x+32,akablock_1_y+32);

                            ctx.drawImage(akablock_0,akablock_2_x,akablock_2_y);
                            ctx.drawImage(akablock_1,akablock_2_x+64,akablock_2_y);
                            ctx.drawImage(akablock_0,akablock_2_x+96,akablock_2_y);
                        }else{
                            ctx.drawImage(akareba_1,akareba_1_x,akareba_1_y);
                            ctx.drawImage(akareba_1,akareba_2_x,akareba_2_y);

                            ctx.drawImage(akablock_1,akablock_1_x,akablock_1_y);
                            ctx.drawImage(akablock_0,akablock_1_x+32,akablock_1_y+32);

                            ctx.drawImage(akablock_1,akablock_2_x,akablock_2_y);
                            ctx.drawImage(akablock_0,akablock_2_x+64,akablock_2_y);
                            ctx.drawImage(akablock_1,akablock_2_x+96,akablock_2_y);
                        }
                        if(aoreba==0){
                            ctx.drawImage(aoreba_0,aoreba_2_x,aoreba_2_y);

                            ctx.drawImage(aoblock_1,aoblock_2_x,aoblock_2_y);
                            ctx.drawImage(aoblock_0,aoblock_2_x+32,aoblock_2_y-32);
                            ctx.drawImage(aoblock_1,aoblock_2_x+96,aoblock_2_y-64);
                        }else{
                            ctx.drawImage(aoreba_1,aoreba_2_x,aoreba_2_y);

                            ctx.drawImage(aoblock_0,aoblock_2_x,aoblock_2_y);
                            ctx.drawImage(aoblock_1,aoblock_2_x+32,aoblock_2_y-32);
                            ctx.drawImage(aoblock_0,aoblock_2_x+96,aoblock_2_y-64);
                        }
                        if(vs_deyu<2){
                            ctx.drawImage(deyukabe,deyukabe_x,deyukabe_y);
                        }
                        

                        //しゅうくん移動。。
                        if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                            key_interval=10;//100/1000[s]の間、長押しでの連続入力を無効。
                            for(let i=0;i<key_input.length;i++){
                                if(key_input.charAt(i)=="↑"){
                                    idou(0,-32);
                                }else if(key_input.charAt(i)=="←"){
                                    idou(-32,0);
                                }else if(key_input.charAt(i)=="→"){
                                    idou(32,0);
                                }else if(key_input.charAt(i)=="↓"){
                                    idou(0,32);
                                }else if(key_input.charAt(i)=="〇"){
                                    var serihu_sakujo_yotei=[];
                                    for(let i=0;i<serihu.length;i++){//文章送り
                                        serihu[i].OK=serihu[i].OK+1;
                                        if((serihu[i].OK)*28>=serihu[i].hyouji_i){//OKしてももう文章ないよ 
                                            if(serihu[i].cursor==0){//選択肢がないセリフだよ
                                                serihu_sakujo_yotei[serihu_sakujo_yotei.length]=i;//消すね
                                            }else{//選択肢があるね！
                                                serihu.hyouji_i=serihu.hyouji_i-1;//セリフ消えちゃうから表示戻してね❤
                                                serihu[i].OK=serihu[i].OK-1;
                                                if(serihu[i].cursor==1){
                                                    serihu[i].cursor=2;//選択モードにしとくよ
                                                }
                                                if(serihu[i].cursor==2){}//無
                                                if(serihu[i].cursor==3){HP=HP_MAX;serihu_sakujo_yotei[serihu_sakujo_yotei.length]=i;}//回復用選択肢

                                                if(serihu[i].cursor==4){}//無
                                                if(serihu[i].cursor==5){akareba=(akareba+1)%2;serihu_sakujo_yotei[serihu_sakujo_yotei.length]=i;}//ON_OFF

                                                if(serihu[i].cursor==6){}//無
                                                if(serihu[i].cursor==7){aoreba=(aoreba+1)%2;serihu_sakujo_yotei[serihu_sakujo_yotei.length]=i;}//ON_OFF

                                                if(serihu[i].cursor==8){}//無
                                                if(serihu[i].cursor==9){
                                                    tweet_suruze=1;
                                                    if(tweet_suruze==1){
                                                        key_input="";
                                                        key_owarasete=1;
                                                        tweet_suruze=0;
                                                        var URL_tweet_text="https://twitter.com/intent/tweet?text=邪悪の根源を打ち倒し、ゲームクリアしました！%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Slide_Glitch_RPG";//%0Aで改行
                                                        window.open( URL_tweet_text, '_blank'); 
                                                    }
                                                    serihu_sakujo_yotei[serihu_sakujo_yotei.length]=i;
                                                }//ツイートだ！
                                            }
                                        }
                                    }
                                    for(let i=0;i<serihu_sakujo_yotei.length;i++){
                                        serihu.splice(serihu_sakujo_yotei[serihu_sakujo_yotei.length-i-1],1);//読み終わったセリフを後ろから除去していくね
                                    }

                                    if(GAMEOVER==0){//ゲームオーバーなのに戦闘するな
                                        for(let i=0;i<battle.length;i++){//自分のターン
                                            if(battle[i].hyouji<2){//死体蹴り禁止機能
                                                if(battle[i].cursor==0){
                                                    battle[i].HP=battle[i].HP-Attack;//攻撃！
                                                    battle[i].damaging=1;
                                                }else{
                                                    HP=HP+Math.floor(HP_MAX/3);//回復！
                                                    if(HP>HP_MAX){
                                                        HP=HP_MAX;//しすぎ！
                                                    }
                                                }
                                            }
                                        }
                                        if(vs_deyu==1){//ラスボス戦
                                            if(deyu_battle.hyouji<2){//死体蹴り禁止機能
                                                if(deyu_battle.cursor==0){
                                                    deyu_battle.HP=deyu_battle.HP-Attack;//攻撃！
                                                    deyu_battle.damaging=1;
                                                }else{
                                                    HP=HP+Math.floor(HP_MAX/3);//回復！
                                                    if(HP>HP_MAX){
                                                        HP=HP_MAX;//しすぎ！
                                                    }
                                                }
                                            }
                                        }
                                        for(let i=0;i<battle.length;i++){//相手のターン
                                            if(battle[i].hyouji<2){//死体を動かさない
                                                if(battle[i].HP<=0){
                                                    battle[i].hyouji=3;//死んでた
                                                    battle[i].HP=0;

                                                    EXP=EXP+battle[i].EXP;//経験値プレゼント！よろこべ
                                                    level_up();//レベルアップに喜べ！

                                                    if(battle[i].image[0]==torendei_0 && flag==1){//倒したのトレンデイやんけ！
                                                        flag=2;
                                                        torendei_x=torendei_x+2*32;
                                                    }
                                                    
                                                }else{
                                                    HP=HP-battle[i].Attack;//生きてる！痛い！
                                                    damaging=1;
                                                }
                                            }
                                        }
                                        if(vs_deyu==1){//ラスボス戦
                                            if(deyu_battle.hyouji<2){//死体を動かさない
                                                if(deyu_battle.HP<=0){
                                                    deyu_battle.hyouji=3;//死んでた
                                                    deyu_battle.HP=0;

                                                    EXP=EXP+999999;//経験値プレゼント！よろこべ
                                                    level_up();//レベルアップに喜べ！
                                                }else{
                                                    //生きてる！
                                                    HP=HP-Math.floor(deyu_battle.Attack/30);//生きてる！痛い！
                                                    deyu_battle.HP=deyu_battle.HP+deyu_battle.Attack;
                                                }
                                            }
                                        }
                                        if(HP<=0){//死んでしまうとは何事だ！
                                            HP=0;
                                            GAMEOVER=1;
                                            
                                        }
                                    }
                                    
                                }else if(key_input.charAt(i)=="×"){
                                    if((world_doko_x==4*170 && world_doko_y==1*170)){
                                        deyu_x=5+3*32;
                                        deyu_y=5+0*32;
                                    }
                                }
                            }
                            if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                key_input="";
                                key_interval=0;
                            }
                        }else if(key_interval>0){
                            key_interval=key_interval-1;//カウントダウン
                        }
                        

                        

                        //キャラ表示
                        ctx.drawImage(kanbansan,kanbansan_1_x,kanbansan_1_y);
                        ctx.drawImage(kanbansan,kanbansan_2_x,kanbansan_2_y);
                        ctx.drawImage(kanbansan,kanbansan_3_x,kanbansan_3_y);
                        ctx.drawImage(kanbansan,kanbansan_4_x,kanbansan_4_y);
                        ctx.drawImage(kanbansan,kanbansan_5_x,kanbansan_5_y);
                        ctx.drawImage(kanbansan,kanbansan_6_x,kanbansan_6_y);
                        if(vs_deyu>0){
                            ctx.drawImage(kanbansan,kanbansan_7_x,kanbansan_7_y);
                        }
                        
                        for (let i=0;i<5;i++){
                            ctx.drawImage(jirai,jirai_x+32*i,jirai_y);
                            ctx.drawImage(jirai,jirai_x+32*i,jirai_y+2*32);
                        }
                        var lite_time=Math.floor(loop_count/25);
                        var lite_img;
                        if(lite_time==0){
                            lite_img=lite_0;
                        }else if(lite_time==1){
                            lite_img=lite_1;
                        }else if(lite_time==2){
                            lite_img=lite_2;
                        }else if(lite_time==3){
                            lite_img=lite_3;
                        }
                        for (let l=0;l<3;l++){
                            for (let j=0;j<2;j++){
                                for (let i=0;i<5;i++){
                                    ctx.drawImage(lite_img,lite_x+j*128,lite_y+i*32+170*l);
                                }
                            }
                        }
                        var tekuteku;//しゅうくんを歩かせるのに使うよ！
                        if(Math.floor(loop_count/50)==0){//しゅうくん以外が歩くよ
                            if(serihu.length==0 && battle.length==0){//ウィンドウが出てるときはしゅうくんがslide_glitch状態にから歩きを停止する
                                tekuteku=0;
                            }
                            
                            ctx.drawImage(pon_0,pon_x,pon_y);
                            ctx.drawImage(pon_0,yadoya_x,yadoya_y);
                            ctx.drawImage(pon_0,mori_pon_x,mori_pon_y);
                            ctx.drawImage(pon_0,owapon_x,owapon_y);
                            ctx.drawImage(pon_0,uketuke_x,uketuke_y);
                            ctx.drawImage(zakozakosan_0,zakozakosan_x,zakozakosan_y);
                            ctx.drawImage(moetti_0,moetti_x,moetti_y);
                            ctx.drawImage(save_0,save_1_x,save_1_y);
                            ctx.drawImage(save_0,save_2_x,save_2_y);
                            ctx.drawImage(save_0,save_3_x,save_3_y);
                            ctx.drawImage(habanero_0,habanero_1_x,habanero_1_y);
                            ctx.drawImage(habanero_0,habanero_2_x,habanero_2_y);
                            ctx.drawImage(kusokinoko_0,kusokinoko_1_x,kusokinoko_1_y);
                            ctx.drawImage(kusokinoko_0,kusokinoko_2_x,kusokinoko_2_y);
                            ctx.drawImage(torendei_0,torendei_x,torendei_y);
                            ctx.drawImage(goninsyuu_0,goninsyuu_x,goninsyuu_y);

                            ctx.drawImage(zakozakosan_0,vs_goninsyuu_x,vs_goninsyuu_y);
                            ctx.drawImage(zakozakosan_0,vs_goninsyuu_x-32,vs_goninsyuu_y);
                            ctx.drawImage(zakozakosan_0,vs_goninsyuu_x+32,vs_goninsyuu_y);
                            ctx.drawImage(zakozakosan_0,vs_goninsyuu_x,vs_goninsyuu_y+32);
                            ctx.drawImage(zakozakosan_0,vs_goninsyuu_x,vs_goninsyuu_y+64);

                            ctx.drawImage(zakozakosan_0,pazupazusan_x,pazupazusan_y);
                            ctx.drawImage(deyu32_0,deyu32_x,deyu32_y);

                            ctx.drawImage(kusotori,kusotori_x,kusotori_y);
                        }else{
                            if(serihu.length==0 &&  battle.length==0){//ウィンドウが出てるときはしゅうくんがslide_glitch状態にから歩きを停止する
                                tekuteku=1;
                            }
                            ctx.drawImage(pon_1,pon_x,pon_y);
                            ctx.drawImage(pon_1,yadoya_x,yadoya_y);
                            ctx.drawImage(pon_1,mori_pon_x,mori_pon_y);
                            ctx.drawImage(pon_1,owapon_x,owapon_y);
                            ctx.drawImage(pon_1,uketuke_x,uketuke_y);
                            ctx.drawImage(zakozakosan_1,zakozakosan_x,zakozakosan_y);
                            ctx.drawImage(moetti_1,moetti_x,moetti_y);
                            ctx.drawImage(save_1,save_1_x,save_1_y);
                            ctx.drawImage(save_1,save_2_x,save_2_y);
                            ctx.drawImage(save_1,save_3_x,save_3_y);
                            ctx.drawImage(habanero_1,habanero_1_x,habanero_1_y);
                            ctx.drawImage(habanero_1,habanero_2_x,habanero_2_y);
                            ctx.drawImage(kusokinoko_1,kusokinoko_1_x,kusokinoko_1_y);
                            ctx.drawImage(kusokinoko_1,kusokinoko_2_x,kusokinoko_2_y);
                            ctx.drawImage(torendei_1,torendei_x,torendei_y);
                            ctx.drawImage(goninsyuu_1,goninsyuu_x,goninsyuu_y);

                            ctx.drawImage(zakozakosan_1,vs_goninsyuu_x,vs_goninsyuu_y);
                            ctx.drawImage(zakozakosan_1,vs_goninsyuu_x-32,vs_goninsyuu_y);
                            ctx.drawImage(zakozakosan_1,vs_goninsyuu_x+32,vs_goninsyuu_y);
                            ctx.drawImage(zakozakosan_1,vs_goninsyuu_x,vs_goninsyuu_y+32);
                            ctx.drawImage(zakozakosan_1,vs_goninsyuu_x,vs_goninsyuu_y+64);

                            ctx.drawImage(zakozakosan_1,pazupazusan_x,pazupazusan_y);
                            ctx.drawImage(deyu32_1,deyu32_x,deyu32_y);
                        }
                        
                        if(tekuteku==0){//しゅうくんがあるくよ！ 
                            ctx.drawImage(syuukun_0,deyu_x,deyu_y);
                        }else{
                            ctx.drawImage(syuukun_1,deyu_x,deyu_y);
                        }

                        if(loop_count==0 ||loop_count ==50){
                            for(let i=0;i<battle.length;i++){//バトルウィンドウの敵を歩かせたい
                                if(battle[i].hyouji==0){
                                    battle[i].hyouji=1;
                                }else if(battle[i].hyouji==1){
                                    battle[i].hyouji=0;
                                }
                                
                            }
                            if(vs_deyu==1 &&  deyu_battle.hyouji<2){
                                deyu_battle.hyouji=(deyu_battle.hyouji+1)%2;
                            }

                            var rand_x = (Math.floor(Math.random()*3)-1)*32;//ランダムウォーク
                            var rand_y = (Math.floor(Math.random()*3)-1)*32;
                            var moved=0;
                            if(!((moetti_x+rand_x)%170==165 ||(moetti_x+rand_x)%170==143 || moetti_x+rand_x<5)&& loop_count==0){
                                moetti_x=moetti_x+rand_x;
                                if(rand_x!=0){
                                    moved=1;
                                }
                            }
                            if(!((moetti_y+rand_y)%170==165 ||(moetti_y+rand_y)%170==143 || moetti_y+rand_y<5)&& loop_count==50){
                                moetti_y=moetti_y+rand_y;
                                if(rand_y!=0){
                                    moved=1;
                                }
                            }
                            if(moved==1 && deyu_x==moetti_x && deyu_y==moetti_y){
                                moved=0;
                                battle[battle.length]={image:[moetti_0,moetti_1],HP_MAX:2,HP:2,Attack:2,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:2,damaging:0};
                            }
                        }

                        if((world_doko_x==1*170 && world_doko_y==3*170)||(world_doko_x==2*170 && world_doko_y==0*170)||(world_doko_x==3*170 && world_doko_y==1*170)){
                            kirakira_save_point();//虹色に光輝くセーブポイントに震えろ
                        }
                        

                        if(damaging>0){
                            ctx.drawImage(damage,deyu_x,deyu_y);
                            damaging=damaging+1;
                            if(damaging==10){
                                damaging=0;
                            }
                        }

                        //ウィンドウ表示
                        for(let i=0;i<serihu.length;i++){
                            serihu_window();
                            serihu_dadada(serihu[i]);
                        }
                        for(let i=0;i<battle.length;i++){
                            battle_window();
                            battle_show(battle[i]);

                            var teki_sakujo_yotei=[];
                            for(let i=0;i<battle.length;i++){//死亡判定
                                if(battle[i].hyouji==100){//死亡演出終わった？
                                    teki_sakujo_yotei[teki_sakujo_yotei.length]=i;//消すね
                                }
                            }
                            for(let i=0;i<teki_sakujo_yotei.length;i++){
                                battle.splice(teki_sakujo_yotei[teki_sakujo_yotei.length-i-1],1);//死亡した敵を後ろから除去していくね
                            }
                        }
                        if(vs_deyu==1){
                            deyu_battle_show() ;
                        }
                        ctx.drawImage(map_2,-world_x,-world_y);//世界表示2

                        if(GAMEOVER>0 && GAMEOVER<100){
                            GAMEOVER=GAMEOVER+1;
                            ctx.fillStyle="rgb(255,0,0,0.5)";
                            ctx.fillRect(0,0,170,170);
                            ctx.font = "20px 'ＭＳ Ｐゴシック'";//font size
                            ctx.fillStyle="#FFFFFF";
                            ctx.fillText("GAMEOVER", 35, 120);
                            ctx.font = "10px 'ＭＳ Ｐゴシック'";//font size
                            
                        }else if(GAMEOVER>=100){
                            if(flag==1){//トレンデイに敗北…
                                flag=0;
                            }
                            if(vs_deyu==1){//でゆっちに負け！
                                vs_deyu=0;
                                save_point=4;
                            }
                            HP=HP_MAX;
                            GAMEOVER=0;
                            battle=[];
                            worp_load();
                        }
                        
                        //しゅうくんステータス
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(135,1,34,7);
                        ctx.fillRect(118,0,16,9);
                        ctx.fillRect(0,0,26,9);
                        ctx.fillStyle="rgb(255,0,0)";
                        ctx.fillRect(136,2,32,5);
                        ctx.fillStyle="rgb(0,255,0)";
                        ctx.fillRect(136,2,Math.floor(32*HP/HP_MAX),5);
                        ctx.fillText("HP", 136-16, 8);
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillText("Lv: "+Level, 1, 8);
                    }

                }, 10);//10/1000[s]でくりかえすぞ！
            }//ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－ここまでonloadー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－
            function worp_load(){
                world_doko_x=0;
                world_doko_y=0;
                set_iti();
                if(save_point==1){
                    world_slide(1*170,3*170);
                    deyu_x=5+2*32;
                    deyu_y=5+3*32;
                }else if(save_point==2){
                    world_slide(2*170,0*170);
                    deyu_x=5+2*32;
                    deyu_y=5+3*32;
                }else if(save_point==3){
                    world_slide(3*170,1*170);
                    deyu_x=5+4*32;
                    deyu_y=5+3*32;
                }else if(save_point==4){
                    world_slide(3*170,4*170);
                    deyu_x=5+2*32;
                    deyu_y=5+3*32;
                }
            }
            function level_up(){
                while(EXP>9){
                    Level=Level+1;                       
                    EXP=EXP-10;
                    HP=HP+3;
                    HP_MAX=HP_MAX+3;
                    Attack=Attack+1;
                }
            }

            function idou(dx,dy){//移動時に呼ばれる
                if(dy!=0){
                    for(let i=0;i<battle.length;i++){//戦闘コマンド選択
                        if(battle[i].cursor==0){
                            battle[i].cursor=1;
                        }else if(battle[i].cursor==1){
                            battle[i].cursor=0;
                        }  
                    }
                    if(vs_deyu==1){
                        deyu_battle.cursor=(deyu_battle.cursor+1)%2;
                    }
                }
                if(dx!=0){
                    for(let i=0;i<serihu.length;i++){//会話コマンド選択
                        if(serihu[i].cursor==2){
                            serihu[i].cursor=3;
                        }else if(serihu[i].cursor==3){
                            serihu[i].cursor=2;
                        }
                        if(serihu[i].cursor==4){
                            serihu[i].cursor=5;
                        }else if(serihu[i].cursor==5){
                            serihu[i].cursor=4;
                        } 
                        if(serihu[i].cursor==7){
                            serihu[i].cursor=6;
                        }else if(serihu[i].cursor==6){
                            serihu[i].cursor=7;
                        }
                        if(serihu[i].cursor==8){
                            serihu[i].cursor=9;
                        }else if(serihu[i].cursor==9){
                            serihu[i].cursor=8;
                        }        
                    }
                }
                //移動可能かを調べる
                var idou_iro;
                if(dx>0){
                    idou_iro=ctx.getImageData(deyu_x+dx,deyu_y,1,1);//移動先の画像を1ピクセル取得
                }else{
                    idou_iro=ctx.getImageData(deyu_x-1,deyu_y,1,1);//移動先の画像を1ピクセル取得
                }
                dx=dx*idou_OK(idou_iro.data);//移動不可なら0にする
                if(dy>0){
                    idou_iro=ctx.getImageData(deyu_x,deyu_y+dy,1,1);//移動先の画像を1ピクセル取得
                }else{
                    idou_iro=ctx.getImageData(deyu_x,deyu_y-1,1,1);//移動先の画像を1ピクセル取得
                }
                dy=dy*idou_OK(idou_iro.data);//移動不可なら0にする
                
                
                deyu_x=deyu_x+dx;
                deyu_y=deyu_y+dy;

                var world_dx=0;
                var world_dy=0;
                if(deyu_x>=165){//右端 5 6 7 8 9
                    deyu_x=5;
                    world_dx=170;

                }else if(deyu_x<=4){//左端 0 1 2 3 4
                    deyu_x=133;
                    world_dx=-170;
                }
                if(deyu_y>=165){//下端 5 6 7 8 9
                    deyu_y=5;
                    world_dy=170;
                }else if(deyu_y<=4){//上端 0 1 2 3 4
                    deyu_y=133;
                    world_dy=-170;
                }
                if(world_dx!=0 || world_dy!=0){
                    world_slide(world_dx,world_dy);
                }
                
                if(dx!=0 || dy!=0){
                    serihu_tuika();
                    teki_tuika();
                }
                

            }

            function idou_OK(iro_data){
                if(iro_data[0]==78 && iro_data[1]==168 && iro_data[2]== 0){//濃い緑
                }else if(iro_data[0]==86 && iro_data[1]==159 && iro_data[2]== 24){//灰濃い緑
                }else if(iro_data[0]==105 && iro_data[1]==76 && iro_data[2]== 47){//茶色
                }else if(iro_data[0]==108 && iro_data[1]==85 && iro_data[2]== 61){//灰茶色
                }else if(iro_data[0]==83 && iro_data[1]==83 && iro_data[2]== 83){//灰色
                }else if(iro_data[0]==90 && iro_data[1]==90 && iro_data[2]== 90){//灰色２
                }else if(iro_data[0]==200 && iro_data[1]==0 && iro_data[2]== 0){//赤ブロック
                }else if(iro_data[0]==0 && iro_data[1]==0 && iro_data[2]== 200){//青ブロック
                }else if(iro_data[0]==255 && iro_data[1]==255 && iro_data[2]== 255){//白
                }else{//ヨシ！
                    return 1;
                }
                return 0;
            }
            
            function serihu_window(){
                ctx.fillStyle="rgb(200,0,255,0.1)";
                ctx.fillRect(10,124,150,36);
                ctx.fillStyle="#FFFFFF";
                ctx.fillRect(11,125,1,34);
                ctx.fillRect(158,125,1,34);
                ctx.fillRect(11,125,148,1);
                ctx.fillRect(11,158,148,1);
            }
            function serihu_dadada(serihu){
                for(let i=0;i<2;i++){//何回か書いて濃くします…
                    if(serihu.hyouji_i<14+28*serihu.OK){//一行目表示（1文字ずつ増える）
                        ctx.fillText(serihu.text.slice(0+28*serihu.OK,serihu.hyouji_i), 15, 138);
                    }else{//一行目をいっぱい表示した
                        ctx.fillText(serihu.text.slice(0+28*serihu.OK,14+28*serihu.OK), 15, 138);
                    }
                    if(serihu.hyouji_i<28+28*serihu.OK){//二行目表示（1文字ずつ増える）
                        ctx.fillText(serihu.text.slice(14+28*serihu.OK,serihu.hyouji_i), 15, 150);
                    }else{//二行目をいっぱい表示した
                        ctx.fillText(serihu.text.slice(14+28*serihu.OK,28+28*serihu.OK), 15, 150);
                }
                }
                if(serihu.cursor==2 || serihu.cursor==3){
                    ctx.fillStyle="rgb(100,50,0,0.1)";
                    ctx.fillRect(10,114,70,10);
                    ctx.fillStyle="#FFFFFF";
                    ctx.fillRect(10,114,1,12);
                    ctx.fillRect(80,114,1,12);
                    ctx.fillRect(10,114,70,1);
                    ctx.fillText("悩む", 20, 124);
                    ctx.fillText("泊まる", 50, 124);
                    if(serihu.cursor==2){
                        ctx.fillText("▶", 14, 124);
                    }else{
                        ctx.fillText("▶", 44, 124);
                    }

                }else if(serihu.hyouji_i<(serihu.OK+1)*28 || serihu.hyouji_i<serihu.text.length){//文字がウィンドウいっぱい表示されてない or セリフが全部表示されてない
                    serihu.hyouji_i=serihu.hyouji_i+1;//表示文字増やす //OKボタン押したら+1して続きの文字を押す、というのがいい感じだよね。そう思うよ。俺は
                }else if(serihu.cursor==4 || serihu.cursor==5){
                    ctx.fillStyle="rgb(100,50,0,0.1)";
                    ctx.fillRect(10,114,70,10);
                    ctx.fillStyle="#FFFFFF";
                    ctx.fillRect(10,114,1,12);
                    ctx.fillRect(80,114,1,12);
                    ctx.fillRect(10,114,70,1);
                    ctx.fillText("悩む", 20, 124);
                    ctx.fillText("切替る", 50, 124);
                    if(serihu.cursor==4){
                        ctx.fillText("▶", 14, 124);
                    }else{
                        ctx.fillText("▶", 44, 124);
                    }
                }else if(serihu.cursor==6 || serihu.cursor==7){
                    ctx.fillStyle="rgb(100,50,0,0.1)";
                    ctx.fillRect(10,114,70,10);
                    ctx.fillStyle="#FFFFFF";
                    ctx.fillRect(10,114,1,12);
                    ctx.fillRect(80,114,1,12);
                    ctx.fillRect(10,114,70,1);
                    ctx.fillText("悩む", 20, 124);
                    ctx.fillText("切替る", 50, 124);
                    if(serihu.cursor==6){
                        ctx.fillText("▶", 14, 124);
                    }else{
                        ctx.fillText("▶", 44, 124);
                    }
                }else if(serihu.cursor==8 || serihu.cursor==9){
                    ctx.fillStyle="rgb(100,50,0,0.1)";
                    ctx.fillRect(10,114,70,10);
                    ctx.fillStyle="#FFFFFF";
                    ctx.fillRect(10,114,1,12);
                    ctx.fillRect(80,114,1,12);
                    ctx.fillRect(10,114,70,1);
                    ctx.fillText("悩む", 20, 124);
                    ctx.fillText("ツイる", 50, 124);
                    if(serihu.cursor==8){
                        ctx.fillText("▶", 14, 124);
                    }else{
                        ctx.fillText("▶", 44, 124);
                    }
                }
            }

            function serihu_tuika(){
                if(deyu_x==pon_x && deyu_y==pon_y){
                    serihu[serihu.length]={text:"スライドグリッチという、話してても戦ってても動けるバグがあるみたいです。",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==kanbansan_1_x && deyu_y==kanbansan_1_y){
                    serihu[serihu.length]={text:"〇ボタンかEnterで会話ができるぜ！",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==kanbansan_2_x && deyu_y==kanbansan_2_y){
                    serihu[serihu.length]={text:"ダメージは攻撃力と同じで、攻撃力はレベルと同じらしいぜ。",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==kanbansan_3_x && deyu_y==kanbansan_3_y){
                    serihu[serihu.length]={text:"地雷は体力の50%+1のダメージだ！無理ゲーだな！",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==kanbansan_4_x && deyu_y==kanbansan_4_y){
                    serihu[serihu.length]={text:"しゅうくんの攻撃力はレベルと同じなんだ！だから一撃で倒すにはそれだけレベルが必要なんだ！",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==kanbansan_5_x && deyu_y==kanbansan_5_y){
                    serihu[serihu.length]={text:"知ってるかい？このゲームは長押しすると連打になるんだ。",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==kanbansan_6_x && deyu_y==kanbansan_6_y){
                    serihu[serihu.length]={text:"見よ！この光り輝く「！」を！これがエリート看板だ！",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==kanbansan_7_x && deyu_y==kanbansan_7_y){
                    if(vs_deyu==1){
                        serihu[serihu.length]={text:"ヒントだ！ラスボスは戦闘開始時にこちらの攻撃力+100の回復力に設定されるぜ！",hyouji_i:0,OK:0,cursor:0};
                    }else if(vs_deyu>1){
                        serihu[serihu.length]={text:"俺のヒントは役立ったかい？",hyouji_i:0,OK:0,cursor:0};
                    }
                    
                }
                if(deyu_x==(yadoya_x-32) && deyu_y==yadoya_y){
                    serihu[serihu.length]={text:"泊まります？",hyouji_i:0,OK:0,cursor:1};
                }
                if(deyu_x==mori_pon_x && deyu_y==mori_pon_y){
                    serihu[serihu.length]={text:"こういうなんもないエリアがあってもいいのです。",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==vs_goninsyuu_x && deyu_y==vs_goninsyuu_y){
                    serihu[serihu.length]={text:"フォーメーションTだ！むかいうて！",hyouji_i:0,OK:0,cursor:0};
                }
                if(((deyu_x==vs_goninsyuu_x-32 || deyu_x==vs_goninsyuu_x+32) && deyu_y==vs_goninsyuu_y)||(deyu_x==vs_goninsyuu_x && (deyu_y==vs_goninsyuu_y+32|| deyu_y==vs_goninsyuu_y+64))){
                    serihu[serihu.length]={text:"うおー",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==uketuke_x && deyu_y==uketuke_y+32){
                    serihu[serihu.length]={text:"パズルは好きですか？嫌いならタイトルから先のエリアをロードしちゃえばいいと思いますよ。",hyouji_i:0,OK:0,cursor:0};
                }
                for (let i=0;i<5;i++){
                    if(deyu_x==jirai_x+32*i && (deyu_y==jirai_y || deyu_y== jirai_y+2*32)){//地雷が10個もあるのでループで判定
                        serihu[serihu.length]={text:"地雷！？50%ダメージを受けた！",hyouji_i:0,OK:0,cursor:0};
                        damaging=1;
                        HP=HP-Math.floor(HP_MAX/2+1);
                        if(HP<=0){//死んでしまうとは何事だ！
                            HP=0;
                            GAMEOVER=1;
                        }
                    }
                }
                if(deyu_x==save_1_x&&deyu_y==save_1_y){
                    serihu[serihu.length]={text:"回復しちゃうよ！",hyouji_i:0,OK:0,cursor:0};
                    HP=HP_MAX;
                    if(GAMEOVER==0){
                        save_point=1;
                    }
                }
                if(deyu_x==save_2_x&&deyu_y==save_2_y){
                    serihu[serihu.length]={text:"回復しちゃうよ！",hyouji_i:0,OK:0,cursor:0};
                    HP=HP_MAX;
                    if(GAMEOVER==0){
                        save_point=2;
                    }
                }
                if(deyu_x==save_3_x&&deyu_y==save_3_y){
                    serihu[serihu.length]={text:"回復しちゃうよ！",hyouji_i:0,OK:0,cursor:0};
                    HP=HP_MAX;
                    if(GAMEOVER==0){
                        save_point=3;
                    }
                }
                if((deyu_x==akareba_1_x && deyu_y==akareba_1_y)||(deyu_x==akareba_2_x && deyu_y==akareba_2_y)){
                    serihu[serihu.length]={text:"赤スイッチを切り替える？",hyouji_i:0,OK:0,cursor:4};
                }
                if((deyu_x==aoreba_2_x && deyu_y==aoreba_2_y)){
                    serihu[serihu.length]={text:"青スイッチを切り替える？",hyouji_i:0,OK:0,cursor:6};
                }
                if(deyu_x==pazupazusan_x && deyu_y==pazupazusan_y){
                    serihu[serihu.length]={text:"きみはパズル解けた？ぼくは全然だめだったよ><",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==deyu32_x&&deyu_y==deyu32_y&&vs_deyu>1){
                    serihu[serihu.length]={text:"ぐえー",hyouji_i:0,OK:0,cursor:0};
                }
                if((deyu_x==kusotori_x&& deyu_y==kusotori_y)){
                    serihu[serihu.length]={text:"ツイートする？",hyouji_i:0,OK:0,cursor:8};
                }
            }

            function battle_window(){
                ctx.fillStyle="rgb(200,0,255,0.1)";
                ctx.fillRect(10,19,150,100);
                ctx.fillStyle="#FFFFFF";
                ctx.fillRect(11,20,1,40);
                ctx.fillRect(59,20,1,40);
                ctx.fillRect(11,20,49,1);
                ctx.fillRect(11,60,49,1);
                ctx.fillText("たたかう", 20, 35);
                ctx.fillText("1/3 回復", 21, 55);

                ctx.fillRect(61,20,1,43);
                ctx.fillRect(158,20,1,98);
                ctx.fillRect(61,20,97,1);
                ctx.fillRect(11,117,148,1);
                ctx.fillRect(11,62,50,1);
                ctx.fillRect(11,62,1,56);
            }
            
            function battle_show(battle){
                ctx.fillText("▶", 12, 35+battle.cursor*20);
                if(battle.hyouji<2){
                    ctx.drawImage(battle.image[battle.hyouji],battle.x,80);
                }else if(battle.hyouji<100){
                    ctx.drawImage(battle.image[0],battle.x,80+0.1*(battle.hyouji*battle.hyouji-50*battle.hyouji+98));
                    ctx.drawImage(DEATH,battle.x,80);
                    battle.hyouji=battle.hyouji+1;
                }else{
                    //死、完了！
                }
                if(battle.damaging>0){
                    battle.damaging=battle.damaging+1;
                    ctx.drawImage(damage,battle.x,80);
                    if(battle.damaging==10){
                        battle.damaging=0;
                    }
                }
                
                ctx.fillStyle="rgb(255,0,0)";
                ctx.fillRect(battle.x,74,32,5);
                ctx.fillStyle="rgb(0,255,0)";
                ctx.fillRect(battle.x,74,Math.floor(32*battle.HP/battle.HP_MAX),5);
            }
            function deyu_battle_show(){
                ctx.fillStyle="rgb(200,0,255,0.1)";
                ctx.fillRect(10,19,150,100);
                ctx.fillStyle="#FFFFFF";
                ctx.fillRect(11,20,1,40);
                ctx.fillRect(59,20,1,40);
                ctx.fillRect(11,20,49,1);
                ctx.fillRect(11,60,49,1);
                ctx.fillText("たたかう", 20, 35);
                ctx.fillText("1/3 回復", 21, 55);

                ctx.fillRect(61,20,1,43);
                ctx.fillRect(158,20,1,98);
                ctx.fillRect(61,20,97,1);
                ctx.fillRect(11,117,148,1);
                ctx.fillRect(11,62,50,1);
                ctx.fillRect(11,62,1,56);

                ctx.fillText("▶", 12, 35+deyu_battle.cursor*20);
                if(deyu_battle.hyouji<2){
                    ctx.drawImage(deyu_battle.image[deyu_battle.hyouji],deyu_battle.x,48);
                }else if(deyu_battle.hyouji<100){
                    ctx.drawImage(deyu_battle.image[0],deyu_battle.x,48+0.1*(deyu_battle.hyouji*deyu_battle.hyouji-50*deyu_battle.hyouji+98));
                    ctx.drawImage(DEATH,deyu_battle.x,80);
                    deyu_battle.hyouji=deyu_battle.hyouji+1;
                }else{
                    vs_deyu=2;//エンディングだ～！
                    save_point=4;
                    worp_load();//ワープ！
                    //死、完了！
                }
                if(deyu_battle.damaging>0){
                    deyu_battle.damaging=deyu_battle.damaging+1;
                    ctx.drawImage(damage,deyu_battle.x+16,64);
                    if(deyu_battle.damaging==10){
                        deyu_battle.damaging=0;
                    }
                }
                ctx.fillStyle="rgb(0,0,0)";
                ctx.fillRect(deyu_battle.x-2,50,36,9);
                ctx.fillStyle="rgb(255,255,255)";
                ctx.fillRect(deyu_battle.x-1,51,34,7);
                ctx.fillStyle="rgb(255,0,0)";
                ctx.fillRect(deyu_battle.x,52,32,5);
                ctx.fillStyle="rgb(0,255,0)";
                ctx.fillRect(deyu_battle.x,52,Math.floor(32*deyu_battle.HP/deyu_battle.HP_MAX),5);
            }
            function teki_tuika(){
                if(deyu_x==zakozakosan_x && deyu_y==zakozakosan_y){
                    battle[battle.length]={image:[zakozakosan_0,zakozakosan_1],HP_MAX:3,HP:3,Attack:1,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:1,damaging:0};
                    serihu[serihu.length]={text:"ざこざこさんだ！HP:3 AT:1 EXP:1",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==moetti_x && deyu_y==moetti_y){
                    battle[battle.length]={image:[moetti_0,moetti_1],HP_MAX:2,HP:2,Attack:2,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:2,damaging:0};
                    serihu[serihu.length]={text:"もえっちだ！HP:2 AT:2 EXP:2",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==habanero_1_x && deyu_y==habanero_1_y){
                    battle[battle.length]={image:[habanero_0,habanero_1],HP_MAX:5,HP:5,Attack:9,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:5,damaging:0};
                    serihu[serihu.length]={text:"なげきハバネロだ！HP:5 AT:9 EXP:5",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==habanero_2_x && deyu_y==habanero_2_y){
                    battle[battle.length]={image:[habanero_0,habanero_1],HP_MAX:5,HP:5,Attack:9,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:5,damaging:0};
                    serihu[serihu.length]={text:"なげきハバネロだ！HP:5 AT:9 EXP:5",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==kusokinoko_1_x && deyu_y==kusokinoko_1_y){
                    battle[battle.length]={image:[kusokinoko_0,kusokinoko_1],HP_MAX:30,HP:30,Attack:1,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:10,damaging:0};
                    serihu[serihu.length]={text:"耐久キノコだ！HP:30 AT:1 EXP:10",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==kusokinoko_2_x && deyu_y==kusokinoko_2_y){
                    battle[battle.length]={image:[kusokinoko_0,kusokinoko_1],HP_MAX:30,HP:30,Attack:1,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:10,damaging:0};
                    serihu[serihu.length]={text:"耐久キノコだ！HP:30 AT:1 EXP:10",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==torendei_x && deyu_y==torendei_y){
                    if(flag==0){
                        battle[battle.length]={image:[torendei_0,torendei_1],HP_MAX:1000,HP:1000,Attack:1,x:70,hyouji:0,cursor:0,EXP:100,damaging:0};
                        serihu[serihu.length]={text:"トレンデイだ！HP:1000 AT:1 EXP:100",hyouji_i:0,OK:0,cursor:0};
                        flag=1;
                    }else if(flag>1){
                        serihu[serihu.length]={text:"トホホ、もう戦わないよ",hyouji_i:0,OK:0,cursor:0};
                    }
                }
                if(deyu_x==goninsyuu_x && deyu_y==goninsyuu_y){
                    battle[battle.length]={image:[goninsyuu_0,goninsyuu_1],HP_MAX:50,HP:50,Attack:5,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:30,damaging:0};
                    battle[battle.length]={image:[goninsyuu_0,goninsyuu_1],HP_MAX:50,HP:50,Attack:5,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:30,damaging:0};
                    battle[battle.length]={image:[goninsyuu_0,goninsyuu_1],HP_MAX:50,HP:50,Attack:5,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:30,damaging:0};
                    battle[battle.length]={image:[goninsyuu_0,goninsyuu_1],HP_MAX:50,HP:50,Attack:5,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:30,damaging:0};
                    battle[battle.length]={image:[goninsyuu_0,goninsyuu_1],HP_MAX:50,HP:50,Attack:5,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:30,damaging:0};
                    serihu[serihu.length]={text:"影の五人衆だ！×5　HP:50 AT:5 EXP:30",hyouji_i:0,OK:0,cursor:0};
                }
                if(deyu_x==deyu32_x && deyu_y==deyu32_y && vs_deyu==0){
                    battle[battle.length]={image:[deyuhando_0,deyuhando_0],HP_MAX:3000,HP:3000,Attack:10,x:120,hyouji:0,cursor:0,EXP:0,damaging:0};
                    battle[battle.length]={image:[deyuhando_1,deyuhando_1],HP_MAX:3000,HP:3000,Attack:10,x:15,hyouji:0,cursor:0,EXP:0,damaging:0};
                    deyu_battle={image:[deyu64_0,deyu64_1],HP_MAX:3000+Level,HP:3000+Level,Attack:Level+100,x:53,hyouji:0,cursor:0,EXP:0,damaging:0};
                    serihu[serihu.length]={text:"JUN汁ｗがいぢわるしてくる HP,AT,EXP: ?",hyouji_i:0,OK:0,cursor:0};
                    vs_deyu=1;
                }
                if(deyu_x==owapon_x && deyu_y==owapon_y){
                    battle[battle.length]={image:[pon_0,pon_1],HP_MAX:9999999,HP:9999999,Attack:9999999,x:Math.floor(Math.random()*(115)+12),hyouji:0,cursor:0,EXP:9999999,damaging:0};
                    serihu[serihu.length]={text:"部屋一個余っちゃいました（笑）  HP:9999999 AT:9999999",hyouji_i:0,OK:0,cursor:0};
                }
            }

            function kirakira_save_point(){
                var rgb=[];
                var color_loop_time=0;
                var color_loop_y=0;
                var color_loop_y_2=1;
                kirakira_save_point=function(){//初期化処理をしたあとに関数を再定義することで初期化を一度だけ行うらしいっす！
                    color_loop_time=color_loop_time+1;
                    if(color_loop_time>200){color_loop_time=0;}
                    imageData= ctx.getImageData(0,0,170,170);//キャンバスの色全部とる
                    for (let index_x = 0; index_x < 170; index_x++) {//これxとyの順番あってるの？笑
                        color_loop_y=60;//強引に横の色を合わせる
                        for (let index_y = 0; index_y < 170; index_y++) {
                            color_loop_y=color_loop_y+color_loop_y_2;
                            if(color_loop_y<1){
                                color_loop_y_2=1;
                            }else if(color_loop_y>60){
                                color_loop_y_2=-1;
                            }
                            if(imageData.data[4*(index_y*170+index_x)]==255 && imageData.data[4*(index_y*170+index_x)+1]==0 && imageData.data[4*(index_y*170+index_x)+2]==0){
                                //#FF0000
                                var h=((color_loop_y)/60*(Math.cos(Math.PI*(index_x-85)/85*2)/2+0.5)-color_loop_time/200)*6*2;//HSV空間のH、みたいな。6個に分けやすくする
                                if(h>6){h=h-6;}
                                if(h<0){h=h+6;}
                                if(h<0){h=h+6;}
                                var i= parseInt(h);//6等分した段階で整数に
                                var hi=(h-i)%6;
                                var v1 = 255 * (hi);
                                var v2 = 255 * (1-hi);
                                switch(i){
                                    case 0: rgb = [ 255, v1, 0 ]; break;
                                    case 6: rgb = [ 255, v1, 0 ]; break;
                                    case 1: rgb = [ v2, 255, 0 ]; break;
                                    case 2: rgb = [ 0, 255, v1 ]; break;
                                    case 3: rgb = [ 0, v2, 255 ]; break;
                                    case 4: rgb = [ v1, 0, 255 ]; break;
                                    case 5: rgb = [ 255, 0, v2 ]; break;
                                }
                                imageData.data[4*(index_y*170+index_x)]=rgb[0];
                                imageData.data[4*(index_y*170+index_x)+1]=rgb[1];
                                imageData.data[4*(index_y*170+index_x)+2]=rgb[2];
                                    
                            }
                        }
                    }
                    ctx.putImageData(imageData, 0, 0);
                }
            }
        </script>
    </head>
    <body>
        <div id="top"></div>
        <header id="header">
            <button onclick="html_link_btn()" id="html_link_btn"></button>
            <nav id="html_link_nav">
                <ul id="html_link_ul"></ul>
            </nav>
            <a href="../index.html">
                <img id="go_home" src="../images/site/omotyabako_deka.png" alt="トップページへ" height="1px"><!--ここで高さを入れておかないと、クソでかい画像が一瞬読み込まれてボタンの大きさが暴走する-->
            </a>
            <h1 id="title_h1">
                JUN汁ｗおもちゃばこ。
            </h1>
        </header>

        <div id="mannaka">
            <h2>すらいどぐりっちしゅうくんRPG</h2>
            <p>
                キーボード    移動:WASD,↑←→↓,KHLJ    〇:Enter, ×:Shift
            </p> 
            <div id="parent_div">
                <canvas id="cnvs" height="170px" width="170px"><!--styleのheigthは見た目の大きさを変えているにすぎない。表示領域はcssじゃない。-->
                </canvas>
            </div>
            <div id="buttons">
                <div id="button_left">
                    <div>
                        <input type="button" class="key_button" value="↑">
                    </div>
                    <div>
                        <input type="button" class="key_button" value="←">
                        <input type="button" class="key_button" value="→">
                    </div>
                    <div>
                        <input type="button" class="key_button" value="↓">
                    </div>
                    
                </div>
                <div id="button_right">
                    <input type="button" class="key_button" value="〇">
                    <input type="button" class="key_button" value="×">
                </div>
            </div>
             <div id="kouryaku_div">
                <a href="./slide_glitch_kouryaku.html"  target="_blank" rel="noopener noreferrer" >
                    攻略サイト
                </a>
             </div>

            
            <footer>
                <ul id="footul">
                    <li id="foot_tweet_li">
                        <a href=""  target="_blank" rel="noopener noreferrer" id="foot_tweet_a"><!--onload_functions()でhrefを書き込んでるで！-->
                            <img src="../images/site/twitterbutton.gif" alt="ツイートボタン" id="tweet_img">
                        </a>
                    </li>
                    <li>
                        <a href="#top" id="totop"> 
                            ページ上部に移動
                        </a>
                    </li>
                </ul>
            </footer>
        </div>
    </body>
</html>
