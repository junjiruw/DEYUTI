<!DOCTYPE html>
<html lang="ja">
    <head prefix="og: http://ogp.me/ns# website: http://ogp.me/ns/website#">
        <meta charset="UTF-8">
        <!--文字コードは上のほうにないとすべておしまいになるらしい-->
        <meta name="description" content="クリッカー系ゲームを…つくりたい！">                                                                 <!--ページ説明　入力すること！-->
        <title>JUN汁ｗおもちゃばこ。/おもちゃ/毎日しゅうくん</title>                                                         <!--タイトル　入力すること！-->
        <!--OGPとかいうの-->
        <meta property="og:site_name" content="JUN汁ｗおもちゃばこ。/omocha/everyday_syuukun">                                <!--タイトル　入力すること！-->
        <meta property="og:title" content="毎日しゅうくん">                                                               <!--タイトル　入力すること！-->
        <meta property="og:type" content="article"> <!--websiteはトップページ、articleが記事だってさ-->
        <meta property="og:url" content="https://junjiruw.github.io/DEYUTI/omocha/everyday_syuukun.html">                   <!--リンク　入力すること！-->
        <meta property="og:image" content="https://github.com/junjiruw/DEYUTI/blob/master/images/site/junjiruw_bako.png?raw=true">
        <meta name="twitter:card" content="summary"><!--なにを表示するか-->
        <meta name="twitter:site" content="@junjiruw"><!--フッターに表示されるらしい…どこ？-->
        <meta name="viewport" content="width=device-width,initial-scale=1"><!--スマホで見てる人向けに表示領域の設定-->
        <link rel="stylesheet" href="../css/style.css">
        
        <link rel="icon" href="../images/site/favicon32.png">
        <style>
            div#mannaka{
                width: 98%;
            }
            div#parent_div{
                text-align: center;
                margin: 10px;
            }
            #canvas{
                background: #ffffff;
                height: 80vh;/*これ、PCブラウザで横に狭くしたら崩壊せえへん？→勝手に崩壊してろ　→スマホはどースンだよ→そこはonloadくんとこで頑張ってもろて…*/
                /*image-rendering: pixelated;ドット絵を拡大したいなら使え*/
            }
        </style>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-1MB5XLN4LW"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-1MB5XLN4LW');
        </script>
        <!-- Google tag (gtag.js) -->

        <script src="../js/public.js"></script>

        <!--pixiJSを読み込もう-->
        <script src="../js/library/pixi.min.js"></script>
        <!--ライセンス表記はコイツの中に書いてあるぜ！-->
        <!--pixi-filters-を読み込もう-->
        <script src="../js/library/pixi-filters.js"></script>
        <!--ライセンス表記はコイツの中に書いてあるぜ！-->

        <script>
            onload = function(){
                onload_functions();

                const canvas =document.getElementById("canvas");
                if (navigator.userAgent.match(/iPhone|Android.+Mobile/)) {//貴様！スマホで見ているな！？
                    canvas.style.height=70+"vh";
                    canvas.style.width=canvas.clientHeight*2/3+"px";
                    //canvas.style.height=canvas.clientWidth+"px";
                }
                const app = new PIXI.Application({//PIXIアプリを作成
                    view : canvas, //canvas指定
                    antialias : true,//アンチエイリアス。デフォルトOFF
                    //preserveDrawingBuffer: true,//canvasのキャプチャとか実装するなら必要らしい。
                    backgroundColor: 0x303030,
                    width:1000,
                    height:1500,
                });
                PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;//スプライトの拡大をぼやけさせない。

                const 基本文字_黒=new PIXI.TextStyle({
                    fontSize: 40,
                    fill: 0x101010,
                    fontWeight: 300,
                });
                const 基本文字_白=new PIXI.TextStyle({
                    fontSize: 40,
                    fill: 0xFFFFFF,
                    fontWeight: 300,
                });
                const 時刻文字=new PIXI.TextStyle({
                    fontSize: 70,
                    fill: 0x101010,
                    fontWeight: 700,
                });

                let time =0;
                let day=1;
                const 曜日=["日","月","火","水","木","金","土"];
                let 曜日カウント=0;
                let 倍速=1;
                let ダイヤ=0;

                const 上コンテナ = new PIXI.Container();
                app.stage.addChild(上コンテナ);

                const 上バー=new PIXI.Graphics();
                上バー.beginFill(0xffffff);
                上バー.drawRect(10,10,980,90);
                上バー.endFill();
                上コンテナ.addChild(上バー);

                const 時刻表示 = new PIXI.Text( "00:00" ,時刻文字);
                時刻表示.position.set(800,15);
                上コンテナ.addChild(時刻表示);

                const 曜日表示 = new PIXI.Text( "（月）" ,時刻文字);
                曜日表示.position.set(320,15);
                上コンテナ.addChild(曜日表示);

                const 日付表示 = new PIXI.Text( "😎月/01日" ,時刻文字);
                日付表示.position.set(30,15);
                上コンテナ.addChild(日付表示);

                const ダイヤ表示 = new PIXI.Text( "💎:0",時刻文字);
                ダイヤ表示.position.set(980,110);
                ダイヤ表示.anchor.set(1,0);
                上コンテナ.addChild(ダイヤ表示);

                上コンテナ.zIndex = 10;

                
                //---

                const 中コンテナ = new PIXI.Container();
                app.stage.addChild(中コンテナ);

                const 中央=new PIXI.Graphics();
                中央.beginFill(0xafdfcf);
                中央.drawRect(10,110,980,590);
                中央.endFill();
                中コンテナ.addChild(中央);

                let 所持しゅうくん数=1;
                let しゅうくん = new Array(20);
                for(let i=0;i<20;i++){
                    しゅうくん[i]=new PIXI.Sprite(PIXI.Texture.from("../images/omocha/every_syuukun/syukun1616.png"));
                    しゅうくん[i].anchor.set(0.5);
                    しゅうくん[i].scale.set(10);
                    しゅうくん[i].x=100+Math.floor(i/3)*130;
                    しゅうくん[i].y=280+i%3*150;
                    しゅうくん[i].visible=false;
                    しゅうくん[i].作業内容="";
                    しゅうくん[i].進捗=0;
                    しゅうくん[i].進捗表示=new PIXI.Graphics();
                    しゅうくん[i].バー表示=function(){
                        this.進捗表示.clear()
                        .beginFill(0x404040)
                        .drawRect(しゅうくん[i].x-96,しゅうくん[i].y-110,192,34)
                        .endFill()
                        .beginFill(0x40ff40)
                        .drawRect(しゅうくん[i].x-94,しゅうくん[i].y-108,188*this.進捗,30)
                        .endFill();
                    };
                    しゅうくん[i].バー非表示=function(){
                        this.進捗表示.clear();
                    };
                    中コンテナ.addChild(しゅうくん[i]);
                    中コンテナ.addChild(しゅうくん[i].進捗表示);
                }
                中コンテナ.zIndex = -1;
                //---

                const mainコンテナ = new PIXI.Container();
                app.stage.addChild(mainコンテナ);
                
                let お世話 = new Array(4);
                let お世話_text = new Array(4);
                const お世話_内容=["🍙","💪","🧘","🌿"];
                for(let i=0;i<4;i++){
                    お世話[i]=new PIXI.Graphics()
                    .beginFill(0xffffff)
                    .drawRect(0,0,237,187)
                    .endFill();
                    お世話[i].x=10+248*[i%2];
                    お世話[i].y=710+198*[Math.floor(i/2)];
                    お世話[i].interactive=true;//タッチ操作許可
                    お世話[i].有効=true;
                    お世話[i].on("pointerdown",()=>{
                        if(お世話[i].有効){
                            for(let j=0;j<所持しゅうくん数;j++){
                                if(しゅうくん[j].作業内容==""){//なんもしてねえやついた
                                    しゅうくん[j].作業内容=お世話_内容[i];
                                    しゅうくん[j].バー表示();
                                    break;
                                };
                            }
                        }
                    });
                    お世話[i].有効化=function(){
                        お世話[i].有効=true;
                        this.clear()//いったん消して描きなおす
                        .beginFill(0xcfcfcf)
                        .drawRect(0,0,237,187)
                        .endFill();
                    };
                    お世話[i].無効化=function(){
                        お世話[i].有効=false;
                        this.clear()//いったん消して描きなおす
                        .beginFill(0x5f5f5f)
                        .drawRect(0,0,237,187)
                        .endFill();
                    };
                    mainコンテナ.addChild(お世話[i]);


                    お世話_text[i]= new PIXI.Text( お世話_内容[i] ,時刻文字);
                    お世話_text[i].position.set(118,93);
                    お世話_text[i].anchor.set(0.5);
                    お世話[i].addChild(お世話_text[i]);
                }
                let お世話カウンター=[0,0,0,0];
                let 本日お世話=[0,0,0,0];
                let お世話ノルマ=[3,3,100,100,10];
                let お世話速度=[1,0.9,0.5,0.1];
                

                const 店=new PIXI.Graphics()
                .beginFill(0xffffff)
                .drawRect(505,710,485,385)
                .endFill();
                店.interactive=true;//タッチ操作許可
                店.on("pointerdown",()=>{
                        console.log("oh");
                    });
                mainコンテナ.addChild(店);

                const ミッション=new PIXI.Graphics()
                .beginFill(0xffffff)
                .drawRect(505,1105,485,385)
                .endFill();
                ミッション.interactive=true;//タッチ操作許可
                ミッション.on("pointerdown",()=>{
                        console.log("oh");
                    });
                mainコンテナ.addChild(ミッション);


                const デイリーミッションだよ = new PIXI.Text( "デイリーミッション" ,基本文字_白);
                デイリーミッションだよ.anchor.set(0.5);
                デイリーミッションだよ.position.set(250,1130);
                mainコンテナ.addChild(デイリーミッションだよ);
                
                let daily_mission = new Array(5);
                const daily_mission_text = new Array(5);
                const daily_mission_内容=["🍙×","💪×","🧘×","🌿×","ツンツンする×"];
                const daily_mission_報酬=[10,10,100,300,30];
                for(let i=0;i<5;i++){
                    daily_mission[i]=new PIXI.Graphics()
                    .beginFill(0xcfcfcf)
                    .drawRect(0,0,485,55)
                    .endFill();
                    daily_mission[i].x=10;
                    daily_mission[i].y=1165+i*60;
                    daily_mission[i].interactive=true;//タッチ操作許可
                    daily_mission[i].有効=false;
                    daily_mission[i].達成=false;
                    daily_mission[i].on("pointerdown",()=>{
                        if(daily_mission[i].有効){
                            daily_mission[i].無効化();
                            ダイヤ+=daily_mission_報酬[i];
                        }
                    });
                    daily_mission[i].有効化=function(){
                        daily_mission[i].有効=false;
                        daily_mission[i].達成=false;
                        this.clear()//いったん消して描きなおす
                        .beginFill(0xcfcfcf)
                        .drawRect(0,0,485,55)
                        .endFill();
                    };
                    daily_mission[i].無効化=function(){
                        daily_mission[i].有効=false;
                        this.clear()//いったん消して描きなおす
                        .beginFill(0x3f3f3f)
                        .drawRect(0,0,485,55)
                        .endFill();
                    };
                    daily_mission[i].更新=function(){
                        if(本日お世話[i]>=お世話ノルマ[i] && daily_mission[i].達成==false){
                            daily_mission[i].達成=true;
                            daily_mission[i].有効=true;
                            daily_mission[i].clear()//いったん消して描きなおす
                            .beginFill(0xcfcfcf)
                            .drawRect(0,0,485,55)
                            .endFill()
                            .beginFill(0xefef0f)
                            .drawRect(0,0,485,55)
                            .endFill();
                        }
                        
                        if(本日お世話[i]<お世話ノルマ[i]){
                            daily_mission[i].clear()//いったん消して描きなおす
                            .beginFill(0xcfcfcf)
                            .drawRect(0,0,485,55)
                            .endFill()
                            .beginFill(0xffcfcf)
                            .drawRect(0,0,485/お世話ノルマ[i]*本日お世話[i],55)
                            .endFill();
                        }

                    };
                    mainコンテナ.addChild(daily_mission[i]);

                    daily_mission_text[i]= new PIXI.Text( daily_mission_内容[i]+お世話ノルマ[i] ,基本文字_黒);
                    daily_mission_text[i].position.set(5,5);
                    daily_mission[i].addChild(daily_mission_text[i]);

                    const 報酬 = new PIXI.Text( "💎："+daily_mission_報酬[i] ,基本文字_黒);
                    報酬.anchor.set(1,0);
                    報酬.position.set(480,5);
                    daily_mission[i].addChild(報酬);

                };                
                
                //---
                
                app.stage.sortChildren();//コンテナのzソート


                //↓ここでセーブデータによって色々いじる処理が入るよ！
                所持しゅうくん数=20;
                for(let i=0;i<所持しゅうくん数;i++){
                    しゅうくん[i].visible=true;
                }
                
                お世話[2].無効化();
                お世話[3].無効化();
                daily_mission[2].無効化();
                daily_mission[3].無効化();
                //倍速=6000;
                //↑ここでセーブデータによって色々いじる処理が入るよ！

                app.ticker.add(loop);                
                function loop(delta){//1/60[s]くらいで動く。引数は前フレームからの経過時間*60 …まあ大体1だ  app.ticker.speed = 3;で変えられるらしいっすよ
                    time+=delta;//本当はdelta/60だけど、ゲームバランス的に速度60倍しておく
                    if(time>=86400){
                        day+=Math.floor(time/86400);
                        日付表示.text="😎月/"+(day%32).toString().padStart(2,0)+"日";
                        曜日表示.text="（"+曜日[day%7]+"）";
                        if(曜日カウント<Math.floor(day/7)){
                            //console.log(Math.floor(day/7)-曜日カウント);//何週間飛んだ？
                            曜日カウント=Math.floor(day/7);
                        }
                        time=time%86400;
                    }
                    時刻表示.text=Math.floor(time/3600).toString().padStart(2,0)+":"+Math.floor(Math.floor((time%3600)/60)).toString().padStart(2,0);
                    ダイヤ表示.text="💎:"+ダイヤ;
                    app.ticker.speed=倍速;

                    for(let i=0;i<所持しゅうくん数;i++){
                        for(let j=0;j<4;j++){
                            if(しゅうくん[i].作業内容==お世話_内容[j]){
                                しゅうくん[i].進捗+=倍速/100*お世話速度[j];
                                if(しゅうくん[i].進捗>=1){
                                    しゅうくん[i].バー非表示();
                                    しゅうくん[i].進捗=0;
                                    しゅうくん[i].作業内容="";
                                    お世話カウンター[j]++;
                                    本日お世話[j]++;
                                    daily_mission[j].更新();
                                }else{
                                    しゅうくん[i].バー表示();
                                }
                            }
                        }
                    }



                }
            }
        </script>
    </head>
    <body>
        <div id="top"></div>
        <header id="header">
            <button onclick="html_link_btn()" id="html_link_btn"></button>
            <nav id="html_link_nav">
                <ul id="html_link_ul"></ul>
            </nav>
            <a href="../index.html">
                <img id="go_home" src="../images/site/omotyabako_deka.png" alt="トップページへ" height="1px"><!--ここで高さを入れておかないと、クソでかい画像が一瞬読み込まれてボタンの大きさが暴走する-->
            </a>
            <h1 id="title_h1">
                JUN汁ｗおもちゃばこ。
            </h1>
        </header>
        <div id="mannaka">

            <div id="parent_div">
                <canvas id="canvas"></canvas>
            </div>

            <footer>
                <ul id="footul">
                    <li id="foot_tweet_li">
                        <a href=""  target="_blank" rel="noopener noreferrer" id="foot_tweet_a"><!--onload_functions()でhrefを書き込んでるで！-->
                            <img src="../images/site/twitterbutton.gif" alt="ツイートボタン" id="tweet_img">
                        </a>
                    </li>
                    <li>
                        <a href="#top" id="totop"> 
                            ページ上部に移動
                        </a>
                    </li>
                </ul>
            </footer>
        </div>
    </body>
</html>
