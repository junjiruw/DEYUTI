<!DOCTYPE html>
<html lang="ja">
    <head prefix="og: http://ogp.me/ns# website: http://ogp.me/ns/website#">
        <meta charset="UTF-8">
        <!--文字コードは上のほうにないとすべておしまいになるらしい-->
        <meta name="description" content="カードゲーム作りたい">
        <title>JUN汁ｗおもちゃばこ。/おもちゃ/しゅうくんカード</title>
        <!--OGPとかいうの-->
        <meta property="og:site_name" content="JUN汁ｗおもちゃばこ。/omocha/syuukun_card">                                <!--タイトル　入力すること！-->
        <meta property="og:title" content="しゅうくんカード">                                                               <!--タイトル　入力すること！-->
        <meta property="og:type" content="article"> <!--websiteはトップページ、articleが記事だってさ-->
        <meta property="og:url" content="https://junjiruw.github.io/DEYUTI/omocha/syuukun_card.html">                   <!--リンク　入力すること！-->
        <meta property="og:image" content="https://github.com/junjiruw/DEYUTI/blob/master/images/site/junjiruw_bako.png?raw=true">
        <meta name="twitter:card" content="summary"><!--なにを表示するか-->
        <meta name="twitter:site" content="@junjiruw"><!--フッターに表示されるらしい…どこ？-->
        <link rel="stylesheet" href="../css/style.css">
        
        <link rel="icon" href="../images/site/favicon32.png">
        <style>

            div#mannaka{
                width: 98%;
                margin: auto;
                background: #16151a;
                border: 2px solid #ffffff;
                color: #ffffff;   
                font-size: 16px;    
            }

            div#parent_div{
                text-align: center;
                margin: 10px;
            }
            canvas{
                background: #ffffff;
                height: 70vh;/*これ、PCブラウザで横に狭くしたら崩壊せえへん？→勝手に崩壊してろ*/
                /*image-rendering: pixelated;ドット絵を拡大したいなら使え*/
                
            }
            canvas#cnvs_hidden{
                display: none;                
            }


            div#buttons{
                display: flex;
            }
            input.key_button{
                background-color: #FFFFFF;
                width: 1.5em;
                height: 1.5em;
                font-size: 2em;
                font-family: "misaki_gothic";
                margin: 0.25em;
                margin-left: 1em;
            }
            input.key_button:active{
                background-color: #656965;
                color: #FFFFFF;
            }
            div#button_left{
                text-align: left;
                width: 50%;
            }
            div#button_left div{
                text-align: center;
            }
            div#button_right{
                text-align: center;
                width: 50%;
            }
            #omake_div{
                text-align: right;
            } 
            label.button_lable{
                background-color: #FFFFFF;
                color: #000;
                padding: 2px;
                padding-right: 5px;
                padding-left: 5px;
            }
            

        </style>
        <script src="../js/public.js"></script>
        <script>
            //素材読み込み
            var test=new Image();
            test.src="../images/omocha/syuukun_card/200130.png";
            var test_syuukun=new Image();
            test_syuukun.src="../images/omocha/syuukun_card/test_syuukun200130.png";
            
            var title_image =new Image();
            title_image.src="../images/omocha/syuukun_card/syuukunkadotitele.png";
            var turn_end=new Image();
            turn_end.src="../images/omocha/syuukun_card/ta-nendman.png";
            var yamahuda=new Image();
            yamahuda.src="../images/omocha/syuukun_card/yamahuda.png";
            var hakaba=new Image();
            hakaba.src="../images/omocha/syuukun_card/hakaba64.png";
            var card_basyo=new Image();
            card_basyo.src="../images/omocha/syuukun_card/card_basyo.png";
            var yubi=new Image();
            yubi.src="../images/omocha/syuukun_card/ka-soru64.png";//嘘。拡大したから128
            var atk_plate=new Image();
            atk_plate.src="../images/omocha/syuukun_card/atk_plate.png";
            var def_plate=new Image();
            def_plate.src="../images/omocha/syuukun_card/def_plate.png";
            var atk_circle=new Image();
            atk_circle.src="../images/omocha/syuukun_card/atk_circle.png";
            var zuba64=new Image();
            zuba64.src="../images/omocha/syuukun_card/zuba64.png";
            var kati_image=new Image();
            kati_image.src="../images/omocha/syuukun_card/syouhai300_kati.png";
            var make_image=new Image();
            make_image.src="../images/omocha/syuukun_card/syouhai300_make.png";

            var tehuda32=new Image();
            tehuda32.src="../images/omocha/syuukun_card/tehuda32.png";
            var kougeki_1_32=new Image();
            kougeki_1_32.src="../images/omocha/syuukun_card/kougeki1_32.png";
            var tairyoku_1_32=new Image();
            tairyoku_1_32.src="../images/omocha/syuukun_card/tairyoku1_32.png";
            var ponya_32=new Image();
            ponya_32.src="../images/omocha/syuukun_card/ponya_32.png";
            //--下がカード？

            var card_syuukun=new Image();
            card_syuukun.src="../images/omocha/syuukun_card/card_syuukun130200.png";
            var hojorobo_image=new Image();
            hojorobo_image.src="../images/omocha/syuukun_card/hojorobo.png";
            var kinkyuujitai5_image=new Image();
            kinkyuujitai5_image.src="../images/omocha/syuukun_card/kinkyuujitai5.png";
            var ryuunoitigeki_img=new Image();
            ryuunoitigeki_img.src="../images/omocha/syuukun_card/ryuunoitigeki.png";
            var powerup3_img=new Image();
            powerup3_img.src="../images/omocha/syuukun_card/powerup3.png";
            var HPup5_img=new Image();
            HPup5_img.src="../images/omocha/syuukun_card/HPup5.png";
            
            var ponya_image=new Image();
            ponya_image.src="../images/omocha/syuukun_card/ponya.png";
            var ponya_ace_image=new Image();
            ponya_ace_image.src="../images/omocha/syuukun_card/ponyaace.png";
            var yakuso_3_image=new Image();
            yakuso_3_image.src="../images/omocha/syuukun_card/yakusou3.png";

            var kameisi_image=new Image();
            kameisi_image.src="../images/omocha/syuukun_card/kameisi.png";
            var kametetu_image=new Image();
            kametetu_image.src="../images/omocha/syuukun_card/kametetu.png";

            var henyamotin_image=new Image();
            henyamotin_image.src="../images/omocha/syuukun_card/henyamotin.png";

            var ponya_sutoraiku_image=new Image();
            ponya_sutoraiku_image.src="../images/omocha/syuukun_card/ponyastrike.png";
            var ponya_big_image=new Image();
            ponya_big_image.src="../images/omocha/syuukun_card/ponyabig.png";            
            var ponya_rein_image=new Image();
            ponya_rein_image.src="../images/omocha/syuukun_card/ponyarein.png";
            var ponya_daburu_image=new Image();
            ponya_daburu_image.src="../images/omocha/syuukun_card/ponyadaburu.png";
            
            var kyuukoukasakusenki_image=new Image();
            kyuukoukasakusenki_image.src="../images/omocha/syuukun_card/kyuukoukasakusenki.png";
            var atakkumojuru_image=new Image();
            atakkumojuru_image.src="../images/omocha/syuukun_card/atakkumojuru.png";
            var kaihukumojuru_image=new Image();
            kaihukumojuru_image.src="../images/omocha/syuukun_card/kaihukumojuru.png";
            var sukurappudoro_image=new Image();
            sukurappudoro_image.src="../images/omocha/syuukun_card/sukurappudoro.png";

            var sasori_image=new Image();
            sasori_image.src="../images/omocha/syuukun_card/sasori.png";
            var sasori_seitai_image=new Image();
            sasori_seitai_image.src="../images/omocha/syuukun_card/sasori_seitai.png";

            var ikkakudaija_atama_image=new Image();
            ikkakudaija_atama_image.src="../images/omocha/syuukun_card/ikkakudaija_atama.png";
            var ikkakudaija_hara_image=new Image();
            ikkakudaija_hara_image.src="../images/omocha/syuukun_card/ikkakudaija_hara.png";
            var ikkakudaija_yubi_image=new Image();
            ikkakudaija_yubi_image.src="../images/omocha/syuukun_card/ikkakudaija_yubi.png";

            var buiwa_image=new Image();
            buiwa_image.src="../images/omocha/syuukun_card/buiwa.png";
            var raihudaiya_image=new Image();
            raihudaiya_image.src="../images/omocha/syuukun_card/raihudaiya.png";
            var seiretu_image=new Image();
            seiretu_image.src="../images/omocha/syuukun_card/seiretu.png";

            var kyuusainote_image=new Image();
            kyuusainote_image.src="../images/omocha/syuukun_card/kyuusainote.png";
            var kenrounarusoukou_image=new Image();
            kenrounarusoukou_image.src="../images/omocha/syuukun_card/kenrounarukata.png";
            var zettainotamasii_image=new Image();
            zettainotamasii_image.src="../images/omocha/syuukun_card/zettainotamasii.png";

            var kyousinja_image=new Image();
            kyousinja_image.src="../images/omocha/syuukun_card/kyousinja.png";
            var hametunokami_image=new Image();
            hametunokami_image.src="../images/omocha/syuukun_card/hametunokami.png";

            var burakkusyuukun_image=new Image();
            burakkusyuukun_image.src="../images/omocha/syuukun_card/burakkusyuukun.png";
            var doragonburesu_image=new Image();
            doragonburesu_image.src="../images/omocha/syuukun_card/doragonburesu.png";
            var hojoseki_image=new Image();
            hojoseki_image.src="../images/omocha/syuukun_card/hojoseki.png";
            var musyounoai_image=new Image();
            musyounoai_image.src="../images/omocha/syuukun_card/musyounoai.png";
            var nitouryuukengi_image=new Image();
            nitouryuukengi_image.src="../images/omocha/syuukun_card/nitouryuukengi.png";
            var sinennoai_image=new Image();
            sinennoai_image.src="../images/omocha/syuukun_card/sinennoai.png";
            var tyoubusou_image=new Image();
            tyoubusou_image.src="../images/omocha/syuukun_card/tyoubusou.png";
            var yamika_image=new Image();
            yamika_image.src="../images/omocha/syuukun_card/yamika.png";
            var yamiryuusyuu_image=new Image();
            yamiryuusyuu_image.src="../images/omocha/syuukun_card/yamiryuusyuu.png";
            var zerozonbizu_image=new Image();
            zerozonbizu_image.src="../images/omocha/syuukun_card/zerozonbizu.png";

            var aidorukourin_image=new Image();
            aidorukourin_image.src="../images/omocha/syuukun_card/aidorukourin.png";
            var hametunosinkou_image=new Image();
            hametunosinkou_image.src="../images/omocha/syuukun_card/hametunosinkou.png";
            var ikkakudaija_2_image=new Image();
            ikkakudaija_2_image.src="../images/omocha/syuukun_card/ikkakudaija_2.png";
            var ittouryoudan_image=new Image();
            ittouryoudan_image.src="../images/omocha/syuukun_card/ittouryoudan.png";
            var ponyaaidoru_image=new Image();
            ponyaaidoru_image.src="../images/omocha/syuukun_card/ponyaaidoru.png";
            var ponyasyoukansi_image=new Image();
            ponyasyoukansi_image.src="../images/omocha/syuukun_card/ponyasyoukansi.png";
            var sentanseisei_image=new Image();
            sentanseisei_image.src="../images/omocha/syuukun_card/sentanseisei.png";
            var sukurappubirudo_image=new Image();
            sukurappubirudo_image.src="../images/omocha/syuukun_card/sukurappubirudo.png";
            var sukurappugoremu_image=new Image();
            sukurappugoremu_image.src="../images/omocha/syuukun_card/sukurappugoremu.png";
            var zousyoku_image=new Image();
            zousyoku_image.src="../images/omocha/syuukun_card/zousyoku.png";

            var sasori_hujou_image=new Image();
            sasori_hujou_image.src="../images/omocha/syuukun_card/sasori_hujou.png";
            var dokuhakinoko_image=new Image();
            dokuhakinoko_image.src="../images/omocha/syuukun_card/dokuhakinoko.png";
            var karamaruito_image=new Image();
            karamaruito_image.src="../images/omocha/syuukun_card/karamaruito.png";
            var ookametake_image=new Image();
            ookametake_image.src="../images/omocha/syuukun_card/ookametake.png";
            var moukyodokudaitake_image=new Image();
            moukyodokudaitake_image.src="../images/omocha/syuukun_card/moukyodokudaitake.png";
            var rozusyuu_image=new Image();
            rozusyuu_image.src="../images/omocha/syuukun_card/rozusyuu.png";
            var kanbansan_image=new Image();
            kanbansan_image.src="../images/omocha/syuukun_card/kanbansan.png";
            var gurumesinjidai_image=new Image();
            gurumesinjidai_image.src="../images/omocha/syuukun_card/gurumesinjidai.png";
            var kinkyuujitai3_image=new Image();
            kinkyuujitai3_image.src="../images/omocha/syuukun_card/kinkyuujitai3.png";
            var miryousuruhitomi_image=new Image();
            miryousuruhitomi_image.src="../images/omocha/syuukun_card/miryousuruhitomi.png";
            var kankyouseihagoremu_image=new Image();
            kankyouseihagoremu_image.src="../images/omocha/syuukun_card/kankyouseihagoremu.png";

            var dokuzomenaihu_image=new Image();
            dokuzomenaihu_image.src="../images/omocha/syuukun_card/dokuzomenaihu.png";
            var muzomenaihu_image=new Image();
            muzomenaihu_image.src="../images/omocha/syuukun_card/muzomenaihu.png";
            var naihuzomeotoko_image=new Image();
            naihuzomeotoko_image.src="../images/omocha/syuukun_card/naihuzomeotoko.png";
            var tizomenaihu_image=new Image();
            tizomenaihu_image.src="../images/omocha/syuukun_card/tizomenaihu.png";
            var sabitayari_image=new Image();
            sabitayari_image.src="../images/omocha/syuukun_card/sabitayari.png";
            var kantuuya_image=new Image();
            kantuuya_image.src="../images/omocha/syuukun_card/kantuuya.png";
            var sabitataiken_image=new Image();
            sabitataiken_image.src="../images/omocha/syuukun_card/sabitataiken.png";
            var ueponsarubeji_image=new Image();
            ueponsarubeji_image.src="../images/omocha/syuukun_card/ueponsarubeji.png";
            var hokakusuneku_image=new Image();
            hokakusuneku_image.src="../images/omocha/syuukun_card/hokakusuneku.png";
            var isseihokaku_image=new Image();
            isseihokaku_image.src="../images/omocha/syuukun_card/isseihokaku.png";
            var ryuukon_image=new Image();
            ryuukon_image.src="../images/omocha/syuukun_card/ryuukon.png";
            var sunattidoragon_image=new Image();
            sunattidoragon_image.src="../images/omocha/syuukun_card/sunattidoragon.png";
            var touryuuzannosiren_image=new Image();
            touryuuzannosiren_image.src="../images/omocha/syuukun_card/touryuuzannosiren.png";
            var aooni_image=new Image();
            aooni_image.src="../images/omocha/syuukun_card/aooni.png";
            var akaoni_image=new Image();
            akaoni_image.src="../images/omocha/syuukun_card/akaoni.png";
            var ikaribakuhatu_image=new Image();
            ikaribakuhatu_image.src="../images/omocha/syuukun_card/ikaribakuhatu.png";

            var nezumi_image=new Image();
            nezumi_image.src="../images/omocha/syuukun_card/nezumi.png";
            var tyuunezumi_image=new Image();
            tyuunezumi_image.src="../images/omocha/syuukun_card/tyuunezumi.png";
            var dekanezumi_image=new Image();
            dekanezumi_image.src="../images/omocha/syuukun_card/dekanezumi.png";
            var dokunezumi_image=new Image();
            dokunezumi_image.src="../images/omocha/syuukun_card/dokunezumi.png";
            var tamanezumi_image=new Image();
            tamanezumi_image.src="../images/omocha/syuukun_card/tamanezumi.png";
            var tatujinnezumi_image=new Image();
            tatujinnezumi_image.src="../images/omocha/syuukun_card/tatujinnezumi.png";
            var kyuusonekowokamu_image=new Image();
            kyuusonekowokamu_image.src="../images/omocha/syuukun_card/kyuusonekowokamu.png";
            var tamanori_image=new Image();
            tamanori_image.src="../images/omocha/syuukun_card/tamanori.png";
            var tamanorinezumi_image=new Image();
            tamanorinezumi_image.src="../images/omocha/syuukun_card/tamanorinezumi.png";
            var tamanoridokunezumi_image=new Image();
            tamanoridokunezumi_image.src="../images/omocha/syuukun_card/tamanoridokunezumi.png";
            var tyuukun_image=new Image();
            tyuukun_image.src="../images/omocha/syuukun_card/tyuukun.png";


            var hirobakutan_image=new Image();
            hirobakutan_image.src="../images/omocha/syuukun_card/hirobakutan.png";
            var motinreddo_image=new Image();
            motinreddo_image.src="../images/omocha/syuukun_card/motinreddo.png";
            var motinburuu_image=new Image();
            motinburuu_image.src="../images/omocha/syuukun_card/motinburuu.png";
            var motingurin_image=new Image();
            motingurin_image.src="../images/omocha/syuukun_card/motingurin.png";
            var motiniero_image=new Image();
            motiniero_image.src="../images/omocha/syuukun_card/motiniero.png";
            var motinpinku_image=new Image();
            motinpinku_image.src="../images/omocha/syuukun_card/motinpinku.png";
            var gingapawa_image=new Image();
            gingapawa_image.src="../images/omocha/syuukun_card/gingapawa.png";
            var motinkosumo_image=new Image();
            motinkosumo_image.src="../images/omocha/syuukun_card/motinkosumo.png";
            var yamiyonokage_image=new Image();
            yamiyonokage_image.src="../images/omocha/syuukun_card/yamiyonokage.png";
            var motinburakku_image=new Image();
            motinburakku_image.src="../images/omocha/syuukun_card/motinburakku.png";
            var ekken_image=new Image();
            ekken_image.src="../images/omocha/syuukun_card/ekken.png";
            var ou_image=new Image();
            ou_image.src="../images/omocha/syuukun_card/ou.png";

            var buppinhanbai_image=new Image();
            buppinhanbai_image.src="../images/omocha/syuukun_card/buppinhanbai.png";
            var daijanotukai_image=new Image();
            daijanotukai_image.src="../images/omocha/syuukun_card/daijanotukai.png";
            var hametuwomatumono_image=new Image();
            hametuwomatumono_image.src="../images/omocha/syuukun_card/hametuwomatumono.png";
            var kameko_image=new Image();
            kameko_image.src="../images/omocha/syuukun_card/kameko.png";
            var operobo_image=new Image();
            operobo_image.src="../images/omocha/syuukun_card/operobo.png";
            var sasori_musume_image=new Image();
            sasori_musume_image.src="../images/omocha/syuukun_card/sasori_musume.png";
            var sourugadona_image=new Image();
            sourugadona_image.src="../images/omocha/syuukun_card/sourugadona.png";
            var zerozerozero_image=new Image();
            zerozerozero_image.src="../images/omocha/syuukun_card/zerozerozero.png";


            var happisukoru_image=new Image();
            happisukoru_image.src="../images/omocha/syuukun_card/happisukoru.png";
            var pantingukuraudo_image=new Image();
            pantingukuraudo_image.src="../images/omocha/syuukun_card/pantingukuraudo.png";
            var pupukuraudo_image=new Image();
            pupukuraudo_image.src="../images/omocha/syuukun_card/pupukuraudo.png";
            
            var hitujikuraudo_image=new Image();
            hitujikuraudo_image.src="../images/omocha/syuukun_card/hitujikuraudo.png";
            var daburukuraudo_image=new Image();
            daburukuraudo_image.src="../images/omocha/syuukun_card/daburukuraudo.png";
            var hikoukigumo_image=new Image();
            hikoukigumo_image.src="../images/omocha/syuukun_card/hikoukigumo.png";

            var amakuraudo_image=new Image();
            amakuraudo_image.src="../images/omocha/syuukun_card/amakuraudo.png";
            var poizunkuraudo_image=new Image();
            poizunkuraudo_image.src="../images/omocha/syuukun_card/poizunkuraudo.png";
            var biribirikuraudo_image=new Image();
            biribirikuraudo_image.src="../images/omocha/syuukun_card/biribirikuraudo.png";

            var enjerukuraudo_image=new Image();
            enjerukuraudo_image.src="../images/omocha/syuukun_card/enjerukuraudo.png";
            var kuraudo_image=new Image();
            kuraudo_image.src="../images/omocha/syuukun_card/kuraudo.png";
            var detaappurodo_image=new Image();
            detaappurodo_image.src="../images/omocha/syuukun_card/detaappurodo.png";
            
            var taihuu0gou_image=new Image();
            taihuu0gou_image.src="../images/omocha/syuukun_card/taihuu0gou.png";

            var dakuesu_image=new Image();
            dakuesu_image.src="../images/omocha/syuukun_card/dakuesu.png";
            var kanbanmusume_image=new Image();
            kanbanmusume_image.src="../images/omocha/syuukun_card/kanbanmusume.png";
            var kumosuitoriki_image=new Image();
            kumosuitoriki_image.src="../images/omocha/syuukun_card/kumosuitoriki.png";
            var pandemikku_image=new Image();
            pandemikku_image.src="../images/omocha/syuukun_card/pandemikku.png";
            var zangyakuakuma_image=new Image();
            zangyakuakuma_image.src="../images/omocha/syuukun_card/zangyakuakuma.png";
            
            var kyoumeiponya_image=new Image();
            kyoumeiponya_image.src="../images/omocha/syuukun_card/kyoumeiponya.png";
            var syukuniumu_image=new Image();
            syukuniumu_image.src="../images/omocha/syuukun_card/syukuniumu.png";
            
            var mitibiki_image=new Image();
            mitibiki_image.src="../images/omocha/syuukun_card/mitibiki.png";
            var pon_image=new Image();
            pon_image.src="../images/omocha/syuukun_card/pon.png";
            var tutata_image=new Image();
            tutata_image.src="../images/omocha/syuukun_card/tutata.png";
            var nyoro_image=new Image();
            nyoro_image.src="../images/omocha/syuukun_card/nyoro.png";
            var long_image=new Image();
            long_image.src="../images/omocha/syuukun_card/long.png";
            var kokuten_image=new Image();
            kokuten_image.src="../images/omocha/syuukun_card/kokuten.png";
            var wesutan_image=new Image();
            wesutan_image.src="../images/omocha/syuukun_card/wesutan.png";
            var hiru_image=new Image();
            hiru_image.src="../images/omocha/syuukun_card/hiru.png";
            var kengou_image=new Image();
            kengou_image.src="../images/omocha/syuukun_card/kengou.png";
            var omaemooreda_image=new Image();
            omaemooreda_image.src="../images/omocha/syuukun_card/omaemooreda.png";


            var sutahhu_image=new Image();
            sutahhu_image.src="../images/omocha/syuukun_card/sutahhu.png";

            var tensyu_image=new Image();
            tensyu_image.src="../images/omocha/syuukun_card/tensyu.png";
            var sitappa_image=new Image();
            sitappa_image.src="../images/omocha/syuukun_card/sitappa.png";
            /*
            var _image=new Image();
            _image.src="../images/omocha/syuukun_card/.png";
            */
            //--メニュー？

            var kuria=new Image();
            kuria.src="../images/omocha/syuukun_card/kuria.png";
            var okane=new Image();
            okane.src="../images/omocha/syuukun_card/okane.png";
            var omise_image=new Image();
            omise_image.src="../images/omocha/syuukun_card/omise64.png";
            //--お店？

            var sakyura_omise=new Image();
            sakyura_omise.src="../images/omocha/syuukun_card/sakyura_omise.png";

            var ponya_pack=new Image();
            ponya_pack.src="../images/omocha/syuukun_card/ponyapakku.png";
            var jouisyoukanpakku=new Image();
            jouisyoukanpakku.src="../images/omocha/syuukun_card/jouisyoukanpakku.png";

            var zakopakku=new Image();
            zakopakku.src="../images/omocha/syuukun_card/zakopakku.png";
            var mahopakku=new Image();
            mahopakku.src="../images/omocha/syuukun_card/mahoupakku.png";
            var kyoupakku=new Image();
            kyoupakku.src="../images/omocha/syuukun_card/kyoupakku.png";

            var musumepakku=new Image();
            musumepakku.src="../images/omocha/syuukun_card/musumepakku.png";

            var musumepakku2=new Image();
            musumepakku2.src="../images/omocha/syuukun_card/musumepakku2.png";

            
            var amarimonopakku=new Image();
            amarimonopakku.src="../images/omocha/syuukun_card/amarimonopakku.png";
            //--ステージ？
            var henyamoti_title=new Image();
            henyamoti_title.src="../images/omocha/syuukun_card/henyamotinsougen_title.png";
            var henyamoti=new Image();
            henyamoti.src="../images/omocha/syuukun_card/henyamotinsougen.png";
            var henyamotin_kuria=new Image();
            henyamotin_kuria.src="../images/omocha/syuukun_card/henyamotin_kuria.png";

            var saiten_title=new Image();
            saiten_title.src="../images/omocha/syuukun_card/tikaranosaiten_title.png";
            var saiten=new Image();
            saiten.src="../images/omocha/syuukun_card/tikaranosaiten.png";
            var saiten_kuria=new Image();
            saiten_kuria.src="../images/omocha/syuukun_card/tikaranosaiten_kuria.png";

            var burakku_title=new Image();
            burakku_title.src="../images/omocha/syuukun_card/burakku_title.png";
            var burakku_manga=new Image();
            burakku_manga.src="../images/omocha/syuukun_card/burakku_manga.png";
            var burakku_kuria=new Image();
            burakku_kuria.src="../images/omocha/syuukun_card/burakku_kuria.png";
                //森
            var hujounomori_title=new Image();
            hujounomori_title.src="../images/omocha/syuukun_card/hujounomori_title.png";
            var hujounomori_kakoi=new Image();
            hujounomori_kakoi.src="../images/omocha/syuukun_card/hujou_kakoi.png";
            var hujou_kuria=new Image();
            hujou_kuria.src="../images/omocha/syuukun_card/hujou_kuria.png";

            var syuukun_20_0=new Image();
            syuukun_20_0.src="../images/omocha/syuukun_card/syuukun_20_0.png";
            var syuukun_20_1=new Image();
            syuukun_20_1.src="../images/omocha/syuukun_card/syuukun_20_1.png";
            var syuukun_20_2=new Image();
            syuukun_20_2.src="../images/omocha/syuukun_card/syuukun_20_2.png";
            var syuukun_20_3=new Image();
            syuukun_20_3.src="../images/omocha/syuukun_card/syuukun_20_3.png";

            var syuukun_20=[syuukun_20_0,syuukun_20_1,syuukun_20_2,syuukun_20_3];

            var kumo_mori_0=new Image();
            kumo_mori_0.src="../images/omocha/syuukun_card/kumo_mori_0.png";
            var kumo_mori_1=new Image();
            kumo_mori_1.src="../images/omocha/syuukun_card/kumo_mori_1.png";
            var kumo_mori_2=new Image();
            kumo_mori_2.src="../images/omocha/syuukun_card/kumo_mori_2.png";
            var kumo_mori_3=new Image();
            kumo_mori_3.src="../images/omocha/syuukun_card/kumo_mori_3.png";
            var kumo_mori_4=new Image();
            kumo_mori_4.src="../images/omocha/syuukun_card/kumo_mori_4.png";

            var kumo_mori=[kumo_mori_0,kumo_mori_1,kumo_mori_2,kumo_mori_3,kumo_mori_4];

            var sasori_hujou_0=new Image();
            sasori_hujou_0.src="../images/omocha/syuukun_card/sasori_hujou_20_0.png";
            var sasori_hujou_1=new Image();
            sasori_hujou_1.src="../images/omocha/syuukun_card/sasori_hujou_20_1.png";

            var sasori_hujou_20=[sasori_hujou_0,sasori_hujou_1];

            var kurosyuukun_20=new Image();
            kurosyuukun_20.src="../images/omocha/syuukun_card/kurosyuukun_20.png";

            var kanban_20_0=new Image();
            kanban_20_0.src="../images/omocha/syuukun_card/kanban_20_0.png";
            var kanban_20_1=new Image();
            kanban_20_1.src="../images/omocha/syuukun_card/kanban_20_1.png";
            var kanban_20_2=new Image();
            kanban_20_2.src="../images/omocha/syuukun_card/kanban_20_2.png";
            var kanban_20_3=new Image();
            kanban_20_3.src="../images/omocha/syuukun_card/kanban_20_3.png";

            var kanban_20=[kanban_20_0,kanban_20_1,kanban_20_2,kanban_20_3];

            var dokuhakinoko_20_0=new Image();
            dokuhakinoko_20_0.src="../images/omocha/syuukun_card/dokuhakinoko_20_0.png";
            var dokuhakinoko_20_1=new Image();
            dokuhakinoko_20_1.src="../images/omocha/syuukun_card/dokuhakinoko_20_1.png";

            var dokuhakinoko_20=[dokuhakinoko_20_0,dokuhakinoko_20_1];

            var karamaruito_20_0=new Image();
            karamaruito_20_0.src="../images/omocha/syuukun_card/karamaruito_20_0.png";
            var karamaruito_20_1=new Image();
            karamaruito_20_1.src="../images/omocha/syuukun_card/karamaruito_20_1.png";

            var karamaruito_20=[karamaruito_20_0,karamaruito_20_1];

            var ookametake_20=new Image();
            ookametake_20.src="../images/omocha/syuukun_card/ookametake_20.png";
            
            var kankyouseihagoremu_20_0=new Image();
            kankyouseihagoremu_20_0.src="../images/omocha/syuukun_card/kankyouseihagoremu_20_0.png";
            var kankyouseihagoremu_20_1=new Image();
            kankyouseihagoremu_20_1.src="../images/omocha/syuukun_card/kankyouseihagoremu_20_1.png";

            var kankyouseihagoremu_20=[kankyouseihagoremu_20_0,kankyouseihagoremu_20_1];

            var rozusyuu_20_0=new Image();
            rozusyuu_20_0.src="../images/omocha/syuukun_card/rozusyuu_20_0.png";
            var rozusyuu_20_1=new Image();
            rozusyuu_20_1.src="../images/omocha/syuukun_card/rozusyuu_20_1.png";

            var rozusyuu_20=[rozusyuu_20_0,rozusyuu_20_1];

            var ken_1_20=new Image();
            ken_1_20.src="../images/omocha/syuukun_card/ken_1_20.png";

            var kaiwa_window=new Image();
            kaiwa_window.src="../images/omocha/syuukun_card/kaiwa_window.png";

            var morikabe_1_0=new Image();
            morikabe_1_0.src="../images/omocha/syuukun_card/morikabe_1_0.png";
            var morikabe_1_1=new Image();
            morikabe_1_1.src="../images/omocha/syuukun_card/morikabe_1_1.png";

            var morikabe_1=[morikabe_1_0,morikabe_1_1];
                //森

            var syuukungari_title=new Image();
            syuukungari_title.src="../images/omocha/syuukun_card/syuukungari_title.png";
            var syuukungari=new Image();
            syuukungari.src="../images/omocha/syuukun_card/syuukungari.png";
            var syuukungari_kuria=new Image();
            syuukungari_kuria.src="../images/omocha/syuukun_card/syuukungari_kuria.png";

                //デッキ盗難
            var dekkitounan_title=new Image();
            dekkitounan_title.src="../images/omocha/syuukun_card/dekkitounan_title.png";
            var nezumi500=new Image();
            nezumi500.src="../images/omocha/syuukun_card/nezumi500.png";
            var dekanezumi500=new Image();
            dekanezumi500.src="../images/omocha/syuukun_card/dekanezumi500.png";
            
            var zako500=new Image();
            zako500.src="../images/omocha/syuukun_card/zako500.png";
            var maho500=new Image();
            maho500.src="../images/omocha/syuukun_card/maho500.png";
            var kyou500=new Image();
            kyou500.src="../images/omocha/syuukun_card/kyou500.png";
            
            var dokunezumi500=new Image();
            dokunezumi500.src="../images/omocha/syuukun_card/dokunezumi500.png";
            var tamanezumi500=new Image();
            tamanezumi500.src="../images/omocha/syuukun_card/tamanezumi500.png";
            var tatujinnezumi500=new Image();
            tatujinnezumi500.src="../images/omocha/syuukun_card/tatujinnezumi500.png";

            var ken500=new Image();
            ken500.src="../images/omocha/syuukun_card/ken500.png";
            var tairyoku500=new Image();
            tairyoku500.src="../images/omocha/syuukun_card/tairyoku500.png";

            var tamanorinezumi500=new Image();
            tamanorinezumi500.src="../images/omocha/syuukun_card/tamanorinezumi500.png";
            var tyuukun500=new Image();
            tyuukun500.src="../images/omocha/syuukun_card/tyuukun500.png";
            var dekkitounan_kuria=new Image();
            dekkitounan_kuria.src="../images/omocha/syuukun_card/dekkitounan_kuria.png";
                //デッキ盗難

            var henyamotinkingudamu=new Image();
            henyamotinkingudamu.src="../images/omocha/syuukun_card/henyamotinkingudamu.png";
            var henyamotinkingudamu_title=new Image();
            henyamotinkingudamu_title.src="../images/omocha/syuukun_card/henyamotinkingudamu_title.png";
            var henyamotinkingudamu_kuria=new Image();
            henyamotinkingudamu_kuria.src="../images/omocha/syuukun_card/henyamotinkingudamu_kuria.png";

            var tengoku_title=new Image();
            tengoku_title.src="../images/omocha/syuukun_card/tengoku_title.png";
            var tengoku_0=new Image();
            tengoku_0.src="../images/omocha/syuukun_card/tengoku_0000.png";
            var tengoku_1=new Image();
            tengoku_1.src="../images/omocha/syuukun_card/tengoku_0001.png";
            var tengoku_2=new Image();
            tengoku_2.src="../images/omocha/syuukun_card/tengoku_0002.png";
            var tengoku_3=new Image();
            tengoku_3.src="../images/omocha/syuukun_card/tengoku_0003.png";
            var tengoku_4=new Image();
            tengoku_4.src="../images/omocha/syuukun_card/tengoku_0004.png";
            var tengoku_5=new Image();
            tengoku_5.src="../images/omocha/syuukun_card/tengoku_0005.png";
            var tengoku=[tengoku_0,tengoku_1,tengoku_2,tengoku_3,tengoku_4,tengoku_5];
            var tengoku_kuria=new Image();
            tengoku_kuria.src="../images/omocha/syuukun_card/tengoku_kuria.png";

            var seigen_1=new Image();
            seigen_1.src="../images/omocha/syuukun_card/seigen_1.png";
            var seigen_2=new Image();
            seigen_2.src="../images/omocha/syuukun_card/seigen_2.png";
            var seigen_3=new Image();
            seigen_3.src="../images/omocha/syuukun_card/seigen_3.png";
            
            var seigen_title=new Image();
            seigen_title.src="../images/omocha/syuukun_card/seigen_title.png";
            var seigen_kuria=new Image();
            seigen_kuria.src="../images/omocha/syuukun_card/seigen_kuria.png";

            var ending_title=new Image();
            ending_title.src="../images/omocha/syuukun_card/ending_title.png";

            var EX_title=new Image();
            EX_title.src="../images/omocha/syuukun_card/EX_title.png";
            var EX_kuria=new Image();
            EX_kuria.src="../images/omocha/syuukun_card/EX_kuria.png";
            var OKkuria=new Image();
            OKkuria.src="../images/omocha/syuukun_card/okkuria.png";

            var junbityuu_title=new Image();
            junbityuu_title.src="../images/omocha/syuukun_card/junbityuu.png";
            //ここにゲームパラメータを置くとイイネ。
            var my_deck=[];
            var teki_deck=[];
            var my_yamahuda=[];
            var teki_yamahuda=[];
            var my_tehuda=[];
            var teki_tehuda=[];
            var my_ba=["","","","",""];

            var teki_ba=["","","","",""];
            var death_my_ba=["","","","",""];//死亡時演出のためにカードを別の場所に移したい（場に残すとバグの温床になることは自明なので）
            var death_teki_ba=["","","","",""];
            var tukau_mahou=[];//魔法つかった瞬間に消えるのよくないと思った。
            
            var my_haka=[];
            var teki_haka=[];
            //キーボードなど、システムの、あの、アレ、アレさ！-------------------------------------------------
            var key_input="";
            var what_input="";//キーボード同時おしに使う
            var key_interval=0;//n*10[s]　長押しの連続入力に使ってる
            var key_owarasete=0;
            var 長押し阻止=0;//決定ボタンを長押し連打するのはまずいのでは？となったので阻止します。

            var game_phase="タイトル";

            var お金=0;
            //----------------------
            var drop_gold=0;

            var cursor=16;
            var pre_cursor;
            var ba_haiti=[2,1,3,0,4];
            var cursor2=0;
            var cursor_lock=0;//プレイヤーの選択を向こうにしたいときに0以外を入れる。予定。

            var duel_phase="自由";
            var aite_phase=0;//相手のターンに動かしたい。
            var aite_nayami;//相手ターンの悩みフェーズに使うなんか用途不明の変数だ！
            var aite_delay=0;//お前高速で動きすぎ！
            var 誰殴る=0;//誰を殴るかを決めるときに使うことで有名

            var atk_card="";
            var def_card="";
            var tukau_card_num;

            var my_pull=2;
            var my_deck_pull=my_pull;
            var my_deck_pull_編集中=my_deck_pull;
            var my_now_pull=my_pull;
            var my_stage_pull=0;
            var teki_pull=2;
            var 一時的なドロー枚数=[my_now_pull,teki_pull];

            var syousai_card;
            var syousai_state;
            var syousai_state_color;

            var my_kougeki_sum=0;//AI用
            var teki_kougeki_sum=0;//降参にも使ってる

            var tehuda_maisuu=0;//手札の角度覚えるのに使ってる
            var card_kankaku=0;
            var kakudo=10;

            var zuba=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]//zuba64を表示するタイマー
            var yamahuda_damage=[0,0,0,0];//0,2が俺へのダメージで、1,3が相手へのダメージ描写

            var get_card="";
            var card_count=0;
            var new_card=0;

            var time=0;

            var 特殊状態=[];
            var 相手の降参=0;
            
            
            //---上デュエル系？　下デッキ系…？？？？？？？？
            var 所持カード=[];
            var deck_list;
            var teki_deck_list;

            var 編集中デッキ={card_list:[],ACE:[],TOP_ACE:[]};
            var 保存デッキ=[{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]}];
            var カードカウント=0;
            var pre_カード="";

            var sub_phase="基本";

            var MAX_deck=20;
            var MAX_ACE=2;
            var MAX_TOP_ACE=1;

            var カードインデックス=0;
            var カードスワップ=0;
            var カードスワップ_カード=0;//お前が全部グローバルな変数で解決するせいでバグりまくりだぜ！
            var これのデッキ枚数=0;
            var これの所持枚数=0;

            var scroll_x=0;
            var scroll_x2=0;

            var cursor_x=0;
            var cursor_y=0;

            var 編集中ACE=[];
            var 編集中TOP_ACE=[];
            //---------ステージ？
            var stage=1;
            var mini_stage=0;
            var next_mini_stage=0;

            var 演出カウント=-1;
            var next_phase="";

            var MAX_STAGE=1;

            var 初回クリアメッセージフラグ=0;

            var URL_tweet_text="";
                //森
            var mori_stage=[[[[]]]];//xy-xyの四次元になると思う！0:歩ける　1:壁…5:壁　6~:モンスターとか…イベント系…かも…
            var stage_x=0;
            var stage_y=0;
            
            var syuukun_x=0;
            var syuukun_y=0;
            var syuukun_move=[0,0];
            var syuukun_muki=0;

            var 光デカさ=3;
            var 光あふれる世界;

            var 木漏れ日=[[[]]];
            var 雲=[[]];
            for(let i=0;i<5;i++){
                雲.push([Math.random()*300+334,Math.random()*330,Math.random()+0.5]);
            }
            var セリフ="";
            var セリフ_ピ=0;
            var セリフダダダ=0;
            var セリフガガガ=0;
            var pre_セリフダダダ=0;

            var 討伐数=0;
            var 目標討伐数=1000;

                //デッキ盗難
            var 今回のデッキ={card_list:[],ACE:[],TOP_ACE:[]};
            var 今回のデッキ_表示={card_list:[],ACE:[],TOP_ACE:[]};

            var get_mode=0;
                //チャレンジ
            var クリア済み=[0,0,0,0,0,0,0,0,0];
            var 挑戦デッキ=0;
            //------------セーブ
            var save_所持カード=[];
            var save_deck_list={card_list:[],ACE:[],TOP_ACE:[]};
            var all_card=[];

            //---お店

            var パック売るよ=-1;
            //パックの定義は…カードが定義されてないと…できない
            var 購入数=[0,0,0];
            var 金額=[10,75,100,100,10000,7500,7500,1000,0];
            var 出てきたカード=[];
            var 出てきたカード_ソート=[];
            

            onload = function(){
                onload_functions();
                const cnvs = document.getElementById('cnvs');//IDを指定して変数にぶち込む
                const ctx = cnvs.getContext("2d");

                const cnvs2 = document.getElementById('cnvs_hidden');//IDを指定して変数にぶち込む
                const ctx2 = cnvs2.getContext("2d");
                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。

                if (navigator.userAgent.match(/iPhone|Android.+Mobile/)) {//貴様！スマホで見ているな！？
                    cnvs.style.width=100+"%";
                    cnvs.style.height=cnvs.clientWidth+"px";
                }

                var buttons = document.getElementsByClassName("key_button");//ボタン操作
                if( window.ontouchstart === null ){ // 注：ontouchstartが存在しない時は undefined が返る
                    //ようするにタッチ機能がある端末なら
                    for(let i=0;i<buttons.length;i++){
                        buttons[i].addEventListener("touchstart",function(e){//押すと動く
                            e.preventDefault();//ボタンをもとの状態に戻してください（血涙）
                            key_input=this.value;
                            key_interval=-1;//初回限定モード（1回は動作させたいので。）
                            key_owarasete=0;
                        });
                        buttons[i].addEventListener("touchend",function(e){//離すと動く
                            e.preventDefault();//ボタンをもとの状態に戻してください（血涙）
                            if(key_interval!=-1){//一回も実行されてないのに終了するのはボタンとしておかしいので、はじく
                                key_input="";
                                key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                            }else{
                                key_owarasete=1;//一度も実行されてないけど、ボタンはもう押してないのよ。
                            }
                        });
                    }
                }else{
                    //一般的なPCなら
                    for(let i=0;i<buttons.length;i++){
                        buttons[i].addEventListener("mousedown",function(){//押すと動く
                            key_input=this.value;
                            key_interval=-1;//初回限定モード（1回は動作させたいので。）
                            key_owarasete=0;
                        });
                        buttons[i].addEventListener("mouseup",function(){//離すと動く
                            if(key_interval!=-1){//一回も実行されてないのに終了するのはボタンとしておかしいので、はじく
                                key_input="";
                                key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                            }else{
                                key_owarasete=1;//一度も実行されてないけど、ボタンはもう押してないのよ。
                            }
                        });

                    }
                }
                
                document.addEventListener('keydown', function(key){//キーボード操作

                    what_input="";
                    if(key.key=="w" || key.key=="k" || key.key=="ArrowUp"){
                        what_input="↑";
                    }else if(key.key=="a" || key.key=="h" || key.key=="ArrowLeft"){
                        what_input="←";
                    }else if(key.key=="d" || key.key=="l" || key.key=="ArrowRight"){
                        what_input="→";
                    }else if(key.key=="s" || key.key=="j" || key.key=="ArrowDown"){
                        what_input="↓";
                    }else if(key.key=="Enter"){
                        what_input="〇";
                    }else if(key.key=="Shift"){
                        what_input="×";
                    }
                    if(key_input.indexOf(what_input)==-1){//すでに押されていたら、文字列検索でひっかかる。ひっかからないなら-1が帰ってくる
                        key_input=key_input+what_input;//キーボードは同時押しが可能なので書き換えではなく、追加にします。え？キーボードとボタン同時押しされたら？バ～カ
                    }
                    if (what_input != ""){key.preventDefault();}//矢印キーでの操作時に、画面が上下にスクロールしてしまうことを防ぐ

                    
                });
                document.addEventListener('keyup', function(key){//キーボード操作
                    what_input="";
                    if(key.key=="w" || key.key=="ArrowUp"){
                        what_input="↑";
                    }else if(key.key=="a" || key.key=="ArrowLeft"){
                        what_input="←";
                    }else if(key.key=="d" || key.key=="ArrowRight"){
                        what_input="→";
                    }else if(key.key=="s" || key.key=="ArrowDown"){
                        what_input="↓";
                    }else if(key.key=="Enter"){
                        what_input="〇";
                    }else if(key.key=="Shift"){
                        what_input="×";
                    }
                    
                    key_input=key_input.slice(0,key_input.indexOf(what_input))+key_input.slice(key_input.indexOf(what_input)+1);//該当文字を消去
                    if(key_input==""){
                        key_interval=0;//長押しの連続入力に使ってるだけなので長押しが終わったら初期化するんよ
                    }
                });

                function card_draw(print_card,x,y,of_y=0){
                    ctx.drawImage(print_card.card.image,x,y+of_y);
                    if(print_card.state.indexOf("毒:")!=-1){
                        ctx.fillStyle="rgb(200,0,200,0.3)";
                        ctx.fillRect(x,y+of_y,130,200);
                    }
                    if(print_card.state.indexOf("TOP_ACE")!=-1){//なんか変な囲い方してますね…
                        ctx.fillStyle="rgb(255,0,0,1)";
                        ctx.fillRect(x-2,y+of_y,5,200);
                        ctx.fillRect(x+128,y+of_y,5,200);
                        ctx.fillRect(x,y+of_y,133,5);
                        ctx.fillRect(x,y+of_y+195,133,5);
                    }
                    if(print_card.state.indexOf("ACE")!=-1){
                        ctx.fillStyle="rgb(255,255,0)";
                        ctx.fillRect(x-2,y+of_y,5,200);
                        ctx.fillRect(x+128,y+of_y,5,200);
                        ctx.fillRect(x,y+of_y,133,5);
                        ctx.fillRect(x,y+195+of_y,133,5);
                    }
                    
                    if(print_card.state.indexOf("モンスター")!=-1){
                        ctx.drawImage(atk_plate,x,y+104+of_y);
                        ctx.drawImage(def_plate,x,y+152+of_y);
                        ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(255,255,255)";
                        if(print_card.ATK<10){
                            ctx.fillText(print_card.ATK, x+13, y+146+of_y,42);
                        }else{
                            ctx.fillText(print_card.ATK, x+3, y+146+of_y,42);
                        }
                        if(print_card.HP<10){
                            ctx.fillText(print_card.HP, x+13, y+188+of_y,42);
                        }else{
                            ctx.fillText(print_card.HP, x+3, y+188+of_y,42);
                        }
                        for(let i=0;i<print_card.can_ATK;i++){//攻撃可能モンスターにはマークを表示,攻撃可能回数まで。
                            ctx.drawImage(atk_circle,x+10+10*Math.sin(time*Math.PI/64)+i*30,y+20+8*Math.sin(time*Math.PI/16)+of_y+i*30);
                        }
                    }else{//魔法じゃん（ほんまか？）
                        ctx.fillStyle="rgb(0,200,0)";
                        ctx.fillRect(x-2,y+of_y,3,200);
                        ctx.fillRect(x+130,y+of_y,3,200);
                        ctx.fillRect(x,y+of_y,133,3);
                        ctx.fillRect(x,y+197+of_y,133,3);
                    }
                    
                    
                }
                function death_card(shi_card,haka,doko){

                    shi_card.card.effect("死んだ",shi_card);

                    if(haka==teki_haka){
                        shi_card.position="teki_haka";
                        death_teki_ba[doko]=shi_card;
                        death_teki_ba[doko].move=10;
                    }else{
                        shi_card.position="my_haka";
                        death_my_ba[doko]=shi_card;
                        death_my_ba[doko].move=10;
                    }

                    shi_card.HP=shi_card.card.HP;//回復
                    //shi_card.state=shi_card.card.state;
                    shi_card.can_ATK=0;//攻撃不可
                    
                    if(shi_card.state.indexOf("消滅")==-1){
                        haka.push(shi_card);//GO墓場
                    }
                    
                    
                    return "";//場から除去するためにこいつをba_i[n]に代入しておいてくれ。
                    
                }
                function 蘇生(ba,ba_i,haka,haka_i){
                    ba[ba_i]=haka[haka_i];
                    haka.splice(haka_i, 1);
                    if(ba==my_ba){
                        ba[ba_i].position="my_ba";
                    }else{
                        ba[ba_i].position="teki_ba";
                    }
                    
                    ba[ba_i].move=5;
                }
                function syoukan(card,ba_name,num){
                    var ba
                    ba=card;
                    ba.position=ba_name;
                    
                    if(ba.state.indexOf("三回攻撃")!=-1){
                        ba.can_ATK=3;
                    }else if(ba.state.indexOf("二回攻撃")!=-1){
                        ba.can_ATK=2;
                    }else{
                        ba.can_ATK=1;
                    }
                    
                    ba.move=5;
                    if(ba_name=="my_ba"){
                        for(let i=0;i<5;i++){//破滅持ちは死ぬ
                            if(my_ba[i]!=="" && my_ba[i].state.indexOf("破滅")!=-1){
                                my_ba[i]=death_card(my_ba[i],my_haka,i);
                            }
                        }
                        for(let i=0;i<特殊状態.length;i++){
                            if(特殊状態[i]=="攻撃"){
                                ba.ATK+=特殊状態[i+1];
                                i+=1;
                                if(ba.ATK<0){
                                    ba.ATK=0;//マイナスにしたら回復してまう…
                                }
                            }else if(特殊状態[i]=="体力"){
                                ba.HP+=特殊状態[i+1];
                                if(ba.HP<=0){//死んだ…！
                                    ba.HP=1;//慈悲です。召喚前に殺すのがめんどくさくて実装しなかったとかそういうのじゃないです。本当です。
                                }
                                i+=1;
                            }
                        }
                        my_ba[num]=ba;
                        my_ba[num].card.effect("召喚された",["my_ba",my_ba[num]]);
                    }else{
                        for(let i=0;i<5;i++){//破滅持ちは死ぬ
                            if(teki_ba[i]!=="" && teki_ba[i].state.indexOf("破滅")!=-1){
                                teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                            }
                        }
                        teki_ba[num]=ba;
                        teki_ba[num].card.effect("召喚された",["teki_ba",teki_ba[num]]);
                    }
                    
                }
                function デッキカード追加(deck,card,doko){
                    let deck_length=deck.length;
                    deck[deck_length]={card:card};
                    deck[deck_length].ATK=card.ATK;
                    deck[deck_length].HP=card.HP;
                    deck[deck_length].state=card.state.slice();//sliceをつけることで参照渡しをやめさせて値渡しを行わせています
                    deck[deck_length].position=doko;
                }

                function 上位召喚(joui_card,deck,num,継承state){
                    let doko_syoukan;
                    let doko_tehuda;
                    let ba;
                    let deck_length=deck.length;

                    if(deck==my_deck){//自デッキ
                        doko_syoukan="my_ba";
                        ba=my_ba;
                    }else{//敵だね。
                        doko_syoukan="teki_ba";
                        ba=teki_ba;
                    }
                    
                    デッキカード追加(deck,joui_card,doko_syoukan);
                    deck[deck_length].state.push(...継承state);
                    syoukan(deck[deck_length],doko_syoukan,num);
                    
                }
                function deck_initialize(list,deck,yamahuda){
                    //my_deck[i]={card:test_card,ATK:1,HP:1,state:[],position:"my_yamahuda",can_ATK:0};
                    var doko_position;
                    var doko_syoukan;
                    var doko_tehuda;
                    var ba;
                    var tehuda;
                    if(deck==my_deck){
                        doko_position="my_yamahuda";//自デッキの初期化なら自分の山札に入れてね
                        doko_syoukan="my_ba";
                        doko_tehuda="my_tehuda";
                        ba=my_ba;
                        tehuda=my_tehuda;
                    }else{
                        doko_position="teki_yamahuda";//敵だね。
                        doko_syoukan="teki_ba";
                        doko_tehuda="teki_tehuda";
                        ba=teki_ba;
                        tehuda=teki_tehuda;
                    }
                    var nani_card;
                    var imano_num;
                    var swap;
                    var ACE;
                    imano_num=0;

                    for(let i=0;i<list.card_list.length;i++){
                        nani_card=list.card_list[i][0];//このカードn枚山札に入れるぜ！
                        for(let j=0;j<list.card_list[i][1];j++){
                            deck[imano_num]={card:nani_card};//ここだけ描き方が違うのはな、しかたないんやなって
                            deck[imano_num].ATK=nani_card.ATK;
                            deck[imano_num].HP=nani_card.HP;
                            deck[imano_num].state=nani_card.state.slice();//sliceをつけることで参照渡しをやめさせて値渡しを行わせています
                            deck[imano_num].position=doko_position;
                            deck[imano_num].can_ATK=0;//これは攻撃可能かどうかを意味するぞ！山札から攻撃しないでくれよな！（いや、できるやつがいずれでるかもしれんが）
                            yamahuda[imano_num]=deck[imano_num];//とりあえず全部山札にぶちこんでやるぜ～！
                            imano_num+=1;
                        }
                    }
                    
                    ACE=[...list.TOP_ACE];//スプレッド構文　...hoge はhogeの中身と同様になる。
                    
                    let TOPの一時保管=[];//いったんTOP_ACEを隔離しないとダメだと思った

                    for(let j=0;j<ACE.length;j++){//なんでjがiより先にあるかだって？知らないほうがいいことも…あるんだよ
                         for(let i=0;i<yamahuda.length;i++){//TOP_ACEを抜き出す
                            if(yamahuda[i].card==ACE[j]){//TOPを発見した
                                yamahuda[i].state[yamahuda[i].state.length]="TOP_ACE";
                                TOPの一時保管[TOPの一時保管.length]=yamahuda[i];
                                ACE.splice(j,1);
                                yamahuda.splice(i,1);//召喚したので山札減ります。
                                j-=1;//取り出したので
                                break;
                            }
                        }
                        if(ACE.length==0){
                            break;
                        }
                    }

                    ACE=[...list.ACE];//スプレッド構文　...hoge はhogeの中身と同様になる。
                    for(let i=0;i<yamahuda.length;i++){//ACEにACEstateをあげる
                        for(let j=0;j<ACE.length;j++){
                            if(yamahuda[i].card==ACE[j]){
                                
                                yamahuda[i].state[yamahuda[i].state.length]="ACE";
                                ACE.splice(j,1);
                                break;
                            }
                        }
                        if(ACE.length==0){
                            break;
                        }
                    }
                    //ここでシャッフルすべきよ！そうだわ！　→Fisher-Yates shuffleというらしい
                    for(let i=yamahuda.length-1;i>0;i--){//デッキのケツから…
                        var j = Math.floor(Math.random() * (i + 1));//ケツ以下の番号の札をランダムに選び
                        swap =yamahuda[i];//iとjでスワップする。
                        yamahuda[i]=yamahuda[j];
                        yamahuda[j]=swap;
                    }
                    //TOP_ACEの召喚順もランダムに…すると演出が終わるからやめろ
                   

                    //シャッフルが終わったらTOP_ACEを召喚していくぜ！
                    let ACE_count=0;//召喚数見ます
                    for(let i=0;i< TOPの一時保管.length;i++){
                        if(TOPの一時保管[i].state.indexOf("モンスター")!=-1 && ACE_count!=5){//モンスターのTOP_ACEは召喚
                            for(let j=ACE_count;j<5;j++){
                                if(ba[ba_haiti[j]]==""){
                                    syoukan(TOPの一時保管[i],doko_syoukan,ba_haiti[j]);//デッキの最初にいるやつから召喚していく
                                    ACE_count=j+1;
                                    break;
                                }else if(j==4){//なんかしらねえが場が埋まってて召喚できなかったぜ！
                                    ACE_count=5;
                                    tehuda[tehuda.length]=TOPの一時保管[i];
                                    tehuda[tehuda.length-1].position=doko_tehuda;
                                }
                            }
                        }else{//魔法は手札に…もしくは召喚しすぎたモンスター
                            tehuda[tehuda.length]=TOPの一時保管[i];
                            tehuda[tehuda.length-1].position=doko_tehuda;
                        }
                    }
                }
                function pull_card(yamahuda,tehuda=undefined,maisuu){
                    if(yamahuda.length<maisuu){
                        maisuu=yamahuda.length;//山札にカードがないのに引くんじゃない
                    }
                    if(yamahuda==my_yamahuda){//自デッキの初期化なら自分の山札に入れてね
                        for(let i=0;i<maisuu;i++){
                            tehuda[tehuda.length]=yamahuda[yamahuda.length-1];
                            tehuda[tehuda.length-1].position="my_tehuda";
                            yamahuda.splice(-1,1);//ドローしたので山札減ります。
                        }
                    }else{//敵だね。
                        for(let i=0;i<maisuu;i++){
                            tehuda[tehuda.length]=yamahuda[yamahuda.length-1];
                            tehuda[tehuda.length-1].position="teki_tehuda";
                            yamahuda.splice(-1,1);//ドローしたので山札減ります。
                        }
                    }
                    
                    
                }
                function atk_mons(){//体力減らすところまでしかない。このあとに殺してる。…どうなんだ
                    
                    if(def_card.state.indexOf("防御:")!=-1){
                        if(def_card.state[def_card.state.indexOf("防御:")+1]>atk_card.ATK){
                            def_card.HP+=atk_card.ATK;
                        }else{
                            def_card.HP+=def_card.state[def_card.state.indexOf("防御:")+1];
                        }
                    }
                    //防御計算を先に行う理由は防御計算が先に行われるといい感じだからです。
                    //防御側のスキルなどが発動
                    def_card.card.effect("攻撃された");//攻撃カードとか渡したくないですか？→どうせグローバル変数にあるから渡さんでええ！（なるほど～）

                    //攻撃側のスキルが発動
                    atk_card.card.effect("攻撃した");//攻撃カードの効果が後なのは、なんか防御カードが死んで…いや、待て、攻撃カードが死ぬ可能性もあるな、そんなもん実装するなバーカ
                    
                    if(def_card.state.indexOf("雲")!=-1){//雲ちゃんだ
                        if(def_card.HP<=atk_card.ATK){//ダメージもりもりちゃんです…
                            if(duel_phase!="相手"){//俺のターンだから相手への攻撃だぜ！
                                if(atk_card.ATK-def_card.HP<=teki_yamahuda.length && teki_yamahuda.length!=0){//デッキ許容ダメージだぜ
                                    atk_yamahuda(atk_card.ATK-def_card.HP,teki_yamahuda,teki_haka,teki_ba,teki_tehuda);//貫通分のダメージを負ってもらうぜ！
                                    def_card.HP=atk_card.ATK+1;//延命さ
                                }else{
                                    //このあと大ダメージにより死になさい
                                }
                            }else{
                                if(atk_card.ATK-def_card.HP<=my_yamahuda.length && my_yamahuda.length!=0){//デッキ許容ダメージだぜ
                                    atk_yamahuda(atk_card.ATK-def_card.HP,my_yamahuda,my_haka,my_ba,my_tehuda);//貫通分のダメージを負ってもらうぜ！
                                    def_card.HP=atk_card.ATK+1;//延命さ
                                }else{
                                    //このあと大ダメージにより死になさい
                                }
                            }
                            
                        }
                    }else if(atk_card.state.indexOf("貫通")!=-1){//貫通で雲攻撃したときに二重で減らすのは鬼畜の所業なのでelseにしてます。
                        if(atk_card.ATK-def_card.HP>0){//貫通してますね…
                            if(duel_phase!="相手"){//俺のターンだから相手への攻撃だぜ！
                                if(atk_card.ATK-def_card.HP>teki_yamahuda.length){//貫通しすぎだ！
                                    atk_yamahuda(teki_yamahuda.length,teki_yamahuda,teki_haka,teki_ba,teki_tehuda);//デッキには消えてもらいます。
                                }else{
                                    atk_yamahuda(atk_card.ATK-def_card.HP,teki_yamahuda,teki_haka,teki_ba,teki_tehuda);//貫通分のダメージを負ってもらうぜ！
                                }
                                
                            }else{
                                if(atk_card.ATK-def_card.HP>my_yamahuda.length){//貫通しすぎだ！
                                    atk_yamahuda(my_yamahuda.length,my_yamahuda,my_haka,my_ba,my_tehuda);//デッキには消えてもらいます。
                                }else{
                                    atk_yamahuda(atk_card.ATK-def_card.HP,my_yamahuda,my_haka,my_ba,my_tehuda);//貫通分のダメージを負ってもらうぜ！
                                }
                                
                            }
                        }
                    }


                    //ダメージ計算
                    if(def_card.card.name!="導き"){
                        def_card.HP-=atk_card.ATK;
                    }
                    
                }
                function atk_yamahuda(atk,yamahuda,haka,ba,tehuda){
                    var doko_haka;
                    var dare_kati;
                    var doko_syoukan;
                    var doko_tehuda;
                    var haka_length_pre;
                    if(yamahuda==teki_yamahuda){//敵への攻撃さ！
                        dare_kati="俺勝ち";                          
                        doko_haka="teki_haka";
                        doko_syoukan="teki_ba";
                        doko_tehuda="teki_tehuda";
                        haka_length_pre=teki_haka.length;
                    }else{
                        dare_kati="敵勝ち";                          
                        doko_haka="my_haka";
                        doko_syoukan="my_ba";
                        doko_tehuda="my_tehuda";
                        haka_length_pre=my_haka.length;
                    }
                    if(atk>yamahuda.length){//はい死亡～！攻撃された側の負け👍(0枚になっただけでは死なないよ)
                        atk=yamahuda.length;
                        duel_phase=dare_kati;
                    }
                    if(yamahuda==teki_yamahuda){//敵への攻撃さ！
                        yamahuda_damage[1]=atk;
                    }else{
                        yamahuda_damage[0]=atk;
                    }
                    let deck_top;
                    for(let i=0;i<atk;i++){
                        deck_top=yamahuda[yamahuda.length-1];
                        yamahuda.splice(-1,1);//ここにないとドロー系ACEが壊れる
                        if(deck_top.state.indexOf("ACE")!=-1 || deck_top.state.indexOf("TOP_ACE")!=-1){//ACEモンスター来た！
                            if(deck_top.state.indexOf("モンスター")!=-1){
                                for(let j=0;j<5;j++){
                                    if(ba[ba_haiti[j]]==""){
                                        syoukan(deck_top,doko_syoukan,ba_haiti[j]);
                                        if(atk>yamahuda.length+i+1){//召喚時のドロー処理などでデッキ枚数が減っていると枚数がマイナスになったりするので減らす
                                            atk=yamahuda.length+i+1;
                                        }
                                        break;
                                    }
                                    if(j==4){//召喚できなかった（笑）→手札へ
                                        tehuda[tehuda.length]=deck_top;
                                        tehuda[tehuda.length-1].position=doko_tehuda;
                                    }
                                }
                                
                                if(dare_kati=="俺勝ち"){
                                    duel_phase="自由";//最後の砦が召喚されたので勝ちを取り消してターン続行
                                }else{
                                    duel_phase="相手";
                                }
                            }else{//召喚できなかった（笑）→手札へ
                                tehuda[tehuda.length]=deck_top;
                                tehuda[tehuda.length-1].position=doko_tehuda;

                            }
                        }else{
                            haka[haka.length]=deck_top;
                            haka[haka.length-1].position=doko_haka;
                        }
                        
                    }
                    if(yamahuda==teki_yamahuda){//敵への攻撃さ！
                        yamahuda_damage[3]=teki_haka.length-haka_length_pre;
                    }else{
                        yamahuda_damage[2]=my_haka.length-haka_length_pre;
                    }
                }
                function ba_mons_num(ba){
                    var num_of_mons;
                    num_of_mons=0;
                    for(let i=0;i<5;i++){
                        if(ba[i]!=""){
                            num_of_mons+=1;
                        }
                    }
                    return num_of_mons;
                }
                function text_kaigyou_hyouji(txt,x,y,x_haba,y_haba,moji_zenkaku,iro=[]){//テキストをcanvasでも改行してくれるんや！
                    var txt_array;
                    var past_i;
                    var moji_x;
                    var moji_count;
                    var moji_color;
                    var color_count;
                    var iro_count;
                    txt_array=[];
                    past_i=0;
                    moji_count=0;
                    color_count=-1;
                    iro_count=0;
                    moji_color=ctx.fillStyle;
                    ctx.font = moji_zenkaku+"px  'ＭＳ ゴシック'";//フォント設定。
                    for (let i=0; i<txt.length; i++){
                        if(ctx.measureText(txt.substr(past_i,i-past_i+2)).width > x_haba){
                            txt_array[txt_array.length]=txt.substr(past_i,i-past_i+1);
                            past_i=i+1;
                        }
                    }
                    if(past_i!=txt.length){//切り取り余ってますよ
                        txt_array[txt_array.length]=txt.substr(past_i);
                    }
                    if(txt_array.length+1>Math.floor(y_haba/moji_zenkaku)){//縦にはみ出してるぞ
                        text_kaigyou_hyouji(txt,x,y,x_haba,y_haba,moji_zenkaku-1,iro);//ちょっと小さくなってやりなおしてこい
                    }else{
                        if(iro==""){//色ぬりしない
                            for (let i=0; i<txt_array.length; i++){
                                    ctx.fillText(txt_array[i], x, y+(i+1)*moji_zenkaku);//文字を表示していくぜー！
                            }
                        }else{
                            //色を塗りたいという気持ちはありませんか？
                            //iro[[色変えはじめ,塗る文字数,"rgb( , , )"],[],[],...] 
                            iro[iro.length]=[0,0,"終わり"];
                            for (let i=0; i<txt_array.length; i++){
                                moji_x=0;
                                for(let j=0;j<txt_array[i].length;j++){
                                    
                                    if(moji_count==iro[iro_count][0]){
                                        color_count=iro[iro_count][1];
                                        ctx.fillStyle=iro[iro_count][2];
                                        iro_count+=1;
                                    }
                                        
                                    if(color_count>=1){
                                        color_count-=1;
                                    }else if(color_count==0){
                                        color_count-=1;
                                        ctx.fillStyle=moji_color;//色戻して
                                    }
                                    ctx.fillText(txt_array[i][j], x+moji_x, y+(i+1)*moji_zenkaku);//文字を表示していくぜー!(1文字ずつ)
                                    moji_x+=ctx.measureText(txt_array[i][j]).width;
                                    moji_count+=1;
                                }
                            }
                        }
                        ctx.fillStyle=moji_color;//色戻して
                    }
                }
                function takusan_card_draw(card,x,y,x_haba,y_haba){
                    var kakudai;
                    var x_maisuu;
                    kakudai=1;
                    while(card.length>Math.floor(x_haba/(kakudai*140))*Math.floor(y_haba/(kakudai*210))){//拡大率を下げてカードが全部枠に入るように調整する
                        kakudai-=0.01;
                    }
                    x_maisuu=Math.floor(x_haba/(kakudai*140));
                    ctx.save();
                    ctx.scale(kakudai,kakudai);
                    for(let i=0;i<card.length;i++){
                        card_draw(card[i],x/kakudai+140*(i%x_maisuu),y/kakudai+210*(Math.floor(i/x_maisuu)));
                    }
                    ctx.restore();
                }
                function シンプルカード表示(print_card,x,y,of_y=0){
                    ctx.drawImage(print_card.image,x,y+of_y);
                    
                    if(print_card.state.indexOf("モンスター")!=-1){
                        ctx.drawImage(atk_plate,x,y+104+of_y);
                        ctx.drawImage(def_plate,x,y+152+of_y);
                        ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(255,255,255)";
                        if(print_card.ATK<10){
                            ctx.fillText(print_card.ATK, x+13, y+146+of_y,42);
                        }else{
                            ctx.fillText(print_card.ATK, x+3, y+146+of_y,42);
                        }
                        if(print_card.HP<10){
                            ctx.fillText(print_card.HP, x+13, y+188+of_y,42);
                        }else{
                            ctx.fillText(print_card.HP, x+3, y+188+of_y,42);
                        }
                    }else{//魔法じゃん（ほんまか？）
                        ctx.fillStyle="rgb(0,200,0)";
                        ctx.fillRect(x-2,y+of_y,3,200);
                        ctx.fillRect(x+130,y+of_y,3,200);
                        ctx.fillRect(x,y+of_y,133,3);
                        ctx.fillRect(x,y+197+of_y,133,3);
                    }   
                }
                function パックの中身(card,x,y,x_haba,y_haba){
                    var kakudai;
                    var x_maisuu;
                    var hyouji_maisuu=1;
                    var count=0;

                    for(let i=1;i<card.length;i++){
                        if(card[i-1]!=card[i]){
                            hyouji_maisuu+=1;
                        }
                        
                    }

                    kakudai=1;
                    while(hyouji_maisuu>Math.floor(x_haba/(kakudai*140))*Math.floor(y_haba/(kakudai*210))){//拡大率を下げてカードが全部枠に入るように調整する
                        kakudai-=0.01;
                    }
                    x_maisuu=Math.floor(x_haba/(kakudai*140));
                    ctx.save();
                    ctx.scale(kakudai,kakudai);

                    シンプルカード表示(card[0],x/kakudai,y/kakudai);
                    for(let i=1;i<card.length;i++){
                        if(card[i-1]!=card[i]){
                            count+=1;
                            シンプルカード表示(card[i],x/kakudai+140*(count%x_maisuu),y/kakudai+210*(Math.floor(count/x_maisuu)));
                        }
                        
                    }
                    ctx.restore();
                }
                function 出てきたカードの中身(card,x,y,x_haba,y_haba){
                    var kakudai;
                    var x_maisuu;
                    var count=0;

                    kakudai=1;
                    while(card.length>Math.floor(x_haba/(kakudai*140))*Math.floor(y_haba/(kakudai*210))){//拡大率を下げてカードが全部枠に入るように調整する
                        kakudai-=0.01;
                    }
                    x_maisuu=Math.floor(x_haba/(kakudai*140));
                    ctx.save();
                    ctx.scale(kakudai,kakudai);

                    for(let i=0;i<card.length;i++){
                        シンプルカード表示(card[i],x/kakudai+140*(i%x_maisuu),y/kakudai+210*(Math.floor(i/x_maisuu)));
                    }
                    ctx.restore();
                }
                //deck_list={card_list:[[sukurappudoro,2],[atakkumojuru,10]],ACE:[],TOP_ACE:[]};
                function デッキ表示(card,x,y,x_haba,y_haba){
                    var kakudai;
                    var x_maisuu;
                    var hyouji_maisuu=0;
                    var count=0;

                    for(let i=0;i<card.card_list.length;i++){
                        hyouji_maisuu+=card.card_list[i][1];                        
                    }

                    kakudai=1;
                    while(hyouji_maisuu>Math.floor(x_haba/(kakudai*140))*Math.floor(y_haba/(kakudai*210))){//拡大率を下げてカードが全部枠に入るように調整する
                        kakudai-=0.01;
                    }

                    x_maisuu=Math.floor(x_haba/(kakudai*140));
                    ctx.save();
                    ctx.scale(kakudai,kakudai);

                    var 一時_ACE=[...card.ACE];
                    var 一時_TOP_ACE=[...card.TOP_ACE];
                    var もう枠描いたので無視してください=0;
                    for(let i=0;i<card.card_list.length;i++){
                        for(let j=0;j<card.card_list[i][1];j++){
                            もう枠描いたので無視してください=0;
                            for(let k=0;k<一時_TOP_ACE.length;k++){
                                if(一時_TOP_ACE[k]==card.card_list[i][0]){
                                    ctx.fillStyle="rgb(255,0,0)";
                                    ctx.fillRect(x/kakudai+140*(count%x_maisuu)-4,y/kakudai+210*(Math.floor(count/x_maisuu))-4,138,208);
                                    一時_TOP_ACE.splice(k,1);
                                    もう枠描いたので無視してください=1;
                                    break;
                                }
                            }
                            if(もう枠描いたので無視してください==0){
                                for(let k=0;k<一時_ACE.length;k++){
                                    if(一時_ACE[k]==card.card_list[i][0]){
                                        ctx.fillStyle="rgb(255,255,0)";
                                        ctx.fillRect(x/kakudai+140*(count%x_maisuu)-4,y/kakudai+210*(Math.floor(count/x_maisuu))-4,138,208);
                                        一時_ACE.splice(k,1);
                                        break;
                                    }
                                }
                            }
                            
                            シンプルカード表示(card.card_list[i][0],x/kakudai+140*(count%x_maisuu),y/kakudai+210*(Math.floor(count/x_maisuu)));
                            count+=1;
                        }
                        
                    }
                    ctx.restore();
                }
                function 保存デッキ表示(card,x,y,x_haba,y_haba){
                    var kakudai;
                    var x_maisuu;
                    var hyouji_maisuu=0;

                    kakudai=1;
                    while(card.card_list.length>Math.floor(x_haba/(kakudai*140))*Math.floor(y_haba/(kakudai*210))){//拡大率を下げてカードが全部枠に入るように調整する
                        kakudai-=0.01;
                    }

                    x_maisuu=Math.floor(x_haba/(kakudai*140));
                    ctx.save();
                    ctx.scale(kakudai,kakudai);

                    for(let i=0;i<card.ACE.length;i++){
                        ctx.fillStyle="rgb(255,255,0)";
                        ctx.fillRect(x/kakudai+140*(card.ACE[i]%x_maisuu)-4,y/kakudai+210*(Math.floor(card.ACE[i]/x_maisuu))-4,138,208);
                    }
                    for(let i=0;i<card.TOP_ACE.length;i++){
                        ctx.fillStyle="rgb(255,0,0)";
                        ctx.fillRect(x/kakudai+140*(card.TOP_ACE[i]%x_maisuu)-4,y/kakudai+210*(Math.floor(card.TOP_ACE[i]/x_maisuu))-4,138,208);
                    }
                    for(let i=0;i<card.card_list.length;i++){
                        シンプルカード表示(card.card_list[i],x/kakudai+140*(i%x_maisuu),y/kakudai+210*(Math.floor(i/x_maisuu)));
                    }
                    ctx.restore();
                }
                function tokusyu_hyouji(x,y){
                    ctx.font = "32px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                    ctx.fillStyle="rgb(0,0,0)";
                    for(let i=0;i<特殊状態.length;i++){
                        if(特殊状態[i]=="攻撃"){
                            ctx.drawImage(kougeki_1_32,x+40*i,y);
                            ctx.fillText(特殊状態[i+1], x+35+40*i, y+27,30);
                            i+=1;
                        }else if(特殊状態[i]=="体力"){
                            ctx.drawImage(tairyoku_1_32,x+40*i,y);
                            ctx.fillText(特殊状態[i+1], x+35+40*i, y+27,30);
                            i+=1;
                        }
                    }
                }

                function カードパック(x,y,pack){
                    ctx.fillStyle="rgb(20,20,50)";
                    ctx.fillRect(x-2,y-2,134,224);

                    ctx.drawImage(pack,x,y);

                    ctx.beginPath();
                    ctx.arc(x+65,y+12, 8,0,Math.PI*2, true);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.arc(x+65,y+12, 8,0,Math.PI*2, true);
                    ctx.fillStyle ="rgb(20,20,50,0.1)";
                    ctx.fill();

                    ctx.fillStyle="rgb(20,20,20,0.5)";
                    ctx.fillRect(x,y+22,130,2);
                    ctx.fillRect(x,y+22,2,198);
                    ctx.fillRect(x+128,y+22,2,198);
                    ctx.fillRect(x+2,y+218,126,2);
                    ctx.fillRect(x+2,y+24,126,2);
                    
                }
                function パック陳列 (x,y,pack,今選ばれてます){
                    if(今選ばれてます){
                        ctx.fillStyle="rgb(0,0,0,0.2)";
                        ctx.fillRect(x-10,y,140,235);
                        カードパック(x,y,pack);
                        カードパック(x+10,y,pack);
                        ctx.fillStyle="rgb(0,0,0,0.2)";
                        ctx.fillRect(x+25,y,5,220);
                        カードパック(x+30,y,pack);
                        ctx.fillStyle="rgb(0,0,0,0.2)";
                        ctx.fillRect(x+60,y,40,220);

                        ctx.fillStyle="rgb(20,20,50)";
                        ctx.beginPath();
                        ctx.arc(x+95,y+12, 8,0,Math.PI*2, true);
                        ctx.stroke();
                        ctx.beginPath();

                        ctx.beginPath();
                        ctx.arc(x+95,y+12, 7,0,Math.PI*2, true);
                        ctx.fillStyle ="rgb(150,150,150)";
                        ctx.fill();

                        カードパック(x+100,y,pack);
                        
                        ctx.beginPath();
                        ctx.arc(x+165,y+12, 8,0,Math.PI*2, true);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.arc(x+165,y+2, 8,0,Math.PI*2, true);
                        ctx.stroke();
                        ctx.beginPath();

                        ctx.fill();
                        ctx.arc(x+165,y+12, 7,0,Math.PI*2, true);
                        ctx.fillStyle ="rgb(200,200,200)";
                        ctx.fill();
                        ctx.beginPath();
                        ctx.arc(x+165,y+2, 7,0,Math.PI*2, true);
                        ctx.fillStyle ="rgb(200,200,200)";
                        ctx.fill();
                        
                    }else{
                        ctx.fillStyle="rgb(0,0,0,0.2)";
                        ctx.fillRect(x-10,y,140,235);
                        カードパック(x,y,pack);
                        カードパック(x+10,y,pack);
                        ctx.fillStyle="rgb(0,0,0,0.2)";
                        ctx.fillRect(x+25,y,5,220);
                        カードパック(x+30,y,pack);
                        ctx.fillStyle="rgb(0,0,0,0.2)";
                        ctx.fillRect(x+50,y,10,220);
                        カードパック(x+60,y,pack);

                        ctx.fillStyle="rgb(20,20,50)";
                        ctx.fillRect(x+125,y+3,40,18);
                        
                        ctx.beginPath();
                        ctx.arc(x+125,y+12, 8,0,Math.PI*2, true);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.arc(x+165,y+12, 8,0,Math.PI*2, true);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.arc(x+165,y+2, 8,0,Math.PI*2, true);
                        ctx.stroke();
                        ctx.beginPath();

                        ctx.beginPath();
                        ctx.arc(x+125,y+12, 7,0,Math.PI*2, true);
                        ctx.fillStyle ="rgb(200,200,200)";
                        ctx.fill();
                        ctx.arc(x+165,y+12, 7,0,Math.PI*2, true);
                        ctx.fillStyle ="rgb(200,200,200)";
                        ctx.fill();
                        
                        
                        ctx.fillStyle="rgb(200,200,200)";
                        ctx.fillRect(x+125,y+5,40,14);

                        ctx.fillStyle="rgb(0,0,0,0.4)";
                        ctx.fillRect(x,y,190,220);

                        ctx.beginPath();
                        ctx.arc(x+165,y+2, 7,0,Math.PI*2, true);
                        ctx.fillStyle ="rgb(200,200,200)";
                        ctx.fill();
                        ctx.fillStyle="rgb(200,200,200)";
                        ctx.fillRect(x+125,y+5,40,2);
                    }
                    
                }
                function カードゲット(card){//パックでの入手は毎回セーブ走っちゃうのもアレだし放置で　←対応すればいいだけでは？　←絶対バグるからヤダ
                    let new_card=0;
                    //取得カード決定
                    for(let i=0;i<所持カード.length;i++){
                        if(所持カード[i][0].name==card.name){//持ってる？このカード
                            所持カード[i][1]+=1;
                            new_card=1;//このカード持ってたわ
                            break;
                        }
                    }
                    if(new_card==0){//新規カードだ！
                        所持カード[所持カード.length]=[card,1];
                    }
                    所持カードのセーブ();
                }
                function 光(x,y){//偉大なる先生により与えられた光です。大切にしましょう。
                    let iro_index = (y * 100 + x) * 4;//100っていうのはキャンバスが100だからさ
                    let iro_heikin;
                    iro_heikin=(光あふれる世界.data[iro_index + 0]+光あふれる世界.data[iro_index + 1]+光あふれる世界.data[iro_index + 2])/150;//平均じゃないじゃん→そうだね
                    光あふれる世界.data[iro_index + 0]=光あふれる世界.data[iro_index + 0]+((光あふれる世界.data[iro_index + 0]/iro_heikin));
                    光あふれる世界.data[iro_index + 1]=光あふれる世界.data[iro_index + 1]+((光あふれる世界.data[iro_index + 1]/iro_heikin));
                    光あふれる世界.data[iro_index + 2]=光あふれる世界.data[iro_index + 2]+((光あふれる世界.data[iro_index + 2]/iro_heikin));
                    
                }
                function 森イベント(ID){
                    if(ID==6){
                        演出カウント=1;
                        mini_stage=2;//戦闘モード
                        next_mini_stage=1;
                        teki_deck_list=sasori_hujou_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                        teki_pull=2;//ドロー枚数
                        drop_gold=50;//お金ー！

                        mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]=0;//消滅
                        討伐数+=1;
                    }else if(ID==7){
                        mini_stage=3;//会話モード
                        セリフガガガ=0;
                        セリフ="気が付いているか？この森に入った時点で戦闘が開始されている…誰と戦ってるんだ？………………そこらへんの敵を倒しても戦闘は終わらねえ、無駄に戦闘を重ねるとデッキがなくなっちまうぞ。";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==8){
                        mini_stage=3;//会話モード
                        セリフガガガ=0;
                        セリフ="毒になったらターン終了時に毒の分だけダメージを受けてしまうぞ！治す方法は…未実装！";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==9){
                        mini_stage=3;//会話モード
                        セリフガガガ=1;
                        セリフ="おい！看板にはなんか有益な情報が書いてあると思ったら大間違いだぞ！いいな！";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==10){
                        演出カウント=1;
                        mini_stage=2;//戦闘モード
                        next_mini_stage=1;
                        teki_deck_list=dokuhakinoko_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                        teki_pull=2;//ドロー枚数
                        drop_gold=20;//お金ー！

                        mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]=0;//消滅
                        討伐数+=1;
                    }else if(ID==11){
                        mini_stage=3;//会話モード
                        セリフガガガ=1;
                        セリフ="キノコうめええええええええええええええええええええええええええええええええええええええええええええええええええええええええええええええええええええ　ｳｯ";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==12){
                        mini_stage=3;//会話モード
                        セリフガガガ=1;
                        セリフ="キノコうめええええええええええええええええええええええええええええええええええええええええええええええええええええええええええええええええええええ　ｳｯ";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==13){
                        mini_stage=3;//会話モード
                        セリフガガガ=0;
                        if(目標討伐数>=討伐数){
                            セリフ="現在特別プログラム実施中！ボスモンスター以外をすべて倒して豪華景品獲得！詳しくはホームページを御覧ください！　htttps://syuu-kun.kyou-mo.gen-ki "+"…残り討伐数:"+(目標討伐数-討伐数);
                        }else{
                            セリフ="お楽しみいただけましたか？アンケートにご協力ください　htttps://syuu-kun.kyou-mo.gen-ki/anke----to ";
                        }
                        
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==14){
                        演出カウント=1;
                        mini_stage=2;//戦闘モード
                        next_mini_stage=1;
                        teki_deck_list=karamaruito_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                        teki_pull=3;//ドロー枚数
                        drop_gold=50;//お金ー！

                        mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]=0;//消滅
                        討伐数+=1;
                    }else if(ID==15){
                        演出カウント=1;
                        mini_stage=2;//戦闘モード
                        next_mini_stage=1;
                        teki_deck_list=ookametake_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                        teki_pull=1;//ドロー枚数
                        drop_gold=350;//お金ー！

                        mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]=0;//消滅
                        討伐数+=1;
                    }else if(ID==16){
                        演出カウント=1;
                        mini_stage=2;//戦闘モード
                        next_mini_stage=1;
                        teki_deck_list=kankyouseihagoremu_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                        teki_pull=2;//ドロー枚数
                        drop_gold=150;//お金ー！

                        mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]=0;//消滅
                        討伐数+=1;
                    }else if(ID==19){
                        mini_stage=3;//会話モード
                        セリフガガガ=0;
                        セリフ="僕の触手による戦闘継続妨害を受けていてもここまで来るとはね…なかなかやるじゃないか";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==18){
                        if(討伐数>=目標討伐数){
                            演出カウント=1;
                            mini_stage=2;//戦闘モード
                            next_mini_stage=1;
                            teki_deck_list=kanbansan_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                            teki_pull=2;//ドロー枚数
                            drop_gold=500;//お金ー！

                            mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]=0;//消滅
                            討伐数+=1;
                        } 
                    }else if(ID==17){
                        if(特殊状態.length==0){
                            特殊状態.push("攻撃");
                            特殊状態.push(1);
                        }else{
                            for(let i=0;i<特殊状態.length;i++){
                                if(特殊状態[i]=="攻撃"){
                                    特殊状態[i+1]+=1;
                                    break;
                                }
                                if(i==特殊状態.length-1){
                                    特殊状態.push("攻撃");
                                    特殊状態.push(1);
                                }
                            }
                        }
                        
                        mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]=0;//消滅
                    }else if(ID==20){
                        mini_stage=3;//会話モード
                        セリフガガガ=1;
                        セリフ="てめえか！森に入ってからずっと戦ってることになってたの！";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==21){
                        mini_stage=3;//会話モード
                        セリフガガガ=0;
                        セリフ="フｯ…君たちもあの人の声に呼ばれてこの世界に来たんだろう？だとしたらボクのライバルってことになる…ね";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==22){
                        mini_stage=3;//会話モード
                        セリフガガガ=0;
                        セリフ="声？なんの話だ？";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==23){
                        mini_stage=3;//会話モード
                        セリフガガガ=0;
                        セリフ="声を聞いてないのかい？ああ、愛を受け取れなかったのか…哀れに…";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==24){
                        mini_stage=3;//会話モード
                        セリフガガガ=0;
                        セリフ="あー…コイツはこの世界のオリジナルしゅうくんだから声に呼ばれてこの世界にいるわけじゃあないぞ";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==25){
                        mini_stage=3;//会話モード
                        セリフガガガ=1;
                        セリフ="そうか…ならば、なおさら君達をここでつぶしておくべきだね！美しく散るがいい！";
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(ID==26){
                        演出カウント=1;
                        mini_stage=2;//戦闘モード
                        next_mini_stage=4;//クリアじゃー！！！
                        teki_deck_list=rozusyuu_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                        teki_pull=2;//ドロー枚数
                        drop_gold=350;//お金ー！

                        mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]=0;//消滅
                        討伐数+=1;
                        cursor2=0;
                    }
                }
                function セリフ表示(x,y,x_haba,文字サイズ,改行数){
                    let txt=[""];
                    let セリフ改行先頭=セリフ_ピ;//ピが表示する先頭なのでもらってください。

                    
                    ctx.font = 文字サイズ+"px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                    ctx.fillStyle="rgb(255,255,255)";//白文字に限定すなー！☝汗汗
                    
                    for(let i=0; i<改行数;i++){//表示する文だけまわす
                        if(セリフ改行先頭>=セリフ.length){//これ以上表示するものないぜ
                            break;
                        }
                        for(let j=0;j<セリフ.length-セリフ改行先頭+1;j++){
                            if(ctx.measureText(セリフ.substr(セリフ改行先頭,j)).width>x_haba){//超えちまったぜ…！一線をな…！
                                if(セリフダダダ-セリフ改行先頭<j-1){
                                    txt[i]=セリフ.substr(セリフ改行先頭,セリフダダダ-セリフ改行先頭);//ダダダ中は途中までで切ってくらさい
                                }else{
                                    txt[i]=セリフ.substr(セリフ改行先頭,j-1);//ダダダ越え
                                }                                
                                セリフ改行先頭+=j-1;
                                break;
                            }
                            if(j==セリフ.length-セリフ改行先頭){//文章終わった
                                if(セリフダダダ-セリフ改行先頭<j){
                                    txt[i]=セリフ.substr(セリフ改行先頭,セリフダダダ-セリフ改行先頭);//ダダダ中は途中までで切ってくらさい
                                }else{
                                    txt[i]=セリフ.substr(セリフ改行先頭,j);//ダダダ越え
                                }        
                                セリフ改行先頭+=j;
                            }
                        }
                        
                        //ctx.fillText(txt[i], x, y+i*(文字サイズ+2)+文字サイズ+セリフダダダ%2*5);//表示するぜ！ダダダしてるとなんか縦に揺れるの読みにくいぜ！
                        ctx.fillText(txt[i], x, y+i*(文字サイズ+2)+文字サイズ+セリフガガガ%2*5);//表示するぜ
                        
                    }
                    if(セリフガガガ!=0){
                        セリフガガガ+=1;//うるせえ！
                    }
                    if(pre_セリフダダダ==-1){//ボタンをおすとこれになって
                        セリフダダダ=セリフ改行先頭;//ダダダが加速してセリフが全部表示される
                    }
                    pre_セリフダダダ=セリフダダダ;//ダダダが終わっているとpreに変化が起きないってわけサ　←オイ！マシな実装をしろ　←帰って
                    if(セリフダダダ<セリフ改行先頭){
                        セリフダダダ+=1;//ダダダ
                    }else{   
                        if(セリフ.length>セリフダダダ){
                            ctx.fillText("▼",x+x_haba-文字サイズ, y+(改行数-0.5)*(文字サイズ+2)+文字サイズ-Math.floor(time%30/15)*10);//こうさ、続きがあることがわかるとユーザーは感謝するんだ
                        }   
                    }
                }
                function 二十ドット表示(x,y,ID,キャンバス,倍率){//二十というのはドットの大きさが20×20だからです。　まずい！2^n警察がきた！　この子だけは！この子だけは！
                    x=x/倍率;
                    y=y/倍率;
                    ctx.save();
                    ctx.imageSmoothingEnabled = false;//画像を拡大してもぼやけない！えらいぞ～
                    ctx.scale(倍率,倍率);
                    if(ID==1){
                        キャンバス.drawImage(morikabe_1[(x+y)/20%2],x,y);
                    }else if(ID==6){
                        キャンバス.drawImage(sasori_hujou_20[Math.floor(time%30/20)],x,y);
                    }else if(ID==7 || ID==20 || ID==24){
                        キャンバス.drawImage(kurosyuukun_20,x,y);
                    }else if(ID==8){
                        キャンバス.drawImage(kanban_20[Math.floor(time%40/10)],x,y);
                    }else if(ID==9){
                        キャンバス.drawImage(kanban_20[Math.floor(time%4)],x,y);
                    }else if(ID==10){
                        キャンバス.drawImage(dokuhakinoko_20[Math.floor((time+x+y)%30/20)],x,y);
                    }else if(ID==11){
                        キャンバス.drawImage(sasori_hujou_20[Math.floor(time%2)],x,y);
                    }else if(ID==12){
                        キャンバス.drawImage(kurosyuukun_20,x,y+time%3-1);
                    }else if(ID==13){
                        キャンバス.drawImage(kanban_20[Math.floor(time%40/10)],x,y);
                    }else if(ID==14){
                        キャンバス.drawImage(karamaruito_20[Math.floor((time+x+y)%30/20)],x,y);
                    }else if(ID==15){
                        キャンバス.drawImage(ookametake_20,x,y);
                    }else if(ID==16){
                        キャンバス.drawImage(kankyouseihagoremu_20[Math.floor((time)%30/20)],x,y);
                    }else if(ID==19 || ID==21 || ID==23 || ID==25 ){
                        キャンバス.drawImage(rozusyuu_20[Math.floor((time)%30/20)],x,y);
                    }else if(ID==18){
                        if(討伐数>=目標討伐数){
                           キャンバス.drawImage(kanban_20[Math.floor(time%40/10)],x,y);
                        }
                    }else if(ID==17){
                        キャンバス.drawImage(ken_1_20,x,y);
                    }else if(ID==22){
                        キャンバス.drawImage(syuukun_20_1,x,y);
                    }
                    
                    ctx.restore();
                    
                }
                function 不浄の森(){
                    if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                        key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                        for(let i=0;i<key_input.length;i++){
                            if(key_input.charAt(i)=="↑"){
                                if(mini_stage==1){
                                    if(syuukun_y==0){
                                        syuukun_y=4;
                                        stage_y-=1;
                                    }else if(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y-1]!=1){
                                        syuukun_y-=1;
                                        syuukun_move[1]+=20;
                                        if(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]>5){//イベントら～
                                            森イベント(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]);
                                        }
                                    }
                                }
                            }else if(key_input.charAt(i)=="←"){
                                if(mini_stage==1){
                                    if(syuukun_x==0){
                                        syuukun_x=4;
                                        stage_x-=1;
                                        syuukun_muki=0;
                                    }else if(mori_stage[stage_x][stage_y][syuukun_x-1][syuukun_y]!=1){
                                        syuukun_x-=1;
                                        syuukun_move[0]+=20;
                                        if(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]>5){//イベントら～
                                            森イベント(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]);
                                        }
                                    }
                                }else if(mini_stage==4){
                                    cursor2=(cursor2+1)%2;
                                }
                            }else if(key_input.charAt(i)=="→"){
                                if(mini_stage==1){
                                    if(syuukun_x==4){
                                        syuukun_x=0;
                                        stage_x+=1;
                                        syuukun_muki=1;
                                    }else if(mori_stage[stage_x][stage_y][syuukun_x+1][syuukun_y]!=1){
                                        syuukun_x+=1;
                                        syuukun_move[0]+=-20;
                                        if(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]>5){//イベントら～
                                            森イベント(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]);
                                        }
                                    }
                                }else if(mini_stage==4){
                                    cursor2=(cursor2+1)%2;
                                }
                            }else if(key_input.charAt(i)=="↓"){
                                if(mini_stage==1){
                                    if(syuukun_y==4){
                                        syuukun_y=0;
                                        stage_y+=1;
                                    }else if(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y+1]!=1){
                                        syuukun_y+=1;
                                        syuukun_move[1]+=-20;
                                        if(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]>5){//イベントら～
                                            森イベント(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]);
                                        }
                                    }
                                }
                            }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                長押し阻止=1;
                                if(mini_stage==1){
                                }else if(mini_stage==3){
                                    if(pre_セリフダダダ==セリフダダダ){
                                        if(セリフ.length>セリフダダダ){
                                            セリフ_ピ=セリフダダダ;
                                        }else{
                                            if(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]>=19){
                                                mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]+=1;
                                                森イベント(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]);
                                            }else{
                                                mini_stage=1;
                                            }
                                           
                                        }
                                    }else{
                                        pre_セリフダダダ=-1;
                                    }
                                }else if(mini_stage==4){
                                    if(cursor2==0){
                                        初回クリアメッセージフラグ=0;
                                        next_phase="ステージ選択";
                                        演出カウント=1;
                                        cursor=3;
                                    }else{
                                        key_input="";//なんかこれないとボタン操作がいかれる
                                        URL_tweet_text="https://twitter.com/intent/tweet?text=不浄の森を突破した！討伐数："+討伐数+"/28%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                        window.open( URL_tweet_text, '_blank'); 
                                    }
                                }
                            }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                if(mini_stage==1){
                                }else if(mini_stage==3){
                                    if(pre_セリフダダダ==セリフダダダ){
                                        if(セリフ.length>セリフダダダ){
                                            セリフ_ピ=セリフダダダ+1;
                                        }else{
                                            if(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]>=19){
                                                mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]+=1;
                                                森イベント(mori_stage[stage_x][stage_y][syuukun_x][syuukun_y]);
                                            }else{
                                                mini_stage=1;
                                            }
                                        }
                                    }else{
                                        pre_セリフダダダ=-1;
                                    }
                                }
                                長押し阻止=1;
                            }
                            
                        }
                        if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                            key_input="";
                            key_interval=0;
                        }
                    }else if(key_interval>0){
                        key_interval=key_interval-1;//カウントダウン
                    }

                    if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                        長押し阻止=0; 
                    }
                    
                    if(mini_stage==0){
                        討伐数=0;
                        目標討伐数=26;

                        my_deck=[];//初期化初期化ー！って初期化しなくて良いヤツも初期化してる気がする。まあいいか
                        
                        my_yamahuda=[];
                        my_tehuda=[];
                        my_ba=["","","","",""];
                        death_my_ba=["","","","",""];//死亡時演出のためにカードを別の場所に移したい（場に残すとバグの温床になることは自明なので）
                        tukau_mahou=[];//魔法つかった瞬間に消えるのよくないと思った。
                        my_haka=[];

                        
                        deck_initialize(deck_list,my_deck,my_yamahuda);

                        
                        for(let i=0;i<5;i++){
                            if(my_ba[i]!=""){
                                my_ba[i].card.effect("ターン開始",["自ターン",i]);
                            }
                        }

                        my_now_pull=my_deck_pull+my_stage_pull;//場合によってはここで増やしてもいいと、でゆっちは思うよ
                        pull_card(my_yamahuda,my_tehuda,my_now_pull);

                        mini_stage=1;//これを基準世界とする
                        mori_stage[0]=[];
                        mori_stage[0][0]=[[1,1,1,1,1],[1,1,7,1,1],[1,8,0,1,1],[1,1,0,9,1],[1,1,0,1,1]];//xy-xyの四次元になると思う！0:歩ける　1:壁…5:壁　6~:モンスターとか…イベント系…かも…
                        mori_stage[0][1]=[[1,1,1,1,1],[1,11,10,0,0],[1,10,0,0,0],[1,0,0,0,0],[1,0,0,0,0]];
                        mori_stage[0][2]=[[1,1,1,1,1],[0,0,0,0,0],[0,0,6,0,1],[0,0,0,0,1],[0,0,0,0,1]];
                        mori_stage[0][3]=[[1,1,1,1,1],[0,0,0,0,0],[1,1,1,1,1],[1,0,15,0,1],[1,0,1,0,1]];
                        mori_stage[0][4]=[[1,1,1,1,1],[0,0,0,10,1],[1,1,0,10,1],[1,12,0,10,1],[1,1,1,1,1]];
                        mori_stage[1]=[];
                        mori_stage[1][0]=[[1,1,0,1,1],[1,0,0,0,1],[1,6,0,0,0],[1,0,0,0,1],[1,1,0,1,1]];
                        mori_stage[1][1]=[[1,0,0,0,0],[1,0,0,0,0],[0,0,0,0,0],[1,10,0,0,0],[1,1,1,1,1]];
                        mori_stage[1][2]=[[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,13,1],[1,1,0,1,1]];
                        mori_stage[1][3]=[[1,0,1,0,1],[1,0,1,17,1],[1,0,1,1,1],[1,0,0,0,0],[1,1,1,1,1]];
                        mori_stage[1][4]=[[1,1,1,1,1],[1,0,0,16,1],[1,0,0,0,1],[0,0,0,0,1],[1,1,0,0,1]];
                        mori_stage[1][5]=[[1,1,1,1,1],[1,0,14,0,0],[1,0,1,1,1],[1,0,0,0,0],[1,0,1,1,1]];
                        mori_stage[1][6]=[[1,1,1,1,1],[0,10,10,16,1],[1,1,1,0,0],[0,0,15,16,1],[1,1,1,1,1]];
                        mori_stage[1][7]=[[1,1,1,1,1],[1,0,0,0,1],[0,0,0,19,1],[1,0,0,0,1],[1,1,1,1,1]];
                        mori_stage[2]=[];
                        mori_stage[2][0]=[[1,1,10,1,1],[1,0,0,10,1],[1,10,0,10,1],[1,0,10,10,1],[1,1,1,1,1]];
                        mori_stage[2][1]=[[1,1,1,1,1],[1,17,1,1,1],[1,0,1,0,0],[1,0,15,0,1],[1,1,1,1,1]];
                        mori_stage[2][2]=[[1,1,0,1,1],[1,0,0,14,1],[0,0,0,0,0],[1,1,1,1,1],[1,1,1,1,1]];
                        mori_stage[2][3]=[[1,1,1,1,1],[1,1,0,0,0],[0,0,0,1,1],[1,14,0,0,0],[1,1,1,1,1]];
                        mori_stage[2][4]=[[1,1,0,0,1],[0,0,0,1,1],[1,1,1,0,0],[0,0,6,0,1],[1,1,1,1,1]];
                        mori_stage[2][5]=[[1,0,1,1,1],[1,0,0,18,1],[0,0,0,1,1],[1,1,1,1,1],[1,1,1,1,1]];
                        
                        //6サソリ　10毒　14クモ 15亀 16ゴレム   


                        木漏れ日[0]=[[]];//x,y,揺れる方向
                        光デカさ=4;
                        for(let i=0;i<光デカさ*光デカさ;i++){
                            木漏れ日[0].push([44+i%光デカさ,90+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([14+i%光デカさ,10+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([17+i%光デカさ,12+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([20+i%光デカさ,9+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([39+i%光デカさ,47+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([39+i%光デカさ,52+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([43+i%光デカさ,52+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([47+i%光デカさ,51+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([51+i%光デカさ,52+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([43+i%光デカさ,48+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([47+i%光デカさ,47+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([51+i%光デカさ,46+Math.floor(i/光デカさ),0]);

                            木漏れ日[0].push([84+i%光デカさ,28+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([88+i%光デカさ,58+Math.floor(i/光デカさ),0]);
                            木漏れ日[0].push([85+i%光デカさ,57+Math.floor(i/光デカさ),0]);

                            木漏れ日[0].push([45+i%光デカさ,40+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([49+i%光デカさ,41+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([53+i%光デカさ,41+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([57+i%光デカさ,41+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([53+i%光デカさ,45+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([57+i%光デカさ,45+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([57+i%光デカさ,37+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([61+i%光デカさ,39+Math.floor(i/光デカさ),1]);

                            木漏れ日[0].push([68+i%光デカさ,4+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([67+i%光デカさ,1+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([17+i%光デカさ,70+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([12+i%光デカさ,73+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([19+i%光デカさ,66+Math.floor(i/光デカさ),1]);
                            木漏れ日[0].push([89+i%光デカさ,76+Math.floor(i/光デカさ),1]);
                        }
                        木漏れ日[1]=[];
                        for(let i=0;i<16;i++){
                            木漏れ日[1].push([44+i%光デカさ,90+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([47+i%光デカさ,92+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([17+i%光デカさ,12+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([27+i%光デカさ,15+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([77+i%光デカさ,42+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([78+i%光デカさ,43+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([81+i%光デカさ,38+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([88+i%光デカさ,3+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([6+i%光デカさ,88+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([10+i%光デカさ,86+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([1+i%光デカさ,79+Math.floor(i/光デカさ),0]);

                            木漏れ日[1].push([48+i%光デカさ,14+Math.floor(i/光デカさ),1]);
                            木漏れ日[1].push([69+i%光デカさ,11+Math.floor(i/光デカさ),1]);
                            木漏れ日[1].push([67+i%光デカさ,50+Math.floor(i/光デカさ),1]);
                            木漏れ日[1].push([82+i%光デカさ,53+Math.floor(i/光デカさ),1]);
                            木漏れ日[1].push([29+i%光デカさ,76+Math.floor(i/光デカさ),1]);
                            木漏れ日[1].push([69+i%光デカさ,16+Math.floor(i/光デカさ),1]);

                            木漏れ日[1].push([82+i%光デカさ,79+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([88+i%光デカさ,79+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([92+i%光デカさ,79+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([88+i%光デカさ,83+Math.floor(i/光デカさ),0]);
                            木漏れ日[1].push([90+i%光デカさ,75+Math.floor(i/光デカさ),0]);

                            木漏れ日[1].push([88+i%光デカさ,74+Math.floor(i/光デカさ),1]);
                            木漏れ日[1].push([84+i%光デカさ,74+Math.floor(i/光デカさ),1]);
                            木漏れ日[1].push([92+i%光デカさ,74+Math.floor(i/光デカさ),1]);
                            木漏れ日[1].push([87+i%光デカさ,70+Math.floor(i/光デカさ),1]);
                            木漏れ日[1].push([91+i%光デカさ,70+Math.floor(i/光デカさ),1]);

                            木漏れ日[1].push([87+i%光デカさ,80+Math.floor(i/光デカさ),1]);
                        }
                        木漏れ日[2]=[];
                        光デカさ=10;
                        for(let i=0;i<光デカさ*光デカさ;i++){
                            木漏れ日[2].push([44+i%光デカさ,44+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([45+i%光デカさ,44+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([54+i%光デカさ,44+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([55+i%光デカさ,44+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([44+i%光デカさ,34+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([45+i%光デカさ,34+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([34+i%光デカさ,34+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([35+i%光デカさ,34+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([38+i%光デカさ,54+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([35+i%光デカさ,49+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([64+i%光デカさ,54+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([65+i%光デカさ,49+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([60+i%光デカさ,24+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([59+i%光デカさ,29+Math.floor(i/光デカさ),1]);

                        }
                        光デカさ=3;
                        for(let i=0;i<光デカさ*光デカさ;i++){
                            木漏れ日[2].push([44+i%光デカさ,44+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([45+i%光デカさ,44+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([54+i%光デカさ,46+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([55+i%光デカさ,42+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([44+i%光デカさ,33+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([46+i%光デカさ,34+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([34+i%光デカさ,34+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([35+i%光デカさ,30+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([34+i%光デカさ,55+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([35+i%光デカさ,52+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([46+i%光デカさ,36+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([42+i%光デカさ,43+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([44+i%光デカさ,26+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([52+i%光デカさ,46+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([24+i%光デカさ,13+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([45+i%光デカさ,24+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([34+i%光デカさ,64+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([15+i%光デカさ,40+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([24+i%光デカさ,35+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([35+i%光デカさ,42+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([64+i%光デカさ,55+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([55+i%光デカさ,52+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([66+i%光デカさ,76+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([72+i%光デカさ,63+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([64+i%光デカさ,56+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([52+i%光デカさ,86+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([54+i%光デカさ,73+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([65+i%光デカさ,64+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([44+i%光デカさ,54+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([65+i%光デカさ,70+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([64+i%光デカさ,55+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([75+i%光デカさ,62+Math.floor(i/光デカさ),1]);

                        }

                        光デカさ=1;
                        for(let i=0;i<光デカさ*光デカさ;i++){
                            木漏れ日[2].push([45+i%光デカさ,44+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([46+i%光デカさ,44+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([58+i%光デカさ,46+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([56+i%光デカさ,42+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([43+i%光デカさ,33+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([47+i%光デカさ,34+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([30+i%光デカさ,34+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([309+i%光デカさ,30+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([33+i%光デカさ,55+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([37+i%光デカさ,52+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([42+i%光デカさ,36+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([47+i%光デカさ,43+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([47+i%光デカさ,26+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([51+i%光デカさ,46+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([26+i%光デカさ,13+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([42+i%光デカさ,24+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([31+i%光デカさ,64+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([17+i%光デカさ,40+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([23+i%光デカさ,25+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([36+i%光デカさ,32+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([62+i%光デカさ,45+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([51+i%光デカさ,42+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([64+i%光デカさ,66+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([70+i%光デカさ,53+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([60+i%光デカさ,46+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([50+i%光デカさ,76+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([50+i%光デカさ,63+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([60+i%光デカさ,54+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([40+i%光デカさ,44+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([61+i%光デカさ,60+Math.floor(i/光デカさ),1]);

                            木漏れ日[2].push([64+i%光デカさ,45+Math.floor(i/光デカさ),0]);
                            木漏れ日[2].push([78+i%光デカさ,52+Math.floor(i/光デカさ),1]);

                        }
                        雲=[];
                        for(let i=0;i<5;i++){
                            雲.push([Math.random()*300+334,Math.random()*330,Math.random()+0.5]);
                        }
                        
                        
                        stage_x=0;
                        stage_y=0;
                        syuukun_x=2;
                        syuukun_y=2;
                        syuukun_move=[0,0];
                        syuukun_muki=0;
                    }else if(mini_stage==1){

                        
                    }else if(mini_stage==2){
                        teki_deck=[];
                        teki_yamahuda=[];
                        teki_tehuda=[];
                        teki_ba=["","","","",""];
                        death_teki_ba=["","","","",""];
                        teki_haka=[];
                        
                        deck_initialize(teki_deck_list,teki_deck,teki_yamahuda);

                        
                        my_now_pull=my_deck_pull+my_stage_pull;//ステージごとのドロー加算
                        //ドローはさせないんですか？→はいできません。苦しんでください
                        for(let i=0;i<5;i++){//攻撃回数の回復
                            if(my_ba[i]!=""){
                                if(my_ba[i].state.indexOf("三回攻撃")!=-1){
                                    my_ba[i].can_ATK=3;
                                }else if(my_ba[i].state.indexOf("二回攻撃")!=-1){
                                    my_ba[i].can_ATK=2;
                                }else{
                                    my_ba[i].can_ATK=1;
                                }
                            }
                        }

                        next_phase="戦闘";

                        cursor=16;
                        cursor2=0;
                        duel_phase="自由";
                        aite_phase=0;//相手のターンに動かしたい。
                       
                        aite_delay=0;//お前高速で動きすぎ！

                        my_kougeki_sum=0;//AI用
                        teki_kougeki_sum=0;//降参にも使ってる

                        zuba=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]//zuba64を表示するタイマー
                        yamahuda_damage=[0,0,0,0];//左が俺へのダメージで、右が相手へのダメージ描写
                        
                        get_card="";
                        相手の降参=0;

                        atk_card="";
                        def_card="";

                        一時的なドロー枚数=[my_now_pull,teki_pull];
                    }//mini_stage==3は下のほうにある

                    

                    ctx2.fillStyle="rgb(0,30,5)";
                    ctx2.fillRect(0,0,100,100);
                    
                    for(let i=0;i<5;i++){//フィールドを描こう
                        for(let j=0;j<5;j++){
                            二十ドット表示(i*20,j*20,mori_stage[stage_x][stage_y][i][j],ctx2,1);
                        }
                    }

                    if(syuukun_muki==0){
                        if(syuukun_move[0]!=0){
                            ctx2.drawImage(syuukun_20[(time)%4],syuukun_x*20+syuukun_move[0],syuukun_y*20+syuukun_move[1]-(time)%2);
                        }else if(syuukun_move[1]!=0){
                            ctx2.drawImage(syuukun_20[(time)%4],syuukun_x*20+syuukun_move[0]-(time)%2,syuukun_y*20+syuukun_move[1]);
                        }else{
                            ctx2.drawImage(syuukun_20[1],syuukun_x*20+syuukun_move[0],syuukun_y*20+syuukun_move[1]);
                        }
                    }else{
                        ctx2.save();
                        ctx2.scale(-1,1);
                        if(syuukun_move[0]!=0){
                            ctx2.drawImage(syuukun_20[(time)%4],-syuukun_x*20-20-syuukun_move[0],syuukun_y*20+syuukun_move[1]-(time)%2);
                        }else if(syuukun_move[1]!=0){
                            ctx2.drawImage(syuukun_20[(time)%4],-syuukun_x*20-20-syuukun_move[0]-(time)%2,syuukun_y*20+syuukun_move[1]);
                        }else{
                            ctx2.drawImage(syuukun_20[1],-syuukun_x*20-20-syuukun_move[0],syuukun_y*20+syuukun_move[1]);
                        }
                        ctx2.restore();
                    }
                    

                    if(syuukun_move[0]>0){
                        syuukun_move[0]-=4;
                        syuukun_muki=0;
                    }else if(syuukun_move[0]<0){
                        syuukun_move[0]+=4;
                        syuukun_muki=1;
                    }
                    if(syuukun_move[1]>0){
                        syuukun_move[1]-=4;
                    }else if(syuukun_move[1]<0){
                        syuukun_move[1]+=4;
                    }

                    ctx2.fillStyle="rgb(255,255,255,0.1)";
                    ctx2.fillRect(0,0,100,100);//ぼんやりとした光
                    ctx2.fillStyle="rgb(0,0,0,0.5)";
                    ctx2.fillRect(0,0,100,100);//ぼんやりとした影 特殊状況で消える

                    

                    光あふれる世界 = ctx2.getImageData(0,0,100,100);
                    if(stage_y==7){
                        for(let i=0;i<木漏れ日[2].length;i++){
                            if(木漏れ日[2][i][2]==0){
                                光(木漏れ日[2][i][0]+Math.floor(Math.abs(time%300-150)/51),木漏れ日[2][i][1]);
                            }else if(木漏れ日[2][i][2]==1){
                                光(木漏れ日[2][i][0],木漏れ日[2][i][1]+Math.floor(Math.abs((time+50)%400-200)/101));
                            }
                        }
                    }else{
                        for(let i=0;i<木漏れ日[(stage_x+stage_y)%2].length;i++){
                            if(木漏れ日[(stage_x+stage_y)%2][i][2]==0){
                                光(木漏れ日[(stage_x+stage_y)%2][i][0]+Math.floor(Math.abs(time%300-150)/51),木漏れ日[(stage_x+stage_y)%2][i][1]);
                            }else if(木漏れ日[(stage_x+stage_y)%2][i][2]==1){
                                光(木漏れ日[(stage_x+stage_y)%2][i][0],木漏れ日[(stage_x+stage_y)%2][i][1]+Math.floor(Math.abs((time+50)%400-200)/101));
                            }
                        }
                    }
                    
                    ctx2.putImageData(光あふれる世界,0,0);
                    


                    ctx.fillStyle="rgb(0,30,5)";
                    ctx.fillRect(0,0,1000,1000);
                    
                    ctx.save();
                    ctx.scale(9,9);
                    ctx.imageSmoothingEnabled = false;//画像を拡大してもぼやけない！えらいぞ～
                    ctx.drawImage(cnvs2,6,10);//x+6 y+10
                    ctx.restore();


                    ctx.drawImage(hujounomori_kakoi,0,0);



                    ctx.save();
                    ctx.scale(3,3);
                    for(let i=0;i<5;i++){
                        ctx.drawImage(kumo_mori[i],雲[i][0],雲[i][1]);
                        雲[i][0]-=雲[i][2];
                        if(雲[i][0]<-200){
                            雲[i]=[Math.random()*300+334,Math.random()*330,Math.random()+0.5];
                        }
                    }
                    
                    ctx.restore();


                    if(mini_stage==3){//会話モード
                        ctx.drawImage(kaiwa_window,10,690);
                        セリフ表示(40,700,940,50,5);
                        ctx.fillStyle="rgb(100,100,100)";
                        ctx.fillRect(35,485,210,210);
                        二十ドット表示(40,490,mori_stage[stage_x][stage_y][syuukun_x][syuukun_y],ctx,10);
                    }
                    

                    ctx.fillStyle="rgb(0,0,0)";//上のほうを描いてます。
                    ctx.fillRect(105,5,440,90);
                    ctx.fillStyle="rgb(255,255,255)";
                    ctx.fillRect(110,10,430,80);
                    ctx.fillStyle="rgb(150,200,255)";
                    ctx.fillRect(388,12,150,76);
                    ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                    ctx.fillStyle="rgb(0,0,0)";
                    ctx.drawImage(yamahuda,110,20);
                    ctx.fillText(my_yamahuda.length, 174, 70,70);
                    ctx.drawImage(hakaba,250,20);
                    ctx.fillText(my_haka.length, 308, 70,70);
                    ctx.font = "32px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                    ctx.fillStyle="rgb(0,0,0)";
                    if(my_tehuda.length>0){
                        ctx.drawImage(tehuda32,390,14);
                        ctx.fillText(my_tehuda.length, 425, 41);
                    }
                    if(ba_mons_num(my_ba)>0){
                        ctx.drawImage(ponya_32,460,14);
                        ctx.fillText(ba_mons_num(my_ba), 495, 41);
                    }
                    tokusyu_hyouji(390,46);

                    if(mini_stage==4){//クリアモード
                        ctx.fillStyle="rgb(0,0,0,0.75)";
                        ctx.fillRect(0,0,1000,1000);
                        ctx.drawImage(hujou_kuria,0,0);
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(50,700,900,250);

                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillText("ステージ選択へ", 200, 930);
                        ctx.fillText("ツイート", 700, 930);

                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        if(cursor2==0){
                            ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                        }else{
                            ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                        }
                        ctx.restore();
                        if(MAX_STAGE==4){
                            初回クリアメッセージフラグ=1;
                            MAX_STAGE=5;
                            localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                            
                            カードゲット(rozusyuu);
                        }
                        if(初回クリアメッセージフラグ==1){
                            ctx.fillText("ローズしゅうくん", 100, 780);
                            ctx.fillText("を手に入れてしまった！", 100, 840);
                        }
                    }
                    
                }
                function デッキ盗難(){
                    if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                        key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                        for(let i=0;i<key_input.length;i++){
                            if(get_mode==0){
                                if(key_input.charAt(i)=="↑"){
                                    cursor_y=(cursor_y+1)%2;
                                    cursor_x=0;
                                    セリフダダダ=0;
                                }else if(key_input.charAt(i)=="←"){
                                    
                                    if(mini_stage==14){//クリア画面
                                        cursor2=(cursor2+1)%2;
                                    }else{
                                        
                                        if(cursor_y==0){
                                            if(cursor_x>0){
                                                cursor_x-=1;
                                            }else if(scroll_x!=0){
                                                scroll_x-=1;
                                            }else{
                                                if(今回のデッキ_表示.card_list.length-7>0){
                                                    scroll_x=今回のデッキ_表示.card_list.length-7;
                                                }
                                                cursor_x=6;
                                            }
                                            
                                        }else if(mini_stage%2==0){
                                            cursor_x=(cursor_x+1)%2;
                                        }
                                        

                                    }
                                }else if(key_input.charAt(i)=="→"){
                                    if(mini_stage==14){//クリア画面
                                        cursor2=(cursor2+1)%2;
                                    }else{
                                        if(cursor_y==0){
                                            if(cursor_x<6){
                                                cursor_x+=1;
                                            }else if(scroll_x<今回のデッキ_表示.card_list.length-7){
                                                scroll_x+=1;
                                            }else{
                                                scroll_x=0;
                                                cursor_x=0;
                                            }
                                            
                                        }else if(mini_stage%2==0){
                                            cursor_x=(cursor_x+1)%2;
                                        }
                                    }
                                }else if(key_input.charAt(i)=="↓"){
                                    cursor_y=(cursor_y+1)%2;
                                    cursor_x=0;
                                    セリフダダダ=0;
                                }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                    長押し阻止=1;
                                    if(cursor_y==1){
                                        if(mini_stage==0){
                                        }else if(mini_stage==1){
                                            演出カウント=1;
                                            mini_stage=-1;//戦闘モード
                                            next_mini_stage=2;
                                            teki_deck_list=nezumi_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                                            teki_pull=2;//ドロー枚数
                                            drop_gold=300;//お金ー！

                                            セリフ="どちらかのカードを拾えそうだ";
                                            セリフガガガ=0;
                                            セリフ_ピ=0;
                                            セリフダダダ=0;
                                            cursor_x=0;
                                        }else if(mini_stage==2){
                                            出てきたカード=[];
                                            if(cursor_x==0){
                                                for(i=0;i<2;i++){
                                                        出てきたカード[i]=雑魚パック[Math.floor(Math.random()*雑魚パック.length)];
                                                }
                                            }else if(cursor_x==1){
                                                for(i=0;i<3;i++){
                                                        出てきたカード[i]=魔法パック[Math.floor(Math.random()*魔法パック.length)];
                                                }
                                            }
                                            for(i=0;i<出てきたカード.length;i++){
                                                カードゲット(出てきたカード[i]);
                                                for(j=0;j<今回のデッキ.card_list.length;j++){
                                                    if(今回のデッキ.card_list[j][0]==出てきたカード[i]){
                                                        今回のデッキ.card_list[j][1]+=1;
                                                        break;
                                                    }
                                                    if(j==今回のデッキ.card_list.length-1){
                                                        今回のデッキ.card_list.push([出てきたカード[i],1]);
                                                        break;
                                                    }
                                                }
                                            }
                                            カードカウント=0;
                                            for(let i=0;i<今回のデッキ.card_list.length;i++){
                                                for(let j=0;j<今回のデッキ.card_list[i][1];j++){
                                                    今回のデッキ_表示.card_list[カードカウント]=今回のデッキ.card_list[i][0];
                                                    カードカウント+=1;
                                                }
                                            }

                                            今回のデッキ_表示.TOP_ACE=[0,今回のデッキ.card_list[0][1],今回のデッキ.card_list[0][1]+今回のデッキ.card_list[1][1],今回のデッキ.card_list[0][1]+今回のデッキ.card_list[1][1]+今回のデッキ.card_list[2][1]];
                                            get_mode=3;
                                            
                                        }else if(mini_stage==3){
                                            演出カウント=1;
                                            mini_stage=-1;//戦闘モード
                                            next_mini_stage=4;
                                            teki_deck_list=dekanezumi_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                                            teki_pull=2;//ドロー枚数
                                            drop_gold=500;//お金ー！

                                            セリフ="どちらかのカードを拾えそうだ";
                                            セリフガガガ=0;
                                            セリフ_ピ=0;
                                            セリフダダダ=0;
                                            cursor_x=0;
                                        }else if(mini_stage==4){
                                            出てきたカード=[];
                                            if(cursor_x==0){
                                                for(i=0;i<2;i++){
                                                        出てきたカード[i]=雑魚パック[Math.floor(Math.random()*雑魚パック.length)];
                                                }
                                                for(i=0;i<3;i++){
                                                        出てきたカード[i+2]=魔法パック[Math.floor(Math.random()*魔法パック.length)];
                                                }
                                            }else if(cursor_x==1){
                                                for(i=0;i<1;i++){
                                                        出てきたカード[i]=強パック[Math.floor(Math.random()*強パック.length)];
                                                }
                                            }

                                            for(i=0;i<出てきたカード.length;i++){
                                                カードゲット(出てきたカード[i]);
                                                for(j=0;j<今回のデッキ.card_list.length;j++){
                                                    if(今回のデッキ.card_list[j][0]==出てきたカード[i]){
                                                        今回のデッキ.card_list[j][1]+=1;
                                                        break;
                                                    }
                                                    if(j==今回のデッキ.card_list.length-1){
                                                        今回のデッキ.card_list.push([出てきたカード[i],1]);
                                                        break;
                                                    }
                                                }
                                            }
                                            カードカウント=0;
                                            for(let i=0;i<今回のデッキ.card_list.length;i++){
                                                for(let j=0;j<今回のデッキ.card_list[i][1];j++){
                                                    今回のデッキ_表示.card_list[カードカウント]=今回のデッキ.card_list[i][0];
                                                    カードカウント+=1;
                                                }
                                            }

                                            今回のデッキ_表示.TOP_ACE=[0,今回のデッキ.card_list[0][1],今回のデッキ.card_list[0][1]+今回のデッキ.card_list[1][1],今回のデッキ.card_list[0][1]+今回のデッキ.card_list[1][1]+今回のデッキ.card_list[2][1]];
                                            get_mode=5;
                                            
                                        }else if(mini_stage==5){
                                            演出カウント=1;
                                            mini_stage=-1;//戦闘モード
                                            next_mini_stage=6;
                                            teki_deck_list=dokunezumi_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                                            teki_pull=3;//ドロー枚数
                                            drop_gold=500;//お金ー！

                                            セリフ="攻撃力か体力を上昇できそうだ";
                                            セリフガガガ=0;
                                            セリフ_ピ=0;
                                            セリフダダダ=0;
                                            cursor_x=0;
                                        }else if(mini_stage==6){
                                            if(cursor_x==0){
                                                特殊状態.push("攻撃");
                                                特殊状態.push(1);

                                            }else{
                                                特殊状態.push("体力");
                                                特殊状態.push(3);
                                            }
                                            mini_stage=7;
                                            セリフ="玉ねずみが現れた！";
                                            セリフガガガ=0;
                                            セリフ_ピ=0;
                                            セリフダダダ=0;
                                            cursor_x=0;
                                        }else if(mini_stage==7){
                                            演出カウント=1;
                                            mini_stage=-1;//戦闘モード
                                            next_mini_stage=8;
                                            teki_deck_list=tamanezumi_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                                            teki_pull=1;//ドロー枚数
                                            drop_gold=500;//お金ー！

                                            セリフ="どちらかのカードを拾えそうだ";
                                            セリフガガガ=0;
                                            セリフ_ピ=0;
                                            セリフダダダ=0;
                                            cursor_x=0;
                                        }else if(mini_stage==8){
                                            出てきたカード=[];
                                            if(cursor_x==0){
                                                for(i=0;i<2;i++){
                                                        出てきたカード[i]=雑魚パック[Math.floor(Math.random()*雑魚パック.length)];
                                                }
                                                for(i=0;i<5;i++){
                                                        出てきたカード[i+2]=魔法パック[Math.floor(Math.random()*魔法パック.length)];
                                                }
                                            }else if(cursor_x==1){
                                                for(i=0;i<1;i++){
                                                        出てきたカード[i]=強パック[Math.floor(Math.random()*強パック.length)];
                                                }
                                            }

                                            for(i=0;i<出てきたカード.length;i++){
                                                カードゲット(出てきたカード[i]);
                                                for(j=0;j<今回のデッキ.card_list.length;j++){
                                                    if(今回のデッキ.card_list[j][0]==出てきたカード[i]){
                                                        今回のデッキ.card_list[j][1]+=1;
                                                        break;
                                                    }
                                                    if(j==今回のデッキ.card_list.length-1){
                                                        今回のデッキ.card_list.push([出てきたカード[i],1]);
                                                        break;
                                                    }
                                                }
                                            }
                                            カードカウント=0;
                                            for(let i=0;i<今回のデッキ.card_list.length;i++){
                                                for(let j=0;j<今回のデッキ.card_list[i][1];j++){
                                                    今回のデッキ_表示.card_list[カードカウント]=今回のデッキ.card_list[i][0];
                                                    カードカウント+=1;
                                                }
                                            }

                                            今回のデッキ_表示.TOP_ACE=[0,今回のデッキ.card_list[0][1],今回のデッキ.card_list[0][1]+今回のデッキ.card_list[1][1],今回のデッキ.card_list[0][1]+今回のデッキ.card_list[1][1]+今回のデッキ.card_list[2][1]];
                                            get_mode=9;
                                        }else if(mini_stage==9){
                                            演出カウント=1;
                                            mini_stage=-1;//戦闘モード
                                            next_mini_stage=10;
                                            teki_deck_list=tatujinnezumi_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                                            teki_pull=2;//ドロー枚数
                                            drop_gold=1000;//お金ー！

                                            セリフ="どちらかのカードを拾えそうだ";
                                            セリフガガガ=0;
                                            セリフ_ピ=0;
                                            セリフダダダ=0;
                                            cursor_x=0;
                                        }else if(mini_stage==10){
                                            出てきたカード=[];
                                            if(cursor_x==0){
                                                for(i=0;i<10;i++){
                                                        出てきたカード[i]=雑魚パック[Math.floor(Math.random()*雑魚パック.length)];
                                                }
                                                for(i=0;i<10;i++){
                                                        出てきたカード[i+10]=魔法パック[Math.floor(Math.random()*魔法パック.length)];
                                                }
                                            }else if(cursor_x==1){
                                                for(i=0;i<2;i++){
                                                        出てきたカード[i]=強パック[Math.floor(Math.random()*強パック.length)];
                                                }
                                            }

                                            for(i=0;i<出てきたカード.length;i++){
                                                カードゲット(出てきたカード[i]);
                                                for(j=0;j<今回のデッキ.card_list.length;j++){
                                                    if(今回のデッキ.card_list[j][0]==出てきたカード[i]){
                                                        今回のデッキ.card_list[j][1]+=1;
                                                        break;
                                                    }
                                                    if(j==今回のデッキ.card_list.length-1){
                                                        今回のデッキ.card_list.push([出てきたカード[i],1]);
                                                        break;
                                                    }
                                                }
                                            }
                                            カードカウント=0;
                                            for(let i=0;i<今回のデッキ.card_list.length;i++){
                                                for(let j=0;j<今回のデッキ.card_list[i][1];j++){
                                                    今回のデッキ_表示.card_list[カードカウント]=今回のデッキ.card_list[i][0];
                                                    カードカウント+=1;
                                                }
                                            }

                                            今回のデッキ_表示.TOP_ACE=[0,今回のデッキ.card_list[0][1],今回のデッキ.card_list[0][1]+今回のデッキ.card_list[1][1],今回のデッキ.card_list[0][1]+今回のデッキ.card_list[1][1]+今回のデッキ.card_list[2][1]];
                                            get_mode=11;
                                        }else if(mini_stage==11){
                                            演出カウント=1;
                                            mini_stage=-1;//戦闘モード
                                            next_mini_stage=12;
                                            teki_deck_list=tamanori_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                                            teki_pull=2;//ドロー枚数
                                            drop_gold=1500;//お金ー！

                                            セリフ="攻撃力か体力を上昇できそうだ";
                                            セリフガガガ=0;
                                            セリフ_ピ=0;
                                            セリフダダダ=0;
                                            cursor_x=0;
                                        }else if(mini_stage==12){
                                            if(cursor_x==0){
                                                if(特殊状態.indexOf("攻撃")!=-1){
                                                    特殊状態[特殊状態.indexOf("攻撃")+1]+=1;
                                                }else{
                                                    特殊状態.push("攻撃");
                                                    特殊状態.push(1);
                                                }
                                            }else{
                                                if(特殊状態.indexOf("体力")!=-1){
                                                    特殊状態[特殊状態.indexOf("体力")+1]+=3;
                                                }else{
                                                    特殊状態.push("体力");
                                                    特殊状態.push(3);
                                                }
                                            }
                                            mini_stage=13;
                                            セリフ="黒幕が現れた！";
                                            セリフガガガ=0;
                                            セリフ_ピ=0;
                                            セリフダダダ=0;
                                            cursor_x=0;
                                        }else if(mini_stage==13){
                                            演出カウント=1;
                                            mini_stage=-1;//戦闘モード
                                            next_mini_stage=14;
                                            teki_deck_list=tyuukun_list;//使用デッキ あれ？宣言箇所下のほうだけどいいのかな、いいか
                                            teki_pull=3;//ドロー枚数
                                            drop_gold=3000;//お金ー！

                                            セリフ="クリア！";
                                            セリフガガガ=0;
                                            セリフ_ピ=0;
                                            セリフダダダ=0;
                                            cursor_x=0;
                                        }

                                        
                                    }
                                    if(mini_stage==14){
                                        if(cursor2==0){
                                            初回クリアメッセージフラグ=0;
                                            next_phase="ステージ選択";
                                            演出カウント=1;
                                            cursor=3;
                                        }else{
                                            key_input="";//なんかこれないとボタン操作がいかれる
                                            URL_tweet_text="https://twitter.com/intent/tweet?text=ネズミたちを駆除した！%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                            window.open( URL_tweet_text, '_blank'); 
                                        }
                                        
                                    }
                                }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                    長押し阻止=1;
                                }
                            }else{
                                if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                    長押し阻止=1;
                                    mini_stage=get_mode;
                                    get_mode=0;
                                    if(mini_stage==3){
                                        セリフ="デカねずみが現れた！";
                                    }else if(mini_stage==5){
                                        セリフ="毒ねずみが現れた！";
                                    }else if(mini_stage==7){
                                        //ここではないのである。
                                    }else if(mini_stage==9){
                                        セリフ="達人ねずみが現れた！";
                                    }else if(mini_stage==11){
                                        セリフ="玉乗りねずみが現れた！";
                                    }
                                    セリフガガガ=0;
                                    セリフ_ピ=0;
                                    セリフダダダ=0;
                                    cursor_x=0;
                                }
                            }
                            
                            
                        }
                        if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                            key_input="";
                            key_interval=0;
                        }
                        
                    }else if(key_interval>0){
                        key_interval=key_interval-1;//カウントダウン
                    }

                    if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                        長押し阻止=0; 
                    }
                    
                    ctx.fillStyle="rgb(20,20,60)";
                    ctx.fillRect(0,0,1000,1000);
                    ctx.fillStyle="rgb(255,255,255)";
                    ctx.fillRect(240,240,520,520);
                    
                    ctx.fillStyle="rgb(200,200,200)";
                    ctx.fillRect(0,760,1000,250);
                    ctx.fillStyle="rgb(30,30,30)";
                    ctx.fillRect(10,770,980,220);
                    
                    if(mini_stage==0){//初期化だぜー！
                        今回のデッキ={card_list:[[syuukun,1],[burakkusyuukun,1],[rozusyuu,1],[ikaribakuhatu,1]],ACE:[],TOP_ACE:[syuukun,burakkusyuukun,rozusyuu,ikaribakuhatu]};
                        今回のデッキ_表示={card_list:[],ACE:[],TOP_ACE:[0,1,2,3]};
                        
                        カードカウント=0;
                        for(let i=0;i<今回のデッキ.card_list.length;i++){
                            for(let j=0;j<今回のデッキ.card_list[i][1];j++){
                                今回のデッキ_表示.card_list[カードカウント]=今回のデッキ.card_list[i][0];
                                カードカウント+=1;
                            }
                        }
                        scroll_x=0;
                        cursor_x=0;
                        cursor_y=1;
                        mini_stage=1;//ここをかえると調整が楽でいいよね！え？誰向けのコメント？
                        get_mode=0;
                        
                        セリフ="ネズミが現れた！";
                        セリフガガガ=0;
                        セリフ_ピ=0;
                        セリフダダダ=0;
                    }else if(mini_stage==1){
                        
                        セリフ表示(20,780,960,50,4)

                        ctx.fillStyle="rgb(30,30,30)";
                        ctx.fillRect(250,250,500,500);
                        ctx.drawImage(nezumi500,250,250);
                    }else if(mini_stage==2){
                        
                        セリフ表示(20,780,960,50,4)
                        ctx.fillStyle="rgb(155,155,155)";
                        ctx.fillRect(300,250,150,500);
                        ctx.fillRect(550,250,150,500);
                        ctx.drawImage(zako500,300,250);
                        ctx.drawImage(maho500,550,250);

                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(325,600,100,100);
                        ctx.fillRect(575,600,100,100);

                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillText("+2", 350, 670,50);
                        ctx.fillText("+3", 600, 670,50);

                    }else if(mini_stage==3){
                        
                        セリフ表示(20,780,960,50,4)

                        ctx.fillStyle="rgb(30,30,30)";
                        ctx.fillRect(250,250,500,500);
                        ctx.drawImage(dekanezumi500,250,250);
                    }else if(mini_stage==4){
                        
                        セリフ表示(20,780,960,50,4)
                        ctx.fillStyle="rgb(155,155,155)";
                        ctx.fillRect(250,250,150,500);
                        ctx.drawImage(zako500,250,250);
                        ctx.fillRect(400,250,150,500);
                        ctx.drawImage(maho500,400,250);
                        ctx.fillRect(600,250,150,500);
                        ctx.drawImage(kyou500,600,250);

                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(275,600,250,100);
                        ctx.fillRect(625,600,100,100);

                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillText("+2", 300, 670,50);
                        ctx.fillText("+3", 450, 670,50);
                        ctx.fillText("+1", 650, 670,50);

                    }else if(mini_stage==5){
                        
                        セリフ表示(20,780,960,50,4)

                        ctx.fillStyle="rgb(30,30,30)";
                        ctx.fillRect(250,250,500,500);
                        ctx.drawImage(dokunezumi500,250,250);
                    }else if(mini_stage==6){
                        
                        セリフ表示(20,780,960,50,4)
                        ctx.fillStyle="rgb(155,155,155)";
                        ctx.fillRect(300,250,150,500);
                        ctx.fillRect(550,250,150,500);
                        ctx.drawImage(ken500,300,250);
                        ctx.drawImage(tairyoku500,550,250);

                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(325,600,100,100);
                        ctx.fillRect(575,600,100,100);

                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillText("+1", 350, 670,50);
                        ctx.fillText("+3", 600, 670,50);
                    }else if(mini_stage==7){
                        
                        セリフ表示(20,780,960,50,4)

                        ctx.fillStyle="rgb(30,30,30)";
                        ctx.fillRect(250,250,500,500);
                        ctx.drawImage(tamanezumi500,250,250);
                    }else if(mini_stage==8){
                        
                        セリフ表示(20,780,960,50,4)
                        ctx.fillStyle="rgb(155,155,155)";
                        ctx.fillRect(250,250,150,500);
                        ctx.drawImage(zako500,250,250);
                        ctx.fillRect(400,250,150,500);
                        ctx.drawImage(maho500,400,250);
                        ctx.fillRect(600,250,150,500);
                        ctx.drawImage(kyou500,600,250);

                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(275,600,250,100);
                        ctx.fillRect(625,600,100,100);

                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillText("+2", 300, 670,50);
                        ctx.fillText("+5", 450, 670,50);
                        ctx.fillText("+1", 650, 670,50);
                    }else if(mini_stage==9){
                        
                        セリフ表示(20,780,960,50,4)

                        ctx.fillStyle="rgb(30,30,30)";
                        ctx.fillRect(250,250,500,500);
                        ctx.drawImage(tatujinnezumi500,250,250);
                    }else if(mini_stage==10){
                        
                        セリフ表示(20,780,960,50,4)
                        ctx.fillStyle="rgb(155,155,155)";
                        ctx.fillRect(250,250,150,500);
                        ctx.drawImage(zako500,250,250);
                        ctx.fillRect(400,250,150,500);
                        ctx.drawImage(maho500,400,250);
                        ctx.fillRect(600,250,150,500);
                        ctx.drawImage(kyou500,600,250);

                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(275,600,250,100);
                        ctx.fillRect(625,600,100,100);

                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillText("+10", 300, 670,50);
                        ctx.fillText("+10", 450, 670,50);
                        ctx.fillText("+2", 650, 670,50);
                    }else if(mini_stage==11){
                        
                        セリフ表示(20,780,960,50,4)

                        ctx.fillStyle="rgb(30,30,30)";
                        ctx.fillRect(250,250,500,500);
                        ctx.drawImage(tamanorinezumi500,250,250);
                    }else if(mini_stage==12){
                        
                        セリフ表示(20,780,960,50,4)
                        ctx.fillStyle="rgb(155,155,155)";
                        ctx.fillRect(300,250,150,500);
                        ctx.fillRect(550,250,150,500);
                        ctx.drawImage(ken500,300,250);
                        ctx.drawImage(tairyoku500,550,250);

                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(325,600,100,100);
                        ctx.fillRect(575,600,100,100);

                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillText("+1", 350, 670,50);
                        ctx.fillText("+3", 600, 670,50);
                    }else if(mini_stage==13){
                        
                        セリフ表示(20,780,960,50,4)

                        ctx.fillStyle="rgb(30,30,30)";
                        ctx.fillRect(250,250,500,500);
                        ctx.drawImage(tyuukun500,250,250);
                    }else if(mini_stage==-1){//戦闘準備ー！ これn回動いてない？（笑）
                        my_deck=[];//初期化初期化ー！って初期化しなくて良いヤツも初期化してる気がする。まあいいか
                        teki_deck=[];
                        my_yamahuda=[];
                        teki_yamahuda=[];
                        my_tehuda=[];
                        teki_tehuda=[];
                        my_ba=["","","","",""];
                        teki_ba=["","","","",""];
                        death_my_ba=["","","","",""];//死亡時演出のためにカードを別の場所に移したい（場に残すとバグの温床になることは自明なので）
                        death_teki_ba=["","","","",""];
                        tukau_mahou=[];//魔法つかった瞬間に消えるのよくないと思った。

                        my_haka=[];
                        teki_haka=[];
                        
                        deck_initialize(今回のデッキ,my_deck,my_yamahuda);
                        deck_initialize(teki_deck_list,teki_deck,teki_yamahuda);
                        
                        
                        for(let i=0;i<5;i++){
                            if(my_ba[i]!=""){
                                my_ba[i].card.effect("ターン開始",["自ターン",i]);
                            }
                        }

                        my_now_pull=3+my_stage_pull;//ステージドロー
                        pull_card(my_yamahuda,my_tehuda,my_now_pull);
                        一時的なドロー枚数=[my_now_pull,teki_pull];
                        next_phase="戦闘";

                        cursor=16;
                        cursor2=0;

                        duel_phase="自由";
                        aite_phase=0;//相手のターンに動かしたい。
                       
                        aite_delay=0;//お前高速で動きすぎ！

                        my_kougeki_sum=0;//AI用
                        teki_kougeki_sum=0;//降参にも使ってる

                        zuba=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]//zuba64を表示するタイマー
                        yamahuda_damage=[0,0,0,0];//左が俺へのダメージで、右が相手へのダメージ描写
                        
                        get_card="";
                        相手の降参=0;

                        atk_card="";
                        def_card="";
                    }

                    //カード表示
                    ctx.fillStyle="rgb(100,100,100)";
                    ctx.fillRect(5,5,990,230);

                    for(let i=0;i<9;i++){
                        ctx.fillStyle="rgb(200,200,200)";
                        if((i+scroll_x-1)>=0 && (i+scroll_x-1)<今回のデッキ_表示.card_list.length){
                            ctx.fillRect(-130+140*i,10,140,220);
                            ctx.drawImage(今回のデッキ_表示.card_list[i+scroll_x-1].image,-125+140*i,20);
                            if(今回のデッキ_表示.TOP_ACE.indexOf(i+scroll_x-1)!=-1){
                                ctx.fillStyle="rgb(255,0,0)";
                                ctx.fillRect(-125+140*i-2,20,5,200);
                                ctx.fillRect(-125+140*i+128,20,5,200);
                                ctx.fillRect(-125+140*i,20,133,5);
                                ctx.fillRect(-125+140*i,20+195,133,5);
                            }
                            if(今回のデッキ_表示.ACE.indexOf(i+scroll_x-1)!=-1){
                                ctx.fillStyle="rgb(255,255,0)";
                                ctx.fillRect(-125+140*i-2,20,5,200);
                                ctx.fillRect(-125+140*i+128,20,5,200);
                                ctx.fillRect(-125+140*i,20,133,5);
                                ctx.fillRect(-125+140*i,20+195,133,5);
                            }
                        } 
                    }

                    //  スクロール？
                    ctx.fillStyle="rgb(100,100,100)";
                    ctx.fillRect(50,225,900,20);

                    ctx.fillStyle="rgb(255,255,255)";
                    
                    if(今回のデッキ_表示.card_list.length>7){
                        ctx.fillRect(60+680*(scroll_x/(今回のデッキ_表示.card_list.length-7)),227,200,16);
                    }else{
                        ctx.fillRect(60,227,880,16);
                    }


                    //  カーソル
                    if(cursor_y==0){
                        ctx.drawImage(yubi,20+cursor_x*140,150+4*Math.sin(time*Math.PI/8));
                    }else if(cursor_y==1){
                        if(mini_stage%2==1){
                            ctx.drawImage(yubi,440,700+4*Math.sin(time*Math.PI/8));
                        }else if(mini_stage==2 || mini_stage==6 || mini_stage==12){
                            if(cursor_x==0){
                                ctx.drawImage(yubi,300,700+4*Math.sin(time*Math.PI/8));
                            }else if(cursor_x==1){
                                ctx.drawImage(yubi,590,700+4*Math.sin(time*Math.PI/8));
                            }
                        }else if(mini_stage==4 || mini_stage==8 || mini_stage==10){
                            if(cursor_x==0){
                                ctx.drawImage(yubi,350,700+4*Math.sin(time*Math.PI/8));
                            }else if(cursor_x==1){
                                ctx.drawImage(yubi,610,700+4*Math.sin(time*Math.PI/8));
                            }
                        }
                        
                    }

                    
                    if(cursor_y==0){
                        ctx.fillStyle="rgb(100,100,130)";
                        ctx.fillRect(0,740,1000,260);
                        ctx.fillStyle="rgb(55,55,55)";//詳細表示─
                        ctx.fillRect(5,745,990,250);
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(10,750,980,240);
                        ctx.fillStyle="rgb(55,55,55)";
                        ctx.fillRect(550,755,5,230);
                        if(cursor_x+scroll_x<今回のデッキ_表示.card_list.length){
                            syousai_card=今回のデッキ_表示.card_list[cursor_x+scroll_x];
                        }else{
                            syousai_card="";
                        }
                        
                        if(syousai_card!=""){
                            ctx.fillStyle="rgb(200,200,200)";
                            ctx.fillRect(15,755,490,50);
                            ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText(syousai_card.name, 20, 798,480);
                            

                            if(syousai_card.state.indexOf("モンスター")!=-1){
                                ctx.drawImage(atk_plate,560,760);
                                ctx.drawImage(def_plate,610,765);
                                ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                if(syousai_card.ATK<10){
                                    ctx.fillText(syousai_card.ATK, 574, 802,42);
                                }else{
                                    ctx.fillText(syousai_card.ATK, 564, 802,42);
                                }
                                if(syousai_card.HP<10){
                                    ctx.fillText(syousai_card.HP, 624, 802,42);
                                }else{
                                    ctx.fillText(syousai_card.HP, 614, 802,42);
                                }
                            }
                            ctx.fillStyle="rgb(0,0,0)";
                            text_kaigyou_hyouji(syousai_card.text, 20, 810,520,180,40,syousai_card.text_iro);//x,yは左上指定だから注意だ！
                        
                            syousai_state_color=[];
                            syousai_state="分類:";
                            for(let i=0;i<syousai_card.state.length;i++){
                                if(syousai_card.state[i]=="TOP_ACE"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,7,"rgb(255,0,0)"];
                                }else if(syousai_card.state[i]=="ACE"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,3,"rgb(200,200,0)"];
                                }else if(syousai_card.state[i]=="毒:"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,1,"rgb(200,0,200)"];
                                }else if(syousai_card.state[i]=="防御:"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,2,"rgb(0,0,200)"];
                                }
                                syousai_state+=" "+syousai_card.state[i];
                            }
                            text_kaigyou_hyouji(syousai_state, 560, 810,420,180,40,syousai_state_color);//x,yは左上指定だから注意だ！
                            
                            カードインデックス=今回のデッキ_表示.card_list.indexOf(syousai_card);
                            カードカウント=0;
                            if(カードインデックス!=-1){
                                カードインデックス
                                for(let i=カードインデックス;i<今回のデッキ_表示.card_list.length;i++){
                                    if(今回のデッキ_表示.card_list[i]==今回のデッキ_表示.card_list[カードインデックス]){
                                        カードカウント+=1;
                                    }else{
                                        break;
                                    }
                                }
                            }
                            ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText("デッキ："+カードカウント+"枚", 695, 800);
                            
                        }
                    }//ここまで詳細


                    ctx.fillStyle="rgb(255,255,255)";
                    ctx.fillRect(10,270,120,74);
                    ctx.fillStyle="rgb(255,255,255)";
                    ctx.fillRect(10,347,120,74);
                    
                    ctx.scale(2, 2);
                    ctx.font = "32px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                    ctx.fillStyle="rgb(0,0,0)";
                    for(let i=0;i<特殊状態.length;i++){
                        if(特殊状態[i]=="攻撃"){
                            ctx.drawImage(kougeki_1_32,10+40*(i%2),140+34*Math.ceil(i/2));
                            ctx.fillText(特殊状態[i+1], 10+35+40*(i%2), 140+27+34*Math.ceil(i/2),30);
                            i+=1;
                        }else if(特殊状態[i]=="体力"){
                            ctx.drawImage(tairyoku_1_32,10+40*(i%2),140+34*Math.ceil(i/2));
                            ctx.fillText(特殊状態[i+1], 10+35+40*(i%2), 140+27+34*Math.ceil(i/2),30);
                            i+=1;
                        }
                    }
                    ctx.scale(0.5, 0.5);

                    if(get_mode!=0){
                        ctx.fillStyle="rgb(0,0,0,0.6)";
                        ctx.fillRect(0,0,1000,1000);
                        ctx.fillStyle="rgb(200,200,200)";
                        if(出てきたカード.length==1){
                            ctx.fillText(出てきたカード[0].name, 430,395+4*Math.sin(time*Math.PI/8),140,210,140);
                            ctx.fillRect(430,395+4*Math.sin(time*Math.PI/8),140,210);
                            ctx.drawImage(出てきたカード[0].image,435,400+4*Math.sin(time*Math.PI/8));
                        }else if(出てきたカード.length<6){
                            for(i=0;i<出てきたカード.length;i++){
                                ctx.fillText(出てきたカード[i].name, 500-75*出てきたカード.length+i*150-5,395+4*Math.sin(time*Math.PI/8),140,210,140);
                                ctx.fillRect(500-75*出てきたカード.length+i*150-5,395+4*Math.sin(time*Math.PI/8),140,210);
                                ctx.drawImage(出てきたカード[i].image,500-75*出てきたカード.length+i*150,400+4*Math.sin(time*Math.PI/8));
                            }
                        }else{
                            for(i=0;i<出てきたカード.length;i++){
                                ctx.fillText(出てきたカード[i].name, 45+i/(出てきたカード.length-1)*770,395+4*Math.sin(time*Math.PI/8),140,210,140);
                                ctx.fillRect(45+i/(出てきたカード.length-1)*770,395+4*Math.sin(time*Math.PI/8),140,210);
                                ctx.drawImage(出てきたカード[i].image,50+i/(出てきたカード.length-1)*770,400+4*Math.sin(time*Math.PI/8));
                            }
                        }
                        
                    }



                    if(mini_stage==14){//クリアだ。おめでとう。
                        ctx.fillStyle="rgb(0,0,0,0.75)";
                        ctx.fillRect(0,0,1000,1000);
                        ctx.drawImage(dekkitounan_kuria,0,0);//
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(50,700,900,250);

                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillText("ステージ選択へ", 200, 930);
                        ctx.fillText("ツイート", 700, 930);

                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        if(cursor2==0){
                            ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                        }else{
                            ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                        }
                        ctx.restore();
                        if(MAX_STAGE==6){
                            MAX_STAGE=7;
                            localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                        }
                        ctx.fillText("デッキ保存ボタンから", 100, 780);
                        ctx.fillText("クリア時デッキを撮影できるぞ！", 100, 840);
                        
                                
                    }

                }
                function EXステージ(){
                    ctx.fillStyle="rgb(20,20,50)";
                    ctx.fillRect(0,0,1000,1000);
                    if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                            key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                            for(let i=0;i<key_input.length;i++){
                                if(key_input.charAt(i)=="↑"){
                                    if(mini_stage==1){
                                        if(cursor!=0&& cursor!=1 && cursor!=2 &&cursor!=-1){
                                            cursor-=3;
                                        }else if(cursor!=-1){
                                            cursor=-1;
                                        }else{
                                            cursor=6;
                                        }
                                    }else if(mini_stage==2){
                                        cursor2=(cursor2+1)%2
                                    }
                                    
                                    
                                }else if(key_input.charAt(i)=="←"){
                                    if(mini_stage==1){
                                        if(cursor==-1){
                                            cursor=6;
                                        }else if(cursor!=0 && cursor!=3 && cursor!=6){
                                            cursor-=1;
                                        }else{
                                            cursor+=2;
                                        }
                                    }else if(mini_stage==3){
                                        cursor2=(cursor2+1)%2;
                                    }
                                }else if(key_input.charAt(i)=="→"){
                                    if(mini_stage==1){
                                        if(cursor==-1){
                                            cursor=8;
                                        }else if(cursor!=2 && cursor!=5 && cursor!=8){
                                            cursor+=1;
                                        }else{
                                            cursor-=2;
                                        }
                                    }else if(mini_stage==3){
                                        cursor2=(cursor2+1)%2;
                                    }
                                    
                                    
                                }else if(key_input.charAt(i)=="↓"){
                                    if(mini_stage==1){
                                        if(cursor==-1){
                                            cursor=0;
                                        }else if(cursor==6){
                                            cursor=-1;
                                        }else{
                                            cursor+=3;
                                            if(cursor>9){
                                                cursor-=9;
                                            }
                                        }  
                                    }else if(mini_stage==2){
                                        cursor2=(cursor2+1)%2
                                    }
                                    
                                }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                    if(mini_stage==1){
                                        if(cursor==-1){
                                            next_phase="ステージ選択";
                                            演出カウント=1;
                                            cursor=3;
                                        }else{
                                            mini_stage=2;
                                            cursor2=0;
                                        }
                                    }else if(mini_stage==2){
                                        if(cursor2==0){
                                            演出カウント=1;
                                            mini_stage=-1;//戦闘モード
                                            next_mini_stage=-2;
                                            teki_deck_list=tensyu_list;//使用デッキ
                                            teki_pull=1;//ドロー枚数
                                            drop_gold=100000;//お金ー！

                                            挑戦デッキ=cursor;
                                        }else{
                                            mini_stage=1;                                            
                                        }

                                    }else if(mini_stage==3){
                                        if(cursor2==0){
                                            mini_stage=1;
                                        }else{
                                            key_input="";//なんかこれないとボタン操作がいかれる
                                            URL_tweet_text="https://twitter.com/intent/tweet?text=しゅうくんカードを完全制覇した！%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                            window.open( URL_tweet_text, '_blank'); 
                                        }
                                    }
                                    
                                    長押し阻止=1;
                                }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                    長押し阻止=1;
                                }
                                
                            }
                            if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                key_input="";
                                key_interval=0;
                            }
                            
                        }else if(key_interval>0){
                            key_interval=key_interval-1;//カウントダウン
                        }

                        if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                            長押し阻止=0; 
                        }


                    if(mini_stage==0){
                        cursor=0;
                        mini_stage=1;
                    }else if(mini_stage==-1 && 演出カウント==1){//戦闘準備ー！ 
                        my_deck=[];//初期化初期化ー！って初期化しなくて良いヤツも初期化してる気がする。まあいいか
                        teki_deck=[];
                        my_yamahuda=[];
                        teki_yamahuda=[];
                        my_tehuda=[];
                        teki_tehuda=[];
                        my_ba=["","","","",""];
                        teki_ba=["","","","",""];
                        death_my_ba=["","","","",""];//死亡時演出のためにカードを別の場所に移したい（場に残すとバグの温床になることは自明なので）
                        death_teki_ba=["","","","",""];
                        tukau_mahou=[];//魔法つかった瞬間に消えるのよくないと思った。

                        my_haka=[];
                        teki_haka=[];
                        
                        deck_initialize(チャレンジリスト[cursor],my_deck,my_yamahuda);
                        deck_initialize(teki_deck_list,teki_deck,teki_yamahuda);
                        
                        
                        for(let i=0;i<5;i++){
                            if(my_ba[i]!=""){
                                my_ba[i].card.effect("ターン開始",["自ターン",i]);
                            }
                        }

                        my_now_pull=3;//ステージドロー
                        pull_card(my_yamahuda,my_tehuda,my_now_pull);
                        一時的なドロー枚数=[my_now_pull,teki_pull];
                        next_phase="戦闘";

                        cursor=16;
                        cursor2=0;

                        duel_phase="自由";
                        aite_phase=0;//相手のターンに動かしたい。
                       
                        aite_delay=0;//お前高速で動きすぎ！

                        my_kougeki_sum=0;//AI用
                        teki_kougeki_sum=0;//降参にも使ってる

                        zuba=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]//zuba64を表示するタイマー
                        yamahuda_damage=[0,0,0,0];//左が俺へのダメージで、右が相手へのダメージ描写
                        
                        get_card="";
                        相手の降参=0;

                        atk_card="";
                        def_card="";
                    }else if(mini_stage==-2){
                        if(クリア済み[0]*クリア済み[1]*クリア済み[2]*クリア済み[3]*クリア済み[4]*クリア済み[5]*クリア済み[6]*クリア済み[7]*クリア済み[8]==1 && duel_phase=="俺勝ち"){
                            mini_stage=3;
                            if(MAX_STAGE==11){
                                MAX_STAGE=12;
                                localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                            }
                        }else{
                            mini_stage=1;
                        }
                    }

                    if(mini_stage>0){
                        

                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(20,20,700,910);

                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillRect(40,40,150,220);
                        ctx.drawImage(ponya_image,50,50);

                        ctx.fillRect(290,40,150,220);
                        ctx.drawImage(kyuukoukasakusenki_image,300,50);

                        ctx.fillRect(540,40,150,220);
                        ctx.drawImage(ikkakudaija_atama_image,550,50);
                        
                        ctx.fillRect(40,340,150,220);
                        ctx.drawImage(yamiryuusyuu_image,50,350);

                        ctx.fillRect(290,340,150,220);
                        ctx.drawImage(moukyodokudaitake_image,300,350);

                        ctx.fillRect(540,340,150,220);
                        ctx.drawImage(akaoni_image,550,350);

                        ctx.fillRect(40,640,150,220);
                        ctx.drawImage(nezumi_image,50,650);

                        ctx.fillRect(290,640,150,220);
                        ctx.drawImage(pupukuraudo_image,300,650);

                        ctx.fillRect(540,640,150,220);
                        ctx.drawImage(kinkyuujitai5_image,550,650);

                        for(let i=0;i<9;i++){
                            if(クリア済み[i]==1){
                                ctx.drawImage(OKkuria,50+i%3*250,50+Math.floor(i/3)*300);
                            }
                        }
                        
                        ctx.fillStyle="rgb(240,230,250)";
                        ctx.fillRect(20,920,120,70);
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillText("戻る", 30, 970);
                    
                    
                        if(cursor==0){
                            ctx.drawImage(yubi,50,280+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==1){
                            ctx.drawImage(yubi,300,280+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==2){
                            ctx.drawImage(yubi,550,280+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==3){
                            ctx.drawImage(yubi,50,580+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==4){
                            ctx.drawImage(yubi,300,580+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==5){
                            ctx.drawImage(yubi,550,580+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==6){
                            ctx.drawImage(yubi,50,880+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==7){
                            ctx.drawImage(yubi,300,880+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==8){
                            ctx.drawImage(yubi,550,880+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==-1){
                            ctx.save();
                            ctx.rotate(270 * Math.PI / 180);
                            ctx.drawImage(yubi,-1020,120+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }
                    }
                    if(mini_stage==2){
                        ctx.fillStyle="rgb(0,0,0,0.5)";
                        ctx.fillRect(0,0,1000,1000);

                        ctx.fillStyle="rgb(50,50,80)";
                        ctx.fillRect(50,50,800,900);
                        ctx.fillRect(810,110,180,210);
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(55,55,790,890);
                        ctx.fillRect(815,115,170,200);
                        ctx.fillStyle="rgb(50,50,80)";
                        ctx.fillRect(60,60,780,880);
                        ctx.fillRect(820,120,160,190);
                        デッキ表示(チャレンジリスト[cursor],65,65,770,870);
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillText("挑戦", 850, 200,120);
                        ctx.fillText("戻る", 850, 270,120);
                        
                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        ctx.drawImage(yubi,125+cursor2*70,-820+4*Math.sin(time*Math.PI/8));
                        ctx.restore();
                        
                    }else if(mini_stage==3){
                        ctx.fillStyle="rgb(0,0,0,0.75)";
                        ctx.fillRect(0,0,1000,1000);
                        ctx.drawImage(EX_kuria,0,0);//変えること。ー－－－－－－－－－－－－－－－－－－－－－－－－－－
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(50,700,900,250);

                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillText("戻る", 200, 930);
                        ctx.fillText("ツイート", 700, 930);

                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        if(cursor2==0){
                            ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                        }else{
                            ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                        }
                        ctx.restore();
                        
                        
                        ctx.fillText("全ステージ制覇！", 100, 780);
                        ctx.fillText("しゅうくんカードマスターだ！", 100, 840);
                            
                        
                    }

                    if(mini_stage!=3){
                        ctx.drawImage(sakyura_omise,0,0);
                    }
                    
                }
                function 所持カードのセーブ(){
                    save_所持カード=[];
                    for(let i=0;i<所持カード.length;i++){
                        save_所持カード[i]=[所持カード[i][0].name,所持カード[i][1]];
                    }
                    localStorage.setItem('所持カード',JSON.stringify(save_所持カード));//ゲームデータセーブ
                }
                
                function 所持カードのロード(txt){
                    所持カード=JSON.parse(txt);
                    for(let i=0;i<所持カード.length;i++){
                        for(let j=0;j<all_card.length;j++){
                            if(all_card[j].name==所持カード[i][0]){//全カードから名前を検索してカードに置き換える
                                所持カード[i][0]=all_card[j];
                                break;
                            }
                        }
                    }
                }

                function デッキのセーブ(){
                    save_deck_list={card_list:[[]],ACE:[],TOP_ACE:[]};
                    if(deck_list.card_list.length!=0){
                        for(let i=0;i<deck_list.card_list.length;i++){
                            save_deck_list.card_list[i]=[deck_list.card_list[i][0].name,deck_list.card_list[i][1]];
                        }
                        for(let i=0;i<deck_list.ACE.length;i++){
                            save_deck_list.ACE[i]=deck_list.ACE[i].name;
                        }
                        for(let i=0;i<deck_list.TOP_ACE.length;i++){
                            save_deck_list.TOP_ACE[i]=deck_list.TOP_ACE[i].name;
                        }
                    }
                    
                    localStorage.setItem('deck_list',JSON.stringify(save_deck_list));//ゲームデータセーブ
                }

                function デッキのロード(txt){
                    deck_list=JSON.parse(txt);
                    for(let i=0;i<deck_list.card_list.length;i++){
                        for(let j=0;j<all_card.length;j++){
                            if(all_card[j].name==deck_list.card_list[i][0]){//全カードから名前を検索してカードに置き換える
                                deck_list.card_list[i][0]=all_card[j];
                                break;
                            }
                        }
                    }
                    for(let i=0;i<deck_list.ACE.length;i++){
                        for(let j=0;j<deck_list.card_list.length;j++){
                            if(deck_list.card_list[j][0].name==deck_list.ACE[i]){//全カードから名前を検索してカードに置き換える
                                deck_list.ACE[i]=deck_list.card_list[j][0];
                                break;
                            }
                        }
                    }
                    for(let i=0;i<deck_list.TOP_ACE.length;i++){
                        for(let j=0;j<deck_list.card_list.length;j++){
                            if(deck_list.card_list[j][0].name==deck_list.TOP_ACE[i]){//全カードから名前を検索してカードに置き換える
                                deck_list.TOP_ACE[i]=deck_list.card_list[j][0];
                                break;
                            }
                        }
                    }
                }
                //保存デッキ=[{card_list:[***,***,***],ACE:[1,2,3],TOP_ACE:[5]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]}];
                function 保存デッキの保存(){
                    let 保存_変換=[{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]}];
                    for(let i=0;i<10;i++){
                        for(let j=0;j<保存デッキ[i].card_list.length;j++){
                            保存_変換[i].card_list[j]= 保存デッキ[i].card_list[j].name;
                        }
                        保存_変換[i].ACE=[...保存デッキ[i].ACE];
                        保存_変換[i].TOP_ACE=[...保存デッキ[i].TOP_ACE];
                    }
                    localStorage.setItem('保存デッキ',JSON.stringify(保存_変換));
                }
                function 保存デッキの読み込み(txt){
                    保存デッキ=JSON.parse(txt);
                    for(let i=0;i<保存デッキ.length;i++){//古いデータだと長さ足りないので長さだけループ
                        for(let j=0;j<保存デッキ[i].card_list.length;j++){
                            for(let k=0;k<all_card.length;k++){
                                if(all_card[k].name==保存デッキ[i].card_list[j]){//全カードから名前を検索してカードに置き換える
                                    保存デッキ[i].card_list[j]=all_card[k];
                                    break;
                                }
                            }
                            //同じカード連続してるだろうから賢い処理を描くこともできるけど、ロード時に一回動くだけだし、いっか（笑）
                        }
                    }
                }
                function 全データ消去(){
                    localStorage.removeItem("所持カード");
                    localStorage.removeItem("deck_list");
                    localStorage.removeItem('保存デッキ');
                    localStorage.removeItem('MAX_STAGE');
                    localStorage.removeItem('MAX_ACE');
                    localStorage.removeItem('MAX_TOP_ACE');
                    localStorage.removeItem('お金');
                    localStorage.removeItem('MAX_deck');
                    localStorage.removeItem('my_pull');
                    localStorage.removeItem('my_deck_pull');
                    
                }

                function デッキの画像ダウンロード(){
                    ctx.fillStyle="rgb(50,50,80)";
                    ctx.fillRect(0,0,1000,1000);
                    ctx.fillStyle="rgb(255,255,255)";
                    ctx.fillRect(5,5,990,990);
                    ctx.fillStyle="rgb(50,50,80)";
                    ctx.fillRect(10,10,980,980);
                    if(stage==6 &&(game_phase=="挑戦" || game_phase=="戦闘")){
                        デッキ表示(今回のデッキ,15,15,970,970);
                    }else{
                        デッキ表示(deck_list,15,15,970,970);
                    }
                        
                    var 今= new Date();
                    var 今_文字=今.getDate()+""+今.getHours()+""+今.getMinutes()+""+今.getSeconds();
                    var DL_URL = document.createElement('a');
                    DL_URL.href=cnvs.toDataURL("image/png");
                    DL_URL.download = 'mydeck'+ 今_文字+ '.png';//ファイル名決めてる
                    DL_URL.click();//強制クリック
                }
                document.getElementById('download_button').addEventListener("click", デッキの画像ダウンロード);//ボタンに機能割り当て

                /*　封印！ これはタイトル画面を作成するときに使っていた秘密の関数なのです！え！？GIT管理してるのにこんなもん残すなって！？うるせー！
                function 全カード表示(card,x,y,x_haba,y_haba){
                    var kakudai;
                    var x_maisuu;
                    var hyouji_maisuu=card.length;
                    var count=0;

                    kakudai=1;
                    while(hyouji_maisuu>Math.ceil(x_haba/(kakudai*140))*Math.ceil(y_haba/(kakudai*210))){//拡大率を下げてカードが全部枠に入るように調整する
                        kakudai-=0.001;
                    }

                    x_maisuu=Math.ceil(x_haba/(kakudai*140));
                    ctx.save();
                    ctx.scale(kakudai,kakudai);

                    for(let i=0;i<card.length;i++){
                        
                            
                        シンプルカード表示(card[i],x/kakudai+140*(count%x_maisuu),y/kakudai+210*(Math.floor(count/x_maisuu)));
                        count+=1;
                        
                        
                    }
                    ctx.restore();
                }

                function 全画像ダウンロード(){
                    ctx.fillStyle="rgb(50,50,80)";
                    ctx.fillRect(0,0,1000,1000);
                    全カード表示(all_card.slice(2,all_card.length-1),-50,-50,1050,1250);
                    
                        
                    var 今= new Date();
                    var 今_文字=今.getDate()+""+今.getHours()+""+今.getMinutes()+""+今.getSeconds();
                    var DL_URL = document.createElement('a');
                    DL_URL.href=cnvs.toDataURL("image/png");
                    DL_URL.download = 'mydeck'+ 今_文字+ '.png';//ファイル名決めてる
                    DL_URL.click();//強制クリック
                }
                document.getElementById('download_button').addEventListener("click", 全画像ダウンロード);//ボタンに機能割り当て
                */
                
                function 外部セーブ(){
                    let 保存データ_一部;
                    let 保存データ_全体="これはしゅうくんカードのセーブデータなのです。";

                    保存データ_一部=[];
                    for(let i=0;i<所持カード.length;i++){
                        保存データ_一部[i]=[所持カード[i][0].name,所持カード[i][1]];
                    }
                    保存データ_全体+="\\"+JSON.stringify(保存データ_一部);
                    
                    保存データ_一部={card_list:[[]],ACE:[],TOP_ACE:[]};
                    if(deck_list.card_list.length!=0){
                        for(let i=0;i<deck_list.card_list.length;i++){
                            保存データ_一部.card_list[i]=[deck_list.card_list[i][0].name,deck_list.card_list[i][1]];
                        }
                        for(let i=0;i<deck_list.ACE.length;i++){
                            保存データ_一部.ACE[i]=deck_list.ACE[i].name;
                        }
                        for(let i=0;i<deck_list.TOP_ACE.length;i++){
                            保存データ_一部.TOP_ACE[i]=deck_list.TOP_ACE[i].name;
                        }
                    }
                    
                    保存データ_全体+="\\"+JSON.stringify(保存データ_一部);

                    保存データ_一部=[{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]}];
                    for(let i=0;i<10;i++){
                        for(let j=0;j<保存デッキ[i].card_list.length;j++){
                            保存データ_一部[i].card_list[j]= 保存デッキ[i].card_list[j].name;
                        }
                        保存データ_一部[i].ACE=[...保存デッキ[i].ACE];
                        保存データ_一部[i].TOP_ACE=[...保存デッキ[i].TOP_ACE];
                    }
                    保存データ_全体+="\\"+JSON.stringify(保存データ_一部);

                    保存データ_全体+="\\"+JSON.stringify(MAX_STAGE);
                    保存データ_全体+="\\"+JSON.stringify(MAX_ACE);
                    保存データ_全体+="\\"+JSON.stringify(MAX_TOP_ACE);
                    保存データ_全体+="\\"+JSON.stringify(お金);
                    保存データ_全体+="\\"+JSON.stringify(MAX_deck);
                    保存データ_全体+="\\"+JSON.stringify(my_pull);
                    保存データ_全体+="\\"+JSON.stringify(my_deck_pull);
                    保存データ_全体+="\\"+JSON.stringify(クリア済み);
                

                    let blob = new Blob([保存データ_全体], {type:'text/plain'});

                    var 今= new Date();
                    var 今_文字=今.getDate()+""+今.getHours()+""+今.getMinutes()+""+今.getSeconds();
                    var DL_URL = document.createElement('a');
                    DL_URL.href=URL.createObjectURL(blob);
                    DL_URL.download = 'しゅうくんカードセーブデータ'+ 今_文字+ '.txt';//ファイル名決めてる
                    DL_URL.click();//強制クリック
                    
                }
                document.getElementById('save_button').addEventListener("click", 外部セーブ);

                function 外部ロード(){
                    let 保存データ_一部="";
                    let 保存データ_全体="";
                    let txt読むマン = new FileReader();
                    txt読むマン.readAsText(this.files[0]);//ファイルを読むマンに解読してもらい、文字列にする
                    txt読むマン.onload = ()=> {//読み終わったら
                        保存データ_全体=txt読むマン.result;
                        保存データ_全体=保存データ_全体.split("\\");
                        if(保存データ_全体[0]=="これはしゅうくんカードのセーブデータなのです。"){
                            所持カードのロード(保存データ_全体[1]);
                            所持カードのセーブ();

                            デッキのロード(保存データ_全体[2]);
                            デッキのセーブ();
                        
                            保存デッキの読み込み(保存データ_全体[3]);
                            if(保存デッキ.length<10){//昔はデッキリストが5つだったので、古いデータを持っている人はここで加算します。10より増やすなら修正箇所が地味に多いので気を付けてくらさい。
                                for(let i=保存デッキ.length;i<10;i++){
                                    保存デッキ.push({card_list:[],ACE:[],TOP_ACE:[]});
                                }
                            }
                            保存デッキの保存();//ゲームデータセーブ
                        
                            MAX_STAGE=Number(保存データ_全体[4]);
                            localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ

                            MAX_ACE=Number(保存データ_全体[5]);
                            localStorage.setItem('MAX_ACE',MAX_ACE);//ゲームデータセーブ

                            MAX_TOP_ACE=Number(保存データ_全体[6]);
                            localStorage.setItem('MAX_TOP_ACE',MAX_TOP_ACE);//ゲームデータセーブ

                            お金=Number(保存データ_全体[7]);
                            localStorage.setItem('お金',お金);//ゲームデータセーブ

                            MAX_deck=Number(保存データ_全体[8]);
                            localStorage.setItem("MAX_deck",MAX_deck);//ゲームデータセーブ

                            my_pull=Number(保存データ_全体[9]);
                            localStorage.setItem('my_pull',my_pull);//ゲームデータセーブ
                        
                            my_deck_pull=Number(保存データ_全体[10]);
                            localStorage.setItem('my_deck_pull',my_deck_pull);//ゲームデータセーブ

                            if(typeof 保存データ_全体[11] !="undefined"){
                                クリア済み=JSON.parse(保存データ_全体[11]);
                                localStorage.setItem('クリア済み',クリア済み);//ゲームデータセーブ
                            }else{
                                クリア済み=[0,0,0,0,0,0,0,0,0];
                                localStorage.setItem('クリア済み',クリア済み);//ゲームデータセーブ
                            }
                            
                            
                            location.reload();
                        }else{
                            alert("なんか読み込めないファイルだった！");
                        }
                        
                    }
                }
                document.getElementById('load_button').addEventListener('change', 外部ロード);



                var compare = function (a, b) {//sort()関数の引数にこの関数を渡すと、数字のソートが可能になる。
                    return a - b
                }
                //カード定義ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－ー－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－
                //effectを使うときはeffect()
                //場所悪くない？→だってカード内に関数使いたかったんだもん…
                var test_card={name:"テストカード",image:test,ATK:1,HP:1,state:["モンスター","test"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"オイラはテストカード！真っ赤な赤色がトレードマークさ！…ところで俺がめちゃくちゃ長い説明文を持ってたとしたらどうする？ぐげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげげ",text_iro:[]};
                var test_card2={name:"テストカード2",image:test_syuukun,ATK:300,HP:400,state:["モンスター","test"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"伝説のテストしゅうくん。あ、まって半角文字のテストしたい123456789aqswderfﾍｲﾍｲﾍｲﾄﾞｳﾅﾝﾀﾞｲﾍｲﾍｲ…いけるじゃん！",text_iro:[[0,1,"rgb(255,0,0)"],[1,1,"rgb(255,255,0)"],[2,1,"rgb(0,255,0)"],[3,1,"rgb(0,255,255)"],[4,1,"rgb(0,0,255)"],[5,1,"rgb(255,0,255)"],[6,1,"rgb(255,0,0)"],[7,1,"rgb(255,255,0)"],[8,1,"rgb(0,255,0)"],[9,1,"rgb(0,255,255)"],[10,1,"rgb(0,0,255)"]]};
                
                var syuukun={name:"しゅうくん",image:card_syuukun,ATK:3,HP:10,state:["モンスター","しゅうくん"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"カードに力を込めろ！",text_iro:[[4,1,"rgb(255,0,0)"]]};
                var hojorobo={name:"補助ロボ",image:hojorobo_image,ATK:3,HP:2,state:["モンスター","機械"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"冒険者を補助するロボ、ホジョボ。",text_iro:[]};
                var kinkyuujitai5={name:"緊急事態─５─",image:kinkyuujitai5_image,state:["魔法","超危険"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        for(let i=0;i<5;i++){//破壊可能対象がいるなら発動可能。
                            if(my_ba[i]!="" && my_ba[i].state.indexOf("TOP_ACE")==-1 && my_ba[i].state.indexOf("ACE")==-1){
                                return true; 
                            }
                            if(teki_ba[i]!="" && teki_ba[i].state.indexOf("TOP_ACE")==-1 && teki_ba[i].state.indexOf("ACE")==-1){
                                return true; 
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }
                      
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        for(let i=0;i<5;i++){
                            if(my_ba[i]!="" && my_ba[i].state.indexOf("TOP_ACE")==-1 && my_ba[i].state.indexOf("ACE")==-1){
                                my_ba[i]=death_card(my_ba[i],my_haka,i);
                            }
                            if(teki_ba[i]!="" && teki_ba[i].state.indexOf("TOP_ACE")==-1 && teki_ba[i].state.indexOf("ACE")==-1){
                                teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                            }
                        }
                    }
                },AI:function(タイミング){
                    if(タイミング=="手札から"){
                        my_kougeki_sum=0;
                        teki_kougeki_sum=0;
                        for(let i=0;i<5;i++){
                            if(my_ba[i]!="" && my_ba[i].state.indexOf("ACE")==-1 && my_ba[i].state.indexOf("TOP_ACE")==-1){//zakoモンスターだね
                                my_kougeki_sum+=my_ba[i].ATK;
                            }
                            if(teki_ba[i]!="" && teki_ba[i].state.indexOf("TOP_ACE")==-1 && teki_ba[i].state.indexOf("ACE")==-1){//zakoモンスターだね
                                teki_kougeki_sum+=teki_ba[i].ATK;
                            }
                        }
                        if(my_kougeki_sum>teki_kougeki_sum){//発動条件ざつすぎん？
                            return true;
                        }
                        return false; 
                    }
                },text:"全モンスター破壊。(TOP_ACE ACEを除く)「事故発生、緊急事態─５─　本エリアは封鎖されます」",text_iro:[[10,7,"rgb(255,0,0)"],[18,3,"rgb(200,200,0)"]]};
                var ryuunoitigeki={name:"龍の一撃",image:ryuunoitigeki_img,state:["魔法","敵選択"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){//破壊可能対象がいるなら発動可能。
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("TOP_ACE")==-1 && teki_ba[i].state.indexOf("ACE")==-1){
                                    return true; 
                                }
                            }
                        }else{
                            for(let i=0;i<5;i++){//破壊可能対象がいるなら発動可能。
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("TOP_ACE")==-1 && my_ba[i].state.indexOf("ACE")==-1){
                                    return true; 
                                }
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            if(teki_ba[cursor2]!="" && teki_ba[cursor2].state.indexOf("TOP_ACE")==-1 && teki_ba[cursor2].state.indexOf("ACE")==-1){
                                teki_ba[cursor2]=death_card(teki_ba[cursor2],teki_haka,cursor2);
                                return true; //選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            var 一番強いカードの数値=-1;
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("TOP_ACE")==-1 && my_ba[i].state.indexOf("ACE")==-1){//破壊可能対象
                                    if(一番強いカードの数値<my_ba[i].HP*my_ba[i].ATK){
                                        一番強いカードの数値=my_ba[i].HP*my_ba[i].ATK;
                                        cursor2=i;
                                    } 
                                }
                            }
                            my_ba[cursor2]=death_card(my_ba[cursor2],my_haka,cursor2);
                        }
                        
                    }
                },AI:function(タイミング){
                    return true;//殺せるヤツがいるならどんどん使っていけ！
                },text:"相手モンスターを1体破壊！(TOP_ACE ACEを除く)",text_iro:[[14,7,"rgb(255,0,0)"],[22,3,"rgb(200,200,0)"]]};
                var powerup3={name:"パワーアップ３",image:powerup3_img,state:["魔法","味方選択","攻撃上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){//味方がいるなら発動可能。
                                if(my_ba[i]!=""){
                                    return true; 
                                }
                            }
                        }else{
                            for(let i=0;i<5;i++){//味方がいるなら発動可能。
                                if(teki_ba[i]!=""){
                                    return true; 
                                }
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""){
                                my_ba[cursor2].ATK+=3;
                                return true; //選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            var 一番元気なカードの数値=0;
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(一番元気なカードの数値<teki_ba[i].HP*teki_ba[i].can_ATK){
                                        一番元気なカードの数値=teki_ba[i].HP*teki_ba[i].can_ATK;
                                        cursor2=i;
                                    } 
                                }
                            }
                            teki_ba[cursor2].ATK+=3;
                        }
                        
                    }
                },AI:function(タイミング){
                    for(let i=0;i<5;i++){
                        if(teki_ba[i]!="" && teki_ba[i].can_ATK>0){//攻撃できない奴しかいないのに発動しても意味ないねん
                            return true; 
                        }
                    }
                    return false;
                },text:"味方モンスター1体の攻撃力+3！これで君もモテモテだ！",text_iro:[]};
                var HPup5={name:"体力アップ5",image:HPup5_img,state:["魔法","味方選択","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){//味方がいるなら発動可能。
                                if(my_ba[i]!=""){
                                    return true; 
                                }
                            }
                        }else{
                            for(let i=0;i<5;i++){//味方がいるなら発動可能。
                                if(teki_ba[i]!=""){
                                    return true; 
                                }
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""){
                                my_ba[cursor2].HP+=5;
                                return true; //選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            var 一番元気なカードの数値=-1;
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(一番元気なカードの数値<teki_ba[i].ATK){
                                        一番元気なカードの数値=teki_ba[i].ATK;
                                        cursor2=i;
                                    } 
                                }
                            }
                            teki_ba[cursor2].HP+=5;
                        }
                        
                    }
                },AI:function(タイミング){
                    return true;//強いキャラがいないと使わないってほうが賢い気もするが、気にするな！
                },text:"味方モンスター1体の体力+5！きょうもげんきだ！",text_iro:[]};

                var ponya={name:"ぽにゃ",image:ponya_image,ATK:2,HP:1,state:["モンスター","ぽにゃ"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"ぽにゃ。きょうも草原を歩く",text_iro:[]};
                var ponya_ace={name:"ぽにゃエース",image:ponya_ace_image,ATK:3,HP:5,state:["モンスター","ぽにゃ"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"ぽにゃエース。今日のお花は黄色♪",text_iro:[]};
                var yakuso_3={name:"薬草3",image:yakuso_3_image,state:["魔法","味方選択","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){for(let i=0;i<5;i++){if(my_ba[i]!=""){return true;}}
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){if(my_ba[cursor2]!=""){my_ba[cursor2].HP+=3;return true;}//選択系魔法は正しく動いたらtrueを返すこと！ 
                            return false; 
                        }else{var 一番元気なカードの数値=-1;for(let i=0;i<5;i++){if(teki_ba[i]!=""){if(一番元気なカードの数値<teki_ba[i].ATK){ 一番元気なカードの数値=teki_ba[i].ATK;cursor2=i;} }}teki_ba[cursor2].HP+=3;
                        }
                    }
                },AI:function(タイミング){
                    return true;//強いキャラがいないと使わないってほうが賢い気もするが、気にするな！
                },text:"なぜだか元気になる草。HP+3",text_iro:[]};

                var kameisi={name:"亀石",image:kameisi_image,ATK:2,HP:4,state:["モンスター","防御:",1],effect_req:function(タイミング){
                    return true;  
                },effect:function(タイミング){
                },AI:function(タイミング){
                    return true;
                },text:"亀に似た石。ダメージを１減らす。",text_iro:[]};
                var kametetu={name:"亀鉄",image:kametetu_image,ATK:2,HP:4,state:["モンスター","防御:",2],effect_req:function(タイミング){
                    return true;  
                },effect:function(タイミング){
                },AI:function(タイミング){
                    return true;
                },text:"鉄に似た亀。ダメージを2減らす。",text_iro:[]};

                var henyamotin={name:"へにゃもちん",image:henyamotin_image,ATK:2,HP:1,state:["モンスター","へにゃもちん","ACE"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"彗星のごとく現れた、我らのヒーロー！へにゃもちん！いつだってACEさ！",text_iro:[[0,2,"rgb(200,200,0)"],[13,4,"rgb(200,200,0)"],[30,3,"rgb(200,200,0)"]]};
                
                var ponya_sutoraiku={name:"ぽにゃストライク",image:ponya_sutoraiku_image,ATK:2,HP:3,state:["モンスター","ぽにゃ"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        let ponya_数=0;
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i]!=option[1] && my_ba[i].state.indexOf("ぽにゃ")!=-1){
                                    ponya_数=my_ba[i].state.filter(function(state){
                                        return state=="ぽにゃ";     //要素を一個ずつ見て、条件と一致するものを要素にもつ配列を生成する
                                    }).length;                      //できた配列の長さをそれとする
                                    option[1].ATK+=2*ponya_数;
                                }
                            }
                        }else{//敵
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i]!=option[1] && teki_ba[i].state.indexOf("ぽにゃ")!=-1){
                                    ponya_数=teki_ba[i].state.filter(function(state){
                                        return state=="ぽにゃ";     //要素を一個ずつ見て、条件と一致するものを要素にもつ配列を生成する
                                    }).length;                      //できた配列の長さをそれとする
                                    option[1].ATK+=2*ponya_数;
                                }
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、自分の場のぽにゃモンスターの数だけ攻撃力+2（自分は含めない）",text_iro:[]};
                var ponya_big={name:"ぽにゃBIG",image:ponya_big_image,ATK:1,HP:15,state:["モンスター","ぽにゃ","BIG"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"でかいぽにゃ。このゲームでは攻撃力が低く、体力が多いモンスターは攻撃されにくいということを覚えておこう。",text_iro:[]};
                var ponya_daburu={name:"ぽにゃダブル",image:ponya_daburu_image,ATK:2,HP:3,state:["モンスター","ぽにゃ","ぽにゃ","二回攻撃"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"双子のぽにゃは1ターンに二度攻撃を行う！しかもぽにゃ二体分だ！",text_iro:[]};
                var ponya_rein={name:"ぽにゃレイン！",image:ponya_rein_image,state:["魔法","敵ダメージ"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("ぽにゃ")!=-1){//こちらの場にぽにゃがいる
                                    for(let j=0;j<5;j++){
                                        if(teki_ba[j]!=""){return true; }//敵が一人はいる→発動可能
                                    }
                                }
                            }
                        }else{ 
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("ぽにゃ")!=-1){//敵の場にぽにゃがいる
                                    for(let j=0;j<5;j++){
                                        if(my_ba[j]!=""){return true; }//味方が一人はいる→発動可能
                                    }
                                }
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let ponya_数=0;
                        let ぽにゃカウント=0;
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("ぽにゃ")!=-1){//こちらの場にぽにゃがいる
                                    ponya_数=my_ba[i].state.filter(function(state){
                                        return state=="ぽにゃ";     //要素を一個ずつ見て、条件と一致するものを要素にもつ配列を生成する
                                    }).length;                      //できた配列の長さをそれとする
                                    ぽにゃカウント+=ponya_数;
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){//敵の場
                                    teki_ba[i].HP-=ぽにゃカウント*2;
                                    if(teki_ba[i].HP<=0){
                                        teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                    }
                                }
                            }
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("ぽにゃ")!=-1){//こちらの場にぽにゃがいる
                                    ponya_数=teki_ba[i].state.filter(function(state){
                                        return state=="ぽにゃ";     //要素を一個ずつ見て、条件と一致するものを要素にもつ配列を生成する
                                    }).length;                      //できた配列の長さをそれとする
                                    ぽにゃカウント+=ponya_数;
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){//敵の場
                                    my_ba[i].HP-=ぽにゃカウント*2;
                                    if(my_ba[i].HP<=0){
                                        my_ba[i]=death_card(my_ba[i],my_haka,i);
                                    }
                                }
                            }
                        }
                        return false; 
                    }
                },AI:function(タイミング){
                    return true;//まあ、使いたいときにつかえや😁
                },text:"こちらの場のぽにゃモンスターの数×２のダメージを相手モンスターすべてに与える！「ぽにゃにゃにゃにゃにゃにゃにゃにゃにゃ！」",text_iro:[]};
                
                var kyuukoukasakusenki={name:"急降下作戦機",image:kyuukoukasakusenki_image,ATK:1,HP:2,state:["モンスター","機械"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            pull_card(my_yamahuda,my_tehuda,1);
                        }else{//敵
                            pull_card(teki_yamahuda,teki_tehuda,1);
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時1ドロー。これより本機は作戦を開始する！",text_iro:[]};
                var atakkumojuru={name:"アタックモジュール",image:atakkumojuru_image,ATK:1,HP:2,state:["モンスター","機械","ドロー"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i]!=option[1]){
                                    my_ba[i].ATK+=1;
                                    if(my_ba[i].state.indexOf("機械")!=-1){//機械
                                        my_ba[i].ATK+=1;
                                    }
                                }
                            }
                        }else{//敵
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i]!=option[1]){
                                    teki_ba[i].ATK+=1;
                                    if(teki_ba[i].state.indexOf("機械")!=-1){//機械
                                        teki_ba[i].ATK+=1;
                                    }
                                }
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、自分以外の場のモンスターの攻撃力+1(機械は+2)",text_iro:[]};
                var kaihukumojuru={name:"回復モジュール",image:kaihukumojuru_image,ATK:1,HP:2,state:["モンスター","機械"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i]!=option[1]){
                                    my_ba[i].HP+=1;
                                    if(my_ba[i].state.indexOf("機械")!=-1){//機械
                                        my_ba[i].HP+=2;
                                    }
                                }
                            }
                        }else{//敵
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i]!=option[1]){
                                    teki_ba[i].HP+=1;
                                    if(teki_ba[i].state.indexOf("機械")!=-1){//機械
                                        teki_ba[i].HP+=2;
                                    }
                                }
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、自分以外の場のモンスターの体力+1(機械は+3)",text_iro:[]};
                var sukurappudoro={name:"スクラップ・ドロー",image:sukurappudoro_image,state:["魔法","ドロー"],effect_req:function(タイミング){
                    let 機械の数=0;
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("機械")!=-1){//墓地にいる機械
                                    機械の数+=1;
                                }
                            }
                            if(Math.floor(機械の数/2)>=1){
                                return true;//1ドローはできなら発動可能で。
                            }
                        }else{ 
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("機械")!=-1){//墓地にいる機械
                                    機械の数+=1;
                                }
                            }
                            if(Math.floor(機械の数/2)>=1){
                                return true;//1ドローはできなら発動可能で。
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    let 機械の数=0;
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("機械")!=-1){//墓地にいる機械
                                    機械の数+=1;
                                }
                            }
                            pull_card(my_yamahuda,my_tehuda,Math.floor(機械の数/2));
                        }else{ 
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("機械")!=-1){//墓地にいる機械
                                    機械の数+=1;
                                }
                            }
                            pull_card(teki_yamahuda,teki_tehuda,Math.floor(機械の数/2));
                        }
                    } 
                },AI:function(タイミング){
                    return true;//使えるなら使っとけ
                },text:"自分の墓地に眠る機械モンスターの数/2（切り捨て）だけドローする。",text_iro:[]};


                var sasori={name:"サソリ",image:sasori_image,ATK:2,HP:5,state:["モンスター","二回攻撃"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"二回攻撃。",text_iro:[]};
                var sasori_seitai={name:"サソリ_成体",image:sasori_seitai_image,ATK:2,HP:5,state:["モンスター","三回攻撃"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"三回攻撃。",text_iro:[]};
                
                var ikkakudaija_atama={name:"一角大蛇の頭",image:ikkakudaija_atama_image,ATK:0,HP:30,state:["モンスター","一角大蛇","一角大蛇の先端"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"炎の海を泳ぎ、蒼の角で貫く。獄海を支配する巨大な大蛇。",text_iro:[]};
                var ikkakudaija_hara={name:"一角大蛇の腹",image:ikkakudaija_hara_image,ATK:0,HP:5,state:["モンスター","一角大蛇"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        let 先端数=0;
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("一角大蛇の先端")!=-1){//こちらの場にいる
                                    先端数=my_ba[i].state.filter(function(state){
                                        return state=="一角大蛇の先端";     //要素を一個ずつ見て、条件と一致するものを要素にもつ配列を生成する
                                    }).length;                      //できた配列の長さをそれとする
                                    option[1].ATK+=先端数*3;
                                    option[1].HP+=先端数*2;
                                }
                            }

                        }else{//敵
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("一角大蛇の先端")!=-1){//こちらの場にいる
                                    先端数=teki_ba[i].state.filter(function(state){
                                        return state=="一角大蛇の先端";     //要素を一個ずつ見て、条件と一致するものを要素にもつ配列を生成する
                                    }).length;                      //できた配列の長さをそれとする
                                    option[1].ATK+=先端数*3;
                                    option[1].HP+=先端数*2;
                                }
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"一角大蛇の99%。召喚時、先端の数×3の攻撃力,×2のHPを得る",text_iro:[]};
                var ikkakudaija_yubi={name:"一角大蛇の指",image:ikkakudaija_yubi_image,ATK:5,HP:6,state:["モンスター","一角大蛇","一角大蛇の先端"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"一角大蛇の尾。獲物を指差す。",text_iro:[]};

                var buiwa={name:"ブ・岩",image:buiwa_image,ATK:2,HP:17,state:["モンスター","ブロック"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"ブロックモンスターがいるとき、ブロックモンスターにしか攻撃できない（そのなかでも一番上にいるやつに攻撃する）",text_iro:[]};
                var raihudaiya={name:"ライフダイヤ",image:raihudaiya_image,state:["魔法","味方選択","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){for(let i=0;i<5;i++){if(my_ba[i]!=""){return true;}}
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){if(my_ba[cursor2]!=""){my_ba[cursor2].HP+=10;return true;}//選択系魔法は正しく動いたらtrueを返すこと！ 
                            return false; 
                        }else{var 一番元気なカードの数値=-1;for(let i=0;i<5;i++){if(teki_ba[i]!=""){if(一番元気なカードの数値<teki_ba[i].ATK){ 一番元気なカードの数値=teki_ba[i].ATK;cursor2=i;} }}teki_ba[cursor2].HP+=10;
                        }
                    }
                },AI:function(タイミング){
                    return true;//強いキャラがいないと使わないってほうが賢い気もするが、気にするな！
                },text:"生命ダイヤモンド、胸に当てて祈る。HP+10",text_iro:[]};
                var seiretu={name:"整列！",image:seiretu_image,state:["魔法"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    for(let j=i+1;j<5;j++){
                                        if(my_ba[j]!="" && my_ba[i].HP<my_ba[j].HP){//なんか下のほうに体力が多いヤツがいる
                                            return true;
                                        }
                                    }
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    for(let j=i+1;j<5;j++){
                                        if(teki_ba[j]!="" && teki_ba[i].HP>teki_ba[j].HP){//なんか下のほうに体力が少ないヤツがいる
                                            return true;
                                        }
                                    }
                                }
                            }

                        }else{ 
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    for(let j=i+1;j<5;j++){
                                        if(my_ba[j]!="" && my_ba[i].HP>my_ba[j].HP){//なんか下のほうに体力が少ないヤツがいる
                                            return true;
                                        }
                                    }
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    for(let j=i+1;j<5;j++){
                                        if(teki_ba[j]!="" && teki_ba[i].HP<teki_ba[j].HP){//なんか下のほうに体力が多いヤツがいる
                                            return true;
                                        }
                                    }
                                }
                            }
                        }

                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 一時的なba=["","","","",""];
                        let 一番元気なカードの数値=-1;
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                for(let j=0;j<5;j++){
                                    if(my_ba[j]!="" && 一番元気なカードの数値==-1){
                                            一番元気なカードの数値=j;
                                    }
                                    if(my_ba[j]!="" && my_ba[j].HP>my_ba[一番元気なカードの数値].HP){
                                            一番元気なカードの数値=j;
                                    }
                                }//場にある一番体力が多いカードを見つける
                                if(一番元気なカードの数値!=-1){
                                    一時的なba[i]=my_ba[一番元気なカードの数値];
                                    my_ba[一番元気なカードの数値]="";
                                    一番元気なカードの数値=-1;
                                }
                            }
                            for(let i=0;i<5;i++){
                                my_ba[i]= 一時的なba[i];
                                my_ba[i].position="my_ba";
                                my_ba[i].move=5;
                            }
                            一時的なba=["","","","",""];
                            for(let i=0;i<5;i++){
                                for(let j=0;j<5;j++){
                                    if(teki_ba[j]!="" && 一番元気なカードの数値==-1){
                                            一番元気なカードの数値=j;
                                    }
                                    if(teki_ba[j]!="" && teki_ba[j].HP<teki_ba[一番元気なカードの数値].HP){
                                            一番元気なカードの数値=j;
                                    }
                                }//場にある一番体力が低いカードを見つける
                                if(一番元気なカードの数値!=-1){
                                    一時的なba[i]=teki_ba[一番元気なカードの数値];
                                    teki_ba[一番元気なカードの数値]="";
                                    一番元気なカードの数値=-1;
                                }
                            }
                            for(let i=0;i<5;i++){
                                teki_ba[i]= 一時的なba[i];
                                teki_ba[i].position="teki_ba";
                                teki_ba[i].move=5;
                            }
                        }else{

                            for(let i=0;i<5;i++){
                                for(let j=0;j<5;j++){
                                    if(my_ba[j]!="" && 一番元気なカードの数値==-1){
                                            一番元気なカードの数値=j;
                                    }
                                    if(my_ba[j]!="" && my_ba[j].HP<my_ba[一番元気なカードの数値].HP){
                                            一番元気なカードの数値=j;
                                    }
                                }//場にある一番体力が多いカードを見つける
                                if(一番元気なカードの数値!=-1){
                                    一時的なba[i]=my_ba[一番元気なカードの数値];
                                    my_ba[一番元気なカードの数値]="";
                                    一番元気なカードの数値=-1;
                                }
                            }
                            for(let i=0;i<5;i++){
                                my_ba[i]= 一時的なba[i];
                                my_ba[i].position="my_ba";
                                my_ba[i].move=5;
                            }
                            一時的なba=["","","","",""];
                            for(let i=0;i<5;i++){
                                for(let j=0;j<5;j++){
                                    if(teki_ba[j]!="" && 一番元気なカードの数値==-1){
                                            一番元気なカードの数値=j;
                                    }
                                    if(teki_ba[j]!="" && teki_ba[j].HP>teki_ba[一番元気なカードの数値].HP){
                                            一番元気なカードの数値=j;
                                    }
                                }//場にある一番体力が低いカードを見つける
                                if(一番元気なカードの数値!=-1){
                                    一時的なba[i]=teki_ba[一番元気なカードの数値];
                                    teki_ba[一番元気なカードの数値]="";
                                    一番元気なカードの数値=-1;
                                }
                            }
                            for(let i=0;i<5;i++){
                                teki_ba[i]= 一時的なba[i];
                                teki_ba[i].position="teki_ba";
                                teki_ba[i].move=5;
                            }
                        }
                        return false; 
                    }
                },AI:function(タイミング){
                    return true;//どうせ大量にデッキに投入するのでいつでも使っておけ
                },text:"整列ー！体力が高い者は上へ！体力が低い物は下へ並べ！敵？敵は逆順にでも並べておけい！",text_iro:[]};


                var kyuusainote={name:"救済の手",image:kyuusainote_image,ATK:0,HP:10,state:["モンスター","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;
                    }
                    return false;
                },effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    my_ba[i].HP+=2;
                                }
                            }
                            my_ba[option[1]].move=-3;
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    teki_ba[i].HP+=2;
                                }
                            }
                            teki_ba[option[1]].move=-3;
                        }
                    }
                    return false;
                },AI:function(タイミング){return true;},text:"力ある者を救済する手。自ターンの終わりに自分の場のすべてのモンスターのHP+2",text_iro:[]};
                var kenrounarusoukou={name:"堅牢なる装甲",image:kenrounarusoukou_image,ATK:0,HP:20,state:["モンスター","ブロック"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"力ある者を守る装甲。ブロック持ち",text_iro:[]};
                var zettainotamasii={name:"絶対の魂",image:zettainotamasii_image,ATK:0,HP:15,state:["モンスター"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;
                    }
                    return false;
                },effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            my_ba[option[1]].ATK+=2;
                        }else{//敵ターン
                            teki_ba[option[1]].ATK+=2;
                        }
                    }
                    return false;
                },AI:function(タイミング){return true;},text:"救済の手、堅牢なる装甲、絶対の魂、力の祭典。自ターンの終わりに攻撃力+2",text_iro:[]};
                
                var kyousinja={name:"狂信者",image:kyousinja_image,ATK:0,HP:1,state:["モンスター"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"祈りを届けるため、多くの命が捧げられていく",text_iro:[]};
                var hametunokami={name:"破滅の神",image:hametunokami_image,ATK:20,HP:99,state:["モンスター","しゅうくん"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){//ちゃんと条件渡してもいいけどまあ、いいかとなった
                        return true;
                    }
                    return false;
                },effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" &&i!=option[1]){
                                    my_ba[i]=death_card(my_ba[i],my_haka,i);
                                }
                            }
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && i!=option[1]){
                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                }
                            }
                        }
                    }
                    return false;
                },AI:function(タイミング){return true;},text:"全ての命を無へ。自ターンの終わりにこのカード以外の自分の場のモンスターを全て滅する",text_iro:[]};
                
                var burakkusyuukun={name:"ブラックしゅうくん",image:burakkusyuukun_image,ATK:0,HP:20,state:["モンスター","しゅうくん"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;
                },effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            if(my_ba[option[1]].state.indexOf("怒り:")!=-1){//怒り状態ですかぁ？
                                my_ba[option[1]].state[my_ba[option[1]].state.indexOf("怒り:")+1]+=1;//追加だ
                            }
                            if(my_ba[option[1]].state[my_ba[option[1]].state.indexOf("怒り:")+1]==3){//３回目のターンエンド

                                デッキカード追加(my_deck,yamika,"my_tehuda")
                                my_tehuda.push(my_deck[my_deck.length-1]);
                                my_ba[option[1]].state.splice(my_ba[option[1]].state.indexOf("怒り:"),2);
                            }
                        }else{//敵ターン
                            if(teki_ba[option[1]].state.indexOf("怒り:")!=-1){//怒り状態ですかぁ？
                                teki_ba[option[1]].state[teki_ba[option[1]].state.indexOf("怒り:")+1]+=1;//追加だ
                            }
                            if(teki_ba[option[1]].state[teki_ba[option[1]].state.indexOf("怒り:")+1]==3){//３回目のターンエンド

                            デッキカード追加(teki_deck,yamika,"teki_tehuda")
                            teki_tehuda.push(teki_deck[teki_deck.length-1]);
                            teki_ba[option[1]].state.splice(teki_ba[option[1]].state.indexOf("怒り:"),2);
                            }
                        }
                    }
                    
                },AI:function(タイミング){return true;},text:"黒しゅうくん。お前が赤いだけだろ！",text_iro:[]};
                var hojoseki={name:"補助石",image:hojoseki_image,ATK:0,HP:10,state:["モンスター","ブロック"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"異世界にある…マジックストーンの類だろうか？椅子が足りないときは席にもなるようだ",text_iro:[]};
                var musyounoai={name:"無償の愛",image:musyounoai_image,state:["魔法","味方選択","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("しゅうくん")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){if(my_ba[cursor2]!=""&& my_ba[cursor2].state.indexOf("しゅうくん")!=-1){my_ba[cursor2].HP+=20;return true;}//選択系魔法は正しく動いたらtrueを返すこと！ 
                            return false; 
                        }else{var 一番元気なカードの数値=-1;
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1){
                                    if(一番元気なカードの数値<teki_ba[i].ATK){ 
                                        一番元気なカードの数値=teki_ba[i].ATK;cursor2=i;} }}
                                        teki_ba[cursor2].HP+=20;
                        }
                    }
                },AI:function(タイミング){
                    return true;//強いキャラがいないと使わないってほうが賢い気もするが、気にするな！
                },text:"自分の場のしゅうくんを選んで、HP+20「(*´ε`*)ﾁｭｯﾁｭ」",text_iro:[]};
                var nitouryuukengi={name:"二刀流剣技！",image:nitouryuukengi_image,state:["魔法","味方選択","攻撃回数増加"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("しゅうくん")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){if(my_ba[cursor2]!=""&& my_ba[cursor2].state.indexOf("しゅうくん")!=-1){my_ba[cursor2].can_ATK+=1;return true;}//選択系魔法は正しく動いたらtrueを返すこと！ 
                            return false; 
                        }else{var 一番元気なカードの数値=-1;
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1){
                                    if(一番元気なカードの数値<teki_ba[i].ATK){ 
                                        一番元気なカードの数値=teki_ba[i].ATK;cursor2=i;} }}
                                        teki_ba[cursor2].can_ATK+=1;
                        }
                    }    
                },AI:function(タイミング){
                    for(let i=0;i<5;i++){
                        if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1 && teki_ba[i].ATK!=0){
                            return true; 
                        }
                    }
                    return false;
                },text:"自分の場のしゅうくんを選び、このターン攻撃可能回数が+1される",text_iro:[]};
                var sinennoai={name:"深淵の愛",image:sinennoai_image,state:["魔法","コントロール奪取"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            if(ba_mons_num(my_ba)==5){//これ以上奪えない
                                return false;  
                            }
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("しゅうくん")!=-1 && teki_ba[i].card.name!="しゅうくん"){return true;}
                            }
                        }else{
                            if(ba_mons_num(teki_ba)==5){//これ以上奪えない
                                return false;  
                            }
                            for(let i=0;i<5;i++){if(my_ba[i]!=""&& my_ba[i].state.indexOf("しゅうくん")!=-1 && my_ba[i].card.name!="しゅうくん"){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){

                            for(let i=0;i<5;i++){
                                if(ba_mons_num(my_ba)==5){//これ以上奪えない
                                        break;
                                }
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1 && teki_ba[i].card.name!="しゅうくん"){//相手のしゅうくんを探す
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(my_ba[j]==""){
                                            my_ba[j]=teki_ba[i];
                                            teki_ba[i]="";
                                            my_ba[j].position="my_ba";
                                            my_ba[j].move=5;
                                            break;
                                        }
                                    }                                    
                                }
                            }
                        }else{
                            for(let i=0;i<5;i++){
                                if(ba_mons_num(teki_ba)==5){//これ以上奪えない
                                        break;
                                }
                                if(my_ba[i]!=""&& my_ba[i].state.indexOf("しゅうくん")!=-1  && my_ba[i].card.name!="しゅうくん"){//相手のしゅうくんを探す
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(teki_ba[j]==""){
                                            teki_ba[j]=my_ba[i];
                                            my_ba[i]="";
                                            teki_ba[j].position="teki_ba";
                                            teki_ba[j].move=5;
                                            break;
                                        }
                                    }                                    
                                }
                            }
                        }
                    }    
                },AI:function(タイミング){return true;},text:"相手の場にいる全てのしゅうくんを奪う。「これが私の愛ですよ。」(主人公は鈍感系なので効かない)",text_iro:[]};
                var tyoubusou={name:"超武装！",image:tyoubusou_image,state:["魔法","味方選択","攻撃上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("しゅうくん")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){if(my_ba[cursor2]!=""&& my_ba[cursor2].state.indexOf("しゅうくん")!=-1){my_ba[cursor2].ATK+=10;return true;}//選択系魔法は正しく動いたらtrueを返すこと！ 
                            return false; 
                        }else{var 一番元気なカードの数値=-1;
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1){
                                    if(一番元気なカードの数値<teki_ba[i].ATK){ 
                                        一番元気なカードの数値=teki_ba[i].ATK;cursor2=i;} }}
                                        teki_ba[cursor2].ATK+=10;
                        }
                    }
                },AI:function(タイミング){
                    return true;//強いキャラがいないと使わないってほうが賢い気もするが、気にするな！
                },text:"自分の場のしゅうくんを選んで、ATK+10「やっぱこれ持つのが一番つええ。」",text_iro:[]};
                var yamiryuusyuu={name:"闇龍　シュウ",image:yamiryuusyuu_image,ATK:30,HP:40,state:["モンスター","しゅうくん","ドラゴン"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"闇の力を解放したら…もう俺の勝ちなんだよ！",text_iro:[]};
                var yamika={name:"闇化",image:yamika_image,state:["魔法","味方選択","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("しゅうくん")!=-1 && my_ba[i].ATK>=20){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1 && teki_ba[i].ATK>=20){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""&& my_ba[cursor2].state.indexOf("しゅうくん")!=-1  && my_ba[cursor2].ATK>=20){
                                if(my_ba[cursor2].state.indexOf("TOP_ACE")!=-1){
                                    継承state=["TOP_ACE"];
                                }else if(my_ba[cursor2].state.indexOf("ACE")!=-1){
                                    継承state=["ACE"];
                                }
                                継承state.push("上位召喚");
                                my_ba[cursor2]=death_card(my_ba[cursor2],my_haka,cursor2);
                                上位召喚(yamiryuusyuu,my_deck,cursor2,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1  && teki_ba[i].ATK>=20){
                                    if(teki_ba[i].state.indexOf("TOP_ACE")!=-1){
                                        継承state=["TOP_ACE"];
                                    }else if(teki_ba[i].state.indexOf("ACE")!=-1){
                                        継承state=["ACE"];
                                    }
                                    継承state.push("上位召喚");
                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                    上位召喚(yamiryuusyuu,teki_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                    return true;
                                }
                            }
                        }
                    }
                },AI:function(タイミング){
                    return true;//上位召喚したら弱くなるとかありそうだが気にすんな！
                },text:"自分の場のATKが20以上のしゅうくんを選んで、闇の力を解放させる「見せてやるよ！闇の力を！」",text_iro:[]};
                var doragonburesu={name:"ドラゴン・ブレス",image:doragonburesu_image,state:["魔法","味方選択","敵ダメージ"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("ドラゴン")!=-1 && my_ba[i].can_ATK>=1){//こちらの場に攻撃可能なドラゴンがいる
                                    for(let j=0;j<5;j++){
                                        if(teki_ba[j]!=""){return true; }//敵が一人はいる→発動可能
                                    }
                                }
                            }
                        }else{ 
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("ドラゴン")!=-1&& teki_ba[i].can_ATK>=1){//敵の場にいる
                                    for(let j=0;j<5;j++){
                                        if(my_ba[j]!=""){return true; }//味方が一人はいる→発動可能
                                    }
                                }
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!="" && my_ba[cursor2].state.indexOf("ドラゴン")!=-1 && my_ba[cursor2].can_ATK>=1){//こちらの場に攻撃可能なドラゴンがいる
                                
                                my_ba[cursor2].can_ATK-=1;
                                for(let i=0;i<5;i++){
                                    if(teki_ba[i]!=""){//敵の場
                                        teki_ba[i].HP-=Math.floor(my_ba[cursor2].ATK/2);
                                        if(teki_ba[i].HP<=0){
                                            teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                        }
                                    }
                                }
                                return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                        }else{
                            let 一番強いカードの数値=-1;
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("ドラゴン")!=-1&& teki_ba[i].can_ATK>=1){//敵の場にいる
                                    if(teki_ba[i].ATK>一番強いカードの数値){
                                        一番強いカードの数値=teki_ba[i].ATK;
                                        cursor2=i;
                                    }
                                }
                            }

                            teki_ba[cursor2].can_ATK-=1;
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){//敵の場
                                    my_ba[i].HP-=Math.floor(teki_ba[cursor2].ATK/2);
                                    if(my_ba[i].HP<=0){
                                        my_ba[i]=death_card(my_ba[i],my_haka,i);
                                    }
                                }
                            }
                            return true; 
                        }
                        return false; 
                    }
                },AI:function(タイミング){
                    return true;//攻撃力0のドラゴンがいたらどうするんですか？→ﾔﾊ
                },text:"こちらの場の攻撃可能なドラゴンモンスターを選択し、その攻撃力の半分のダメージを相手モンスターすべてに与える！その後、攻撃可能回数-1",text_iro:[]};
                var zerozonbizu={name:"ZEROゾンビs",image:zerozonbizu_image,state:["魔法","復活"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            if(ba_mons_num(my_ba)==5){//これ以上復活しない
                                return false;  
                            }
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("モンスター")!=-1 && my_haka[i].card.ATK==0){//墓地にもともとの攻撃力0のモンスターがいる
                                    return true;
                                }
                            }
                        }else{
                            if(ba_mons_num(teki_ba)==5){//これ以上復活しない
                                return false;  
                            }
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("モンスター")!=-1 && teki_haka[i].card.ATK==0){//墓地にもともとの攻撃力0のモンスターがいる
                                    return true;
                                }
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                           
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("モンスター")!=-1 && my_haka[i].card.ATK==0){//墓地にもともとの攻撃力0のモンスターがいる
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(my_ba[j]==""){
                                            蘇生(my_ba,j,my_haka,i);
                                            i-=1;
                                            break;
                                        }
                                    }            
                                    if(ba_mons_num(my_ba)==5){//これ以上増えない
                                        break;
                                    }                    
                                }
                            }
                                    
                            
                        }else{
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("モンスター")!=-1 && teki_haka[i].card.ATK==0){//墓地にもともとの攻撃力0のモンスターがいる
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(teki_ba[j]==""){
                                            蘇生(teki_ba,j,teki_haka,i);
                                            i-=1;
                                            break;
                                        }
                                    }            
                                    if(ba_mons_num(teki_ba)==5){//これ以上増えない
                                        break;
                                    }                    
                                }
                            }
                        }
                    }    
                },AI:function(タイミング){return true;},text:"自分の墓にいる本来の攻撃力が0のモンスターを蘇生しまくる",text_iro:[]};

                var ponyaaidoru={name:"ぽにゃアイドル♪",image:ponyaaidoru_image,ATK:3,HP:10,state:["モンスター","ぽにゃ"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<my_haka.length;i++){
                                     
                                if(my_haka[i].state.indexOf("モンスター")!=-1 && my_haka[i].state.indexOf("ぽにゃ")!=-1){//墓地に
                                    if(ba_mons_num(my_ba)==5){//これ以上増えない
                                        break;
                                    }   
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(my_ba[j]==""){
                                            蘇生(my_ba,j,my_haka,i);
                                            i-=1;
                                            break;
                                        }
                                    }            
                                }
                            }
                        }else{
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("モンスター")!=-1 && teki_haka[i].state.indexOf("ぽにゃ")!=-1){//墓地に
                                    if(ba_mons_num(teki_ba)==5){//これ以上増えない
                                        break;
                                    }  
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(teki_ba[j]==""){
                                            蘇生(teki_ba,j,teki_haka,i);
                                            i-=1;
                                            break;
                                        }
                                    }                 
                                }
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、墓地のぽにゃモンスターたちを復活させる「みんな！集まれー！！！！」",text_iro:[]};
                var aidorukourin={name:"アイドル降臨！",image:aidorukourin_image,state:["魔法","味方選択","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("ぽにゃ")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("ぽにゃ")!=-1){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""&& my_ba[cursor2].state.indexOf("ぽにゃ")!=-1){
                                if(my_ba[cursor2].state.indexOf("TOP_ACE")!=-1){
                                    継承state=["TOP_ACE"];
                                }else if(my_ba[cursor2].state.indexOf("ACE")!=-1){
                                    継承state=["ACE"];
                                }
                                継承state.push("上位召喚");
                                my_ba[cursor2]=death_card(my_ba[cursor2],my_haka,cursor2);
                                上位召喚(ponyaaidoru,my_deck,cursor2,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("ぽにゃ")!=-1){
                                    if(teki_ba[i].state.indexOf("TOP_ACE")!=-1){
                                        継承state=["TOP_ACE"];
                                    }else if(teki_ba[i].state.indexOf("ACE")!=-1){
                                        継承state=["ACE"];
                                    }
                                    継承state.push("上位召喚");
                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                    上位召喚(ponyaaidoru,teki_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                    return true;
                                }
                            }
                        }
                    }
                },AI:function(タイミング){
                    return true;//上位召喚したら弱くなるとかありそうだが気にすんな！
                },text:"自分の場のぽにゃモンスター1体がアイドルデビュー！？「墓地のみんなー！ライブが始まるよー！」",text_iro:[]};
                var hametunosinkou={name:"破滅の信仰",image:hametunosinkou_image,state:["魔法","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        let 狂信者カウント=0;
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].card.name=="狂信者"){
                                    狂信者カウント+=1;
                                }
                            }
                        }else{ 
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].card.name=="狂信者"){
                                    狂信者カウント+=1;
                                }
                            }
                        }
                        if(狂信者カウント>=5){
                            return true;
                        }else{
                            return false; 
                        }
                         
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].card.name=="狂信者"){//わざわざ確認する必要はないんですけど、ホラ、あとから調整しやすいじゃないですか
                                    if(my_ba[i].state.indexOf("TOP_ACE")!=-1){
                                        継承state=["TOP_ACE"];
                                    }else if(my_ba[i].state.indexOf("ACE")!=-1){
                                        継承state=["ACE"];
                                    }
                                    継承state.push("上位召喚");
                                    my_ba[i]=death_card(my_ba[i],my_haka,i);
                                    上位召喚(hametunokami,my_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター
                                    継承state=[];
                                }
                            }
                            
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].card.name=="狂信者"){
                                    if(teki_ba[i].state.indexOf("TOP_ACE")!=-1){
                                        継承state=["TOP_ACE"];
                                    }else if(teki_ba[i].state.indexOf("ACE")!=-1){
                                        継承state=["ACE"];
                                    }
                                    継承state.push("上位召喚");
                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                    上位召喚(hametunokami,teki_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター
                                    継承state=[];
                                }
                            }
                        }
                    }
                },AI:function(タイミング){
                    return true;//上位召喚したら弱くなるとかありそうだが気にすんな！←このカードでそれはないのでは…？
                },text:"破滅へと進む信仰。自分の場にいる5人の狂信者達の祈りが届くとき、神が生まれる。",text_iro:[]};
                var sentanseisei={name:"先端再生",image:sentanseisei_image,state:["魔法","味方選択","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].card.name=="一角大蛇の腹"){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].card.name=="一角大蛇の腹"){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""&& my_ba[cursor2].card.name=="一角大蛇の腹"){
                                if(my_ba[cursor2].state.indexOf("TOP_ACE")!=-1){
                                    継承state=["TOP_ACE"];
                                }else if(my_ba[cursor2].state.indexOf("ACE")!=-1){
                                    継承state=["ACE"];
                                }
                                継承state.push("上位召喚");
                                my_ba[cursor2]=death_card(my_ba[cursor2],my_haka,cursor2);
                                上位召喚(ikkakudaija_atama,my_deck,cursor2,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].card.name=="一角大蛇の腹"){
                                    if(teki_ba[i].state.indexOf("TOP_ACE")!=-1){
                                        継承state=["TOP_ACE"];
                                    }else if(teki_ba[i].state.indexOf("ACE")!=-1){
                                        継承state=["ACE"];
                                    }
                                    継承state.push("上位召喚");
                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                    上位召喚(ikkakudaija_atama,teki_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                    return true;
                                }
                            }
                        }
                    }
                },AI:function(タイミング){
                    return true;//上位召喚したら弱くなるとかありそうだが気にすんな！
                },text:"一角大蛇の脅威的な再生力は、切り落とした腹部から新たな頭部を生成する",text_iro:[]};
                var ikkakudaija_2={name:"双頭の一角大蛇",image:ikkakudaija_2_image,ATK:5,HP:45,state:["モンスター","一角大蛇","一角大蛇の先端","一角大蛇の先端"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"切り裂いた頭部から不気味な声が轟く！「若造が！その程度の攻撃で我が死ぬと思ったか！」一角大蛇の先端二つとしてカウントする。",text_iro:[]};
                var ittouryoudan={name:"一刀両断",image:ittouryoudan_image,state:["魔法","味方選択","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].card.name=="一角大蛇の頭"){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].card.name=="一角大蛇の頭"){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""&& my_ba[cursor2].card.name=="一角大蛇の頭"){
                                if(my_ba[cursor2].state.indexOf("TOP_ACE")!=-1){
                                    継承state=["TOP_ACE"];
                                }else if(my_ba[cursor2].state.indexOf("ACE")!=-1){
                                    継承state=["ACE"];
                                }
                                継承state.push("上位召喚");
                                my_ba[cursor2]=death_card(my_ba[cursor2],my_haka,cursor2);
                                上位召喚(ikkakudaija_2,my_deck,cursor2,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].card.name=="一角大蛇の頭"){
                                    if(teki_ba[i].state.indexOf("TOP_ACE")!=-1){
                                        継承state=["TOP_ACE"];
                                    }else if(teki_ba[i].state.indexOf("ACE")!=-1){
                                        継承state=["ACE"];
                                    }
                                    継承state.push("上位召喚");
                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                    上位召喚(ikkakudaija_2,teki_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                    return true;
                                }
                            }
                        }
                    }
                },AI:function(タイミング){
                    return true;//上位召喚したら弱くなるとかありそうだが気にすんな！
                },text:"ついに勇者の剣が自分の場にいる一角大蛇の頭を二つに切り裂く。あたりに飛び散る大量の血の中で、不吉な予感が漂い始める───",text_iro:[]};
                var ponyasyoukansi={name:"ぽにゃ召喚士",image:ponyasyoukansi_image,ATK:1,HP:1,state:["モンスター","ぽにゃ"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<5;i++){//空いてる場を探す
                                if(my_ba[i]==""){
                                    上位召喚(ponya,my_deck,i,[]);//これ上位召喚じゃねえだろ←うるへー！いてまうど！
                                }    
                            }        
                        }else{
                            for(let i=0;i<5;i++){//空いてる場を探す
                                if(teki_ba[i]==""){
                                    上位召喚(ponya,teki_deck,i,[]);//これ上位召喚じゃねえだろ←うるへー！いてまうど！
                                }    
                            }    
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、自分の場の空いてるところにぽにゃがいっぱい…うわ！こっちまで来たぞ！",text_iro:[]};
                var zousyoku={name:"増殖…！？",image:zousyoku_image,state:["魔法","味方選択","状態付与"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("ぽにゃ")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("ぽにゃ")!=-1){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""&& my_ba[cursor2].state.indexOf("ぽにゃ")!=-1){
                                my_ba[cursor2].state.push("ぽにゃ");
                                my_ba[cursor2].state.push("ぽにゃ");

                                return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("ぽにゃ")!=-1){
                                    teki_ba[i].state.push("ぽにゃ");
                                    teki_ba[i].state.push("ぽにゃ");

                                    return true;
                                }
                            }
                        }
                    }
                },AI:function(タイミング){
                    return true;
                },text:"自分の場のぽにゃ一体を選び…選び…なんかアイツ2体分増えたみたいになってませんか？",text_iro:[]};
                var sukurappugoremu={name:"スクラップゴーレム",image:sukurappugoremu_image,ATK:0,HP:2,state:["モンスター","スクラップ"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        let 継承攻撃力_index=option[1].state.indexOf("継承攻撃力")+1;
                        let 継承体力_index=option[1].state.indexOf("継承体力")+1;
                        if(継承攻撃力_index!=0){
                            option[1].ATK+=option[1].state[継承攻撃力_index];
                            option[1].HP+=option[1].state[継承体力_index];
                        }
                        
                    }
                },AI:function(タイミング){return true;},text:"召喚時、素材となった機械の能力値を得る",text_iro:[]};
                var sukurappubirudo={name:"スクラップ&ビルド",image:sukurappubirudo_image,state:["魔法","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("機械")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("機械")!=-1){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        let 継承攻撃力=0;
                        let 継承体力=0;
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("機械")!=-1){
                                    if(継承state!=["TOP_ACE"]){//まあ別になくてもいいけど…
                                        if(my_ba[i].state.indexOf("TOP_ACE")!=-1){
                                            継承state=["TOP_ACE"];
                                        }else if(my_ba[i].state.indexOf("ACE")!=-1){
                                            継承state=["ACE"];
                                        }
                                    }
                                    継承攻撃力+=my_ba[i].ATK;
                                    継承体力+=my_ba[i].HP;
                                    my_ba[i]=death_card(my_ba[i],my_haka,i);
                                }
                            }
                            継承state.push("上位召喚");
                            継承state.push("継承攻撃力");
                            継承state.push(継承攻撃力);
                            継承state.push("継承体力");
                            継承state.push(継承体力);
                            for(let i=0;i<5;i++){
                                if(my_ba[i]==""){
                                    上位召喚(sukurappugoremu,my_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター
                                    break;
                                }
                            }
                            
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("機械")!=-1){
                                    if(継承state!=["TOP_ACE"]){//まあ別になくてもいいけど…
                                        if(teki_ba[i].state.indexOf("TOP_ACE")!=-1){
                                            継承state=["TOP_ACE"];
                                        }else if(teki_ba[i].state.indexOf("ACE")!=-1){
                                            継承state=["ACE"];
                                        }
                                    }
                                    継承攻撃力+=teki_ba[i].ATK;
                                    継承体力+=teki_ba[i].HP;
                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                }
                            }
                            継承state.push("上位召喚");
                            継承state.push("継承攻撃力");
                            継承state.push(継承攻撃力);
                            継承state.push("継承体力");
                            継承state.push(継承体力);
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]==""){
                                    上位召喚(sukurappugoremu,teki_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター
                                    break;
                                }
                            }
                        }
                    }
                },AI:function(タイミング){
                    return true;
                },text:"自分の場にいる全ての機械モンスターを粉砕し、スクラップの巨人を生み出す",text_iro:[]};

                var sasori_hujou={name:"サソリ_不浄",image:sasori_hujou_image,ATK:2,HP:10,state:["モンスター","毒付与","二回攻撃"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                            def_card.state[def_card.state.indexOf("毒:")+1]+=1;//追加だ
                        }else{
                            def_card.state.push("毒:");
                            def_card.state.push(1);
                        }
                    }
                },AI:function(タイミング){return true;},text:"毒+1攻撃,二回攻撃。",text_iro:[]};

                var dokuhakinoko={name:"毒吐キノコ",image:dokuhakinoko_image,ATK:3,HP:1,state:["モンスター","毒付与","死亡時"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="死んだ"){
                        if(option!=atk_card && atk_card!=""){//攻撃したの俺じゃねえよな？ && 攻撃で死んだよな？
                            if(atk_card.state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                atk_card.state[atk_card.state.indexOf("毒:")+1]+=3;//追加だ
                            }else{
                                atk_card.state.push("毒:");
                                atk_card.state.push(3);
                            }
                        }
                        
                    }
                },AI:function(タイミング){return true;},text:"オイオイオイ！ソコのザコそうなザコ！オレサマにコウゲキしようとしてんじゃねえのか！テメみてなアホパンチがキクってか！フザケンジャネっぞ！オレサマがシヌようなことになったら、オレサマをコウゲキしやがったヤツにイカス毒を+3してﾔｯｿﾞ！",text_iro:[]};
                var karamaruito={name:"絡まる糸",image:karamaruito_image,ATK:1,HP:3,state:["モンスター","攻撃制限"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.can_ATK>0){//攻撃可能なら
                            def_card.can_ATK-=1;
                        }else{
                        }
                    }
                },AI:function(タイミング){return true;},text:"攻撃した相手の次ターン攻撃可能数を1減らす。拘束された敵はじわじわと森に侵され、いずれ死ぬ",text_iro:[]};
                var ookametake={name:"大亀茸",image:ookametake_image,ATK:2,HP:10,state:["モンスター","防御:",5],effect_req:function(タイミング){
                    return true;  
                },effect:function(タイミング){
                },AI:function(タイミング){
                    return true;
                },text:"大亀に似た大茸。ダメージを5減らす。美味。",text_iro:[]};
                var moukyodokudaitake={name:"猛巨毒大茸",image:moukyodokudaitake_image,ATK:1,HP:20,state:["モンスター","毒付与"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;
                },effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                        my_ba[i].state[my_ba[i].state.indexOf("毒:")+1]+=3;//追加だ
                                    }else{
                                        my_ba[i].state.push("毒:");
                                        my_ba[i].state.push(3);
                                    }
                                }
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                        teki_ba[i].state[teki_ba[i].state.indexOf("毒:")+1]+=3;//追加だ
                                    }else{
                                        teki_ba[i].state.push("毒:");
                                        teki_ba[i].state.push(3);
                                    }
                                }
                            }
                            my_ba[option[1]].move=-3;
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                        my_ba[i].state[my_ba[i].state.indexOf("毒:")+1]+=3;//追加だ
                                    }else{
                                        my_ba[i].state.push("毒:");
                                        my_ba[i].state.push(3);
                                    }
                                }
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                        teki_ba[i].state[teki_ba[i].state.indexOf("毒:")+1]+=3;//追加だ
                                    }else{
                                        teki_ba[i].state.push("毒:");
                                        teki_ba[i].state.push(3);
                                    }
                                }
                            }
                            teki_ba[option[1]].move=-3;
                        }
                    }
                    return false;
                },AI:function(タイミング){return true;},text:"自ターンの終わりにすべてのモンスターに毒+3が降り注ぐ",text_iro:[]};
                var rozusyuu={name:"ローズ・シュウ",image:rozusyuu_image,ATK:0,HP:20,state:["モンスター","しゅうくん","毒付与","攻撃制限"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.can_ATK>0){//攻撃可能なら
                            def_card.can_ATK-=1;
                        }
                        if(def_card.state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                            def_card.state[def_card.state.indexOf("毒:")+1]+=1;//追加だ
                        }else{
                            def_card.state.push("毒:");
                            def_card.state.push(1);
                        }
                    }
                },AI:function(タイミング){return true;},text:"攻撃した相手の次ターン攻撃可能数を1減らし、毒+1を付与する。愛が俺を呼ぶ！",text_iro:[]};
                var kanbansan={name:"看板さん",image:kanbansan_image,ATK:8,HP:20,state:["モンスター","隠しキャラ"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"見せてあげましょう、看板と、非看板の差を──────",text_iro:[]};
                var gurumesinjidai={name:"グルメ新時代",image:gurumesinjidai_image,state:["魔法","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("毒:")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("毒:")!=-1){return true; }}
                        }
                        return false;  
                    }
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""&& my_ba[i].state.indexOf("毒:")!=-1){
                                    my_ba[i].HP+=my_ba[i].state[my_ba[i].state.indexOf("毒:")+1]*3;
                                }
                            } 
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("毒:")!=-1){
                                    teki_ba[i].HP+=teki_ba[i].state[teki_ba[i].state.indexOf("毒:")+1]*3;
                                }
                            } 
                        }
                    }
                },AI:function(タイミング){
                    return true;
                },text:"毒状態の味方は毒の数値×３回復する。…うむ！うまい。",text_iro:[]};
                var kinkyuujitai3={name:"緊急事態─３─",image:kinkyuujitai3_image,state:["魔法","毒付与"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){return true;}
                            }
                        }else{
                             for(let i=0;i<5;i++){if(my_ba[i]!=""){return true; }}
                        }
                        return false;  
                    }
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                        teki_ba[i].state[teki_ba[i].state.indexOf("毒:")+1]+=3;//追加だ
                                    }else{
                                        teki_ba[i].state.push("毒:");
                                        teki_ba[i].state.push(3);
                                    }
                                }
                            } 
                        }else{
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                        my_ba[i].state[my_ba[i].state.indexOf("毒:")+1]+=3;//追加だ
                                    }else{
                                        my_ba[i].state.push("毒:");
                                        my_ba[i].state.push(3);
                                    }
                                }
                            } 
                        }
                    }
                },AI:function(タイミング){
                    return true;
                },text:"相手全体に毒+3の反倫理的攻撃",text_iro:[]};
                var miryousuruhitomi={name:"魅了する瞳",image:miryousuruhitomi_image,state:["魔法","ドロー制限"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            if(一時的なドロー枚数[1]>0){//ドロー枚数残ってる？
                                for(let i=0;i<5;i++){
                                    if(my_ba[i]!="" && my_ba[i].state.indexOf("しゅうくん")!=-1){//こちらの場に
                                        return true; 
                                    }
                                }
                            }
                            
                        }else{ 
                            if(一時的なドロー枚数[0]>0){//ドロー枚数残ってる？
                                for(let i=0;i<5;i++){
                                    if(teki_ba[i]!="" && teki_ba[i].state.indexOf("しゅうくん")!=-1){//敵の場に
                                        return true; 
                                    }
                                }
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            一時的なドロー枚数[1]-=1;//これさ、現状でどんくらい減ってるのか見せたい気持ちもあるけど、めんどいね
                        }else{
                            一時的なドロー枚数[0]-=1;
                        }
                    }
                },AI:function(タイミング){
                    return true;//まあ、使いたいときにつかえや😁
                },text:"しゅうくんが自分の場にいるとき、相手の次のドローを1枚減らさせる。「俺の瞳を見ろ！」",text_iro:[]};
                var kankyouseihagoremu={name:"環境制覇ゴーレム",image:kankyouseihagoremu_image,ATK:1,HP:20,state:["モンスター","ブロック","毒回復"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"過酷な環境でも目標を保護する石製兵器。毒状態のとき、ダメージを受けるのではなく数値の1/3回復する。",text_iro:[]};

                var dokuzomenaihu={name:"毒染めナイフ",image:dokuzomenaihu_image,ATK:5,HP:1,state:["モンスター","ナイフ","武器","毒付与"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                            def_card.state[def_card.state.indexOf("毒:")+1]+=5;//追加だ
                        }else{
                            def_card.state.push("毒:");
                            def_card.state.push(5);
                        }
                    }
                },AI:function(タイミング){return true;},text:"攻撃した相手の傷口に毒+5を流し込む",text_iro:[]};
                var tizomenaihu={name:"血染めナイフ",image:tizomenaihu_image,ATK:5,HP:1,state:["モンスター","ナイフ","武器","防御破壊"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.state.indexOf("防御:")!=-1){//防御ある？
                            def_card.state[def_card.state.indexOf("防御:")+1]-=5;//追加だ
                            if(def_card.state[def_card.state.indexOf("防御:")+1]==0){//防御０は表示しないでおこうよ
                                def_card.state.splice(def_card.state.indexOf("防御:")+1,1);
                                def_card.state.splice(def_card.state.indexOf("防御:"),1);
                            }
                        }else{
                            def_card.state.push("防御:");
                            def_card.state.push(-5);
                        }
                    }
                },AI:function(タイミング){return true;},text:"攻撃した相手に深い傷をつけることで与えるダメージを5増やす",text_iro:[]};
                var muzomenaihu={name:"無染めナイフ",image:muzomenaihu_image,ATK:10,HP:1,state:["モンスター","ナイフ","武器"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"キレイでシンプルなナイフ。お子様にもオススメ。",text_iro:[]};
                var naihuzomeotoko={name:"ナイフ染め男",image:naihuzomeotoko_image,ATK:0,HP:20,state:["モンスター","山札召喚","攻撃回数付与","…ナイフ大好き！寝るときも、ご飯を食べるときも、外にあそびにいくときも、いつもいっしょです！え？なんでこの欄でしゃべってるのかだって？細かいことは忘れて俺のナイフコレクションを見てくれよ～～～"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<my_yamahuda.length;i++){
                                     
                                if(my_yamahuda[i].state.indexOf("モンスター")!=-1 && my_yamahuda[i].state.indexOf("ナイフ")!=-1){//墓地に
                                    if(ba_mons_num(my_ba)==5){//これ以上増えない
                                        break;
                                    }   
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(my_ba[j]==""){
                                            syoukan(my_yamahuda[i],"my_ba",j);
                                            my_yamahuda.splice(i,1);
                                            i-=1;
                                            break;
                                        }
                                    }            
                                }
                            }
                        }else{
                            for(let i=0;i<teki_yamahuda.length;i++){
                                     
                                    if(teki_yamahuda[i].state.indexOf("モンスター")!=-1 && teki_yamahuda[i].state.indexOf("ナイフ")!=-1){//墓地に
                                         if(ba_mons_num(teki_ba)==5){//これ以上増えない
                                             break;
                                         }   
                                         for(let j=0;j<5;j++){//空いてる場を探す
                                             if(teki_ba[j]==""){
                                                 syoukan(teki_yamahuda[i],"teki_ba",j);
                                                 teki_yamahuda.splice(i,1);
                                                 i-=1;
                                                 break;
                                             }
                                         }            
                                     }
                                 }
                        }
                    }else if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("ナイフ")!=-1){//ナイフ？
                                        my_ba[i].can_ATK+=1;
                                    }
                                }
                            }
                            my_ba[option[1]].move=-3;
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("ナイフ")!=-1){//ナイフ？
                                        teki_ba[i].can_ATK+=1;
                                    }
                                }
                            }
                            teki_ba[option[1]].move=-3;
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、山札に眠るナイフコレクションをどんどん召喚しちゃう。ターンエンド時、自分の場のナイフの攻撃回数を+1しちゃう。しちゃうったらしちゃう！",text_iro:[]};
                var sabitayari={name:"錆びた槍",image:sabitayari_image,ATK:5,HP:5,state:["モンスター","武器","貫通"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"貫通：モンスターに攻撃したとき、相手の体力よりも攻撃力が上回ったならその分だけ山札を攻撃できる。が、その攻撃によって勝利することはできない。",text_iro:[]};
                var kantuuya={name:"貫通矢",image:kantuuya_image,state:["魔法","敵ダメージ","貫通"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){return true; }//敵が一人はいる→発動可能
                            }
                        }else{ 
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){return true; }//味方が一人はいる→発動可能
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 貫通ダメージ=0;
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){//敵の場
                                    if(teki_ba[i].HP<3){
                                        貫通ダメージ+=3-teki_ba[i].HP;
                                    }
                                    teki_ba[i].HP-=3;
                                    if(teki_ba[i].HP<=0){
                                        teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                    }
                                }
                            }
                            if(貫通ダメージ>teki_yamahuda.length){//貫通しすぎだ！
                                atk_yamahuda(teki_yamahuda.length,teki_yamahuda,teki_haka,teki_ba,teki_tehuda);//デッキには消えてもらいます。
                            }else{
                                atk_yamahuda(貫通ダメージ,teki_yamahuda,teki_haka,teki_ba,teki_tehuda);//貫通分のダメージを負ってもらうぜ！
                            }
                           
                        }else{
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){//敵の場
                                    if(my_ba[i].HP<3){
                                        貫通ダメージ+=3-my_ba[i].HP;
                                    }
                                    my_ba[i].HP-=3;
                                    if(my_ba[i].HP<=0){
                                        my_ba[i]=death_card(my_ba[i],my_haka,i);
                                    }
                                }
                            }
                            if(貫通ダメージ>my_yamahuda.length){//貫通しすぎだ！
                                    atk_yamahuda(my_yamahuda.length,my_yamahuda,my_haka,my_ba,my_tehuda);//デッキには消えてもらいます。
                                }else{
                                    atk_yamahuda(貫通ダメージ,my_yamahuda,my_haka,my_ba,my_tehuda);//貫通分のダメージを負ってもらうぜ！
                                }
                        }
                        return false; 
                    }
                },AI:function(タイミング){
                    return true;//まあ、使いたいときにつかえや😁
                },text:"相手モンスター全体に３ダメージの貫通矢を放つ。この魔法により相手が負けることはない。",text_iro:[]};
                var sabitataiken={name:"錆びた大剣",image:sabitataiken_image,ATK:10,HP:15,state:["モンスター","武器","みねうち"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.HP<=atk_card.ATK){
                            def_card.HP=atk_card.ATK+1;//防御力計算などはすでに行われているので、これで大丈夫なはず。
                        }
                    }
                },AI:function(タイミング){return true;},text:"ボロボロに風化した巨大な大剣。高い攻撃力を持つが、相手モンスターを追い詰めたとしても倒すことができない。（体力が1残る）",text_iro:[]};
                var ueponsarubeji={name:"ウエポン・サルベージ",image:ueponsarubeji_image,state:["魔法","墓地回収"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("武器")!=-1){return true; }//ぶきあった。
                            }
                        }else{ 
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("武器")!=-1){return true; }//ぶきあった。
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 回収カウント=0;
                        if(duel_phase!="相手"){
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("武器")!=-1){//ぶきあった。
                                    my_tehuda.push(my_haka[i]);
                                    my_haka[i].position="my_tehuda";
                                    my_haka.splice(i,1);
                                    i-=1;
                                    回収カウント+=1;
                                    if(回収カウント==2){
                                        break;
                                    }
                                }
                            }
                           
                        }else{
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("武器")!=-1){//ぶきあった。
                                    teki_tehuda.push(teki_haka[i]);
                                    teki_haka[i].position="teki_tehuda";
                                    teki_haka.splice(i,1);
                                    i-=1;
                                    回収カウント+=1;
                                    if(回収カウント==2){
                                        break;
                                    }
                                }
                            }
                        }
                        return false; 
                    }
                },AI:function(タイミング){
                    return true;//まあ、使いたいときにつかえや😁
                },text:"墓地の上から武器モンスターを二枚手札に加える",text_iro:[]};
                var hokakusuneku={name:"捕獲スネーク",image:hokakusuneku_image,ATK:1,HP:10,state:["モンスター","捕獲"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.state.indexOf("ACE")==-1 && def_card.state.indexOf("TOP_ACE")==-1 ){
                            if(def_card.state.indexOf("服従:")!=-1){//服従蓄積ですかぁ？
                                def_card.state[def_card.state.indexOf("服従:")+1]+=4;//追加だ
                                if(def_card.HP>atk_card.ATK){//攻撃耐えるよね？
                                    if(def_card.state[def_card.state.indexOf("服従:")+1]>=10){//捕獲、成功！
                                        if(def_card.position=="my_ba"){//俺のモンスターを捕獲！？
                                            for(let i=0;i<5;i++){//場空いてる？
                                                if(teki_ba[i]==""){//ここに奪おう
                                                    for(let j=0;j<5;j++){//お前どこ？
                                                        if(my_ba[j]==def_card){//そこにいたのか
                                                            my_ba[j]="";//消えなさい。
                                                            teki_ba[i]=def_card;//おいで
                                                            def_card.position="teki_ba";//ここがお前のあたらしい家だよ
                                                            def_card.move=3;//ちょっと動いて
                                                            break;
                                                        }
                                                    }
                                                    break;
                                                }
                                            }
                                        }else{//お前のモンスターを捕獲！
                                            for(let i=0;i<5;i++){//場空いてる？
                                                if(my_ba[i]==""){//ここに奪おう
                                                    for(let j=0;j<5;j++){//お前どこ？
                                                        if(teki_ba[j]==def_card){//そこにいたのか
                                                            teki_ba[j]="";//消えなさい。
                                                            my_ba[i]=def_card;//おいで
                                                            def_card.position="my_ba";//ここがお前のあたらしい家だよ
                                                            def_card.move=3;//ちょっと動いて
                                                            break;
                                                        }
                                                    }
                                                    break;
                                                }
                                            }
                                        }
                                    }
                                }
                                
                            }else{
                                def_card.state.push("服従:");
                                def_card.state.push(4);
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"攻撃した相手に服従+4。（服従が10に達したモンスターは奪われる。ACE、TOP_ACEを除く。）",text_iro:[]};
                var isseihokaku={name:"一斉捕獲",image:isseihokaku_image,state:["魔法","捕獲"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && (teki_ba[i].state.indexOf("ACE")==-1 && teki_ba[i].state.indexOf("TOP_ACE")==-1 )){
                                    return true;
                                }
                            }
                        }else{
                             for(let i=0;i<5;i++){if(my_ba[i]!="" &&my_ba[i].state.indexOf("ACE")==-1 && my_ba[i].state.indexOf("TOP_ACE")==-1 ){return true; }}
                        }
                        return false;  
                    }
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("ACE")==-1 && teki_ba[i].state.indexOf("TOP_ACE")==-1 ){
                                        if(teki_ba[i].state.indexOf("服従:")!=-1){//服従蓄積ですかぁ？
                                            teki_ba[i].state[teki_ba[i].state.indexOf("服従:")+1]+=2;//追加だ
                                            if(teki_ba[i].state[teki_ba[i].state.indexOf("服従:")+1]>=10){//捕獲！
                                                for(let j=0;j<5;j++){
                                                    if(my_ba[j]==""){//空いてる場だね
                                                        my_ba[j]=teki_ba[i];//おいで
                                                        teki_ba[i]="";//消えなさい。
                                                        my_ba[j].position="my_ba";//ここがお前のあたらしい家だよ
                                                        my_ba[j].move=3;//ちょっと動いて
                                                        break;
                                                    }
                                                }
                                            }
                                        }else{
                                            teki_ba[i].state.push("服従:");
                                            teki_ba[i].state.push(2);
                                        }
                                    }
                                }
                            } 
                        }else{
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("ACE")==-1 && my_ba[i].state.indexOf("TOP_ACE")==-1 ){
                                        if(my_ba[i].state.indexOf("服従:")!=-1){//服従蓄積ですかぁ？
                                            my_ba[i].state[my_ba[i].state.indexOf("服従:")+1]+=2;//追加だ
                                            if(my_ba[i].state[my_ba[i].state.indexOf("服従:")+1]>=10){//捕獲！
                                                for(let j=0;j<5;j++){
                                                    if(teki_ba[j]==""){//空いてる場だね
                                                        teki_ba[j]=my_ba[i];//おいで
                                                        my_ba[i]="";//消えなさい。
                                                        teki_ba[j].position="teki_ba";//ここがお前のあたらしい家だよ
                                                        teki_ba[j].move=3;//ちょっと動いて
                                                        break;
                                                    }
                                                }
                                            }
                                        }else{
                                            my_ba[i].state.push("服従:");
                                            my_ba[i].state.push(2);
                                        }
                                    }
                                }
                            } 
                        }
                    }
                },AI:function(タイミング){
                    if(ba_mons_num(teki_ba)<4){//2つは空いてる場所がほしい…な
                        return true;
                    }
                    
                    return false;
                },text:"相手全体に服従+2の催眠攻撃。上から捕獲していくため、場がいっぱいになったときは下のほうは残っちゃいます＞＜",text_iro:[]};
                var aooni={name:"青鬼",image:aooni_image,ATK:0,HP:30,state:["モンスター","捕獲"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.state.indexOf("ACE")==-1 && def_card.state.indexOf("TOP_ACE")==-1 ){
                            if(def_card.state.indexOf("服従:")!=-1){//服従蓄積ですかぁ？
                                def_card.state[def_card.state.indexOf("服従:")+1]+=10;//追加だ
                            }else{
                                def_card.state.push("服従:");
                                def_card.state.push(10);
                            }
                            if(def_card.HP>atk_card.ATK){//攻撃耐えるよね？
                                if(def_card.state[def_card.state.indexOf("服従:")+1]>=10){//捕獲、成功！
                                    if(def_card.position=="my_ba"){//俺のモンスターを捕獲！？
                                        for(let i=0;i<5;i++){//場空いてる？
                                            if(teki_ba[i]==""){//ここに奪おう
                                                for(let j=0;j<5;j++){//お前どこ？
                                                    if(my_ba[j]==def_card){//そこにいたのか
                                                        my_ba[j]="";//消えなさい。
                                                        teki_ba[i]=def_card;//おいで
                                                        def_card.position="teki_ba";//ここがお前のあたらしい家だよ
                                                        def_card.move=3;//ちょっと動いて
                                                        break;
                                                    }
                                                }
                                                break;
                                            }
                                        }
                                    }else{//お前のモンスターを捕獲！
                                        for(let i=0;i<5;i++){//場空いてる？
                                            if(my_ba[i]==""){//ここに奪おう
                                                for(let j=0;j<5;j++){//お前どこ？
                                                    if(teki_ba[j]==def_card){//そこにいたのか
                                                        teki_ba[j]="";//消えなさい。
                                                        my_ba[i]=def_card;//おいで
                                                        def_card.position="my_ba";//ここがお前のあたらしい家だよ
                                                        def_card.move=3;//ちょっと動いて
                                                        break;
                                                    }
                                                }
                                                break;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"盗竜山を牛耳る人攫い。攻撃した相手に服従+10。",text_iro:[]};
                var akaoni={name:"赤鬼",image:akaoni_image,ATK:10,HP:5,state:["モンスター","貫通"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"盗竜山を牛耳る人攫い。…この仕事…あまり向いてないかも…",text_iro:[]};
                var sunattidoragon={name:"盗竜　スナッチドラゴン",image:sunattidoragon_image,ATK:0,HP:30,state:["モンスター","ドラゴン","捕獲","二回攻撃","体力上昇"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        def_card.HP-=5;
                        atk_card.HP+=5;
                        if(def_card.state.indexOf("ACE")==-1 && def_card.state.indexOf("TOP_ACE")==-1 ){
                            if(def_card.state.indexOf("服従:")!=-1){//服従蓄積ですかぁ？
                                def_card.state[def_card.state.indexOf("服従:")+1]+=8;//追加だ
                            }else{
                                def_card.state.push("服従:");
                                def_card.state.push(8);
                            }
                            if(def_card.HP>atk_card.ATK){//攻撃耐えるよね？
                                if(def_card.state[def_card.state.indexOf("服従:")+1]>=10){//捕獲、成功！
                                    if(def_card.position=="my_ba"){//俺のモンスターを捕獲！？
                                        for(let i=0;i<5;i++){//場空いてる？
                                            if(teki_ba[i]==""){//ここに奪おう
                                                for(let j=0;j<5;j++){//お前どこ？
                                                    if(my_ba[j]==def_card){//そこにいたのか
                                                        my_ba[j]="";//消えなさい。
                                                        teki_ba[i]=def_card;//おいで
                                                        def_card.position="teki_ba";//ここがお前のあたらしい家だよ
                                                        def_card.move=3;//ちょっと動いて
                                                        break;
                                                    }
                                                }
                                                break;
                                            }
                                        }
                                    }else{//お前のモンスターを捕獲！
                                        for(let i=0;i<5;i++){//場空いてる？
                                            if(my_ba[i]==""){//ここに奪おう
                                                for(let j=0;j<5;j++){//お前どこ？
                                                    if(teki_ba[j]==def_card){//そこにいたのか
                                                        teki_ba[j]="";//消えなさい。
                                                        my_ba[i]=def_card;//おいで
                                                        def_card.position="my_ba";//ここがお前のあたらしい家だよ
                                                        def_card.move=3;//ちょっと動いて
                                                        break;
                                                    }
                                                }
                                                break;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"盗竜山の伝説を生み出した竜。攻撃した相手に服従+8。さらに体力を5奪う。",text_iro:[]};
                var touryuuzannosiren={name:"盗竜山の試練",image:touryuuzannosiren_image,state:["魔法","味方選択","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].card.name=="青鬼"){
                                    for(let j=0;j<my_haka.length;j++){
                                        if(my_haka[j].card.name=="赤鬼"){
                                            return true;
                                        }
                                    }
                                }else if(my_ba[i]!="" && my_ba[i].card.name=="赤鬼"){
                                    for(let j=0;j<my_haka.length;j++){
                                        if(my_haka[j].card.name=="青鬼"){
                                            return true;
                                        }
                                    }
                                }
                            }
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].card.name=="青鬼"){
                                    for(let j=0;j<teki_haka.length;j++){
                                        if(teki_haka[j].card.name=="赤鬼"){
                                            return true;
                                        }
                                    }
                                }else if(teki_ba[i]!=""&& teki_ba[i].card.name=="赤鬼"){
                                    for(let j=0;j<teki_haka.length;j++){
                                        if(teki_haka[j].card.name=="青鬼"){
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""&& my_ba[cursor2].card.name=="青鬼"){
                                for(let j=0;j<my_haka.length;j++){
                                    if(my_haka[j].card.name=="赤鬼"){
                                        my_haka.splice(j,1);//消滅。死ですらない
                                        
                                        if(my_ba[cursor2].state.indexOf("TOP_ACE")!=-1){
                                            継承state=["TOP_ACE"];
                                        }else if(my_ba[cursor2].state.indexOf("ACE")!=-1){
                                            継承state=["ACE"];
                                        }
                                        継承state.push("上位召喚");
                                        my_ba[cursor2]="";//消滅。死ですらない
                                        
                                        上位召喚(sunattidoragon,my_deck,cursor2,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                        return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                                    }
                                }
                                
                            }else if(my_ba[cursor2]!=""&& my_ba[cursor2].card.name=="赤鬼"){
                                for(let j=0;j<my_haka.length;j++){
                                    if(my_haka[j].card.name=="青鬼"){
                                        my_haka.splice(j,1);//消滅。死ですらない
                                        
                                        if(my_ba[cursor2].state.indexOf("TOP_ACE")!=-1){
                                            継承state=["TOP_ACE"];
                                        }else if(my_ba[cursor2].state.indexOf("ACE")!=-1){
                                            継承state=["ACE"];
                                        }
                                        継承state.push("上位召喚");
                                        my_ba[cursor2]="";//消滅。死ですらない
                                        
                                        上位召喚(sunattidoragon,my_deck,cursor2,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                        return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                                    }
                                }
                            }
                            
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].card.name=="青鬼"){
                                    for(let j=0;j<teki_haka.length;j++){
                                       if(teki_haka[j].card.name=="赤鬼"){
                                            teki_haka.splice(j,1);//消滅。死ですらない

                                            if(teki_ba[i].state.indexOf("TOP_ACE")!=-1){
                                                継承state=["TOP_ACE"];
                                            }else if(teki_ba[i].state.indexOf("ACE")!=-1){
                                                継承state=["ACE"];
                                            }
                                            継承state.push("上位召喚");
                                            teki_ba[i]="";//消滅。死ですらない
                                            上位召喚(sunattidoragon,teki_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                            return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                                        }
                                    }
                                }else if(teki_ba[i]!=""&& teki_ba[i].card.name=="赤鬼"){
                                    for(let j=0;j<teki_haka.length;j++){
                                       if(teki_haka[j].card.name=="青鬼"){
                                            teki_haka.splice(j,1);//消滅。死ですらない

                                            if(teki_ba[i].state.indexOf("TOP_ACE")!=-1){
                                                継承state=["TOP_ACE"];
                                            }else if(teki_ba[i].state.indexOf("ACE")!=-1){
                                                継承state=["ACE"];
                                            }
                                            継承state.push("上位召喚");
                                            teki_ba[i]="";//消滅。死ですらない
                                            上位召喚(sunattidoragon,teki_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                            return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                                        }
                                    }
                                }
                            }
                        }
                    }
                    return false;
                },AI:function(タイミング){
                    return true;//上位召喚したら弱くなるとかありそうだが気にすんな！
                },text:"場にいる青鬼と墓地にいる赤鬼、もしくは場にいる赤鬼と墓地にいる青鬼。これが竜の姿へと変わっていくのをただ見ていることしかできなかった。",text_iro:[]};
                var ryuukon={name:"龍魂",image:ryuukon_image,state:["魔法","味方選択","攻撃上昇","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("ドラゴン")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("ドラゴン")!=-1){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){if(my_ba[cursor2]!=""&& my_ba[cursor2].state.indexOf("ドラゴン")!=-1){my_ba[cursor2].HP+=20;my_ba[cursor2].ATK+=3;return true;}//選択系魔法は正しく動いたらtrueを返すこと！ 
                            return false; 
                        }else{var 一番元気なカードの数値=-1;
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("ドラゴン")!=-1){
                                    if(一番元気なカードの数値<teki_ba[i].ATK){ 
                                        一番元気なカードの数値=teki_ba[i].ATK;cursor2=i;} }}
                                        teki_ba[cursor2].HP+=20;
                                        teki_ba[cursor2].ATK+=3;
                        }
                    }
                },AI:function(タイミング){
                    return true;//強いキャラがいないと使わないってほうが賢い気もするが、気にするな！
                },text:"自分の場のドラゴンを選んでHP+20,ATK+3",text_iro:[]};
                var ikaribakuhatu={name:"怒り爆発！",image:ikaribakuhatu_image,state:["魔法","味方選択","攻撃上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].card.name=="ブラックしゅうくん"){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].card.name=="ブラックしゅうくん"){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){if(my_ba[cursor2]!=""&& my_ba[cursor2].card.name=="ブラックしゅうくん"){
                            my_ba[cursor2].ATK+=5;
                            my_ba[cursor2].state.push("怒り:");
                            my_ba[cursor2].state.push(0);
                            return true;
                        }//選択系魔法は正しく動いたらtrueを返すこと！ 
                            return false; 
                        }else{var 一番元気なカードの数値=-1;
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].card.name=="ブラックしゅうくん"){
                                    if(一番元気なカードの数値<teki_ba[i].ATK){ 
                                        一番元気なカードの数値=teki_ba[i].ATK;cursor2=i;} }}
                                        teki_ba[cursor2].ATK+=5;
                                        teki_ba[cursor2].state.push("怒り:");
                                        teki_ba[cursor2].state.push(0);
                        }
                    }
                },AI:function(タイミング){
                    return true;//強いキャラがいないと使わないってほうが賢い気もするが、気にするな！
                },text:"自分の場のブラックしゅうくんを選んでATK+5。さらに3回目のターンエンド時に手札に闇化を得る。「もーしゅうくん怒ったからねー！！！」",text_iro:[]};

                var nezumi={name:"ねずみ",image:nezumi_image,ATK:1,HP:1,state:["モンスター","ネズミ"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"ぽにゃより弱いモンスターっていたんだ",text_iro:[]};
                var tyuunezumi={name:"中ねずみ",image:tyuunezumi_image,ATK:3,HP:5,state:["モンスター","ネズミ"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"ﾁｭｰ…ねずみ",text_iro:[]};
                var dekanezumi={name:"デカねずみ",image:dekanezumi_image,ATK:3,HP:15,state:["モンスター","ネズミ"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"ネズミしてはでかい。",text_iro:[]};
                var dokunezumi={name:"毒ねずみ",image:dokunezumi_image,ATK:1,HP:3,state:["モンスター","ネズミ","毒付与"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                            def_card.state[def_card.state.indexOf("毒:")+1]+=3;//追加だ
                        }else{
                            def_card.state.push("毒:");
                            def_card.state.push(3);
                        }
                    }
                },AI:function(タイミング){return true;},text:"噛みついた相手に毒+3。ﾁｭｰ毒になっちゃう！",text_iro:[]};
                var tamanezumi={name:"玉ねずみ",image:tamanezumi_image,ATK:0,HP:20,state:["モンスター","ネズミ","ブロック"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"ﾁｭｰ目の的！？",text_iro:[]};
                var tatujinnezumi={name:"達人ねずみ",image:tatujinnezumi_image,ATK:3,HP:10,state:["モンスター","ネズミ","二回攻撃"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"炸裂！ﾁｭｰ極拳法！二連パンチ！！",text_iro:[]};
                var kyuusonekowokamu={name:"窮鼠猫を嚙む",image:kyuusonekowokamu_image,state:["魔法","攻撃上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("ネズミ")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("ネズミ")!=-1){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""&& my_ba[i].state.indexOf("ネズミ")!=-1){
                                    if(my_ba[i].card.HP>my_ba[i].HP){
                                        my_ba[i].ATK+=my_ba[i].card.HP-my_ba[i].HP;
                                    }
                                }
                            } 
                        }else{var 一番元気なカードの数値=-1;
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("ネズミ")!=-1){
                                    if(teki_ba[i].card.HP>teki_ba[i].HP){
                                        teki_ba[i].ATK+=teki_ba[i].card.HP-teki_ba[i].HP;
                                    }
                                }
                            } 
                        }
                    }
                },AI:function(タイミング){
                    let ダメージ合計=0;
                    for(let i=0;i<5;i++){
                        if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("ネズミ")!=-1){
                            if(teki_ba[i].card.HP>teki_ba[i].HP){
                                ダメージ合計+=teki_ba[i].card.HP-teki_ba[i].HP;
                               
                            }
                        }
                    }
                    if(ダメージ合計>=5){
                        return true; 
                    }else{
                        return false;
                    }
                    
                },text:"自分の場のネズミ達は体力が減っている分だけ攻撃力が上昇する！",text_iro:[]};
                var tamanorinezumi={name:"玉乗りねずみ",image:tamanorinezumi_image,ATK:1,HP:20,state:["モンスター","ネズミ","二回攻撃"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"進行方向チュー意！",text_iro:[]};
                var tamanoridokunezumi={name:"玉乗り毒ねずみ",image:tamanoridokunezumi_image,ATK:1,HP:20,state:["モンスター","ネズミ","毒付与"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                            def_card.state[def_card.state.indexOf("毒:")+1]+=3;//追加だ
                        }else{
                            def_card.state.push("毒:");
                            def_card.state.push(3);
                        }
                    }
                },AI:function(タイミング){return true;},text:"轢いた相手に毒+3。",text_iro:[]};
                var tamanori={name:"玉乗り",image:tamanori_image,state:["魔法","味方選択","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].card.name=="玉ねずみ"){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].card.name=="玉ねずみ"){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""&& my_ba[cursor2].card.name=="玉ねずみ"){
                                if(my_ba[cursor2].state.indexOf("TOP_ACE")!=-1){
                                    継承state=["TOP_ACE"];
                                }else if(my_ba[cursor2].state.indexOf("ACE")!=-1){
                                    継承state=["ACE"];
                                }
                                継承state.push("上位召喚");
                                my_ba[cursor2]=death_card(my_ba[cursor2],my_haka,cursor2);
                                if(Math.random()<0.5){
                                    上位召喚(tamanorinezumi,my_deck,cursor2,継承state);//カードの追加、召喚を行います。いいですね？マスター
                                }else{
                                    上位召喚(tamanoridokunezumi,my_deck,cursor2,継承state);//カードの追加、召喚を行います。いいですね？マスター
                                }
                                

                                return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            let 死にそうなヤツ=[999,-1];
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].card.name=="玉ねずみ"){
                                    if(死にそうなヤツ[1]==-1){
                                        死にそうなヤツ=[teki_ba[i].HP,i];
                                    }else{
                                        if(死にそうなヤツ[0]>teki_ba[i].HP){
                                            死にそうなヤツ=[teki_ba[i].HP,i];
                                        }
                                    }
                                }
                            }
                            if(teki_ba[死にそうなヤツ[1]].state.indexOf("TOP_ACE")!=-1){
                                継承state=["TOP_ACE"];
                            }else if(teki_ba[死にそうなヤツ[1]].state.indexOf("ACE")!=-1){
                                継承state=["ACE"];
                            }
                            継承state.push("上位召喚");
                            teki_ba[死にそうなヤツ[1]]=death_card(teki_ba[死にそうなヤツ[1]],teki_haka,死にそうなヤツ[1]);
                            if(Math.random()<0.5){
                                上位召喚(tamanorinezumi,teki_deck,死にそうなヤツ[1],継承state);//カードの追加、召喚を行います。いいですね？マスター
                            }else{
                                上位召喚(tamanoridokunezumi,teki_deck,死にそうなヤツ[1],継承state);//カードの追加、召喚を行います。いいですね？マスター
                            }
                            

                            return true;
                        }
                    }
                },AI:function(タイミング){
                    for(let i=0;i<5;i++){
                        if(teki_ba[i]!=""&& teki_ba[i].card.name=="玉ねずみ"){
                            if(teki_ba[i].HP<=15){//ちょっと体力減ってるやつオル
                                return true;
                            }
                        }
                    }
                    return false;
                },text:"自分の場の玉ねずみを使って遊ぼうとしているネズミがいるみたいです！今日は誰が来るかな？",text_iro:[]};
                var tyuukun={name:"ちゅーくん",image:tyuukun_image,ATK:0,HP:20,state:["モンスター","しゅうくん","ネズミ"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;
                },effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(option[1]!=i && my_ba[i]!="" && my_ba[i].state.indexOf("ネズミ")!=-1){
                                    if(my_ba[i].state.indexOf("ブロック")==-1){//ブロックあげる
                                        my_ba[i].state.push("ブロック");
                                    }
                                    
                                }
                            }
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(option[1]!=i && teki_ba[i]!="" && teki_ba[i].state.indexOf("ネズミ")!=-1){
                                    if(teki_ba[i].state.indexOf("ブロック")==-1){//ブロックあげる
                                        teki_ba[i].state.push("ブロック");
                                    }
                                    
                                }
                            }
                        }
                    }
                    
                },AI:function(タイミング){return true;},text:"ターンエンド時に自分の場のネズミ達にブロックを与える(自分以外)。「ちゅーたんのためなら我ら盾となりまチュ！」",text_iro:[]};

                var motinreddo={name:"もちん・レッド",image:motinreddo_image,ATK:5,HP:10,state:["モンスター","へにゃもちん","ACE","攻撃上昇"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;},effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("ACE")!=-1){//ACE？
                                        my_ba[i].ATK+=1;
                                    }
                                }
                            }
                            my_ba[option[1]].move=-3;
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("ACE")!=-1){//ACE？
                                        teki_ba[i].ATK+=1;
                                    }
                                }
                            }
                            teki_ba[option[1]].move=-3;
                        }
                    }
                },AI:function(タイミング){return true;},text:"ターンエンド時、自分の場のACEモンスターの攻撃力+1。さらにいつだってACEさ！",text_iro:[]};
                var motinburuu={name:"もちん・ブルー",image:motinburuu_image,ATK:5,HP:10,state:["モンスター","へにゃもちん","ACE","攻撃回数付与"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;},effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("ACE")!=-1){//ACE？
                                        my_ba[i].can_ATK+=1;
                                    }
                                }
                            }
                            my_ba[option[1]].move=-3;
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("ACE")!=-1){//ACE？
                                        teki_ba[i].can_ATK+=1;
                                    }
                                }
                            }
                            teki_ba[option[1]].move=-3;
                        }
                    }
                },AI:function(タイミング){return true;},text:"ターンエンド時、自分の場のACEモンスターの攻撃回数+1。さらにいつだってACEさ！",text_iro:[]};

                var motingurin={name:"もちん・グリーン",image:motingurin_image,ATK:5,HP:10,state:["モンスター","へにゃもちん","ACE","ドロー"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;},effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        let 追加ドロー=0;
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("ACE")!=-1){//ACE？
                                        追加ドロー+=1;
                                    }
                                }
                            }
                            pull_card(my_yamahuda,my_tehuda,追加ドロー);
                            my_ba[option[1]].move=-3;
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("ACE")!=-1){//ACE？
                                        追加ドロー+=1;
                                    }
                                }
                            }
                            pull_card(teki_yamahuda,teki_tehuda,追加ドロー);
                            teki_ba[option[1]].move=-3;
                        }
                    }
                },AI:function(タイミング){return true;},text:"ターンエンド時、自分の場のACEモンスターの数だけドロー。さらにいつだってACEさ！",text_iro:[]};
                var motinpinku={name:"もちん・ピンク",image:motinpinku_image,ATK:5,HP:10,state:["モンスター","へにゃもちん","ACE","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;},effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("ACE")!=-1){//ACE？
                                        my_ba[i].HP+=2;
                                        if(my_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                            my_ba[i].state.splice(my_ba[i].state.indexOf("毒:"),2);//治療
                                        }
                                    }
                                }
                            }
                            my_ba[option[1]].move=-3;
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("ACE")!=-1){//ACE？
                                        teki_ba[i].HP+=2;
                                        if(teki_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                            teki_ba[i].state.splice(teki_ba[i].state.indexOf("毒:"),2);//治療
                                        }
                                    }
                                }
                            }
                            teki_ba[option[1]].move=-3;
                        }
                    }
                },AI:function(タイミング){return true;},text:"ターンエンド時、自分の場のACEモンスターの体力+2。しかも毒治療。さらにいつだってACEさ！",text_iro:[]};
                var motiniero={name:"もちん・イエロー",image:motiniero_image,ATK:5,HP:10,state:["モンスター","へにゃもちん","ACE","ブロック"],effect_req:function(タイミング){
                    return false;},effect:function(タイミング,option){
                },AI:function(タイミング){return true;},text:"…いつだってACEさ！",text_iro:[]};
                var hirobakutan={name:"ヒーロー爆誕！",image:hirobakutan_image,state:["魔法","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        let 狂信者カウント=0;
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("へにゃもちん")!=-1){
                                    狂信者カウント+=1;//変数名を変えろや！
                                }
                            }
                        }else{ 
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("へにゃもちん")!=-1){
                                    狂信者カウント+=1;
                                }
                            }
                        }
                        if(狂信者カウント>=5){
                            return true;
                        }else{
                            return false; 
                        }
                         
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=["上位召喚"];
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                my_ba[i]=death_card(my_ba[i],my_haka,i);
                            }
                            上位召喚(motinreddo,my_deck,2,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(motinburuu,my_deck,1,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(motingurin,my_deck,3,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(motinpinku,my_deck,0,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(motiniero,my_deck,4,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            
                        }else{
                            for(let i=0;i<5;i++){
                                teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                            }
                            上位召喚(motinreddo,teki_deck,2,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(motinburuu,teki_deck,1,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(motingurin,teki_deck,3,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(motinpinku,teki_deck,0,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(motiniero,teki_deck,4,継承state);//カードの追加、召喚を行います。いいですね？マスター
                        }
                    }
                },AI:function(タイミング){
                    return true;//上位召喚したら弱くなるとかありそうだが気にすんな！←このカードでそれはないのでは…？
                },text:"自分の場にいる5人のへにゃもちんモンスターが正義に目覚める！",text_iro:[]};
                var motinkosumo={name:"もちん・コスモ",image:motinkosumo_image,ATK:10,HP:50,state:["モンスター","へにゃもちん","ACE"],effect_req:function(タイミング){
                    return false;},effect:function(タイミング,option){
                },AI:function(タイミング){return true;},text:"銀河の中心でデッキを守る究極戦士！いつだってACEさ！",text_iro:[]};
                var gingapawa={name:"銀河☆パワー！",image:gingapawa_image,state:["魔法","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        let 墓標=[-1,-1,-1,-1,-1];
                        if(duel_phase!="相手"){
                            if(ba_mons_num(my_ba)==5){
                                return false;
                            }
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].card.name=="もちん・レッド"){
                                    墓標[0]=i; 
                                }else if(my_haka[i].card.name=="もちん・ブルー"){
                                    墓標[1]=i;
                                }else if(my_haka[i].card.name=="もちん・イエロー"){
                                    墓標[2]=i;
                                }else if(my_haka[i].card.name=="もちん・グリーン"){
                                    墓標[3]=i;
                                }else if(my_haka[i].card.name=="もちん・ピンク"){
                                    墓標[4]=i;
                                }
                            }
                            if(墓標[0]!=-1 && 墓標[1]!=-1 && 墓標[2]!=-1 && 墓標[3]!=-1 && 墓標[4]!=-1){
                                return true;
                            }else{
                                return false;
                            }
                        }else{
                            if(ba_mons_num(teki_ba)==5){
                                return false;
                            }
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].card.name=="もちん・レッド"){
                                    墓標[0]=i; 
                                }else if(teki_haka[i].card.name=="もちん・ブルー"){
                                    墓標[1]=i;
                                }else if(teki_haka[i].card.name=="もちん・イエロー"){
                                    墓標[2]=i;
                                }else if(teki_haka[i].card.name=="もちん・グリーン"){
                                    墓標[3]=i;
                                }else if(teki_haka[i].card.name=="もちん・ピンク"){
                                    墓標[4]=i;
                                }
                            }
                            if(墓標[0]!=-1 && 墓標[1]!=-1 && 墓標[2]!=-1 && 墓標[3]!=-1 && 墓標[4]!=-1){
                                return true;
                            }else{
                                return false;
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=["上位召喚"];
                        let 墓標=[-1,-1,-1,-1,-1];
                        if(duel_phase!="相手"){
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].card.name=="もちん・レッド"){
                                    墓標[0]=i; 
                                }else if(my_haka[i].card.name=="もちん・ブルー"){
                                    墓標[1]=i;
                                }else if(my_haka[i].card.name=="もちん・イエロー"){
                                    墓標[2]=i;
                                }else if(my_haka[i].card.name=="もちん・グリーン"){
                                    墓標[3]=i;
                                }else if(my_haka[i].card.name=="もちん・ピンク"){
                                    墓標[4]=i;
                                }
                            }
                            for(let i=0;i<5;i++){
                                my_haka.splice(墓標[i],1);
                                for(let j=0;j<5;j++){
                                    if(墓標[i]<墓標[j]){
                                        墓標[j]-=1;
                                    }
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(my_ba[ba_haiti[i]]==""){
                                    上位召喚(motinkosumo,my_deck,ba_haiti[i],継承state);//カードの追加、召喚を行います。いいですね？マスター
                                    break;
                                }
                            }
                            
                            
                        }else{
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].card.name=="もちん・レッド"){
                                    墓標[0]=i; 
                                }else if(teki_haka[i].card.name=="もちん・ブルー"){
                                    墓標[1]=i;
                                }else if(teki_haka[i].card.name=="もちん・イエロー"){
                                    墓標[2]=i;
                                }else if(teki_haka[i].card.name=="もちん・グリーン"){
                                    墓標[3]=i;
                                }else if(teki_haka[i].card.name=="もちん・ピンク"){
                                    墓標[4]=i;
                                }
                            }
                            for(let i=0;i<5;i++){
                                teki_haka.splice(墓標[i],1);
                                for(let j=0;j<5;j++){
                                    if(墓標[i]<墓標[j]){
                                        墓標[j]-=1;
                                    }
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(teki_ba[ba_haiti[i]]==""){
                                    上位召喚(motinkosumo,teki_deck,ba_haiti[i],継承state);//カードの追加、召喚を行います。いいですね？マスター
                                    break;
                                }
                            }
                        }
                    }
                    return false;
                },AI:function(タイミング){
                    return true;//上位召喚したら弱くなるとかありそうだが気にすんな！
                },text:"墓地にいるもちん・赤青緑桃黄の力によって新たな銀河が生み出される！（彼らは墓地から消えます。ちゃお）",text_iro:[]};
                var motinburakku={name:"もちん・ダーク",image:motinburakku_image,ATK:10,HP:20,state:["モンスター","へにゃもちん","ACE"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;},effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].card.name=="へにゃもちん"){
                                    my_tehuda.push(my_haka[i]);
                                    my_haka.splice(i,1);
                                    break;
                                }
                            }
                        }else{//敵ターン
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].card.name=="へにゃもちん"){
                                    teki_tehuda.push(teki_haka[i]);
                                    teki_haka.splice(i,1);
                                    break;
                                    
                                }
                            }
                        }
                    }

                },AI:function(タイミング){return true;},text:"闇夜をうごめく影───ターンエンド時に墓地の名前がへにゃもちんのカードを1枚手札に加える───いつだってACEさ！",text_iro:[]};
                var yamiyonokage={name:"闇夜の影",image:yamiyonokage_image,state:["魔法","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        let へにゃもちんカウント=0;
                        if(duel_phase!="相手"){
                            if(ba_mons_num(my_ba)==5){
                                return false;
                            }
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].card.name=="へにゃもちん"){
                                    へにゃもちんカウント+=1;
                                    if(へにゃもちんカウント==5){
                                        return true;
                                    }
                                }
                            }
                            return false;
                        }else{
                            if(ba_mons_num(teki_ba)==5){
                                return false;
                            }
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].card.name=="へにゃもちん"){
                                    へにゃもちんカウント+=1;
                                    if(へにゃもちんカウント==5){
                                        return true;
                                    }
                                }
                            }
                            return false;
                            
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=["上位召喚"];
                        let へにゃもちんカウント=0;
                        if(duel_phase!="相手"){
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].card.name=="へにゃもちん"){
                                    へにゃもちんカウント+=1;
                                    my_yamahuda.push(my_haka[i]);
                                    my_haka.splice(i,1);
                                    i-=1;
                                    if(へにゃもちんカウント==5){
                                        break;
                                    }
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(my_ba[ba_haiti[i]]==""){
                                    上位召喚(motinburakku,my_deck,ba_haiti[i],継承state);//カードの追加、召喚を行います。いいですね？マスター
                                    break;
                                }
                            }
                            
                            
                        }else{
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].card.name=="へにゃもちん"){
                                    へにゃもちんカウント+=1;
                                    teki_yamahuda.push(teki_haka[i]);
                                    teki_haka.splice(i,1);
                                    i-=1;
                                    if(へにゃもちんカウント==5){
                                        break;
                                    }
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(teki_ba[ba_haiti[i]]==""){
                                    上位召喚(motinburakku,teki_deck,ba_haiti[i],継承state);//カードの追加、召喚を行います。いいですね？マスター
                                    break;
                                }
                            }
                        }
                    }
                    return false;
                },AI:function(タイミング){
                    return true;//上位召喚したら弱くなるとかありそうだが気にすんな！
                },text:"墓地の名前がへにゃもちんのカードを5枚デッキに戻し、ダークヒーローが現れる！「満月だったら闇夜じゃないじゃん！」",text_iro:[]};
                var ou={name:"王",image:ou_image,ATK:0,HP:10,state:["モンスター","へにゃもちん","ACE"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方 
                            if(my_haka.length-my_yamahuda.length>0){
                                option[1].ATK+=(my_haka.length-my_yamahuda.length);
                                option[1].HP+=2*(my_haka.length-my_yamahuda.length);
                            }
                            
                            
                        }else{//敵
                            if(teki_haka.length-teki_yamahuda.length>0){
                                option[1].ATK+=(teki_haka.length-teki_yamahuda.length);
                                option[1].HP+=2*(teki_haka.length-teki_yamahuda.length);
                            }
                            
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、自分の墓地の枚数と山札の枚数の差だけ攻撃力+1、HP+2",text_iro:[]};
                var ekken={name:"謁見",image:ekken_image,state:["魔法","上位召喚"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        let へにゃもちんカウント=0;
                        if(duel_phase!="相手"){
                            if(ba_mons_num(my_ba)==5){
                                return false;
                            }
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].card.name=="へにゃもちん"){
                                    へにゃもちんカウント+=1;
                                    if(へにゃもちんカウント==10){
                                        return true;
                                    }
                                }
                            }
                            return false;
                        }else{
                            if(ba_mons_num(teki_ba)==5){
                                return false;
                            }
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].card.name=="へにゃもちん"){
                                    へにゃもちんカウント+=1;
                                    if(へにゃもちんカウント==10){
                                        return true;
                                    }
                                }
                            }
                            return false;
                            
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=["上位召喚"];
                        let へにゃもちんカウント=0;
                        if(duel_phase!="相手"){
                            for(let i=0;i<my_tehuda.length;i++){
                                if(my_tehuda[i].card.name=="へにゃもちん"){
                                    my_haka.push(my_tehuda[i]);
                                    my_tehuda.splice(i,1);
                                    if(i<tukau_card_num){
                                        tukau_card_num-=1;
                                    }
                                    i-=1;
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(my_ba[ba_haiti[i]]==""){
                                    上位召喚(ou,my_deck,ba_haiti[i],継承state);//カードの追加、召喚を行います。いいですね？マスター
                                    break;
                                }
                            }
                            
                            
                        }else{
                            for(let i=0;i<teki_tehuda.length;i++){
                                if(teki_tehuda[i].card.name=="へにゃもちん"){
                                    teki_haka.push(teki_tehuda[i]);
                                    teki_tehuda.splice(i,1);
                                    if(i<tukau_card_num){
                                        tukau_card_num-=1;
                                    }
                                    i-=1;
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(teki_ba[ba_haiti[i]]==""){
                                    上位召喚(ou,teki_deck,ba_haiti[i],継承state);//カードの追加、召喚を行います。いいですね？マスター
                                    break;
                                }
                            }
                        }
                    }
                    return false;
                },AI:function(タイミング){
                    if(teki_yamahuda.length<15){
                        return true;//あんま山札おおいと0になるので
                    }else{
                        return false;
                    }
                    
                },text:"墓地に名前がへにゃもちんのカードが10枚以上あるとき、手札のへにゃもちんを全て捨て、我らの王が戦場を支配する！",text_iro:[]};

                var buppinhanbai={name:"物品販売",image:buppinhanbai_image,state:["魔法","墓地回収","消滅"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].card.name=="ぽにゃアイドル♪"){
                                    for(let j=0;j<my_haka.length;j++){
                                        if(my_haka[j].state.indexOf("魔法")!=-1){
                                            return true;
                                        }
                                    }   
                                }
                            }
                        }else{ 
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].card.name=="ぽにゃアイドル♪"){
                                    for(let j=0;j<teki_haka.length;j++){
                                        if(teki_haka[j].state.indexOf("魔法")!=-1){
                                            return true;
                                        }
                                    }   
                                }
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 魔法数=0;
                        if(duel_phase!="相手"){
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("魔法")!=-1){
                                    魔法数++;
                                    my_tehuda.push(my_haka[i]);
                                    my_haka.splice(i,1);
                                    i-=1;
                                    if(魔法数==2){
                                        break;
                                    }
                                }
                            }   
                        }else{
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("魔法")!=-1){
                                    魔法数++;
                                    teki_tehuda.push(teki_haka[i]);
                                    teki_haka.splice(i,1);
                                    i-=1;
                                    if(魔法数==2){
                                        break;
                                    }
                                }
                            }  
                        }
                    }
                },AI:function(タイミング){
                    return true; 
                },text:"ぽにゃアイドルが自分の場にいるとき、墓地から魔法を2枚得る。このカードはどっか行く",text_iro:[]};
                var kameko={name:"亀子",image:kameko_image,ATK:2,HP:10,state:["モンスター","防御:",10],effect_req:function(タイミング){
                    return true;  
                },effect:function(タイミング){
                    if(タイミング=="攻撃された"){
                        if(def_card.state.indexOf("防御:")!=-1){//防御ある？
                            def_card.state[def_card.state.indexOf("防御:")+1]-=2;
                            if(def_card.state[def_card.state.indexOf("防御:")+1]==0){
                                def_card.state.splice(def_card.state.indexOf("防御:"),2);
                            }
                        }else{
                            def_card.state.push("防御:");
                            def_card.state.push(-2);
                        }
                    }
                },AI:function(タイミング){
                    return true;
                },text:"硬い甲羅は脆い鎧。あまりいじめられると甲羅が割れちゃいます～！＞＜（攻撃されるたびに防御-2）",text_iro:[]};
                var sasori_musume={name:"サソリ_娘",image:sasori_musume_image,ATK:5,HP:8,state:["モンスター","二回攻撃"],effect_req:function(タイミング){return true;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"二回斬撃。",text_iro:[]};
                var operobo={name:"オペレーションロボット",image:operobo_image,ATK:0,HP:2,state:["モンスター","機械","消滅"],effect_req:function(タイミング){return true;
                },effect:function(タイミング,option){
                    let 機械数=0;
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方 
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("機械")!=-1){
                                    機械数++;
                                    my_tehuda.push(my_haka[i]);
                                    my_haka.splice(i,1);
                                    i-=1;
                                    if(機械数==2){
                                        break;
                                    }
                                }
                            }   
                        }else{
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("機械")!=-1){
                                    機械数++;
                                    teki_tehuda.push(teki_haka[i]);
                                    teki_haka.splice(i,1);
                                    i-=1;
                                    if(機械数==2){
                                        break;
                                    }
                                }
                            }  
                            
                        }
                    }
                },AI:function(タイミング){ return true;},text:"召喚時、墓地から機械モンスターを２枚手札へ加える。死亡時、このカードはどっかへ行く。",text_iro:[]};
                var daijanotukai={name:"大蛇の使い",image:daijanotukai_image,ATK:1,HP:2,state:["モンスター"],effect_req:function(タイミング){return true;
                },effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方 
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].card.name=="一角大蛇の腹"){
                                    
                                    my_tehuda.push(my_haka[i]);
                                    my_haka.splice(i,1);

                                    break;
                                    
                                }
                            }   
                        }else{
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].card.name=="一角大蛇の腹"){

                                    teki_tehuda.push(teki_haka[i]);
                                    teki_haka.splice(i,1);

                                      break;
                                    
                                }
                            }  
                            
                        }
                    }
                },AI:function(タイミング){ return true;},text:"召喚時、墓地から一角大蛇の腹を一枚取り出し手札に加える。",text_iro:[]};
                var sourugadona={name:"ソウル・ガードナー",image:sourugadona_image,ATK:0,HP:1,state:["モンスター","ブロック","体力奪取"],effect_req:function(タイミング){
                    return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i]!=option[1] && my_ba[i].card.name!="導き"){
                                    option[1].HP+=my_ba[i].HP-1;
                                    my_ba[i].HP=1;
                                }
                            }
                        }else{//敵
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i]!=option[1] && teki_ba[i].card.name!="導き"){
                                    option[1].HP+=teki_ba[i].HP-1;
                                    teki_ba[i].HP=1;
                                }
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、味方の体力を1になるまで吸い尽くし、最強の盾と化す。",text_iro:[]};
                var hametuwomatumono={name:"破滅を待つ者",image:hametuwomatumono_image,ATK:0,HP:50,state:["モンスター","破滅"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="死んだ"){
                        if(option.position=="my_ba"){
                            デッキカード追加(my_deck,hametunosinkou,"my_tehuda")
                            my_tehuda.push(my_deck[my_deck.length-1]);
                        }else{
                            デッキカード追加(teki_deck,hametunosinkou,"teki_tehuda")
                            teki_tehuda.push(teki_deck[teki_deck.length-1]);
                        }
                    }
                },AI:function(タイミング){return true;},text:"自分の場にモンスターが召喚されたときこのカードは死に、その祈りは手札に届く。「嬉しいんです。私の残り少ない命が私たちの神の役に立つんですから。」",text_iro:[]};
                var zerozerozero={name:"ゼロ、ゼロ！ゼロォ！！",image:zerozerozero_image,ATK:0,HP:10,state:["モンスター","復活","毒付与"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("モンスター")!=-1 && my_haka[i].card.ATK==0){//墓地にもともとの攻撃力0のモンスターがいる
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(my_ba[j]==""){
                                            蘇生(my_ba,j,my_haka,i);
                                            i-=1;
                                            break;
                                        }
                                    }            
                                    if(ba_mons_num(my_ba)==5){//これ以上増えない
                                        break;
                                    }                    
                                }
                            }
                                    
                            
                        }else{
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("モンスター")!=-1 && teki_haka[i].card.ATK==0){//墓地にもともとの攻撃力0のモンスターがいる
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(teki_ba[j]==""){
                                            蘇生(teki_ba,j,teki_haka,i);
                                            i-=1;
                                            break;
                                        }
                                    }            
                                    if(ba_mons_num(teki_ba)==5){//これ以上増えない
                                        break;
                                    }                    
                                }
                            }
                        
                        }
                    }else if(タイミング=="攻撃した"){
                        if(def_card.state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                            def_card.state[def_card.state.indexOf("毒:")+1]+=1;//追加だ
                        }else{
                            def_card.state.push("毒:");
                            def_card.state.push(1);
                        }
                    }
                },AI:function(タイミング){return true;},text:"ぜろ！ぜろ！ぜろぞんびたちよ、よみがえれ！ぜろ！ぜろ！ぜろ！さあ！こうげきりょくしかない脳無しにこうげきりょくがない脳腐りがくらいつく！（召喚時、元々の攻撃力が0のモンスターを蘇らせまくる）(あとこいつ毒+1持ち)",text_iro:[]};

                var pupukuraudo={name:"ぷーぷーくらうど",image:pupukuraudo_image,ATK:3,HP:10,state:["モンスター","雲"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"雲（攻撃によって死なない。体力を上回ったダメージだけデッキを減らす。デッキが足りないときはさすがに死ぬ。）",text_iro:[]};
                var pantingukuraudo={name:"ぱんちんぐくらうど",image:pantingukuraudo_image,ATK:5,HP:15,state:["モンスター","雲"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"ちょっと暴力が得意な雲",text_iro:[]};
                var happisukoru={name:"ハッピー❤スコール",image:happisukoru_image,state:["魔法","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("雲")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("雲")!=-1){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""&& my_ba[i].state.indexOf("雲")!=-1){
                                    my_ba[i].HP+=7;
                                }
                            } 
                        }else{var 一番元気なカードの数値=-1;
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("雲")!=-1){
                                    teki_ba[i].HP+=7;
                                }
                            } 
                        }
                    }
                },AI:function(タイミング){

                    for(let i=0;i<5;i++){
                        if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("雲")!=-1){
                            if(teki_ba[i].HP<=10){
                                return true;
                            }
                            
                        }
                    } 
                    return false;
                    
                    
                },text:"自分の場の雲たちのHP+7。今日の天気は曇り時々しあわせ！",text_iro:[]};
                var hitujikuraudo={name:"ひつじくらうど",image:hitujikuraudo_image,ATK:1,HP:15,state:["モンスター","雲","防御:",2],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"ふわふわでカチカチな防御２の雲",text_iro:[]};
                var daburukuraudo={name:"だぶるくらうど",image:daburukuraudo_image,ATK:1,HP:10,state:["モンスター","雲","二回攻撃"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"ふわふわとふわふわでふわふわふわふわ",text_iro:[]}; 
                var hikoukigumo={name:"ひこうきぐも",image:hikoukigumo_image,state:["魔法","味方選択","ドロー"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("雲")!=-1){return true;}
                            }
                        }else{ for(let i=0;i<5;i++){if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("雲")!=-1){return true; }}
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""&& my_ba[cursor2].state.indexOf("雲")!=-1){
                                my_ba[cursor2].can_ATK=0;
                                my_yamahuda.unshift(my_ba[cursor2]);//山札の底へ
                                my_ba[cursor2]="";
                                pull_card(my_yamahuda,my_tehuda,2);

                                return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            let 死にそうなヤツ=[999,-1];
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("雲")!=-1){
                                    if(死にそうなヤツ[1]==-1){
                                        死にそうなヤツ=[teki_ba[i].HP,i];
                                    }else{
                                        if(死にそうなヤツ[0]>teki_ba[i].HP){
                                            死にそうなヤツ=[teki_ba[i].HP,i];
                                        }
                                    }
                                }
                            }
                            teki_ba[死にそうなヤツ[1]].can_ATK=10;
                            teki_yamahuda.unshift(teki_ba[死にそうなヤツ[1]]);
                            teki_ba[死にそうなヤツ[1]]="";
                            pull_card(teki_yamahuda,teki_tehuda,2);

                            return true;
                        }
                    }
                },AI:function(タイミング){
                    for(let i=0;i<5;i++){
                        if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("雲")!=-1){
                            if(teki_ba[i].HP<=5){//ちょっと体力減ってるやつオル
                                return true;
                            }
                        }
                    }
                    return false;
                },text:"自分の雲を1枚選んでデッキの底に戻し、2ドロー",text_iro:[]};
                var amakuraudo={name:"あまくらうど",image:amakuraudo_image,ATK:1,HP:10,state:["モンスター","雲","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;},effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("雲")!=-1){//雲？
                                        my_ba[i].HP+=3;
                                    }
                                }
                            }
                            my_ba[option[1]].move=-3;
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("雲")!=-1){//ACE？
                                        teki_ba[i].HP+=3;
                                    }
                                }
                            }
                            teki_ba[option[1]].move=-3;
                        }
                    }
                },AI:function(タイミング){return true;},text:"ターンエンド時、自分の場の雲モンスターの体力+3。しゃわーですっきり！",text_iro:[]};
                var poizunkuraudo={name:"ぽいずんくらうど",image:poizunkuraudo_image,ATK:0,HP:10,state:["モンスター","雲","毒付与"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;//なんでかターンエンドは条件見てる、なんで
                    }
                    return false;
                },effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                        teki_ba[i].state[teki_ba[i].state.indexOf("毒:")+1]+=1;//追加だ
                                    }else{
                                        teki_ba[i].state.push("毒:");
                                        teki_ba[i].state.push(1);
                                    }
                                }
                            }
                            my_ba[option[1]].move=-3;
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                        my_ba[i].state[my_ba[i].state.indexOf("毒:")+1]+=1;//追加だ
                                    }else{
                                        my_ba[i].state.push("毒:");
                                        my_ba[i].state.push(1);
                                    }
                                }
                            }
                            teki_ba[option[1]].move=-3;
                        }
                    }
                    return false;
                },AI:function(タイミング){return true;},text:"自ターンの終わりに相手のモンスター全体に毒+1の毒ガスをおとどけ",text_iro:[]};
                var biribirikuraudo={name:"びりびりくらうど",image:biribirikuraudo_image,ATK:1,HP:10,state:["モンスター","雲","攻撃制限"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.can_ATK>0){//攻撃可能なら
                            def_card.can_ATK-=1;
                        }else{
                        }
                    }
                },AI:function(タイミング){return true;},text:"びりびり。攻撃した相手をびりびりさせて次ターン攻撃可能数を1減らす。びりびり。",text_iro:[]};
                var enjerukuraudo={name:"えんじぇるくらうど",image:enjerukuraudo_image,ATK:5,HP:1,state:["モンスター","雲","貫通"],effect_req:function(タイミング){return false;},effect:function(タイミング){},AI:function(タイミング){return true;},text:"貫くか貫かれるか！恋ってのは殺るか殺られるかなんジャア！",text_iro:[]};
                var kuraudo={name:"クラウド",image:kuraudo_image,ATK:0,HP:1,state:["モンスター","ブロック"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方 
                            option[1].HP+=3*(my_haka.length);
                        }else{//敵
                            option[1].HP+=3*(teki_haka.length);
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、自分の墓地の枚数だけスケールアップし、HP+3。言うまでもないが、雲ではない。",text_iro:[]};
                var detaappurodo={name:"↑データアップロード↑",image:detaappurodo_image,state:["魔法","上位召喚","味方選択"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        let へにゃもちんカウント=-1;//名前がよくありませんでしてよ！
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("雲")!=-1){
                                    へにゃもちんカウント=0;
                                }
                            }
                            if(へにゃもちんカウント==-1){
                                return false;
                            }
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("雲")!=-1){
                                    へにゃもちんカウント+=1;
                                    if(へにゃもちんカウント==10){
                                        return true;
                                    }
                                }
                            }
                            return false;
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("雲")!=-1){
                                    へにゃもちんカウント=0;
                                }
                            }
                            if(へにゃもちんカウント==-1){
                                return false;
                            }
                            for(let i=0;i<teki_haka.length;i++){
                                if(teki_haka[i].state.indexOf("雲")!=-1){
                                    へにゃもちんカウント+=1;
                                    if(へにゃもちんカウント==10){
                                        return true;
                                    }
                                }
                            }
                            return false;
                            
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            if(my_ba[cursor2]!=""&& my_ba[cursor2].state.indexOf("雲")!=-1){
                                if(my_ba[cursor2].state.indexOf("TOP_ACE")!=-1){
                                    継承state=["TOP_ACE"];
                                }else if(my_ba[cursor2].state.indexOf("ACE")!=-1){
                                    継承state=["ACE"];
                                }
                                継承state.push("上位召喚");
                                my_ba[cursor2]=death_card(my_ba[cursor2],my_haka,cursor2);
                                上位召喚(kuraudo,my_deck,cursor2,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                return true;//選択系魔法は正しく動いたらtrueを返すこと！ 
                            }
                            return false; 
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("雲")!=-1){
                                    if(teki_ba[i].state.indexOf("TOP_ACE")!=-1){
                                        継承state=["TOP_ACE"];
                                    }else if(teki_ba[i].state.indexOf("ACE")!=-1){
                                        継承state=["ACE"];
                                    }
                                    継承state.push("上位召喚");
                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                    上位召喚(kuraudo,teki_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター

                                    return true;
                                }
                            }
                        }
                    }
                    return false;
                },AI:function(タイミング){
                    if(teki_haka.length>15){
                        return true;//あんますくなくてもね
                    }else{
                        return false;
                    }
                    
                },text:"墓地に雲が10枚以上あるとき、それらのデータを自分の場の雲に集約、管理、分析、最高のソリューションの提案を行う。もちろん、月々の使用料を心配する必要はありませんよ。",text_iro:[]};
                var taihuu0gou={name:"台風0号",image:taihuu0gou_image,ATK:0,HP:1,state:["モンスター","雲"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){//ちゃんと条件渡してもいいけどまあ、いいかとなった
                        return true;
                    }
                    return false;
                },effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" &&i!=option[1]){
                                    if(my_ba[i].state.indexOf("雲")!=-1){
                                        my_ba[option[1]].ATK+=my_ba[i].ATK;
                                        my_ba[option[1]].HP+=my_ba[i].HP;
                                    }
                                    my_ba[i]=death_card(my_ba[i],my_haka,i);
                                }
                            }
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && i!=option[1]){
                                    if(teki_ba[i].state.indexOf("雲")!=-1){
                                        teki_ba[option[1]].ATK+=teki_ba[i].ATK;
                                        teki_ba[option[1]].HP+=teki_ba[i].HP;
                                    }
                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                }
                            }
                        }
                    }
                    return false;
                },AI:function(タイミング){return true;},text:"自ターンの終わりに自分の場のモンスターをすべて破壊する。雲は取り込み自分をさらに巨大に変える。「天国は0号の中心に位置し、0号の存在に気が付くことは天国の終わりを意味する。」",text_iro:[]};

                var dorodorodokudoku={name:"どろどろドクドク",image:pandemikku_image,ATK:0,HP:1,state:["モンスター"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        let 継承攻撃力_index=option[1].state.indexOf("継承攻撃力")+1;
                        let 継承体力_index=option[1].state.indexOf("継承体力")+1;
                        if(継承攻撃力_index!=0){
                            option[1].ATK+=option[1].state[継承攻撃力_index];
                            option[1].HP+=option[1].state[継承体力_index];
                        }
                    }
                },AI:function(タイミング){return true;},text:"ミ                                                                              +ATK = +HP = Math.ceil(毒量/3)",text_iro:[]};
                var pandemikku={name:"緊急パンデミック収束",image:pandemikku_image,state:["魔法"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            if(ba_mons_num(my_ba)==5){
                                return false;
                            }
                        }else{
                            if(ba_mons_num(teki_ba)==5){
                                return false;
                            }
                        }
                        for(let i=0;i<5;i++){
                            if(my_ba[i]!="" && my_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                return true;
                            }
                            if(teki_ba[i]!="" && teki_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                return true;
                            }
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        let 毒量=0;
                        for(let i=0;i<5;i++){
                            if(my_ba[i]!="" && my_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                毒量+=my_ba[i].state[my_ba[i].state.indexOf("毒:")+1];
                                my_ba[i].state.splice(my_ba[i].state.indexOf("毒:"),2);
                            }
                            if(teki_ba[i]!="" && teki_ba[i].state.indexOf("毒:")!=-1){//毒状態ですかぁ？
                                毒量+=teki_ba[i].state[teki_ba[i].state.indexOf("毒:")+1];
                                teki_ba[i].state.splice(teki_ba[i].state.indexOf("毒:"),2);
                            }
                        }
                        if(duel_phase!="相手"){
                            継承state.push("継承攻撃力");
                            継承state.push(Math.ceil(毒量/3));
                            継承state.push("継承体力");
                            継承state.push(Math.ceil(毒量/3));
                            for(let i=0;i<5;i++){
                                if(my_ba[i]==""){
                                    上位召喚(dorodorodokudoku,my_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター
                                }
                            }
                        }else{
                            継承state.push("継承攻撃力");
                            継承state.push(Math.ceil(毒量/3));
                            継承state.push("継承体力");
                            継承state.push(Math.ceil(毒量/3));
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]==""){
                                    上位召喚(dorodorodokudoku,teki_deck,i,継承state);//カードの追加、召喚を行います。いいですね？マスター
                                }
                            }
                        }
                    }
                },AI:function(タイミング){
                    return true;
                },text:"互いの場に広がっている毒が意思をもった人形となって、自分の場にばらまかれる（毒が多いほど強力になる。毒がなければ発動不可）",text_iro:[]};
                var kanbanmusume={name:"看板娘",image:kanbanmusume_image,ATK:0,HP:1,state:["モンスター","NOT隠しキャラ"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<5;i++){//空いてる場を探す
                                if(my_ba[i]=="" && teki_ba[i]!=""){
                                    上位召喚(kanbansan,my_deck,i,[]);//これ上位召喚じゃねえだろ←うるへー！いてまうど！
                                }    
                            }        
                        }else{
                            for(let i=0;i<5;i++){//空いてる場を探す
                                if(teki_ba[i]=="" && my_ba[i]!=""){
                                    上位召喚(kanbansan,teki_deck,i,[]);//これ上位召喚じゃねえだろ←うるへー！いてまうど！
                                }    
                            }    
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、相手モンスターの目の前に看板を立てる。「はいはいはい！こちらの看板お読みくださーい！」",text_iro:[]};
                var zangyakuakuma={name:"残虐悪魔",image:zangyakuakuma_image,ATK:3,HP:10,state:["モンスター","みねうち","防御破壊"],effect_req:function(タイミング){return false;},effect:function(タイミング){
                    if(タイミング=="攻撃した"){
                        if(def_card.state.indexOf("防御:")!=-1){//防御ある？
                            def_card.state[def_card.state.indexOf("防御:")+1]-=3;//追加だ
                            if(def_card.state[def_card.state.indexOf("防御:")+1]==0){//防御０は表示しないでおこうよ
                                def_card.state.splice(def_card.state.indexOf("防御:")+1,1);
                                def_card.state.splice(def_card.state.indexOf("防御:"),1);//丁寧に消してて偉いと思った
                            }
                        }else{
                            def_card.state.push("防御:");
                            def_card.state.push(-3);
                        }

                        if(def_card.HP<=atk_card.ATK){//みねうち
                            def_card.HP=atk_card.ATK+1;//防御力計算などはすでに行われているので、これで大丈夫なはず。
                        }
                    }
                },AI:function(タイミング){return true;},text:"攻撃した相手を絶命させないように、ただ痛みを与え続ける。防御を3破壊する。",text_iro:[]};
                var kumosuitoriki={name:"雲吸い取り機",image:kumosuitoriki_image,state:["魔法","体力上昇"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("雲")!=-1){//場に雲がいて
                                    for(let j=0;j<my_tehuda.length;j++){
                                        if(my_tehuda[j].state.indexOf("雲")!=-1){//手札に雲がある
                                            return true;
                                        }
                                    }
                                }
                            }
                            return false;
                        }else{
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("雲")!=-1){//場に雲がいて
                                    for(let j=0;j<teki_tehuda.length;j++){
                                        if(teki_tehuda[j].state.indexOf("雲")!=-1){//手札に雲がある
                                            return true;
                                        }
                                    }
                                }
                            }
                            return false;
                        }
                        return false;  
                    }else{
                        return false;  
                    }  
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 回復量=0;
                        if(duel_phase!="相手"){
                            for(let i=0;i<my_tehuda.length;i++){
                                if(my_tehuda[i].state.indexOf("雲")!=-1){//手札に雲がある 捨てる
                                    回復量+=my_tehuda[i].HP;
                                    my_haka.push(my_tehuda[i]);
                                    my_tehuda.splice(i,1);
                                    if(i<tukau_card_num){
                                        tukau_card_num-=1;
                                    }
                                    i-=1;
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("雲")!=-1){//場に雲がいて
                                    my_ba[i].HP+=Math.ceil(回復量/3);
                                }
                            }
                            
                        }else{
                            for(let i=0;i<teki_tehuda.length;i++){
                                if(teki_tehuda[i].state.indexOf("雲")!=-1){//手札に雲がある 捨てる
                                    回復量+=teki_tehuda[i].HP;
                                    teki_haka.push(teki_tehuda[i]);
                                    teki_tehuda.splice(i,1);
                                    if(i<tukau_card_num){
                                        tukau_card_num-=1;
                                    }
                                    i-=1;
                                }
                            }
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("雲")!=-1){//場に雲がいて
                                    teki_ba[i].HP+=Math.ceil(回復量/3);
                                }
                            }
                        }
                    }
                    return false;
                },AI:function(タイミング){
                    return true;//あんま山札おおいと0になるので
                },text:"手札の雲を凝縮して、自分の場の雲たちのHPを凝縮HP合計の1/3回復する。",text_iro:[]};
                var dakuesu={name:"ダークACE",image:dakuesu_image,ATK:5,HP:10,state:["モンスター","ACE"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<teki_haka.length;i++){
                                     
                                if(teki_haka[i].state.indexOf("モンスター")!=-1 && teki_haka[i].state.indexOf("ACE")!=-1){//墓地に
                                    if(ba_mons_num(my_ba)==5){//これ以上増えない
                                        break;
                                    }   
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(my_ba[j]==""){
                                            蘇生(my_ba,j,teki_haka,i);
                                            break;
                                        }
                                    }       
                                    break;     
                                }
                            }
                        }else{
                            for(let i=0;i<my_haka.length;i++){
                                if(my_haka[i].state.indexOf("モンスター")!=-1 && my_haka[i].state.indexOf("ACE")!=-1){//墓地に
                                    if(ba_mons_num(teki_ba)==5){//これ以上増えない
                                        break;
                                    }  
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(teki_ba[j]==""){
                                            蘇生(teki_ba,j,my_haka,i);
                                            break;
                                        }
                                    }  
                                    break;               
                                }
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"召喚時、相手の墓地にいるACEモンスター1体を自分の場に召喚する",text_iro:[]};

                var kyoumeiponya={name:"ぽにゃ-共鳴種-",image:kyoumeiponya_image,ATK:1,HP:1,state:["モンスター","ぽにゃ","共鳴","死亡時"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="死んだ"){
                        if(option.position=="my_ba"){
                            for(let i=0;i<my_yamahuda.length;i++){
                                if(my_yamahuda[i].card.name=="ぽにゃ-共鳴種-"){
                                    for(let j=0;j<5;j++){
                                        if(my_ba[j]==""){
                                            syoukan(my_yamahuda[i],"my_ba",j);
                                            my_yamahuda.splice(i,1);
                                            break;
                                        }
                                    }
                                    break;
                                }
                            }
                        }else{
                            for(let i=0;i<teki_yamahuda.length;i++){
                                if(teki_yamahuda[i].card.name=="ぽにゃ-共鳴種-"){
                                    for(let j=0;j<5;j++){
                                        if(teki_ba[j]==""){
                                            syoukan(teki_yamahuda[i],"teki_ba",j);
                                            teki_yamahuda.splice(i,1);
                                            break;
                                        }
                                    }
                                    break;
                                }
                            }
                        }
                        
                    }
                },AI:function(タイミング){return true;},text:"死の瞬間、自分のデッキに特殊なテレパシーを送り、自分の空いている場に同種を召喚することが判明した。メカニズムが解明されればあの装置が作成できるだろう…",text_iro:[]};
                var syukuniumu={name:"シュクニウム",image:syukuniumu_image,ATK:1,HP:3,state:["モンスター","しゅうくん","死亡時","感染"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="死んだ"){
                        if(option!=atk_card && atk_card!="" && atk_card.state.indexOf("シュクニウム耐性")==-1){//攻撃したの俺じゃねえよな？ && 攻撃で死んだよな？
                            atk_card.card=syukuniumu;
                            atk_card.ATK=1;
                            atk_card.HP=3;
                            atk_card.state=["モンスター","しゅうくん","死亡時","感染"];
                            atk_card.can_ATK=2;//このあと減るので、1+1=2
                        }
                        
                    }
                },AI:function(タイミング){return true;},text:"様々な次元のしゅうくんからサンプルを入手しその共通点を探した…その結果、多くの個体ではシュクニウムという物質が含まれていることがわかった。完璧とは言えないが、しゅうくんの識別に利用できるだろう。ただし扱いを間違えると死亡時に攻撃してきた相手に感染してしまうようだ…",text_iro:[]};

                var pon={name:"ポン・トゥルーミー",image:pon_image,ATK:0,HP:39,state:["モンスター","コントロール奪取","体力上昇","攻撃上昇","ラスボス","シュクニウム耐性"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;
                    }
                    return false;
                },effect:function(タイミング,option){
                    if(タイミング=="ターンエンド"){
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(ba_mons_num(my_ba)==5){//これ以上奪えない
                                        break;
                                }
                                if(teki_ba[i]!=""&& teki_ba[i].state.indexOf("しゅうくん")!=-1 && teki_ba[i].card.name!="しゅうくん"){//相手のしゅうくんを探す
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(my_ba[j]==""){
                                            my_ba[j]=teki_ba[i];
                                            teki_ba[i]="";
                                            my_ba[j].position="my_ba";
                                            my_ba[j].move=5;
                                            break;
                                        }
                                    }                                    
                                }
                            }
                        }else{
                            for(let i=0;i<5;i++){
                                if(ba_mons_num(teki_ba)==5){//これ以上奪えない
                                        break;
                                }
                                if(my_ba[i]!=""&& my_ba[i].state.indexOf("しゅうくん")!=-1  && my_ba[i].card.name!="しゅうくん"){//相手のしゅうくんを探す
                                    for(let j=0;j<5;j++){//空いてる場を探す
                                        if(teki_ba[j]==""){
                                            teki_ba[j]=my_ba[i];
                                            my_ba[i]="";
                                            teki_ba[j].position="teki_ba";
                                            teki_ba[j].move=5;
                                            break;
                                        }
                                    }                                    
                                }
                            }
                        }

                        let しゅうくん数=0;
                        for(let i=0;i<5;i++){
                            if(my_ba[i]!="" && my_ba[i].state.indexOf("しゅうくん")!=-1 ){
                                しゅうくん数+=1;
                                my_ba[i].ATK+=3;
                                my_ba[i].HP+=5;
                            }

                            if(teki_ba[i]!="" && teki_ba[i].state.indexOf("しゅうくん")!=-1 ){
                                しゅうくん数+=1;
                                teki_ba[i].ATK+=3;
                                teki_ba[i].HP+=5;
                            }

                        }
                       

                        if(option[0]=="自ターン"){
                            
                            my_ba[option[1]].HP+=しゅうくん数*7;
                            my_ba[option[1]].move=1;
                        }else{//敵ターン
                            teki_ba[option[1]].HP+=しゅうくん数*7;
                            teki_ba[option[1]].move=1;
                        }
                    }
                    return false;
                },AI:function(タイミング){return true;},text:"「しゅうさんが振り向いてくれません！こうなれば並行世界のしゅうさんを大量に呼んで逆ハーレムするしか生きている意味がないというものです！」ターン終了時：相手のしゅうくんを奪う（主人公は鈍感系なので効かない） 全しゅうくんの攻撃+3,HP+5。自分の体力を場のしゅうくんの数だけ7上昇",text_iro:[]};
                var mitibiki={name:"導き",image:mitibiki_image,ATK:0,HP:"無効",state:["モンスター"],effect_req:function(タイミング){
                    if(タイミング=="ターンエンド"){
                        return true;
                    }
                    return false;
                },effect:function(タイミング,option){
                    if(タイミング=="ターンエンド" || タイミング=="ターン開始" ){
                        let 継承state=["TOP_ACE"];
                        if(option[0]=="自ターン"){
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    my_ba[i]=death_card(my_ba[i],my_haka,i);
                                }
                            }
                            上位召喚(tutata,my_deck,0,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(burakkusyuukun,my_deck,1,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(pon,my_deck,2,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(rozusyuu,my_deck,3,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(long,my_deck,4,継承state);//カードの追加、召喚を行います。いいですね？マスター
                        }else{//敵ターン
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                }
                            }
                            上位召喚(tutata,teki_deck,0,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(burakkusyuukun,teki_deck,1,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(pon,teki_deck,2,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(rozusyuu,teki_deck,3,継承state);//カードの追加、召喚を行います。いいですね？マスター
                            上位召喚(long,teki_deck,4,継承state);//カードの追加、召喚を行います。いいですね？マスター
                        }
                    }
                    return false;
                },AI:function(タイミング){return true;},text:"「少々お待ちください。主を呼んできます。」",text_iro:[]};
                var long={name:"ロングしゅうくん",image:long_image,ATK:0,HP:30,state:["モンスター","しゅうくん"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"なが～いしゅうくん。二人で分けるとちょうどいい長さです！",text_iro:[]};
                var tutata={name:"つたたしゅうくん",image:tutata_image,ATK:3,HP:5,state:["モンスター","しゅうくん","二回攻撃"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"はしるのだいすき！つたたたたたたたたたたた",text_iro:[]};
                var nyoro={name:"にょろしゅうくん",image:nyoro_image,ATK:0,HP:2,state:["モンスター","しゅうくん"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!="" && my_ba[i].state.indexOf("しゅうくん")!=-1){//こちらの場にいる
                                    option[1].ATK+=2;
                                    option[1].HP+=3;
                                }
                            }

                        }else{//敵
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("しゅうくん")!=-1){//こちらの場にいる
                                    option[1].ATK+=2;
                                    option[1].HP+=3;
                                }
                            }
                        }
                    }
                },AI:function(タイミング){return true;},text:"一角大蛇とはよく遊ぶ仲。召喚時、自分の場のしゅうくんの数×2の攻撃力,×3のHPを得る。",text_iro:[]};
                var kokuten={name:"黒点",image:kokuten_image,ATK:0,HP:20,state:["モンスター","しゅうくん","ブロック"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"中心部から微量のシュクニウムが検出された。",text_iro:[]};
                var wesutan={name:"西しゅうくん",image:wesutan_image,ATK:0,HP:2,state:["モンスター","しゅうくん"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            デッキカード追加(my_deck,tyoubusou,"my_tehuda")
                            my_tehuda.push(my_deck[my_deck.length-1]);
                        }else{
                            デッキカード追加(teki_deck,tyoubusou,"teki_tehuda")
                            teki_tehuda.push(teki_deck[teki_deck.length-1]);
                        }
                    }
                },AI:function(タイミング){return true;},text:"西から来たナイスガイ。召喚時、手札に超武装を入れる",text_iro:[]};
                var hiru={name:"ヒールしゅうくん",image:hiru_image,ATK:0,HP:5,state:["モンスター","しゅうくん"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            デッキカード追加(my_deck,musyounoai,"my_tehuda")
                            my_tehuda.push(my_deck[my_deck.length-1]);
                        }else{
                            デッキカード追加(teki_deck,musyounoai,"teki_tehuda")
                            teki_tehuda.push(teki_deck[teki_deck.length-1]);
                        }
                    }
                },AI:function(タイミング){return true;},text:"めちゃかわナース。召喚時、手札に無償の愛を入れる",text_iro:[]};
                var kengou={name:"剣豪しゅうくん",image:kengou_image,ATK:1,HP:3,state:["モンスター","しゅうくん"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            デッキカード追加(my_deck,nitouryuukengi,"my_tehuda")
                            my_tehuda.push(my_deck[my_deck.length-1]);
                            デッキカード追加(my_deck,nitouryuukengi,"my_tehuda")
                            my_tehuda.push(my_deck[my_deck.length-1]);
                            デッキカード追加(my_deck,nitouryuukengi,"my_tehuda")
                            my_tehuda.push(my_deck[my_deck.length-1]);
                        }else{
                            デッキカード追加(teki_deck,nitouryuukengi,"teki_tehuda")
                            teki_tehuda.push(teki_deck[teki_deck.length-1]);
                            デッキカード追加(teki_deck,nitouryuukengi,"teki_tehuda")
                            teki_tehuda.push(teki_deck[teki_deck.length-1]);
                            デッキカード追加(teki_deck,nitouryuukengi,"teki_tehuda")
                            teki_tehuda.push(teki_deck[teki_deck.length-1]);
                        }
                    }
                },AI:function(タイミング){return true;},text:"6本も腕があるので虫さんなのではないか？召喚時、手札に二刀流剣技を3枚入れる",text_iro:[]};
                var omaemooreda={name:"お前も俺だ",image:omaemooreda_image,state:["魔法","しゅうくん付与"],effect_req:function(タイミング){
                    if(タイミング=="手札から"){
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!="" && teki_ba[i].state.indexOf("しゅうくん")==-1){return true;}
                            }
                        }else{
                             for(let i=0;i<5;i++){if(my_ba[i]!=""  && my_ba[i].state.indexOf("しゅうくん")==-1){return true; }}
                        }
                        return false;  
                    }
                },effect:function(タイミング){
                    if(タイミング=="手札から"){
                        let 継承state=[];
                        if(duel_phase!="相手"){
                            for(let i=0;i<5;i++){
                                if(teki_ba[i]!=""){
                                    if(teki_ba[i].state.indexOf("しゅうくん")==-1 && teki_ba[i].state.indexOf("シュクニウム耐性")==-1){
                                        teki_ba[i].state.push("しゅうくん");
                                    }
                                }
                            } 
                        }else{
                            for(let i=0;i<5;i++){
                                if(my_ba[i]!=""){
                                    if(my_ba[i].state.indexOf("しゅうくん")==-1 && my_ba[i].state.indexOf("シュクニウム耐性")==-1){
                                        my_ba[i].state.push("しゅうくん");
                                    }
                                }
                            } 
                        }
                    }
                },AI:function(タイミング){
                    return true;
                },text:"相手モンスター全体にシュクニウムを植え付けてしまう。恐ろしい！",text_iro:[]};

                var sutahhu={name:"制作者紹介",image:sutahhu_image,ATK:1,HP:1,state:["モンスター"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){},AI:function(タイミング){return true;},text:"遊んでくれてありがとー！",text_iro:[]};

                var tensyu={name:"店主サキュラ",image:tensyu_image,ATK:5,HP:50,state:["モンスター","店主"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="ターン開始"){
                        if(option[0]=="自ターン"){//味方
                            デッキカード追加(my_deck,サキュラリスト[Math.floor(Math.random()*サキュラリスト.length)],"my_tehuda")
                            my_tehuda.push(my_deck[my_deck.length-1]);
                            デッキカード追加(my_deck,サキュラリスト[Math.floor(Math.random()*サキュラリスト.length)],"my_tehuda")
                            my_tehuda.push(my_deck[my_deck.length-1]);
                        }else{
                            デッキカード追加(teki_deck,サキュラリスト[Math.floor(Math.random()*サキュラリスト.length)],"teki_tehuda")
                            teki_tehuda.push(teki_deck[teki_deck.length-1]);
                            デッキカード追加(teki_deck,サキュラリスト[Math.floor(Math.random()*サキュラリスト.length)],"teki_tehuda")
                            teki_tehuda.push(teki_deck[teki_deck.length-1]);
                        }
                    }
                },AI:function(タイミング){return true;},text:"ターン開始時、無からカードを2枚取り出す。色欲よりも物欲をそそらせるサキュバス。",text_iro:[]};
                var sitappa={name:"したっぱハート",image:sitappa_image,ATK:2,HP:10,state:["モンスター","ブロック"],effect_req:function(タイミング){return false;},effect:function(タイミング,option){
                    if(タイミング=="召喚された"){
                        if(option[0]=="my_ba"){//味方
                            デッキカード追加(my_deck,サキュラリスト[Math.floor(Math.random()*サキュラリスト.length)],"my_tehuda")
                            my_tehuda.push(my_deck[my_deck.length-1]);
                        }else{
                            デッキカード追加(teki_deck,サキュラリスト[Math.floor(Math.random()*サキュラリスト.length)],"teki_tehuda")
                            teki_tehuda.push(teki_deck[teki_deck.length-1]);
                        }
                    }
                },AI:function(タイミング){return true;},text:"サキュラ様のため、あんな仕事やこんな仕事をお手伝いする下級悪魔。召喚時にカードを1枚お届け。",text_iro:[]};

                var サキュラリスト=[ryuunoitigeki,kinkyuujitai5,raihudaiya,kenrounarusoukou,karamaruito,kanbansan,gurumesinjidai,kinkyuujitai3,tizomenaihu,kantuuya,aooni,akaoni,tamanezumi,kameko,sasori_musume,kanbanmusume,sitappa];

                //全てのカードを参照できる配列…手動で追加していってください。!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇
                all_card=[test_card,test_card2,syuukun,hojorobo,kinkyuujitai5,ryuunoitigeki,powerup3,HPup5,ponya,ponya_ace,yakuso_3,kameisi,kametetu,henyamotin,ponya_sutoraiku,ponya_big,ponya_daburu,ponya_rein,sasori,sasori_seitai,ikkakudaija_atama,ikkakudaija_hara,ikkakudaija_yubi,kyuukoukasakusenki,atakkumojuru,kaihukumojuru,sukurappudoro,buiwa,raihudaiya,seiretu,kyuusainote,kenrounarusoukou,zettainotamasii,kyousinja,hametunokami,burakkusyuukun,hojoseki,musyounoai,nitouryuukengi,sinennoai,tyoubusou,yamiryuusyuu,yamika,doragonburesu,zerozonbizu,ponyaaidoru,aidorukourin,hametunosinkou,sentanseisei,ikkakudaija_2,ittouryoudan,ponyasyoukansi,zousyoku,sukurappugoremu,sukurappubirudo,sasori_hujou,dokuhakinoko,karamaruito,ookametake,moukyodokudaitake,rozusyuu,kanbansan,gurumesinjidai,kinkyuujitai3,miryousuruhitomi,kankyouseihagoremu];
                all_card.push(...[dokuzomenaihu,tizomenaihu,muzomenaihu,naihuzomeotoko,sabitayari,kantuuya,sabitataiken,ueponsarubeji,hokakusuneku,isseihokaku,aooni,akaoni,sunattidoragon,touryuuzannosiren,ryuukon,ikaribakuhatu]);
                all_card.push(...[nezumi,tyuunezumi,dekanezumi,dokunezumi,tamanezumi,tatujinnezumi,kyuusonekowokamu,tamanorinezumi,tamanoridokunezumi,tamanori,tyuukun]);
                all_card.push(...[motinreddo,motinburuu,motingurin,motinpinku,motiniero,hirobakutan,motinkosumo,gingapawa,motinburakku,yamiyonokage,ou,ekken]);
                all_card.push(...[buppinhanbai,kameko,sasori_musume,operobo,daijanotukai,sourugadona,hametuwomatumono,zerozerozero]);
                all_card.push(...[pupukuraudo,pantingukuraudo,happisukoru,hitujikuraudo,daburukuraudo,hikoukigumo,amakuraudo,poizunkuraudo,biribirikuraudo,enjerukuraudo,kuraudo,detaappurodo,taihuu0gou]);
                all_card.push(...[dorodorodokudoku,pandemikku,kanbanmusume,zangyakuakuma,kumosuitoriki,dakuesu]);
                all_card.push(...[kyoumeiponya,syukuniumu,mitibiki,tutata,long,nyoro,kokuten,wesutan,hiru,kengou,omaemooreda]);
                all_card.push(...[sutahhu,tensyu,sitappa]);


                //デッキ組もうぜ！
                var test_list={card_list:[[HPup5,1],[powerup3,2],[test_card2,4],[syuukun,1]],ACE:[test_card2,test_card2],TOP_ACE:[syuukun]};
                var zako_list={card_list:[[test_card2,5]],ACE:[test_card2,test_card2,test_card2,test_card2],TOP_ACE:[test_card2]};
                
                var ponya_list={card_list:[[ponya,5],[ponya_ace,2],[yakuso_3,3]],ACE:[ponya_ace,ponya_ace],TOP_ACE:[ponya]};
                var kameisi_list={card_list:[[kameisi,6],[kametetu,1],[yakuso_3,3]],ACE:[kametetu],TOP_ACE:[kameisi]};
                var henyamotin_list={card_list:[[henyamotin,15]],ACE:[],TOP_ACE:[]};

                var sasori_list={card_list:[[sasori,10],[sasori_seitai,4]],ACE:[sasori_seitai,sasori_seitai],TOP_ACE:[sasori]};
                var ikkakudaija_list={card_list:[[ikkakudaija_atama,1],[ikkakudaija_hara,10],[ikkakudaija_yubi,1]],ACE:[ikkakudaija_yubi],TOP_ACE:[ikkakudaija_atama,ikkakudaija_hara,ikkakudaija_hara]};
                var buiwa_list={card_list:[[buiwa,5],[raihudaiya,3],[seiretu,10],[ryuunoitigeki,3]],ACE:[],TOP_ACE:[buiwa,buiwa,seiretu,seiretu,seiretu,seiretu,seiretu,seiretu,seiretu,seiretu,seiretu,seiretu]};
                var zettainotamasii_list={card_list:[[zettainotamasii,1],[kenrounarusoukou,2],[kyuusainote,2]],ACE:[],TOP_ACE:[zettainotamasii,kenrounarusoukou,kenrounarusoukou,kyuusainote,kyuusainote]};
                var hametu_list={card_list:[[kyousinja,15],[hametunokami,1]],ACE:[hametunokami],TOP_ACE:[kyousinja,kyousinja,kyousinja,kyousinja,kyousinja]};
                
                var burakku_list={card_list:[[burakkusyuukun,1],[hojoseki,3],[yamika,1],[zerozonbizu,1],[doragonburesu,2],[musyounoai,4],[sinennoai,2],[nitouryuukengi,3],[tyoubusou,2]],ACE:[zerozonbizu,tyoubusou,hojoseki],TOP_ACE:[burakkusyuukun,hojoseki,hojoseki,yamika,musyounoai,sinennoai,tyoubusou]};
                
                var sasori_hujou_list={card_list:[[sasori_hujou,2],[sasori_seitai,4]],ACE:[sasori_hujou,sasori_seitai],TOP_ACE:[sasori_hujou]};
                var dokuhakinoko_list={card_list:[[dokuhakinoko,5]],ACE:[],TOP_ACE:[dokuhakinoko,dokuhakinoko,dokuhakinoko,dokuhakinoko,dokuhakinoko]};
                var karamaruito_list={card_list:[[karamaruito,10],[sasori_hujou,3],[kinkyuujitai3,3]],ACE:[karamaruito,karamaruito,karamaruito,karamaruito],TOP_ACE:[karamaruito]};
                var ookametake_list={card_list:[[ookametake,3],[dokuhakinoko,5],[kinkyuujitai3,2]],ACE:[ookametake],TOP_ACE:[ookametake]};
                var kankyouseihagoremu_list={card_list:[[kankyouseihagoremu,3],[moukyodokudaitake,6],[gurumesinjidai,3]],ACE:[],TOP_ACE:[kankyouseihagoremu,moukyodokudaitake,moukyodokudaitake]};
                var rozusyuu_list={card_list:[[rozusyuu,1],[kankyouseihagoremu,2],[karamaruito,2],[dokuhakinoko,2],[sasori_hujou,2],[miryousuruhitomi,3],[musyounoai,2],[moukyodokudaitake,2]],ACE:[],TOP_ACE:[rozusyuu,kankyouseihagoremu,kankyouseihagoremu,musyounoai,musyounoai]};
                var kanbansan_list={card_list:[[kanbansan,15]],ACE:[kanbansan,kanbansan],TOP_ACE:[kanbansan]};
                
                var tizomenaihu_list={card_list:[[tizomenaihu,15],[muzomenaihu,10],[dokuzomenaihu,10],[naihuzomeotoko,5]],ACE:[naihuzomeotoko],TOP_ACE:[tizomenaihu,muzomenaihu,dokuzomenaihu,tizomenaihu,tizomenaihu,naihuzomeotoko]};
                var sabitayari_list={card_list:[[sabitayari,10],[tizomenaihu,5],[sabitataiken,5],[kantuuya,5],[ueponsarubeji,5]],ACE:[ueponsarubeji,sabitataiken],TOP_ACE:[sabitayari,sabitataiken,sabitataiken]};
                var hokaku_list={card_list:[[hokakusuneku,15],[sabitataiken,10],[isseihokaku,10]],ACE:[hokakusuneku,hokakusuneku],TOP_ACE:[hokakusuneku,sabitataiken,hokakusuneku,sabitataiken]};
                var aooni_list={card_list:[[aooni,1],[akaoni,1],[touryuuzannosiren,1],[ryuukon,1],[isseihokaku,4],[buiwa,5],[zerozonbizu,1]],ACE:[buiwa,buiwa],TOP_ACE:[aooni,akaoni,touryuuzannosiren,ryuukon,buiwa,zerozonbizu]};
                
                var nezumi_list={card_list:[[nezumi,5],[tyuunezumi,5],[dekanezumi,1]],ACE:[dekanezumi],TOP_ACE:[nezumi]};
                var dekanezumi_list={card_list:[[nezumi,2],[tyuunezumi,5],[dekanezumi,3]],ACE:[dekanezumi],TOP_ACE:[dekanezumi]};
                var dokunezumi_list={card_list:[[nezumi,15],[dokunezumi,5]],ACE:[dokunezumi,dokunezumi,dokunezumi],TOP_ACE:[nezumi,nezumi,nezumi,nezumi,nezumi]};
                var tamanezumi_list={card_list:[[tamanezumi,5],[tyuunezumi,3],[dokunezumi,5]],ACE:[tamanezumi],TOP_ACE:[tamanezumi,tyuunezumi,tyuunezumi]};
                var tatujinnezumi_list={card_list:[[tatujinnezumi,5],[tamanezumi,3],[dekanezumi,3]],ACE:[dekanezumi,tamanezumi,tatujinnezumi],TOP_ACE:[dekanezumi]};
                var tamanori_list={card_list:[[tamanezumi,5],[tamanori,5],[dokunezumi,3],[nezumi,3],[tyuunezumi,3]],ACE:[],TOP_ACE:[tamanezumi,tamanezumi,tamanori,tamanori]};
                var tyuukun_list={card_list:[[tyuukun,1],[musyounoai,1],[kyuusonekowokamu,3],[tamanezumi,5],[dokunezumi,3],[nezumi,1],[tyuunezumi,3],[seiretu,5],[tatujinnezumi,3],[dekanezumi,5]],ACE:[tamanezumi],TOP_ACE:[tyuukun,tamanezumi,tamanezumi,seiretu,musyounoai,kyuusonekowokamu]};
                
                var ou_list={card_list:[[henyamotin,50],[hirobakutan,1],[gingapawa,1],[ekken,1],[yamiyonokage,3]],ACE:[yamiyonokage,yamiyonokage,yamiyonokage],TOP_ACE:[hirobakutan,gingapawa,ekken]};
                
                var pupu_list={card_list:[[pupukuraudo,15],[pantingukuraudo,2],[happisukoru,5],[powerup3,20]],ACE:[happisukoru],TOP_ACE:[pantingukuraudo,happisukoru,pupukuraudo,pupukuraudo,powerup3,powerup3]};
                var hituji_list={card_list:[[hitujikuraudo,10],[daburukuraudo,10],[hikoukigumo,5],[powerup3,10]],ACE:[hitujikuraudo,hitujikuraudo,hitujikuraudo],TOP_ACE:[hitujikuraudo,hikoukigumo]};
                var ama_list={card_list:[[amakuraudo,10],[poizunkuraudo,8],[biribirikuraudo,7],[happisukoru,10]],ACE:[happisukoru,happisukoru],TOP_ACE:[amakuraudo,biribirikuraudo,poizunkuraudo]};
                var enjeru_list={card_list:[[enjerukuraudo,45],[detaappurodo,1]],ACE:[],TOP_ACE:[detaappurodo,enjerukuraudo]};
                var taihuu_list={card_list:[[taihuu0gou,1],[pupukuraudo,6],[pantingukuraudo,6],[happisukoru,6],[hitujikuraudo,6],[daburukuraudo,6],[amakuraudo,6],[poizunkuraudo,6],[biribirikuraudo,6],[enjerukuraudo,6]],ACE:[],TOP_ACE:[pupukuraudo,daburukuraudo,hitujikuraudo,poizunkuraudo,taihuu0gou]};

                var kyoumei_list={card_list:[[kyoumeiponya,40],[ponya_rein,20]],ACE:[],TOP_ACE:[kyoumeiponya]};
                var syukuniumu_list={card_list:[[syukuniumu,25],[sinennoai,10]],ACE:[syukuniumu,syukuniumu,syukuniumu,syukuniumu,syukuniumu,syukuniumu,syukuniumu,syukuniumu,syukuniumu,syukuniumu],TOP_ACE:[syukuniumu,syukuniumu,syukuniumu,syukuniumu,syukuniumu,sinennoai]};
                var pon_list={card_list:[[mitibiki,1],[tutata,4],[long,3],[nyoro,2],[kokuten,5],[wesutan,3],[hiru,6],[kengou,5],[omaemooreda,5]],ACE:[kokuten,kokuten,kokuten],TOP_ACE:[mitibiki,omaemooreda,omaemooreda]};
                
                var sutahhu_list={card_list:[[sutahhu,15],[test_card,4]],ACE:[],TOP_ACE:[test_card,test_card,test_card,test_card,sutahhu]};

                var tensyu_list={card_list:[[tensyu,1],[sitappa,10]],ACE:[sitappa],TOP_ACE:[tensyu,sitappa,sitappa]};

                var チャレンジリスト=[];
                チャレンジリスト[0]={card_list:[[ponya,1],[ponya_big,3],[ponya_sutoraiku,3],[ponya_daburu,3],[ponya_rein,4],[aidorukourin,2],[buppinhanbai,4]],ACE:[ponya_big,ponya_big,aidorukourin],TOP_ACE:[ponya,ponya_rein]};
                チャレンジリスト[1]={card_list:[[kyuukoukasakusenki,9],[atakkumojuru,5],[operobo,3],[sukurappubirudo,4],[sukurappudoro,4]],ACE:[kyuukoukasakusenki,kyuukoukasakusenki,kyuukoukasakusenki,kyuukoukasakusenki,kyuukoukasakusenki],TOP_ACE:[kyuukoukasakusenki,kyuukoukasakusenki]};
                チャレンジリスト[2]={card_list:[[ikkakudaija_hara,14],[sentanseisei,8],[ittouryoudan,5],[daijanotukai,3]],ACE:[sentanseisei,ikkakudaija_hara,ikkakudaija_hara,ikkakudaija_hara,ikkakudaija_hara],TOP_ACE:[,ikkakudaija_hara,sentanseisei]};
                チャレンジリスト[3]={card_list:[[syuukun,1],[yamika,1],[musyounoai,5],[tyoubusou,3],[doragonburesu,2],[kengou,1]],ACE:[tyoubusou,tyoubusou,yamika],TOP_ACE:[syuukun,musyounoai]};
                チャレンジリスト[4]={card_list:[[moukyodokudaitake,10],[kankyouseihagoremu,2],[gurumesinjidai,5],[powerup3,2]],ACE:[],TOP_ACE:[kankyouseihagoremu,kankyouseihagoremu]};
                チャレンジリスト[5]={card_list:[[akaoni,2],[aooni,3],[touryuuzannosiren,2],[tizomenaihu,5]],ACE:[touryuuzannosiren,touryuuzannosiren,aooni,aooni],TOP_ACE:[akaoni,tizomenaihu]};
                チャレンジリスト[6]={card_list:[[nezumi,1],[dekanezumi,1],[tamanezumi,4],[tatujinnezumi,5],[sourugadona,2],[kyuusonekowokamu,4]],ACE:[tamanezumi,tamanezumi,tatujinnezumi,tatujinnezumi,sourugadona],TOP_ACE:[nezumi,dekanezumi]};
                チャレンジリスト[7]={card_list:[[pupukuraudo,1],[detaappurodo,1],[pantingukuraudo,10],[biribirikuraudo,2],[enjerukuraudo,10],[hikoukigumo,15],[happisukoru,5]],ACE:[detaappurodo,pantingukuraudo,pantingukuraudo,pantingukuraudo,pantingukuraudo],TOP_ACE:[pupukuraudo,hikoukigumo]};
                チャレンジリスト[8]={card_list:[[kokuten,5],[musyounoai,5],[kinkyuujitai5,3],[ryuunoitigeki,4],[zerozonbizu,3],[kinkyuujitai3,10],[kantuuya,3]],ACE:[kokuten,kokuten,kokuten],TOP_ACE:[kokuten,kokuten]};

                //={card_list:[[henyamotin,15]],ACE:[],TOP_ACE:[]};
                //パック
                var ぽにゃパック=[ponya,ponya,ponya,ponya,ponya,ponya,ponya,ponya,ponya_ace,ponya_ace,ponya_ace,ponya_ace,ponya_sutoraiku,ponya_sutoraiku,ponya_big,ponya_big,ponya_daburu,ponya_daburu,ponya_rein,ponya_rein,HPup5,HPup5,powerup3,ryuunoitigeki,ryuunoitigeki,ryuunoitigeki,kinkyuujitai5,kyuukoukasakusenki,kyuukoukasakusenki,kyuukoukasakusenki,kyuukoukasakusenki,atakkumojuru,atakkumojuru,kaihukumojuru,kaihukumojuru,sukurappudoro,sukurappudoro,henyamotin,henyamotin,henyamotin,henyamotin];
                var 上位召喚パック=[aidorukourin,aidorukourin,aidorukourin,zousyoku,zousyoku,ponyasyoukansi,ponyasyoukansi,hametunosinkou,kyousinja,kyousinja,kyousinja,sentanseisei,sentanseisei,sentanseisei,ittouryoudan,ittouryoudan,ikkakudaija_hara,ikkakudaija_hara,ikkakudaija_hara,ikkakudaija_hara,sukurappubirudo,sukurappubirudo,sukurappubirudo,raihudaiya,raihudaiya,raihudaiya,raihudaiya];
 
                var 雑魚パック=[syuukun,hojorobo,ponya,ponya_ace,kameisi,kametetu,henyamotin,ponya_big,ponya_daburu,sasori,ikkakudaija_hara,ikkakudaija_yubi,kyuukoukasakusenki,atakkumojuru,kaihukumojuru,buiwa,kyuusainote,kenrounarusoukou,zettainotamasii,kyousinja,burakkusyuukun,hojoseki,ponyasyoukansi,sasori_hujou,dokuhakinoko,karamaruito,moukyodokudaitake,rozusyuu,dokuzomenaihu,muzomenaihu,naihuzomeotoko];
                var 魔法パック=[ryuunoitigeki,powerup3,HPup5,yakuso_3,sukurappudoro,raihudaiya,seiretu,musyounoai,nitouryuukengi,tyoubusou,yamika,doragonburesu,aidorukourin,hametunosinkou,sentanseisei,ittouryoudan,zousyoku,sukurappubirudo,gurumesinjidai,kinkyuujitai3,miryousuruhitomi,kantuuya,ueponsarubeji,isseihokaku,touryuuzannosiren,ryuukon,ikaribakuhatu];
                var 強パック=[kinkyuujitai5,ponya_sutoraiku,ponya_rein,sasori_seitai,ikkakudaija_atama,zerozonbizu,ookametake,kanbansan,kankyouseihagoremu,tizomenaihu,sabitayari,sabitataiken,hokakusuneku,aooni,akaoni];
                
                var 娘パック=[aidorukourin,aidorukourin,aidorukourin,buppinhanbai,kameko,sasori_musume,operobo,daijanotukai,sourugadona,hametuwomatumono,zerozerozero];
                var 娘パック2=[nezumi,nezumi,nezumi,motinpinku,pupukuraudo,pandemikku,kanbanmusume,zangyakuakuma,kumosuitoriki,dakuesu];

                var あまりものパック=[nezumi,tyuunezumi,dekanezumi,dokunezumi,tamanezumi,tatujinnezumi,tamanori,tyuukun,gingapawa,yamiyonokage,pupukuraudo,pantingukuraudo,happisukoru,hitujikuraudo,daburukuraudo,hikoukigumo,amakuraudo,poizunkuraudo,biribirikuraudo,enjerukuraudo,kyoumeiponya,syukuniumu,tutata,long,nyoro,kokuten,wesutan,hiru,kengou,omaemooreda];
                //ここからロード、なんで一個ずつやってるのかというと、開発中はバージョンによってセーブデータがあったりなかったりするから、バグる。
                //全データ消去();
                if(localStorage.getItem('所持カード')){//セーブデータがあるね
                    所持カードのロード(localStorage.getItem('所持カード'));
                }else{
                    所持カード=[[HPup5,3],[powerup3,2],[syuukun,1],[hojorobo,2]];
                    所持カードのセーブ();
                }
                if(localStorage.getItem('deck_list')){//セーブデータがあるね
                    デッキのロード(localStorage.getItem('deck_list'));
                }else{
                    //初期所持カード
                    deck_list={card_list:[[HPup5,3],[powerup3,2],[syuukun,1],[hojorobo,2]],ACE:[hojorobo,powerup3],TOP_ACE:[syuukun]};
                    デッキのセーブ();
                }
                
                if(localStorage.getItem('保存デッキ')){//セーブデータがあるね
                    保存デッキの読み込み(localStorage.getItem('保存デッキ'));
                    //保存デッキ=[{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]},{card_list:[],ACE:[],TOP_ACE:[]}];
                    
                    if(保存デッキ.length<10){//昔はデッキリストが5つだったので、古いデータを持っている人はここで加算します。10より増やすなら修正箇所が地味に多いので気を付けてくらさい。
                        for(let i=保存デッキ.length;i<10;i++){
                            保存デッキ.push({card_list:[],ACE:[],TOP_ACE:[]});
                        }
                        保存デッキの保存();//ゲームデータセーブ
                    }
                    
                }else{
                    保存デッキの保存();//ゲームデータセーブ
                }
                
                if(localStorage.getItem('MAX_STAGE')){//セーブデータがあるね
                    MAX_STAGE=localStorage.getItem('MAX_STAGE');
                    MAX_STAGE=Number(MAX_STAGE);
                    stage=MAX_STAGE;
                    if(stage==12){
                        stage=11;
                    }
                }else{
                    localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                }

                if(localStorage.getItem('MAX_ACE')){//セーブデータがあるね
                    MAX_ACE=localStorage.getItem('MAX_ACE');
                    MAX_ACE=Number(MAX_ACE);
                }else{
                    localStorage.setItem('MAX_ACE',MAX_ACE);//ゲームデータセーブ
                }

                if(localStorage.getItem('MAX_TOP_ACE')){//セーブデータがあるね
                    MAX_TOP_ACE=localStorage.getItem('MAX_TOP_ACE');
                    MAX_TOP_ACE=Number(MAX_TOP_ACE);
                }else{
                    localStorage.setItem('MAX_TOP_ACE',MAX_TOP_ACE);//ゲームデータセーブ
                }

                if(localStorage.getItem('お金')){//セーブデータがあるね
                    お金=localStorage.getItem('お金');
                    お金=Number(お金);
                }else{
                    localStorage.setItem('お金',お金);//ゲームデータセーブ
                }

                if(localStorage.getItem('MAX_deck')){//セーブデータがあるね
                    MAX_deck=localStorage.getItem('MAX_deck');
                    MAX_deck=Number(MAX_deck);
                }else{
                    localStorage.setItem("MAX_deck",MAX_deck);//ゲームデータセーブ
                }

                if(localStorage.getItem('my_pull')){//セーブデータがあるね
                    my_pull=localStorage.getItem('my_pull');
                    my_pull=Number(my_pull);
                }else{
                    localStorage.setItem('my_pull',my_pull);//ゲームデータセーブ
                }
                
                if(localStorage.getItem('my_deck_pull')){//セーブデータがあるね
                    my_deck_pull=localStorage.getItem('my_deck_pull');
                    my_deck_pull=Number(my_deck_pull);
                }else{
                    my_deck_pull=my_pull;
                    localStorage.setItem('my_deck_pull',my_deck_pull);//ゲームデータセーブ
                }

                if(localStorage.getItem('クリア済み')){//セーブデータがあるね
                    クリア済み=localStorage.getItem('クリア済み').split(',');
                }else{
                    localStorage.setItem('クリア済み',クリア済み);//ゲームデータセーブ
                }
                //お金=99999;
                //deck_list={card_list:[[tensyu,1],[sitappa,2]],ACE:[],TOP_ACE:[tensyu,sitappa]};
                //ponya_list={card_list:[[tamanezumi,4],[kyuusonekowokamu,3]],ACE:[],TOP_ACE:[tamanezumi]};
                //ponya_list=deck_list;
                //所持カード=[[ponya_sutoraiku,5],[ponya_daburu,5]];
                //game_phase="デッキ編集";
                //sub_phase="デッキリスト";
                //cursor=1;
                //MAX_STAGE=4;
                //mini_stage=2;
                //game_phase="挑戦";
                //stage=11;
                //mini_stage=0;
                //stage=1;
                //MAX_TOP_ACE=15;
                //--------------------------------------------------------------------------------------------------------/--------------------------------------------------------------------------------------------------------
                setInterval(function(){//1秒にn回動くぞ！
                    time+=1;
                    if(time==1000){
                        time=0;
                    }

                    if(game_phase=="タイトル"){
                        if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                            key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                            
                            演出カウント+=1;
                            長押し阻止=1;
                            ctx.fillStyle="rgb(50,50,50)";
                        }
                        ctx.drawImage(title_image,0,0);
                        cursor=2;
                        if(演出カウント>=0){
                            演出カウント+=1;
                            ctx.fillRect(0,0,演出カウント*200,1000);
                        }
                        if(演出カウント>5){
                            game_phase="ステージ選択";
                            演出カウント=-11;
                        }
                        //game_phase="挑戦";
                    }else if(game_phase=="ステージ選択"){
                        if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                            key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                            for(let i=0;i<key_input.length;i++){
                                if(key_input.charAt(i)=="↑"){
                                    if(cursor==2 || cursor==3){
                                        cursor=0;
                                    }else if(cursor==4){
                                        cursor=1;
                                    }
                                }else if(key_input.charAt(i)=="←"){
                                    if(cursor==1 || cursor==3 || cursor==4){
                                        cursor-=1;
                                    }
                                }else if(key_input.charAt(i)=="→"){
                                    if(cursor==0 || cursor==2 || cursor==3){
                                        cursor+=1;
                                    }
                                }else if(key_input.charAt(i)=="↓"){
                                    if(cursor==0){
                                        cursor=2;
                                    }else if(cursor==1){
                                        cursor=4;
                                    }
                                }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                    長押し阻止=1;
                                    if(cursor==2){
                                        next_phase="デッキ編集準備";
                                        演出カウント=-20;
                                    }else if(cursor==3 && stage<=11){//実装済みステージ数より大きくしないこと。
                                        next_phase="挑戦";
                                        演出カウント=1;
                                        mini_stage=0;
                                    }else if(cursor==4 && MAX_STAGE!=1){//お店
                                        next_phase="お店準備";
                                        演出カウント=-30;
                                    }else if(cursor==0){//戻る
                                        if(stage==1){
                                            stage=MAX_STAGE;
                                            if(stage==12){
                                                stage=11;
                                            }
                                        }else{
                                            stage-=1;
                                        }
                                    }else if(cursor==1){//進む
                                        if(stage==MAX_STAGE){
                                            stage=1;
                                        }else{
                                            stage+=1;
                                            if(stage==12){
                                                stage=1;
                                            }
                                        }
                                    }
                                }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                    長押し阻止=1;
                                }
                                
                            }
                            if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                key_input="";
                                key_interval=0;
                            }
                            
                        }else if(key_interval>0){
                            key_interval=key_interval-1;//カウントダウン
                        }

                        if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                            長押し阻止=0; 
                        }

                        
                        
                        
                        ctx.fillStyle="rgb(50,50,50)";
                        ctx.fillRect(0,0,1000,100);
                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillText("ステージ選択", 325, 70);
                        ctx.fillText("▶", 750, 70);
                        ctx.fillText("◀", 200, 70);
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(0,800,1000,200);
                        ctx.fillStyle="rgb(50,50,50)";
                        ctx.fillRect(0,800,1000,5);
                        ctx.fillRect(200,825,5,150);
                        ctx.fillRect(800,825,5,150);
                        ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillText("デッキ編集", 20, 880);
                        ctx.drawImage(yamahuda,68,900);
                        ctx.font = "100px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillText("挑戦", 400, 930);
                        ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillText(お金, 860, 988);
                        ctx.drawImage(okane,820,960);

                        if(MAX_STAGE>1){//お店は1をクリアしてから表示
                            ctx.save();
                            ctx.scale(2,2);
                            ctx.drawImage(omise_image,420,410);
                            ctx.restore();
                        }
                        

                        if(stage==1){
                            ctx.drawImage(henyamoti_title,0,100);
                        }else if(stage==2){
                            ctx.drawImage(saiten_title,0,100);
                        }else if(stage==3){
                            ctx.drawImage(burakku_title,0,100);
                        }else if(stage==4){
                            ctx.drawImage(hujounomori_title,0,100);
                        }else if(stage==5){
                            ctx.drawImage(syuukungari_title,0,100);
                        }else if(stage==6){
                            ctx.drawImage(dekkitounan_title,0,100);
                        }else if(stage==7){
                            ctx.drawImage(henyamotinkingudamu_title,0,100);
                        }else if(stage==8){
                            ctx.drawImage(tengoku_title,0,100);
                        }else if(stage==9){
                            ctx.drawImage(seigen_title,0,100);
                        }else if(stage==10){
                            ctx.drawImage(ending_title,0,100);
                        }else if(stage==11){
                            ctx.drawImage(EX_title,0,100);
                        }else{
                            ctx.drawImage(junbityuu_title,0,100);
                        }
                        
                        if(stage<MAX_STAGE){
                            ctx.drawImage(kuria,600,70);
                        }

                        if(cursor==0){
                            ctx.drawImage(yubi,150,80+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==1){
                            ctx.drawImage(yubi,700,80+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==2){
                            ctx.save();
                            ctx.rotate(180 * Math.PI / 180);
                            ctx.drawImage(yubi,-160,-850+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(cursor==3){
                            ctx.save();
                            ctx.rotate(180 * Math.PI / 180);
                            ctx.drawImage(yubi,-560,-850+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(cursor==4){
                            ctx.save();
                            ctx.rotate(180 * Math.PI / 180);
                            ctx.drawImage(yubi,-960,-850+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }

                        
                        

                        ctx.fillStyle="rgb(50,50,50)";
                        if(演出カウント<-26 && 演出カウント>-31){
                            演出カウント+=1;
                            ctx.fillRect(-5000-演出カウント*200,0,6000+演出カウント*200,1000);
                        }

                        if(演出カウント<-20 && 演出カウント>-25){
                            演出カウント-=1;
                            ctx.fillRect(-4000-演出カウント*200,0,5000+演出カウント*200,1000);
                        }

                        if(演出カウント<-16 && 演出カウント>-21){
                            演出カウント+=1;
                            ctx.fillRect(0,0,4000+演出カウント*200,1000);
                        }

                        if(演出カウント<-10 && 演出カウント>-15){
                            演出カウント-=1;
                            ctx.fillRect(0,0,3000+演出カウント*200,1000);
                        }
                        if(演出カウント<0 && 演出カウント>-5){
                            演出カウント-=1;
                            ctx.fillRect(0,0,1000,1000+演出カウント*200);
                        }
                        if(演出カウント>0){
                            演出カウント+=1;
                            ctx.fillRect(0,0,1000,演出カウント*200);
                        }
                        if(演出カウント==6 || 演出カウント==-16 || 演出カウント==-26 ){
                            game_phase=next_phase;
                            演出カウント=-1;
                            cursor2=0;
                            my_stage_pull=0;
                            特殊状態=[];
                        }

                    }else if(game_phase=="挑戦"){
                        
                        if(stage==1){//へにゃもちん草原
                            if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                                key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                                for(let i=0;i<key_input.length;i++){
                                    if(key_input.charAt(i)=="↑"){
                                    }else if(key_input.charAt(i)=="←"){
                                        if(mini_stage==2 || mini_stage==3){
                                            mini_stage=(mini_stage+1)%2+2;
                                        }
                                        if(mini_stage==5){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="→"){
                                        if(mini_stage==2 || mini_stage==3){
                                            mini_stage=(mini_stage+1)%2+2;
                                        }
                                        if(mini_stage==5){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="↓"){
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(mini_stage==0){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=ponya_list;//使用デッキ
                                            teki_pull=2;//ドロー枚数
                                            next_mini_stage=1;//クリアできたらこれが使われるってことさ。
                                            drop_gold=10;//お金ー！
                                        }else if(mini_stage==1){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=kameisi_list;//使用デッキ
                                            teki_pull=2;//ドロー枚数
                                            next_mini_stage=2;//クリアできたらこれが使われるってことさ。
                                            drop_gold=15;//お金ー！
                                        }else if(mini_stage==2){
                                            mini_stage=4;
                                            特殊状態.push("攻撃");
                                            特殊状態.push(1);
                                        }else if(mini_stage==3){
                                            mini_stage=4;
                                            特殊状態.push("体力");
                                            特殊状態.push(1);
                                        }else if(mini_stage==4){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=henyamotin_list;//使用デッキ
                                            teki_pull=1;//ドロー枚数
                                            next_mini_stage=5;//クリアできたらこれが使われるってことさ。
                                            drop_gold=20;//お金ー！
                                        }else if(mini_stage==5){
                                            if(cursor2==0){
                                                初回クリアメッセージフラグ=0;
                                                next_phase="ステージ選択";
                                                演出カウント=1;
                                                cursor=3;
                                            }else{
                                                key_input="";//なんかこれないとボタン操作がいかれる
                                                URL_tweet_text="https://twitter.com/intent/tweet?text=へにゃもちんそうげんを突破した！%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                                window.open( URL_tweet_text, '_blank'); 
                                            }
                                            
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }
                                    
                                }
                                if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                    key_input="";
                                    key_interval=0;
                                }
                                
                            }else if(key_interval>0){
                                key_interval=key_interval-1;//カウントダウン
                            }

                            if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                                長押し阻止=0; 
                            }
                            
                            ctx.drawImage(henyamoti,0,0);
                            if(mini_stage==0){
                                ctx.save();
                                ctx.rotate(180 * Math.PI / 180);
                                ctx.drawImage(yubi,-250,-800+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(mini_stage==1){
                                ctx.drawImage(yubi,400,750+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==2){
                                ctx.drawImage(yubi,250,500+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==3){
                                ctx.drawImage(yubi,550,500+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==4){
                                ctx.drawImage(yubi,400,220+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==5){//クリアだ。おめでとう。
                                ctx.fillStyle="rgb(0,0,0,0.75)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(henyamotin_kuria,0,0);
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillRect(50,700,900,250);

                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText("ステージ選択へ", 200, 930);
                                ctx.fillText("ツイート", 700, 930);

                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                                }else{
                                    ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                             
                                if(MAX_STAGE==1){
                                    初回クリアメッセージフラグ=1;
                                    MAX_STAGE=2;
                                    MAX_ACE+=1;
                                    localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                                    localStorage.setItem('MAX_ACE',MAX_ACE);//ゲームデータセーブ
                                }
                                if(初回クリアメッセージフラグ==1){
                                    ctx.fillText("ACE設定可能数が1増えました！", 100, 780);
                                }
                            }
                            ctx.scale(2, 2);
                            tokusyu_hyouji(20,20);
                            ctx.scale(0.5, 0.5);
                        }else if(stage==2){//力の祭典
                            if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                                key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                                for(let i=0;i<key_input.length;i++){
                                    if(key_input.charAt(i)=="↑"){
                                    }else if(key_input.charAt(i)=="←"){
                                        if(mini_stage==5){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="→"){
                                        if(mini_stage==5){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="↓"){
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(mini_stage==0){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=sasori_list;//使用デッキ
                                            teki_pull=2;//ドロー枚数
                                            next_mini_stage=1;//クリアできたらこれが使われるってことさ。
                                            drop_gold=30;//お金ー！

                                            
                                        }else if(mini_stage==1){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=ikkakudaija_list;//使用デッキ
                                            teki_pull=2;//ドロー枚数
                                            next_mini_stage=2;//クリアできたらこれが使われるってことさ。
                                            drop_gold=50;//お金ー！

                                        }else if(mini_stage==2){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=buiwa_list;//使用デッキ
                                            teki_pull=1;//ドロー枚数
                                            next_mini_stage=3;//クリアできたらこれが使われるってことさ。
                                            drop_gold=70;//お金ー！
                                        }else if(mini_stage==3){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=zettainotamasii_list;//使用デッキ
                                            teki_pull=1;//ドロー枚数
                                            next_mini_stage=4;//クリアできたらこれが使われるってことさ。
                                            drop_gold=100;//お金ー！
                                        }else if(mini_stage==4){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=hametu_list;//使用デッキ
                                            teki_pull=0;//ドロー枚数
                                            next_mini_stage=5;//クリアできたらこれが使われるってことさ。
                                            drop_gold=200;//お金ー！
                                        }else if(mini_stage==5){
                                            if(cursor2==0){
                                                初回クリアメッセージフラグ=0;
                                                next_phase="ステージ選択";
                                                演出カウント=1;
                                                cursor=3;
                                            }else{
                                                key_input="";//なんかこれないとボタン操作がいかれる
                                                URL_tweet_text="https://twitter.com/intent/tweet?text=力の祭典を突破した！%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                                window.open( URL_tweet_text, '_blank'); 
                                            }
                                            
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }
                                    
                                }
                                if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                    key_input="";
                                    key_interval=0;
                                }
                                
                            }else if(key_interval>0){
                                key_interval=key_interval-1;//カウントダウン
                            }

                            if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                                長押し阻止=0; 
                            }
                            ctx.drawImage(saiten,0,0);
                            if(mini_stage==0){
                                ctx.drawImage(yubi,800,770+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==1){
                                ctx.drawImage(yubi,750,370+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==2){
                                ctx.drawImage(yubi,250,850+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==3){
                                ctx.drawImage(yubi,300,400+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==4){
                                ctx.drawImage(yubi,20,170+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==5){//クリアだ。おめでとう。
                                ctx.fillStyle="rgb(0,0,0,0.75)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(saiten_kuria,0,0);
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillRect(50,700,900,250);

                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText("ステージ選択へ", 200, 930);
                                ctx.fillText("ツイート", 700, 930);

                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                                }else{
                                    ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                             
                                if(MAX_STAGE==2){
                                    初回クリアメッセージフラグ=1;
                                    MAX_STAGE=3;
                                    localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                                    MAX_deck=30;
                                    my_pull=3;
                                    my_deck_pull=my_pull;
                                    localStorage.setItem('MAX_deck',MAX_deck);//ゲームデータセーブ
                                    localStorage.setItem('my_pull',my_pull);//ゲームデータセーブ
                                    localStorage.setItem('my_deck_pull',my_deck_pull);//ゲームデータセーブ
                                }
                                if(初回クリアメッセージフラグ==1){
                                    ctx.fillText("デッキの上限枚数+10 ドロー枚数+1", 100, 780);
                                }
                            }
                        }else if(stage==3){//vsブラックしゅうくん
                            if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                                key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                                for(let i=0;i<key_input.length;i++){
                                    if(key_input.charAt(i)=="↑"){
                                    }else if(key_input.charAt(i)=="←"){
                                        if(mini_stage==1){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="→"){
                                        if(mini_stage==1){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="↓"){
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(mini_stage==0){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=burakku_list;//使用デッキ
                                            teki_pull=3;//ドロー枚数
                                            next_mini_stage=1;//クリアできたらこれが使われるってことさ。
                                            drop_gold=250;//お金ー！
                                            
                                        }else if(mini_stage==1){
                                            if(cursor2==0){
                                                初回クリアメッセージフラグ=0;
                                                next_phase="ステージ選択";
                                                演出カウント=1;
                                                cursor=3;
                                            }else{
                                                key_input="";//なんかこれないとボタン操作がいかれる
                                                URL_tweet_text="https://twitter.com/intent/tweet?text=ブラックしゅうくんをブッ飛ばした！%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                                window.open( URL_tweet_text, '_blank'); 
                                            }
                                            
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }
                                    
                                }
                                if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                    key_input="";
                                    key_interval=0;
                                }
                                
                            }else if(key_interval>0){
                                key_interval=key_interval-1;//カウントダウン
                            }

                            if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                                長押し阻止=0; 
                            }
                            ctx.drawImage(burakku_manga,0,0);
                            if(mini_stage==0){
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,810,-70+4*Math.sin(time*Math.PI/8));
                                
                                ctx.restore();
                            }else if(mini_stage==1){//クリアだ。おめでとう。
                                ctx.fillStyle="rgb(0,0,0,0.75)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(burakku_kuria,0,0);//変えること。ー－－－－－－－－－－－－－－－－－－－－－－－－－－
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillRect(50,700,900,250);

                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText("ステージ選択へ", 200, 930);
                                ctx.fillText("ツイート", 700, 930);

                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                                }else{
                                    ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                             
                                if(MAX_STAGE==3){
                                    初回クリアメッセージフラグ=1;
                                    MAX_STAGE=4;
                                    localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                                    MAX_TOP_ACE=2;
                                    localStorage.setItem('MAX_TOP_ACE',MAX_TOP_ACE);//ゲームデータセーブ
                                }
                                if(初回クリアメッセージフラグ==1){
                                    ctx.fillText("TOP_ACE設定可能数+1", 100, 780);
                                }
                            }
                        }else if(stage==4){//不浄の森
                            不浄の森();
                        }else if(stage==5){//しゅうくん狩り
                            if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                                key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                                for(let i=0;i<key_input.length;i++){
                                    if(key_input.charAt(i)=="↑"){
                                        if(mini_stage==1 || mini_stage==2){
                                            mini_stage=(mini_stage)%2+1;
                                        }else if(mini_stage==5 || mini_stage==6){
                                            mini_stage=(mini_stage)%2+5;
                                        }
                                    }else if(key_input.charAt(i)=="←"){
                                        if(mini_stage==8){//クリア画面
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="→"){
                                        if(mini_stage==8){//クリア画面
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="↓"){
                                        if(mini_stage==1 || mini_stage==2){
                                            mini_stage=(mini_stage)%2+1;
                                        }else if(mini_stage==5 || mini_stage==6){
                                            mini_stage=(mini_stage)%2+5;
                                        }
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(mini_stage==0){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=tizomenaihu_list;//使用デッキ
                                            teki_pull=3;//ドロー枚数
                                            next_mini_stage=1;//クリアできたらこれが使われるってことさ。
                                            drop_gold=300;//お金ー！
                                        }else if(mini_stage==1){
                                            mini_stage=3;
                                            特殊状態.push("体力");
                                            特殊状態.push(-10);
                                            my_stage_pull+=2;
                                        }else if(mini_stage==2){
                                            mini_stage=3;
                                            特殊状態.push("体力");
                                            特殊状態.push(20);
                                            if(my_deck_pull>=1){
                                                my_stage_pull-=1;
                                            }else{
                                                //まあもとから0枚なら奪うものもないよ
                                            }
                                            
                                        }else if(mini_stage==3){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=sabitayari_list;//使用デッキ
                                            teki_pull=3;//ドロー枚数
                                            next_mini_stage=4;//クリアできたらこれが使われるってことさ。
                                            drop_gold=500;//お金ー！
                                        }else if(mini_stage==4){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=hokaku_list;//使用デッキ
                                            teki_pull=3;//ドロー枚数
                                            next_mini_stage=5;//クリアできたらこれが使われるってことさ。
                                            drop_gold=500;//お金ー！
                                        }else if(mini_stage==5){
                                            mini_stage=7;
                                            特殊状態[1]-=25;
                                            特殊状態.push("攻撃");
                                            特殊状態.push(1);
                                        }else if(mini_stage==6){
                                            mini_stage=7;
                                            特殊状態[1]+=10;
                                            特殊状態.push("攻撃");
                                            特殊状態.push(-2);
                                        }else if(mini_stage==7){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=aooni_list;//使用デッキ
                                            teki_pull=1;//ドロー枚数
                                            next_mini_stage=8;//クリアできたらこれが使われるってことさ。
                                            drop_gold=1000;//お金ー！
                                        }else if(mini_stage==8){
                                            if(cursor2==0){
                                                初回クリアメッセージフラグ=0;
                                                next_phase="ステージ選択";
                                                演出カウント=1;
                                                cursor=3;
                                            }else{
                                                key_input="";//なんかこれないとボタン操作がいかれる
                                                URL_tweet_text="https://twitter.com/intent/tweet?text=ブラックしゅうくんを取り戻した！%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                                window.open( URL_tweet_text, '_blank'); 
                                            }
                                            
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }
                                    
                                }
                                if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                    key_input="";
                                    key_interval=0;
                                }
                                
                            }else if(key_interval>0){
                                key_interval=key_interval-1;//カウントダウン
                            }

                            if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                                長押し阻止=0; 
                            }
                            
                            ctx.drawImage(syuukungari,0,0);
                            if(mini_stage==0){
                                ctx.drawImage(yubi,440,850+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==1){
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,600,-120+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                                
                            }else if(mini_stage==2){
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,750,-100+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(mini_stage==3){
                                ctx.drawImage(yubi,100,520+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==4){
                                ctx.drawImage(yubi,410,400+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==5){
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,470,-700+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(mini_stage==6){
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,600,-700+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(mini_stage==7){
                                ctx.drawImage(yubi,750,350+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==8){//クリアだ。おめでとう。
                                ctx.fillStyle="rgb(0,0,0,0.75)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(syuukungari_kuria,0,0);
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillRect(50,700,900,250);

                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText("ステージ選択へ", 200, 930);
                                ctx.fillText("ツイート", 700, 930);

                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                                }else{
                                    ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                             
                                if(MAX_STAGE==5){
                                    初回クリアメッセージフラグ=1;
                                    MAX_STAGE=6;
                                    localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                                    
                                    カードゲット(burakkusyuukun);
                                    カードゲット(ikaribakuhatu);
                                    
                                }
                                if(初回クリアメッセージフラグ==1){
                                    ctx.fillText("・ブラックしゅうくん", 100, 780);
                                    ctx.fillText("・怒り爆発！   を手に入れた！", 100, 840);
                                }
                                
                            }
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(30,20,310,90);
                            
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(30,120,150,90);
                            ctx.scale(2, 2);
                            tokusyu_hyouji(20,20);
                            if(my_stage_pull!=0){
                                ctx.font = "32px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.drawImage(tehuda32,20,20+50);
                                if(my_stage_pull>0){
                                    ctx.fillText("+"+my_stage_pull, 20+35, 20+50+27,30);
                                }else{
                                    ctx.fillText(my_stage_pull, 20+35, 20+50+27,30);
                                }
                                
                            }
                            
                            ctx.scale(0.5, 0.5);
                        }else if(stage==6){//デッキ盗難
                            デッキ盗難();
                        }else if(stage==7){//へにゃもちんキングダム
                            if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                                key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                                for(let i=0;i<key_input.length;i++){
                                    if(key_input.charAt(i)=="↑"){
                                    }else if(key_input.charAt(i)=="←"){
                                        if(mini_stage==1){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="→"){
                                        if(mini_stage==1){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="↓"){
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(mini_stage==0){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=ou_list;//使用デッキ
                                            teki_pull=4;//ドロー枚数
                                            next_mini_stage=1;//クリアできたらこれが使われるってことさ。
                                            drop_gold=10000;//お金ー！
                                            
                                        }else if(mini_stage==1){
                                            if(cursor2==0){
                                                初回クリアメッセージフラグ=0;
                                                next_phase="ステージ選択";
                                                演出カウント=1;
                                                cursor=3;
                                            }else{
                                                key_input="";//なんかこれないとボタン操作がいかれる
                                                URL_tweet_text="https://twitter.com/intent/tweet?text=王に力を示した！%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                                window.open( URL_tweet_text, '_blank'); 
                                            }
                                            
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }
                                    
                                }
                                if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                    key_input="";
                                    key_interval=0;
                                }
                                
                            }else if(key_interval>0){
                                key_interval=key_interval-1;//カウントダウン
                            }

                            if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                                長押し阻止=0; 
                            }
                            ctx.drawImage(henyamotinkingudamu,0,0);
                            if(mini_stage==0){
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,810,-70+4*Math.sin(time*Math.PI/8));
                                
                                ctx.restore();
                            }else if(mini_stage==1){//クリアだ。おめでとう。
                                ctx.fillStyle="rgb(0,0,0,0.75)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(henyamotinkingudamu_kuria,0,0);//変えること。ー－－－－－－－－－－－－－－－－－－－－－－－－－－
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillRect(50,700,900,250);

                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText("ステージ選択へ", 200, 930);
                                ctx.fillText("ツイート", 700, 930);

                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                                }else{
                                    ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                             
                                if(MAX_STAGE==7){
                                    初回クリアメッセージフラグ=1;
                                    MAX_STAGE=8;
                                    localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                                    MAX_ACE=5;
                                    localStorage.setItem('MAX_ACE',MAX_ACE);//ゲームデータセーブ
                                }
                                if(初回クリアメッセージフラグ==1){
                                    ctx.fillText("ACE設定可能数+2", 100, 780);
                                }
                            }
                        }else if(stage==8){//天国
                            if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                                key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                                for(let i=0;i<key_input.length;i++){
                                    if(key_input.charAt(i)=="↑"){
                                    }else if(key_input.charAt(i)=="←"){
                                        if(mini_stage==6){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="→"){
                                        if(mini_stage==6){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="↓"){
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(mini_stage==0){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=pupu_list;//使用デッキ
                                            teki_pull=5;//ドロー枚数
                                            next_mini_stage=1;//クリアできたらこれが使われるってことさ。
                                            drop_gold=2000;//お金ー！
                                        }else if(mini_stage==1){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=hituji_list;//使用デッキ
                                            teki_pull=4;//ドロー枚数
                                            next_mini_stage=2;//クリアできたらこれが使われるってことさ。
                                            drop_gold=3000;//お金ー！
                                        }else if(mini_stage==2){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=ama_list;//使用デッキ
                                            teki_pull=4;//ドロー枚数
                                            next_mini_stage=3;//クリアできたらこれが使われるってことさ。
                                            drop_gold=4000;//お金ー！
                                        }else if(mini_stage==3){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=enjeru_list;//使用デッキ
                                            teki_pull=4;//ドロー枚数
                                            next_mini_stage=4;//クリアできたらこれが使われるってことさ。
                                            drop_gold=5000;//お金ー！
                                        }else if(mini_stage==4){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=deck_list;//使用デッキ
                                            teki_pull=4;//ドロー枚数
                                            next_mini_stage=5;//クリアできたらこれが使われるってことさ。
                                            drop_gold=10000;//お金ー！
                                        }else if(mini_stage==5){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=taihuu_list;//使用デッキ
                                            teki_pull=4;//ドロー枚数
                                            next_mini_stage=6;//クリアできたらこれが使われるってことさ。
                                            drop_gold=10000;//お金ー！
                                        }else if(mini_stage==6){
                                            if(cursor2==0){
                                                初回クリアメッセージフラグ=0;
                                                next_phase="ステージ選択";
                                                演出カウント=1;
                                                cursor=3;
                                            }else{
                                                key_input="";//なんかこれないとボタン操作がいかれる
                                                URL_tweet_text="https://twitter.com/intent/tweet?text=天国を抜けた…%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                                window.open( URL_tweet_text, '_blank'); 
                                            }
                                            
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }
                                    
                                }
                                if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                    key_input="";
                                    key_interval=0;
                                }
                                
                            }else if(key_interval>0){
                                key_interval=key_interval-1;//カウントダウン
                            }

                            if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                                長押し阻止=0; 
                            }
                            
                            ctx.drawImage(tengoku[5],-100,-100);
                            ctx.drawImage(tengoku[4],-100,-100+Math.sin(time*Math.PI/100)*20);

                            if(mini_stage==0){              
                                ctx.save();
                                ctx.scale(0.5,0.5);
                                ctx.drawImage(HPup5.image,750,1000+Math.sin(time*Math.PI/100)*50);
                                ctx.restore();
                                
                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[3],-100,-100+Math.sin(time*Math.PI/250)*30);

                                ctx.drawImage(ponya.image,450,450+Math.sin((time/100-1/2)*Math.PI)*50);

                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[2],-100,-100+Math.sin(time*Math.PI/250)*20);
                                
                                
                                ctx.save();
                                ctx.scale(2,2);
                                ctx.drawImage(powerup3.image,350,250+Math.cos(time*Math.PI/100)*50);
                                ctx.restore();

                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[1],-100,-100+Math.cos(time*Math.PI/500)*40);

                                ctx.drawImage(yubi,460,700+4*Math.sin(time*Math.PI/8));
                                ctx.drawImage(tengoku[0],-100,-100+Math.sin(time*Math.PI/250)*50);
                            }else if(mini_stage==1){              
                                ctx.save();
                                ctx.scale(0.5,0.5);
                                ctx.drawImage(kyuukoukasakusenki.image,950,1000+Math.sin(time*Math.PI/100)*50);
                                ctx.restore();
                                
                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[3],-100,-100+Math.sin(time*Math.PI/250)*30);

                                ctx.drawImage(kameisi.image,650,450+Math.sin((time/100-1/2)*Math.PI)*50);

                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[2],-100,-100+Math.sin(time*Math.PI/250)*20);
                                
                                
                                ctx.save();
                                ctx.scale(2,2);
                                ctx.drawImage(ponya_daburu.image,40,350+Math.cos(time*Math.PI/100)*50);
                                ctx.restore();

                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[1],-100,-100+Math.cos(time*Math.PI/500)*40);

                                ctx.drawImage(yubi,460,700+4*Math.sin(time*Math.PI/8));   
                                ctx.drawImage(tengoku[0],-100,-100+Math.sin(time*Math.PI/250)*50);                           
                            }else if(mini_stage==2){              
                                ctx.save();
                                ctx.scale(0.5,0.5);
                                ctx.drawImage(kyuusainote.image,1250,1200+Math.sin(time*Math.PI/100)*50);
                                ctx.restore();
                                
                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[3],-100,-100+Math.sin(time*Math.PI/250)*30);

                                ctx.drawImage(karamaruito.image,350,450+Math.sin((time/100-1/2)*Math.PI)*50);

                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[2],-100,-100+Math.sin(time*Math.PI/250)*20);
                                
                                
                                ctx.save();
                                ctx.scale(2,2);
                                ctx.drawImage(moukyodokudaitake.image,240,350+Math.cos(time*Math.PI/100)*50);
                                ctx.restore();

                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[1],-100,-100+Math.cos(time*Math.PI/500)*40);

                                ctx.drawImage(yubi,460,700+4*Math.sin(time*Math.PI/8));       
                                ctx.drawImage(tengoku[0],-100,-100+Math.sin(time*Math.PI/250)*50);
                            }else if(mini_stage==3){              
                                ctx.save();
                                ctx.scale(0.5,0.5);
                                ctx.drawImage(ou.image,1250,800+Math.sin(time*Math.PI/100)*50);
                                ctx.restore();
                                
                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[3],-100,-100+Math.sin(time*Math.PI/250)*30);

                                //ctx.drawImage(karamaruito.image,350,450+Math.sin((time/100-1/2)*Math.PI)*50);

                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[2],-100,-100+Math.sin(time*Math.PI/250)*20);
                                
                                
                                ctx.save();
                                ctx.scale(2,2);
                                ctx.drawImage(sabitayari.image,140,100+Math.cos(time*Math.PI/100)*50);
                                ctx.restore();

                                ctx.fillStyle="rgb(200,200,255,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[1],-100,-100+Math.cos(time*Math.PI/500)*40);

                                ctx.drawImage(yubi,460,700+4*Math.sin(time*Math.PI/8));   
                                ctx.drawImage(tengoku[0],-100,-100+Math.sin(time*Math.PI/250)*50);
                            }else if(mini_stage==4){              
                                //ctx.save();
                                //ctx.scale(0.5,0.5);
                                //ctx.drawImage(ou.image,1250,800+Math.sin(time*Math.PI/100)*50);
                                //ctx.restore();
                                
                                ctx.fillStyle="rgb(255,200,200,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[3],-100,-100+Math.sin(time*Math.PI/250)*30);

                                

                                ctx.fillStyle="rgb(255,200,200,0.3)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[2],-100,-100+Math.sin(time*Math.PI/250)*20);
                                
                                ctx.drawImage(syuukun.image,450,450+Math.sin((time/100-1/2)*Math.PI)*50);
                                //ctx.save();
                                //ctx.scale(2,2);
                                //ctx.drawImage(sabitayari.image,140,100+Math.cos(time*Math.PI/100)*50);
                                //ctx.restore();

                                ctx.fillStyle="rgb(255,200,200,0.4)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[1],-100,-100+Math.cos(time*Math.PI/500)*40);

                                ctx.drawImage(yubi,460,700+4*Math.sin(time*Math.PI/8));      
                                ctx.drawImage(tengoku[0],-100,-100+Math.sin(time*Math.PI/250)*50);
                            }else if(mini_stage==5){              
                                ctx.save();
                                ctx.scale(0.5,0.5);
                                ctx.drawImage(pantingukuraudo.image,650,1400+Math.sin(time*Math.PI/100)*50);
                                ctx.drawImage(happisukoru.image,850,1300+Math.sin(time*Math.PI/100+Math.PI)*50);
                                ctx.drawImage(daburukuraudo.image,750,1100+Math.cos(time*Math.PI/100)*50);
                                ctx.drawImage(biribirikuraudo.image,1250,1300+Math.cos(time*Math.PI/100+Math.PI)*50);
                                ctx.drawImage(poizunkuraudo.image,1150,900+Math.sin(time*Math.PI/100+Math.PI*3/2)*50);
                                ctx.restore();
                                
                                ctx.fillStyle="rgb(200,100,100,0.3)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[3],-100,-100+Math.sin(time*Math.PI/250)*30);

                                ctx.drawImage(taihuu0gou.image,450,450+Math.sin((time/100-1/2)*Math.PI)*50);

                                ctx.fillStyle="rgb(200,100,100,0.2)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[2],-100,-100+Math.sin(time*Math.PI/250)*20);
                                
                                
                                ctx.save();
                                ctx.scale(2,2);
                                ctx.drawImage(pupukuraudo.image,340,350+Math.cos(time*Math.PI/100)*50);
                                ctx.drawImage(hitujikuraudo.image,20,400+Math.sin(time*Math.PI/100)*50);
                                ctx.drawImage(amakuraudo.image,240,20+Math.cos(time*Math.PI/100+Math.PI/5)*50);
                                ctx.drawImage(enjerukuraudo.image,20,50+Math.sin(time*Math.PI/100+Math.PI)*50);
                                ctx.restore();

                                ctx.fillStyle="rgb(200,100,100,0.1)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku[1],-100,-100+Math.cos(time*Math.PI/500)*40);

                                ctx.drawImage(yubi,460,700+4*Math.sin(time*Math.PI/8));  
                                ctx.drawImage(tengoku[0],-100,-100+Math.sin(time*Math.PI/250)*50);
                            }else if(mini_stage==6){//クリアだ。おめでとう。
                                ctx.drawImage(tengoku[3],-100,-100+Math.sin(time*Math.PI/250)*30);
                                ctx.drawImage(tengoku[2],-100,-100+Math.sin(time*Math.PI/250)*30);
                                ctx.drawImage(tengoku[1],-100,-100+Math.sin(time*Math.PI/250)*30);
                                ctx.drawImage(tengoku[0],-100,-100+Math.sin(time*Math.PI/250)*50);
                                ctx.fillStyle="rgb(0,0,0,0.75)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(tengoku_kuria,0,0);//変えること。ー－－－－－－－－－－－－－－－－－－－－－－－－－－
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillRect(50,700,900,250);

                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText("ステージ選択へ", 200, 930);
                                ctx.fillText("ツイート", 700, 930);

                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                                }else{
                                    ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                             
                                if(MAX_STAGE==8){
                                    初回クリアメッセージフラグ=1;
                                    MAX_STAGE=9;
                                    localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                                }
                                if(初回クリアメッセージフラグ==1){
                                    //ctx.fillText("ACE設定可能数+2", 100, 780);
                                }
                            }
                        }else if(stage==9){//声源
                            if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                                key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                                for(let i=0;i<key_input.length;i++){
                                    if(key_input.charAt(i)=="↑"){
                                    }else if(key_input.charAt(i)=="←"){
                                        if(mini_stage==3){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="→"){
                                        if(mini_stage==3){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="↓"){
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(mini_stage==0){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=kyoumei_list;//使用デッキ
                                            teki_pull=4;//ドロー枚数
                                            next_mini_stage=1;//クリアできたらこれが使われるってことさ。
                                            drop_gold=8000;//お金ー！
                                        }else if(mini_stage==1){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=syukuniumu_list;//使用デッキ
                                            teki_pull=4;//ドロー枚数
                                            next_mini_stage=2;//クリアできたらこれが使われるってことさ。
                                            drop_gold=8000;//お金ー！
                                        }else if(mini_stage==2){
                                            next_phase="戦闘準備";
                                            演出カウント=1;
                                            teki_deck_list=pon_list;//使用デッキ
                                            teki_pull=4;//ドロー枚数
                                            next_mini_stage=3;//クリアできたらこれが使われるってことさ。
                                            drop_gold=8000;//お金ー！
                                        }else if(mini_stage==3){
                                            if(cursor2==0){
                                                初回クリアメッセージフラグ=0;
                                                next_phase="ステージ選択";
                                                演出カウント=1;
                                                cursor=3;
                                            }else{
                                                key_input="";//なんかこれないとボタン操作がいかれる
                                                URL_tweet_text="https://twitter.com/intent/tweet?text=ラスボスに「これ以上しゅうくんを増やすな」と言った！%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                                window.open( URL_tweet_text, '_blank'); 
                                            }
                                            
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }
                                    
                                }
                                if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                    key_input="";
                                    key_interval=0;
                                }
                                
                            }else if(key_interval>0){
                                key_interval=key_interval-1;//カウントダウン
                            }

                            if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                                長押し阻止=0; 
                            }
                            
                            if(mini_stage==0){
                                ctx.drawImage(seigen_1,0,0);
                                ctx.drawImage(yubi,430,770+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==1){
                                ctx.drawImage(seigen_2,0,0);
                                ctx.drawImage(yubi,430,870+4*Math.sin(time*Math.PI/8));
                            }else if(mini_stage==2){
                                ctx.drawImage(seigen_3,0,0);
                                ctx.drawImage(yubi,470,320);
                            }else if(mini_stage==3){//クリアだ。おめでとう。
                                ctx.fillStyle="rgb(0,0,0,0.75)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.drawImage(seigen_kuria,0,0);//変えること。ー－－－－－－－－－－－－－－－－－－－－－－－－－－
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillRect(50,700,900,250);

                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText("ステージ選択へ", 200, 930);
                                ctx.fillText("ツイート", 700, 930);

                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                                }else{
                                    ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                             
                                if(MAX_STAGE==9){
                                    MAX_STAGE=10;
                                    localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                                }
                                    ctx.fillText("あんたはすごい！", 100, 780);
                                
                            }   
                        }else if(stage==10){//END
                            if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                                key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                                for(let i=0;i<key_input.length;i++){
                                    if(key_input.charAt(i)=="↑"){
                                    }else if(key_input.charAt(i)=="←"){
                                        if(mini_stage==1){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="→"){
                                        if(mini_stage==1){
                                            cursor2=(cursor2+1)%2;
                                        }
                                    }else if(key_input.charAt(i)=="↓"){
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(mini_stage==0){

                                        }else if(mini_stage==1){
                                            if(cursor2==0){
                                                初回クリアメッセージフラグ=0;
                                                next_phase="ステージ選択";
                                                演出カウント=1;
                                                cursor=3;
                                            }else{
                                                key_input="";//なんかこれないとボタン操作がいかれる
                                                URL_tweet_text="https://twitter.com/intent/tweet?text=エンディングを見て感動の涙を流した！%0A%0A"+document.title+"%0A"+document.URL+"&hashtags=Syuukun_Card";//%0Aで改行
                                                window.open( URL_tweet_text, '_blank'); 
                                            }
                                            
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }
                                    
                                }
                                if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                    key_input="";
                                    key_interval=0;
                                }
                                
                            }else if(key_interval>0){
                                key_interval=key_interval-1;//カウントダウン
                            }

                            if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                                長押し阻止=0; 
                            }
                            
                            if(mini_stage==0 && 演出カウント==-1){                                
                                next_phase="戦闘準備";
                                演出カウント=1;
                                teki_deck_list=sutahhu_list;//使用デッキ
                                teki_pull=5;//ドロー枚数
                                next_mini_stage=1;//クリアできたらこれが使われるってことさ。
                                drop_gold=0;//お金ー！
                            }else if(mini_stage==1){//クリアだ。おめでとう。
                                ctx.fillStyle="rgb(0,0,0,0.75)";
                                ctx.fillRect(0,0,1000,1000);
                                //ctx.drawImage(seigen_kuria,0,0);//変えること。ー－－－－－－－－－－－－－－－－－－－－－－－－－－
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillRect(50,700,900,250);

                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText("ステージ選択へ", 200, 930);
                                ctx.fillText("ツイート", 700, 930);

                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,850,-190+4*Math.sin(time*Math.PI/8));
                                }else{
                                    ctx.drawImage(yubi,850,-690+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                             
                                if(MAX_STAGE==10){
                                    MAX_STAGE=11;
                                    localStorage.setItem('MAX_STAGE',MAX_STAGE);//ゲームデータセーブ
                                }
                                    ctx.fillText("クリア後ステージも…あるかも！？", 100, 780);
                                
                            } 
                        }else if(stage==11){//EX
                            EXステージ();
                        }
                        

                        if(演出カウント<0 && 演出カウント>-5){
                            演出カウント-=1;
                            ctx.fillStyle="rgb(50,50,50)";
                            ctx.fillRect(0,0,1000,1000+演出カウント*200);
                        }
                        if(演出カウント>0){
                            演出カウント+=1;
                            ctx.fillStyle="rgb(50,50,50)";
                            ctx.fillRect(0,0,1000,演出カウント*200);
                        }
                        if(演出カウント>5){
                            game_phase=next_phase;
                            mini_stage=next_mini_stage;
                            演出カウント=-1;
                        }
                    
                    }else if(game_phase=="お店準備"){
                        game_phase="お店";
                        sub_phase="基本";
                        cursor=0;
                        if(MAX_STAGE==2){
                            パック売るよ=0;
                        }else if(MAX_STAGE>=4 && MAX_STAGE<=6){
                            パック売るよ=1;
                        }else if(MAX_STAGE==7){
                            パック売るよ=4;
                        }else if(MAX_STAGE==8){
                            パック売るよ=5;
                        }else if(MAX_STAGE==9){
                            パック売るよ=6;
                        }else if(MAX_STAGE==10 ||MAX_STAGE==11){
                            パック売るよ=7;
                        }else if(MAX_STAGE==12){
                            パック売るよ=8;
                        }else{
                            パック売るよ=0;
                        }
                    }else if(game_phase=="お店"){
                        if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                            key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                            for(let i=0;i<key_input.length;i++){
                                if(key_input.charAt(i)=="↑"){
                                    if(sub_phase=="基本"){
                                        if(cursor!=0&& cursor!=1 && cursor!=2 &&cursor!=-1){
                                            cursor-=3;
                                        }else if(cursor!=-1){
                                            cursor=-1;
                                        }else{
                                            cursor=Math.floor(パック売るよ/3)*3;
                                        }
                                    }else if(sub_phase=="パック詳細"){
                                        if(cursor2<=2){
                                            購入数[cursor2]+=1;
                                            if(購入数[cursor2]==10){
                                                購入数[cursor2]=0;
                                            }
                                        }
                                    }
                                    
                                }else if(key_input.charAt(i)=="←"){
                                    if(sub_phase=="基本"){
                                        if(cursor==-1){
                                            cursor=パック売るよ;
                                        }else if(cursor!=0 && cursor!=3 && cursor!=6){
                                            cursor-=1;
                                        }else{
                                            if(cursor==パック売るよ){
                                                cursor=-1;
                                            }else{
                                                cursor+=2;
                                                if(cursor>パック売るよ){
                                                    cursor=パック売るよ;
                                                }
                                            }
                                        }
                                    }else if(sub_phase=="パック詳細"){
                                        if(cursor2!=0){
                                            cursor2-=1;
                                        }else{
                                            cursor2=4;
                                        }
                                    }else if(sub_phase=="ガチャ結果"){
                                        if(cursor2!=0){
                                            cursor2-=1;
                                        }else{
                                            cursor2=2;
                                        }
                                    }
                                    
                                }else if(key_input.charAt(i)=="→"){
                                    if(sub_phase=="基本"){
                                        if(cursor==-1){
                                            cursor=Math.floor(パック売るよ/3)*3;
                                        }else if(cursor!=2 && cursor!=5 && cursor!=8){
                                            if(cursor==パック売るよ && パック売るよ==Math.floor(パック売るよ/3)*3){
                                                cursor=-1;
                                            }else{
                                                cursor+=1;
                                                if(cursor>パック売るよ){
                                                    cursor=Math.floor(パック売るよ/3)*3;
                                                }
                                            }
                                            
                                        }else{
                                            cursor-=2;
                                        }
                                    }else if(sub_phase=="パック詳細"){
                                        if(cursor2!=4){
                                            cursor2+=1;
                                        }else{
                                            cursor2=0;
                                        }
                                    }else if(sub_phase=="ガチャ結果"){
                                        if(cursor2!=2){
                                            cursor2+=1;
                                        }else{
                                            cursor2=0;
                                        }
                                    }
                                }else if(key_input.charAt(i)=="↓"){
                                    if(sub_phase=="基本"){
                                        if(cursor==-1){
                                            cursor=0;
                                        }else if(cursor>=Math.floor(パック売るよ/3)*3 && cursor<=Math.floor(パック売るよ/3)*3+2){
                                            cursor=-1;
                                        }else{
                                            cursor+=3;
                                            if(cursor>パック売るよ){
                                                cursor=パック売るよ;
                                            }
                                        }

                                    }else if(sub_phase=="パック詳細"){
                                        if(cursor2<=2){
                                            購入数[cursor2]-=1;
                                            if(購入数[cursor2]==-1){
                                                購入数[cursor2]=9;
                                            }
                                        }
                                    }       
                                }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                    if(sub_phase=="基本"){
                                        if(cursor>=0 && cursor<=9){
                                            sub_phase="パック詳細";
                                            購入数=[0,0,0];
                                            cursor2=2;
                                        }else if(cursor==-1){
                                            演出カウント=1;
                                        }
                                        
                                    }else if(sub_phase=="パック詳細"){
                                        if(cursor2==3 && お金>=金額[cursor]*(購入数[0]*100+購入数[1]*10+購入数[2]) && 購入数[0]+購入数[1]+購入数[2]!=0){
                                            //購入！
                                            
                                            出てきたカード=[];
                                            if(cursor==0){
                                                for(i=0;i<3*(購入数[0]*100+購入数[1]*10+購入数[2]);i++){
                                                    出てきたカード[i]=ぽにゃパック[Math.floor(Math.random()*ぽにゃパック.length)];
                                                }
                                            }else if(cursor==1){
                                                for(i=0;i<3*(購入数[0]*100+購入数[1]*10+購入数[2]);i++){
                                                    出てきたカード[i]=上位召喚パック[Math.floor(Math.random()*上位召喚パック.length)];
                                                }
                                            }else if(cursor==2){
                                                for(i=0;i<3*(購入数[0]*100+購入数[1]*10+購入数[2]);i++){
                                                    出てきたカード[i]=雑魚パック[Math.floor(Math.random()*雑魚パック.length)];
                                                }
                                            }else if(cursor==3){
                                                for(i=0;i<3*(購入数[0]*100+購入数[1]*10+購入数[2]);i++){
                                                    出てきたカード[i]=魔法パック[Math.floor(Math.random()*魔法パック.length)];
                                                }
                                            }else if(cursor==4){
                                                for(i=0;i<3*(購入数[0]*100+購入数[1]*10+購入数[2]);i++){
                                                    出てきたカード[i]=強パック[Math.floor(Math.random()*強パック.length)];
                                                }
                                            }else if(cursor==5){
                                                for(i=0;i<3*(購入数[0]*100+購入数[1]*10+購入数[2]);i++){
                                                    出てきたカード[i]=娘パック[Math.floor(Math.random()*娘パック.length)];
                                                }
                                            }else if(cursor==6){
                                                for(i=0;i<3*(購入数[0]*100+購入数[1]*10+購入数[2]);i++){
                                                    出てきたカード[i]=娘パック2[Math.floor(Math.random()*娘パック2.length)];
                                                }
                                            }else if(cursor==7){
                                                for(i=0;i<3*(購入数[0]*100+購入数[1]*10+購入数[2]);i++){
                                                    出てきたカード[i]=あまりものパック[Math.floor(Math.random()*あまりものパック.length)];
                                                }
                                            }

                                            お金-=金額[cursor]*(購入数[0]*100+購入数[1]*10+購入数[2]);

                                            出てきたカード_ソート=[...出てきたカード];
                                            for(let i=0;i<出てきたカード_ソート.length;i++){
                                                for(let j=i+1;j<出てきたカード_ソート.length;j++){
                                                    if(出てきたカード_ソート[i]==出てきたカード_ソート[j]){
                                                        pre_カード=出てきたカード_ソート[i+1];
                                                        出てきたカード_ソート[i+1]=出てきたカード_ソート[j];
                                                        出てきたカード_ソート[j]=pre_カード;
                                                        break;
                                                    }
                                                }
                                            }


                                            for(let i=0;i<出てきたカード_ソート.length;i++){
                                                get_card={...出てきたカード_ソート[i]};
                                                new_card=0;
                                                カードインデックス=0;
                                                //カードゲット();…しないほうがいいか？いいか。うん、まあ、いいか
                                                for(let j=0;j<所持カード.length;j++){
                                                    if(所持カード[j][0].name==get_card.name){//持ってる？このカード
                                                        所持カード[j][1]+=1;
                                                        new_card=1;//このカード持ってたわ
                                                        カードインデックス=j;
                                                        break;
                                                    }
                                                }
                                                if(new_card==0){//新規カードだ！
                                                    カードインデックス=所持カード.length;
                                                    所持カード[所持カード.length]=[get_card,1];
                                                }
                                                if(i+1!=出てきたカード_ソート.length){
                                                    for(let k=i+1;k<出てきたカード_ソート.length;k++){
                                                        if(出てきたカード_ソート[i]==出てきたカード_ソート[k]){
                                                            所持カード[カードインデックス][1]+=1;
                                                            i+=1;
                                                        }else{
                                                            break;
                                                        }
                                                    }
                                                }
                                            }
                                            
                                        
                                            所持カードのセーブ();
                                            localStorage.setItem('お金',お金);
                                            sub_phase="ガチャ結果";
                                            cursor2=0;
                                            pre_cursor=0;

                                        }else if(cursor2==4){
                                            sub_phase="基本";
                                        }
                                    }else if(sub_phase=="ガチャ結果"){
                                        if(cursor2<=1){
                                            pre_cursor=cursor2;
                                        }else{
                                            sub_phase="基本";
                                        }
                                    }  
                                    長押し阻止=1;
                                }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                    if(sub_phase=="パック詳細"){
                                        sub_phase="基本";
                                    }else if(sub_phase=="ガチャ結果"){
                                        sub_phase="基本";
                                    }   
                                    長押し阻止=1;
                                }
                                
                            }
                            if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                key_input="";
                                key_interval=0;
                            }
                            
                        }else if(key_interval>0){
                            key_interval=key_interval-1;//カウントダウン
                        }

                        if(長押し阻止==1 && (key_input.indexOf("〇")==-1 && key_input.indexOf("×")==-1)){//〇×ボタンの長押し連打阻止。
                            長押し阻止=0; 
                        }

                        ctx.fillStyle="rgb(20,20,50)";
                        ctx.fillRect(0,0,1000,1000);
                        
                        
                        if(sub_phase=="基本"){
                            ctx.fillStyle="rgb(240,230,250)";
                            ctx.fillRect(20,20,700,910);
                            if(パック売るよ>=0){
                                パック陳列 (50,50,ponya_pack,cursor==0);
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText(金額[0], 130, 320);
                                ctx.drawImage(okane,90,290);
                            }
                            
                            if(パック売るよ>=1){
                                パック陳列 (300,50,jouisyoukanpakku,cursor==1);
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText(金額[1], 380, 320);
                                ctx.drawImage(okane,340,290);
                            }
                            
                            if(パック売るよ>=2){
                                パック陳列 (550,50,zakopakku,cursor==2);
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText(金額[2], 630, 320);
                                ctx.drawImage(okane,590,290);
                            }
                            
                            if(パック売るよ>=3){
                                パック陳列 (50,350,mahopakku,cursor==3);
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText(金額[3], 130, 620);
                                ctx.drawImage(okane,90,590);
                            }
                            
                            if(パック売るよ>=4){
                                パック陳列 (300,350,kyoupakku,cursor==4);
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText(金額[4], 380, 620);
                                ctx.drawImage(okane,340,590);
                            }
                            
                            if(パック売るよ>=5){
                                パック陳列 (550,350,musumepakku,cursor==5);
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText(金額[5], 630, 620);
                                ctx.drawImage(okane,590,590);
                            }
                            
                            if(パック売るよ>=6){
                                パック陳列 (50,650,musumepakku2,cursor==6);
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText(金額[6], 130, 920);
                                ctx.drawImage(okane,90,890);
                            }
                            
                            if(パック売るよ>=7){
                                パック陳列 (300,650,amarimonopakku,cursor==7);
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText(金額[7], 380, 920);
                                ctx.drawImage(okane,340,890);
                            }
                            
                            if(パック売るよ>=8){
                                パック陳列 (550,650,ponya_pack,cursor==8);
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText(金額[8], 630, 920);
                                ctx.drawImage(okane,590,890);
                            }
                            
                            ctx.fillStyle="rgb(240,230,250)";
                            ctx.fillRect(20,920,120,70);
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("戻る", 30, 970);
                        
                        
                            if(cursor==0){
                                ctx.drawImage(yubi,100,280+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==1){
                                ctx.drawImage(yubi,350,280+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==2){
                                ctx.drawImage(yubi,600,280+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==3){
                                ctx.drawImage(yubi,100,580+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==4){
                                ctx.drawImage(yubi,350,580+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==5){
                                ctx.drawImage(yubi,600,580+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==6){
                                ctx.drawImage(yubi,100,880+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==7){
                                ctx.drawImage(yubi,350,880+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==8){
                                ctx.drawImage(yubi,600,880+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==-1){
                                ctx.save();
                                ctx.rotate(270 * Math.PI / 180);
                                ctx.drawImage(yubi,-1020,120+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }
                        }else if(sub_phase=="パック詳細"){
                            ctx.fillStyle="rgb(240,230,250)";   
                            ctx.fillRect(20,20,900,260);    
                            ctx.fillRect(40,290,720,620);  
                            if(cursor==0){
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("ぽにゃ+魔法+機械パック", 200, 100);
                                カードパック(50,50,ponya_pack);
                                パックの中身(ぽにゃパック,50,300,700,600);
                            }else if(cursor==1){
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("上位召喚パック", 200, 100);
                                カードパック(50,50,jouisyoukanpakku);
                                パックの中身(上位召喚パック,50,300,700,600);
                            
                            }else if(cursor==2){
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("雑魚パック", 200, 100);
                                カードパック(50,50,zakopakku);
                                パックの中身(雑魚パック,50,300,700,600);
                            }else if(cursor==3){
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("魔法パック", 200, 100);
                                カードパック(50,50,mahopakku);
                                パックの中身(魔法パック,50,300,700,600);
                            }else if(cursor==4){
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("強パック", 200, 100);
                                カードパック(50,50,kyoupakku);
                                パックの中身(強パック,50,300,700,600);
                            }else if(cursor==5){
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("kawaiiパック・前半", 200, 100);
                                カードパック(50,50,musumepakku);
                                パックの中身(娘パック,50,300,700,600);
                            }else if(cursor==6){
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("kawaiiパック・後半", 200, 100);
                                カードパック(50,50,musumepakku2);
                                パックの中身(娘パック2,50,300,700,600);
                            }else if(cursor==7){
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("あまりものパック", 200, 100);
                                カードパック(50,50,amarimonopakku);
                                パックの中身(あまりものパック,50,300,700,600);
                            }

                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText(金額[cursor], 790, 100);//値段
                            ctx.drawImage(okane,750,70);
                            
                            
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("お会計", 800, 347);
                            ctx.fillText(金額[cursor]*(購入数[0]*100+購入数[1]*10+購入数[2]), 840, 400);//値段
                            ctx.drawImage(okane,800,370);

                            ctx.fillStyle="rgb(20,20,20)";   
                            ctx.fillRect(290,150,80,90);  
                            ctx.fillRect(390,150,80,90);  
                            ctx.fillRect(490,150,80,90);  
                            
                            ctx.fillText("3枚入り", 190, 270);

                            ctx.fillStyle="rgb(255,255,255)";   
                            ctx.fillRect(400,160,60,70);  
                            ctx.fillRect(300,160,60,70);  
                            ctx.fillRect(500,160,60,70);  
                            ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";                                
                            ctx.fillText("買う", 630, 250);
                            ctx.fillText("やめる", 750, 250);

                            ctx.font = "70px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText(購入数[0], 315, 220);
                            ctx.fillText(購入数[1], 415, 220);
                            ctx.fillText(購入数[2], 515, 220);
                            ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("▲", 310, 145);
                            ctx.fillText("▲", 410, 145);
                            ctx.fillText("▲", 510, 145);
                            ctx.fillText("▼", 310, 275);
                            ctx.fillText("▼", 410, 275);
                            ctx.fillText("▼", 510, 275);

                            if(お金<金額[cursor]*(購入数[0]*100+購入数[1]*10+購入数[2]) || 購入数[0]+購入数[1]+購入数[2]==0){
                                ctx.fillStyle="rgb(255,0,0)";   
                                ctx.fillRect(620,230,120,10);  
                            }
                            
                            if(cursor2==0){
                                ctx.drawImage(yubi,270,250+4*Math.sin(time*Math.PI/8));
                            }else if(cursor2==1){
                                ctx.drawImage(yubi,370,250+4*Math.sin(time*Math.PI/8));
                            }else if(cursor2==2){
                                ctx.drawImage(yubi,470,250+4*Math.sin(time*Math.PI/8));
                            }else if(cursor2==3){
                                ctx.drawImage(yubi,620,250+4*Math.sin(time*Math.PI/8));
                            }else if(cursor2==4){
                                ctx.drawImage(yubi,770,250+4*Math.sin(time*Math.PI/8));
                            }
                        }else if(sub_phase=="ガチャ結果"){
                            ctx.fillStyle="rgb(240,230,250)";   
                            ctx.fillRect(40,5,600,80);
                            ctx.fillRect(700,5,200,80);
                            ctx.fillRect(40,90,720,820); 

                            if(pre_cursor==0){
                                出てきたカードの中身(出てきたカード,50,100,700,800);
                            }else{
                                出てきたカードの中身(出てきたカード_ソート,50,100,700,800);
                            }
                            

                            ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";                                
                            ctx.fillText("表示:", 50, 80);
                            ctx.fillText("出た順", 200, 80);
                            ctx.fillText("ソート", 400, 80);
                            ctx.fillText("戻る", 750, 70);

                            if(cursor2==0){
                                ctx.drawImage(yubi,210,90+4*Math.sin(time*Math.PI/8));
                            }else if(cursor2==1){
                                ctx.drawImage(yubi,410,90+4*Math.sin(time*Math.PI/8));
                            }else if(cursor2==2){
                                ctx.drawImage(yubi,740,80+4*Math.sin(time*Math.PI/8));
                            }
                        }
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillText("所持金", 800, 467);
                        ctx.fillText(お金, 840, 520);
                        ctx.drawImage(okane,800,490);
                        ctx.drawImage(sakyura_omise,0,0);


                        ctx.fillStyle="rgb(50,50,50)";
                        if(演出カウント<0 && 演出カウント>-6){
                            演出カウント-=1;
                            ctx.fillRect(-演出カウント*200,0,1000+演出カウント*200,1000);
                        }

                        if(演出カウント>0){
                            演出カウント+=1;
                            ctx.fillRect(1000-演出カウント*200,0,演出カウント*200,1000);
                        }

                        if(演出カウント==6){
                            game_phase="ステージ選択";
                            演出カウント=-21;
                            cursor=4;
                        }

                    }else if(game_phase=="デッキ編集準備"){
                        編集中デッキ={card_list:[],ACE:[],TOP_ACE:[]};

                        カードカウント=0;
                        for(let i=0;i<deck_list.card_list.length;i++){
                            for(let j=0;j<deck_list.card_list[i][1];j++){
                                編集中デッキ.card_list[カードカウント]=deck_list.card_list[i][0];
                                カードカウント+=1;
                                
                            }
                        }
                                
                        
                        for(let i=0;i<deck_list.TOP_ACE.length;i++){//TOP_ACEの登録
                            カードインデックス=編集中デッキ.card_list.indexOf(deck_list.TOP_ACE[i]);
                            カードカウント=0;
                            for(let j=カードインデックス+1;j<編集中デッキ.card_list.length;j++){
                                if(編集中デッキ.card_list[j]==編集中デッキ.card_list[カードインデックス]){
                                    カードカウント+=1;
                                }else{
                                    break;
                                }
                                
                            }
                            編集中デッキ.TOP_ACE[i]=編集中デッキ.TOP_ACE.filter(function(TOP_index){
                                    return TOP_index>=カードインデックス && TOP_index<=カードインデックス+カードカウント;     //要素を一個ずつ見て、条件と一致するものを要素にもつ配列を生成する
                                }).length+カードインデックス;            
                            
                        }

                        カードカウント=0;//ACEの登録
                        pre_カード="";
                        for(let i=0;i<deck_list.ACE.length;i++){
                            if(deck_list.ACE[i]==pre_カード){
                                カードカウント+=1;
                                編集中デッキ.ACE[i]=編集中デッキ.card_list.indexOf(deck_list.ACE[i])+カードカウント;
                            }else{
                                カードカウント=0;
                                カードインデックス=deck_list.TOP_ACE.indexOf(deck_list.ACE[i]);
                                if(カードインデックス!=-1){//TOPにACEと同じカードあるじゃん
                                    for(let j=カードインデックス;j<deck_list.TOP_ACE.length;j++){
                                        if(deck_list.TOP_ACE[j]==deck_list.TOP_ACE[カードインデックス]){
                                            カードカウント+=1;
                                        }else{
                                            //break;怖いからやめとこ
                                        }
                                    }
                                }
                                編集中デッキ.ACE[i]=編集中デッキ.card_list.indexOf(deck_list.ACE[i])+カードカウント;
                            }
                            pre_カード=deck_list.ACE[i];
                        }
                        
                        編集中デッキ.ACE.sort(compare);
                        //編集中デッキ.TOP_ACE.sort(compare);
                        game_phase="デッキ編集";
                        sub_phase="基本";
                        scroll_x=0;
                        scroll_x2=0;
                        my_deck_pull_編集中=my_deck_pull;
                    }else if(game_phase=="デッキ編集"){

                        if(key_interval<=0 && key_input!=""){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                            key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                            for(let i=0;i<key_input.length;i++){
                                if(sub_phase=="基本"){
                                    if(key_input.charAt(i)=="↑"){
                                        if(cursor_y>0){
                                            cursor_y-=1;
                                        }
                                    }else if(key_input.charAt(i)=="←"){
                                        if(cursor_x>0){
                                            cursor_x-=1;
                                        }else if(cursor_y==0){
                                            if(scroll_x!=0){
                                                scroll_x-=1;
                                            }else{
                                                if(編集中デッキ.card_list.length-7>0){
                                                    scroll_x=編集中デッキ.card_list.length-7;
                                                }
                                                cursor_x=6;
                                            }
                                            
                                        }else if((cursor_y==1 || cursor_y==2)){
                                            if(scroll_x2!=0){
                                                scroll_x2-=1;
                                            }else{
                                                if(Math.ceil(所持カード.length/2)-7>0){
                                                    scroll_x2=Math.ceil(所持カード.length/2)-7;
                                                }
                                                cursor_x=6;
                                            }
                                            
                                        }
                                        
                                    }else if(key_input.charAt(i)=="→"){
                                        if(cursor_x<6){
                                            cursor_x+=1;
                                        }else if(cursor_y==0){
                                            if(scroll_x<編集中デッキ.card_list.length-7){
                                                scroll_x+=1;
                                            }else{
                                                scroll_x=0;
                                                cursor_x=0;
                                            }
                                            
                                        }else if((cursor_y==1 || cursor_y==2)){
                                            if(scroll_x2<所持カード.length/2-7){
                                                scroll_x2+=1;
                                            }else{
                                                scroll_x2=0;
                                                cursor_x=0;
                                            }
                                            
                                        }
                                        
                                    }else if(key_input.charAt(i)=="↓"){
                                        if(cursor_y<2){
                                            cursor_y+=1;
                                        }
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(syousai_card!=""){
                                            sub_phase="カード移動";
                                            if(編集中デッキ.card_list.indexOf(syousai_card)!=-1){
                                                scroll_x=編集中デッキ.card_list.indexOf(syousai_card);
                                            }else{
                                                scroll_x=編集中デッキ.card_list.length;
                                            }
                                            cursor2=0;
                                            これのデッキ枚数=0;
                                            これの所持枚数=0;
                                        }
                                        
                                        
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                        sub_phase="メニュー";
                                        cursor2=0;
                                    }
                                }else if(sub_phase=="カード移動"){//-----------------------------------------------
                                    if(key_input.charAt(i)=="↑"){
                                        cursor2=(cursor2+1)%2;
                                    }else if(key_input.charAt(i)=="←"){
                                    }else if(key_input.charAt(i)=="→"){
                                    }else if(key_input.charAt(i)=="↓"){
                                        cursor2=(cursor2+1)%2;
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(cursor2==0){
                                            if(これのデッキ枚数!=これの所持枚数){
                                                if(編集中デッキ.card_list.indexOf(syousai_card)!=-1){
                                                    カードインデックス=編集中デッキ.card_list.indexOf(syousai_card)+これのデッキ枚数;
                                                }else{
                                                    カードインデックス=編集中デッキ.card_list.length;
                                                }
                                                
                                                編集中デッキ.card_list.splice(カードインデックス,0,syousai_card);//追加
                                                
                                                for(let i=0;i<編集中デッキ.ACE.length;i++){
                                                    if(編集中デッキ.ACE[i]>=カードインデックス){
                                                        編集中デッキ.ACE[i]+=1;
                                                    }
                                                }
                                                for(let i=0;i<編集中デッキ.TOP_ACE.length;i++){
                                                    if(編集中デッキ.TOP_ACE[i]>=カードインデックス){
                                                        編集中デッキ.TOP_ACE[i]+=1;
                                                    }
                                                }
                                            }
                                        }else{
                                            if(これのデッキ枚数!=0){
                                                カードインデックス=編集中デッキ.card_list.indexOf(syousai_card)+これのデッキ枚数-1;
                                                編集中デッキ.card_list.splice(カードインデックス,1);//削除
                                                for(let i=0;i<編集中デッキ.ACE.length;i++){
                                                    if(編集中デッキ.ACE[i]>カードインデックス){
                                                        編集中デッキ.ACE[i]-=1;
                                                    }else if(編集中デッキ.ACE[i]==カードインデックス){
                                                        編集中デッキ.ACE.splice(i,1);//消しましょうね
                                                        i-=1;
                                                    }
                                                }
                                                for(let i=0;i<編集中デッキ.TOP_ACE.length;i++){
                                                    if(編集中デッキ.TOP_ACE[i]>カードインデックス){
                                                        編集中デッキ.TOP_ACE[i]-=1;
                                                    }else if(編集中デッキ.TOP_ACE[i]==カードインデックス){
                                                        編集中デッキ.TOP_ACE.splice(i,1);//消しましょうね
                                                        i-=1;
                                                    }
                                                }
                                            }
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                        sub_phase="基本";
                                    }
                                }else if(sub_phase=="メニュー"){
                                    if(key_input.charAt(i)=="↑"){
                                        cursor2-=1;
                                        if(cursor2==-1){
                                            cursor2=5;
                                        }
                                    }else if(key_input.charAt(i)=="←"){
                                        if(cursor2==3){
                                            if(my_deck_pull_編集中==0){
                                                my_deck_pull_編集中=my_pull;
                                            }else{
                                                my_deck_pull_編集中-=1;
                                            }
                                        }
                                    }else if(key_input.charAt(i)=="→"){
                                        if(cursor2==3){
                                            if(my_deck_pull_編集中==my_pull){
                                                my_deck_pull_編集中=0;
                                            }else{
                                                my_deck_pull_編集中+=1;
                                            }
                                        }
                                    }else if(key_input.charAt(i)=="↓"){
                                        cursor2+=1;
                                        if(cursor2==6){
                                            cursor2=0;
                                        }
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(cursor2==0){
                                            sub_phase="基本";
                                        }else if(cursor2==1){
                                            sub_phase="ACE編集";
                                            scroll_x2=0;
                                        }else if(cursor2==2){
                                            sub_phase="デッキリスト";
                                            cursor=1;
                                            cursor2=0;

                                        }else if(cursor2==3){
                                            
                                            //ないです。
                                            
                                        }else if(cursor2==4){
                                            if(MAX_deck>=編集中デッキ.card_list.length){
                                                sub_phase="保存確認";
                                            }else{
                                                sub_phase="枚数エラー";
                                            }
                                            cursor2=0;

                                        }else if(cursor2==5){
                                            sub_phase="保存しない";
                                            cursor2=0;
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                        sub_phase="基本";
                                    }
                                }else if(sub_phase=="保存確認" || sub_phase=="保存しない" || sub_phase=="枚数エラー" || sub_phase=="ACE保存確認" || sub_phase=="ACE保存しない" || sub_phase=="ACE枚数エラー"){
                                    if(key_input.charAt(i)=="↑"){
                                        cursor2=(cursor2+1)%2;
                                    }else if(key_input.charAt(i)=="←"){
                                    }else if(key_input.charAt(i)=="→"){
                                    }else if(key_input.charAt(i)=="↓"){
                                        cursor2=(cursor2+1)%2;
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(sub_phase=="保存確認" || sub_phase=="ACE保存確認"){//TOP_ACEの召喚順番をソートしちゃうのよくない気がするんだけど、でゆっちめんどくちゃいよ
                                            if(cursor2==0){
                                                編集中デッキ.ACE.sort(compare);
                                                //編集中デッキ.TOP_ACE.sort(compare);
                                                //同種カード内でのソートしてほしい
                                                編集中ACE=[];
                                                編集中TOP_ACE=[];

                                                for(let i=0;i<編集中デッキ.ACE.length;i++){
                                                    編集中ACE[i]=編集中デッキ.card_list[編集中デッキ.ACE[i]];
                                                }
                                                for(let i=0;i<編集中デッキ.TOP_ACE.length;i++){
                                                    編集中TOP_ACE[i]=編集中デッキ.card_list[編集中デッキ.TOP_ACE[i]];
                                                
                                                }
                                                deck_list.ACE=編集中ACE;
                                                deck_list.TOP_ACE=編集中TOP_ACE;
                                                
                                                カードカウント=1;
                                                pre_カード=編集中デッキ.card_list[0];
                                                deck_list.card_list=[];
                                                if(編集中デッキ.card_list.length!=0){
                                                    for(let i=1;i<編集中デッキ.card_list.length;i++){//一枚目とばそう
                                                        if(pre_カード==編集中デッキ.card_list[i]){
                                                            カードカウント+=1;
                                                        }else{
                                                            deck_list.card_list[deck_list.card_list.length]=[pre_カード,カードカウント];
                                                            pre_カード=編集中デッキ.card_list[i];
                                                            カードカウント=1;
                                                        }
                                                    }
                                                    deck_list.card_list[deck_list.card_list.length]=[pre_カード,カードカウント];//最後抜けてたｗ
                                                }
                                                my_deck_pull=my_deck_pull_編集中;
                                                localStorage.setItem('my_deck_pull',my_deck_pull);//ゲームデータセーブ
                                                デッキのセーブ();
                                                next_phase="ステージ選択";
                                                演出カウント=1;
                                            }else{
                                                if(sub_phase=="保存確認"){
                                                    sub_phase="基本";
                                                }else{
                                                    sub_phase="ACE編集";
                                                }
                                            }
                                        }else if(sub_phase=="保存しない" || sub_phase=="ACE保存しない"){
                                            if(cursor2==0){
                                                next_phase="ステージ選択";
                                                演出カウント=1;
                                            }else{
                                                if(sub_phase=="保存しない"){
                                                    sub_phase="基本";
                                                }else{
                                                    sub_phase="ACE編集";
                                                }
                                            }
                                        }else if(sub_phase=="枚数エラー"){
                                            sub_phase="基本";
                                        }else if(sub_phase=="ACE枚数エラー"){
                                            sub_phase="ACE編集";
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }
                                }else if(sub_phase=="ACE編集" || sub_phase=="deck選択" || sub_phase=="ACE選択" || sub_phase=="TOP_ACE選択"){
                                    if(key_input.charAt(i)=="↑"){
                                        if(cursor_y>0){
                                            cursor_y-=1;
                                        }
                                    }else if(key_input.charAt(i)=="←"){
                                        if(cursor_x>0){
                                            cursor_x-=1;
                                        }else if(cursor_y==0){
                                            if(scroll_x!=0){
                                                scroll_x-=1;
                                            }else{
                                                if(編集中デッキ.card_list.length-7>0){
                                                    scroll_x=編集中デッキ.card_list.length-7; 
                                                }
                                                cursor_x=6;
                                            }
                                            
                                        }else if((cursor_y==1 || cursor_y==2)){
                                            if(scroll_x2!=0){
                                                scroll_x2-=1;
                                            }else{
                                                if(Math.max(MAX_ACE,MAX_TOP_ACE)-7>0){
                                                    scroll_x2=Math.max(MAX_ACE,MAX_TOP_ACE)-7;
                                                }
                                                cursor_x=6;
                                            }
                                            
                                        }
                                        
                                    }else if(key_input.charAt(i)=="→"){
                                        if(cursor_x<6){
                                            cursor_x+=1;
                                        }else if(cursor_y==0){
                                            if(scroll_x<編集中デッキ.card_list.length-7){
                                                scroll_x+=1;
                                            }else{
                                                scroll_x=0;
                                                cursor_x=0;
                                            }
                                            
                                        }else if((cursor_y==1 || cursor_y==2)){
                                            if(scroll_x2<Math.max(MAX_ACE,MAX_TOP_ACE)-7){
                                                scroll_x2+=1;
                                            }else{
                                                scroll_x2=0;
                                                cursor_x=0;
                                            }
                                            
                                        }

                                    }else if(key_input.charAt(i)=="↓"){
                                        if(cursor_y<2){
                                            cursor_y+=1;
                                        }
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(sub_phase=="ACE編集" && 編集中デッキ.card_list.length!=0){
                                            if(cursor_y==0 && syousai_card!=""){
                                                カードスワップ=cursor_x+scroll_x;
                                                sub_phase="deck選択";
                                            }else if(cursor_y==1 &&  MAX_ACE>cursor_x+scroll_x2){
                                                カードスワップ=cursor_x+scroll_x2;
                                                sub_phase="ACE選択";
                                            }else if(cursor_y==2 &&  MAX_TOP_ACE>cursor_x+scroll_x2){
                                                カードスワップ=cursor_x+scroll_x2;
                                                sub_phase="TOP_ACE選択";
                                            }
                                        }else if(sub_phase=="deck選択"){
                                            if(cursor_y==0){
                                                if(カードスワップ==(cursor_x+scroll_x)){//同じカードを選択…解除？キャンセルか？
                                                    if(編集中デッキ.ACE.indexOf(カードスワップ)!=-1){
                                                        編集中デッキ.ACE.splice(編集中デッキ.ACE.indexOf(カードスワップ),1);//消しましょうね
                                                        //消したらソートしたくない？→全体編集後でいいよ
                                                    }else if(編集中デッキ.TOP_ACE.indexOf(カードスワップ)!=-1){
                                                        編集中デッキ.TOP_ACE.splice(編集中デッキ.TOP_ACE.indexOf(カードスワップ),1);//消しましょうね
                                                    }
                                                    カードスワップ=0;
                                                    sub_phase="ACE編集";
                                                }
                                            }else if(cursor_y==1){
                                                if(MAX_ACE>cursor_x+scroll_x2){
                                                    if(編集中デッキ.ACE.length>cursor_x+scroll_x2){
                                                        pre_カード=編集中デッキ.ACE[cursor_x+scroll_x2];
                                                        if(編集中デッキ.ACE.indexOf(カードスワップ)!=-1){//ACE - ACE
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                        }else if(編集中デッキ.TOP_ACE.indexOf(カードスワップ)!=-1){//TOP - ACE
                                                            編集中デッキ.ACE[cursor_x+scroll_x2]=カードスワップ;
                                                            編集中デッキ.TOP_ACE[編集中デッキ.TOP_ACE.indexOf(カードスワップ)]=pre_カード;
                                                            
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                        }else{//NULL -ACE
                                                            編集中デッキ.ACE[cursor_x+scroll_x2]=カードスワップ;
                                                            
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";

                                                        }
                                                    }else{//ACEのあいてるところだね
                                                        if(編集中デッキ.ACE.indexOf(カードスワップ)!=-1){//ACE - ACE
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                        }else if(編集中デッキ.TOP_ACE.indexOf(カードスワップ)!=-1){//TOP - ACE
                                                            編集中デッキ.ACE.push(カードスワップ);
                                                            編集中デッキ.TOP_ACE.splice(編集中デッキ.TOP_ACE.indexOf(カードスワップ),1);//消しましょうね
                                                            
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                        }else{//NULL -ACE
                                                            編集中デッキ.ACE.push(カードスワップ);
                                                            
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";

                                                        }
                                                    }
                                                }
                                            }else if(cursor_y==2){
                                                if(MAX_TOP_ACE>cursor_x+scroll_x2){
                                                    if(編集中デッキ.TOP_ACE.length>cursor_x+scroll_x2){
                                                        pre_カード=編集中デッキ.TOP_ACE[cursor_x+scroll_x2];
                                                        if(編集中デッキ.ACE.indexOf(カードスワップ)!=-1){//ACE - TOP
                                                            編集中デッキ.TOP_ACE[cursor_x+scroll_x2]=カードスワップ;
                                                            編集中デッキ.ACE[編集中デッキ.ACE.indexOf(カードスワップ)]=pre_カード;

                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                        }else if(編集中デッキ.TOP_ACE.indexOf(カードスワップ)!=-1){//TOP - TOP
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                        }else{//NULL - TOP
                                                            編集中デッキ.TOP_ACE[cursor_x+scroll_x2]=カードスワップ;
                                                            
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";

                                                        }
                                                    }else{//TOP_ACEのあいてるところだね
                                                        if(編集中デッキ.ACE.indexOf(カードスワップ)!=-1){//ACE - TOP
                                                            
                                                            編集中デッキ.TOP_ACE.push(カードスワップ);
                                                            編集中デッキ.ACE.splice(編集中デッキ.ACE.indexOf(カードスワップ),1);//消しましょうね
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                        }else if(編集中デッキ.TOP_ACE.indexOf(カードスワップ)!=-1){//TOP - TOP
                                                            
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                        }else{//NULL - TOP
                                                            編集中デッキ.TOP_ACE.push(カードスワップ);
                                                            
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";

                                                        }
                                                    }
                                                }
                                            }
                                        }else if(sub_phase=="ACE選択"){
                                            if(編集中デッキ.ACE.length>カードスワップ){
                                                if(cursor_y==0  && syousai_card!=""){
                                                    if(編集中デッキ.ACE.indexOf(cursor_x+scroll_x)!=-1){//ACE - ACE
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }else if(編集中デッキ.TOP_ACE.indexOf(cursor_x+scroll_x)!=-1){//TOP - ACE
                                                        
                                                        pre_カード=cursor_x+scroll_x;
                                                        カードスワップ=編集中デッキ.ACE[カードスワップ];
                                                        
                                                        編集中デッキ.TOP_ACE[編集中デッキ.TOP_ACE.indexOf(pre_カード)]=カードスワップ;
                                                        編集中デッキ.ACE[編集中デッキ.ACE.indexOf(カードスワップ)]=pre_カード;


                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }else{//NULL -ACE
                                                        pre_カード=cursor_x+scroll_x;
                                                        
                                                        編集中デッキ.ACE[カードスワップ]=pre_カード;
                                                        

                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";

                                                    }
                                                }else if(cursor_y==1){
                                                    if(カードスワップ==(cursor_x+scroll_x2)){//同じカードを選択…解除！
                                                        編集中デッキ.ACE.splice(cursor_x+scroll_x2,1);//消しましょうね
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }
                                                }else if(cursor_y==2){
                                                    if(MAX_TOP_ACE>cursor_x+scroll_x2){
                                                        if(編集中デッキ.TOP_ACE.length>cursor_x+scroll_x2){//ACE - TOP 
                                                            pre_カード=編集中デッキ.TOP_ACE[cursor_x+scroll_x2];
                                                            カードスワップ=編集中デッキ.ACE[カードスワップ];
                                                            
                                                            編集中デッキ.TOP_ACE[cursor_x+scroll_x2]=カードスワップ;
                                                            編集中デッキ.ACE[編集中デッキ.ACE.indexOf(カードスワップ)]=pre_カード;

                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                            
                                                        }else{//TOP_ACEのあいてるところだね//ACE - TOP
                                                            カードスワップ=編集中デッキ.ACE[カードスワップ];
                                                            編集中デッキ.TOP_ACE.push(カードスワップ);
                                                            編集中デッキ.ACE.splice(編集中デッキ.ACE.indexOf(カードスワップ),1);//消しましょうね
                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                            
                                                        }
                                                    }
                                                }
                                            }else{//これACEの選択場所がNULLだ！
                                                if(cursor_y==0  && syousai_card!=""){
                                                    if(編集中デッキ.ACE.indexOf(cursor_x+scroll_x)!=-1){//ACE - ACE
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }else if(編集中デッキ.TOP_ACE.indexOf(cursor_x+scroll_x)!=-1){//TOP - ACE
                                                        
                                                        pre_カード=cursor_x+scroll_x;
                                                        
                                                        編集中デッキ.TOP_ACE.splice(編集中デッキ.TOP_ACE.indexOf(pre_カード),1);//消しましょうね
                                                        編集中デッキ.ACE.push(pre_カード);


                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }else{//NULL -ACE
                                                        pre_カード=cursor_x+scroll_x;
                                                        
                                                        編集中デッキ.ACE.push(pre_カード);
                                                        

                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";

                                                    }
                                                }else if(cursor_y==1 && MAX_ACE>cursor_x+scroll_x2){//キャンセル？
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                }else if(cursor_y==2 && MAX_TOP_ACE>cursor_x+scroll_x2){
                                                    if(編集中デッキ.TOP_ACE.length>cursor_x+scroll_x2){//ACE - TOP 
                                                        pre_カード=編集中デッキ.TOP_ACE[cursor_x+scroll_x2];
                                                        
                                                        編集中デッキ.ACE.push(pre_カード);

                                                        編集中デッキ.TOP_ACE.splice(cursor_x+scroll_x2,1);//消しましょうね
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                        
                                                    }else{//キャンセル？
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }
                                                }
                                            }
                                            
                                        }else if(sub_phase=="TOP_ACE選択"){
                                            if(編集中デッキ.TOP_ACE.length>カードスワップ){
                                                if(cursor_y==0 && syousai_card!=""){
                                                    if(編集中デッキ.ACE.indexOf(cursor_x+scroll_x)!=-1){//ACE - TOP
                                                        pre_カード=cursor_x+scroll_x;
                                                        カードスワップ=編集中デッキ.TOP_ACE[カードスワップ];
                                                        
                                                        編集中デッキ.ACE[編集中デッキ.ACE.indexOf(pre_カード)]=カードスワップ;
                                                        編集中デッキ.TOP_ACE[編集中デッキ.TOP_ACE.indexOf(カードスワップ)]=pre_カード;

                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }else if(編集中デッキ.TOP_ACE.indexOf(cursor_x+scroll_x)!=-1){//TOP - TOP
                                                        
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }else{//NULL - TOP
                                                        pre_カード=cursor_x+scroll_x;
                                                        
                                                        編集中デッキ.TOP_ACE[カードスワップ]=pre_カード;
                                                        

                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";

                                                    }
                                                }else if(cursor_y==1  && MAX_ACE>cursor_x+scroll_x2){
                                                    if(編集中デッキ.ACE.length>cursor_x+scroll_x2){//ACE - TOP 
                                                        pre_カード=編集中デッキ.ACE[cursor_x+scroll_x2];
                                                        カードスワップ=編集中デッキ.TOP_ACE[カードスワップ];
                                                        
                                                        編集中デッキ.ACE[cursor_x+scroll_x2]=カードスワップ;
                                                        編集中デッキ.TOP_ACE[編集中デッキ.TOP_ACE.indexOf(カードスワップ)]=pre_カード;

                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                        
                                                    }else{//ACEのあいてるところだね//ACE - TOP
                                                        カードスワップ=編集中デッキ.TOP_ACE[カードスワップ];
                                                        編集中デッキ.ACE.push(カードスワップ);
                                                        編集中デッキ.TOP_ACE.splice(編集中デッキ.TOP_ACE.indexOf(カードスワップ),1);//消しましょうね
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                        
                                                    }
                                                }else if(cursor_y==2 && MAX_TOP_ACE>cursor_x+scroll_x2){
                                                    if(カードスワップ==(cursor_x+scroll_x2)){//同じカードを選択…解除！
                                                        編集中デッキ.TOP_ACE.splice(cursor_x+scroll_x2,1);//消しましょうね
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }else{//スワップしちゃうのです！
                                                        if(編集中デッキ.TOP_ACE.length>cursor_x+scroll_x2){//ACE - TOP 
                                                            pre_カード=編集中デッキ.TOP_ACE[cursor_x+scroll_x2];
                                                        
                                                            カードスワップ_カード=編集中デッキ.TOP_ACE[カードスワップ];
                                                            
                                                            編集中デッキ.TOP_ACE[cursor_x+scroll_x2]=カードスワップ_カード;
                                                            編集中デッキ.TOP_ACE[カードスワップ]=pre_カード;

                                                            カードスワップ=0;
                                                            sub_phase="ACE編集";
                                                            
                                                        }else{//あいてるところだね
                                                            
                                                        }
                                                        
                                                    }
                                                    
                                                }
                                            }else{//これTOP_ACEの選択場所がNULLだ！
                                                if(cursor_y==0 && syousai_card!=""){
                                                    if(編集中デッキ.ACE.indexOf(cursor_x+scroll_x)!=-1){//ACE - TOP
                                                        pre_カード=cursor_x+scroll_x;
                                                        
                                                        編集中デッキ.ACE.splice(編集中デッキ.ACE.indexOf(pre_カード),1);//消しましょうね
                                                        編集中デッキ.TOP_ACE.push(pre_カード);

                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }else if(編集中デッキ.TOP_ACE.indexOf(cursor_x+scroll_x)!=-1){//TOP - TOP
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }else{//NULL - TOP
                                                        pre_カード=cursor_x+scroll_x;
                                                        
                                                        編集中デッキ.TOP_ACE.push(pre_カード);
                                                        

                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";

                                                    }
                                                }else if(cursor_y==1 && MAX_ACE>cursor_x+scroll_x2){
                                                    if(編集中デッキ.ACE.length>cursor_x+scroll_x2){//ACE - TOP 
                                                        pre_カード=編集中デッキ.ACE[cursor_x+scroll_x2];
                                                        
                                                        編集中デッキ.TOP_ACE.push(pre_カード);

                                                        編集中デッキ.ACE.splice(cursor_x+scroll_x2,1);//消しましょうね
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                        
                                                    }else{//キャンセル？
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    }
                                                }else if(cursor_y==2 && MAX_TOP_ACE>cursor_x+scroll_x2){//キャンセル？
                                                        カードスワップ=0;
                                                        sub_phase="ACE編集";
                                                    
                                                }
                                            }
                                            
                                        }

                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if( sub_phase=="deck選択" || sub_phase=="ACE選択" || sub_phase=="TOP_ACE選択"){
                                            カードスワップ=0;
                                            sub_phase="ACE編集";
                                        }else if(sub_phase=="ACE編集"){
                                            cursor2=1;
                                            sub_phase="ACEメニュー";
                                        }
                                    }
                                }else if(sub_phase=="ACEメニュー"){
                                    if(key_input.charAt(i)=="↑"){
                                        cursor2-=1;
                                        if(cursor2==-1){
                                            cursor2=5;
                                        }
                                    }else if(key_input.charAt(i)=="←"){
                                    }else if(key_input.charAt(i)=="→"){
                                    }else if(key_input.charAt(i)=="↓"){
                                        cursor2+=1;
                                        if(cursor2==6){
                                            cursor2=0;
                                        }
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                        if(cursor2==0){
                                            編集中デッキ.ACE.sort(compare);
                                            //編集中デッキ.TOP_ACE.sort(compare);
                                            //同種カード内でのソートしてほしい
                                            編集中ACE=[];
                                            編集中TOP_ACE=[];

                                            for(let i=0;i<編集中デッキ.ACE.length;i++){
                                                編集中ACE[i]=編集中デッキ.card_list[編集中デッキ.ACE[i]];
                                            }
                                            for(let i=0;i<編集中デッキ.TOP_ACE.length;i++){
                                                編集中TOP_ACE[i]=編集中デッキ.card_list[編集中デッキ.TOP_ACE[i]];
                                            
                                            }

                                            編集中デッキ.ACE=[];
                                            編集中デッキ.TOP_ACE=[];

                                            for(let i=0;i<編集中TOP_ACE.length;i++){//TOP_ACEの登録
                                                カードインデックス=編集中デッキ.card_list.indexOf(編集中TOP_ACE[i]);
                                                カードカウント=0;
                                                for(let j=カードインデックス+1;j<編集中デッキ.card_list.length;j++){
                                                    if(編集中デッキ.card_list[j]==編集中デッキ.card_list[カードインデックス]){
                                                        カードカウント+=1;
                                                    }else{
                                                        break;
                                                    }
                                                    
                                                }
                                                編集中デッキ.TOP_ACE[i]=編集中デッキ.TOP_ACE.filter(function(TOP_index){
                                                        return TOP_index>=カードインデックス && TOP_index<=カードインデックス+カードカウント;     //要素を一個ずつ見て、条件と一致するものを要素にもつ配列を生成する
                                                    }).length+カードインデックス;            
                                                
                                            }

                                            カードカウント=0;//ACEの登録
                                            pre_カード="";
                                            for(let i=0;i<編集中ACE.length;i++){
                                                if(編集中ACE[i]==pre_カード){
                                                    カードカウント+=1;
                                                    編集中デッキ.ACE[i]=編集中デッキ.card_list.indexOf(編集中ACE[i])+カードカウント;
                                                }else{
                                                    カードカウント=0;
                                                    カードインデックス=編集中TOP_ACE.indexOf(編集中ACE[i]);
                                                    if(カードインデックス!=-1){//TOPにACEと同じカードあるじゃん
                                                        for(let j=カードインデックス;j<編集中TOP_ACE.length;j++){
                                                            if(編集中TOP_ACE[j]==編集中TOP_ACE[カードインデックス]){
                                                                カードカウント+=1;
                                                            }else{
                                                                //break;怖いからやめとこ
                                                            }
                                                        }
                                                    }
                                                    編集中デッキ.ACE[i]=編集中デッキ.card_list.indexOf(編集中ACE[i])+カードカウント;
                                                }
                                                pre_カード=編集中ACE[i];
                                            }
                                            sub_phase="基本";
                                            scroll_x2=0;
                                        }else if(cursor2==1){
                                            
                                            sub_phase="ACE編集";
                                            scroll_x2=0;
                                        }else if(cursor2==2){
                                            編集中デッキ.ACE.sort(compare);
                                            編集中デッキ.TOP_ACE.sort(compare);
                                            //同種カード内でのソートしてほしい
                                            編集中ACE=[];
                                            編集中TOP_ACE=[];

                                            for(let i=0;i<編集中デッキ.ACE.length;i++){
                                                編集中ACE[i]=編集中デッキ.card_list[編集中デッキ.ACE[i]];
                                            }
                                            for(let i=0;i<編集中デッキ.TOP_ACE.length;i++){
                                                編集中TOP_ACE[i]=編集中デッキ.card_list[編集中デッキ.TOP_ACE[i]];
                                            
                                            }

                                            編集中デッキ.ACE=[];
                                            編集中デッキ.TOP_ACE=[];

                                            カードカウント=0;//TOP_ACEの登録
                                            pre_カード="";
                                            for(let i=0;i<編集中TOP_ACE.length;i++){
                                                if(編集中TOP_ACE[i]==pre_カード){
                                                    カードカウント+=1;
                                                    編集中デッキ.TOP_ACE[i]=編集中デッキ.card_list.indexOf(編集中TOP_ACE[i])+カードカウント;
                                                }else{
                                                    編集中デッキ.TOP_ACE[i]=編集中デッキ.card_list.indexOf(編集中TOP_ACE[i]);
                                                    カードカウント=0;
                                                }
                                                pre_カード=編集中TOP_ACE[i];
                                            }

                                            カードカウント=0;//ACEの登録
                                            pre_カード="";
                                            for(let i=0;i<編集中ACE.length;i++){
                                                if(編集中ACE[i]==pre_カード){
                                                    カードカウント+=1;
                                                    編集中デッキ.ACE[i]=編集中デッキ.card_list.indexOf(編集中ACE[i])+カードカウント;
                                                }else{
                                                    カードカウント=0;
                                                    カードインデックス=編集中TOP_ACE.indexOf(編集中ACE[i]);
                                                    if(カードインデックス!=-1){//TOPにACEと同じカードあるじゃん
                                                        for(let j=カードインデックス;j<編集中TOP_ACE.length;j++){
                                                            if(編集中TOP_ACE[j]==編集中TOP_ACE[カードインデックス]){
                                                                カードカウント+=1;
                                                            }else{
                                                                //break;怖いからやめとこ
                                                            }
                                                        }
                                                    }
                                                    編集中デッキ.ACE[i]=編集中デッキ.card_list.indexOf(編集中ACE[i])+カードカウント;
                                                }
                                                pre_カード=編集中ACE[i];
                                            }


                                            sub_phase="ACE編集";
                                            scroll_x2=0;
                                        }else if(cursor2==3){
                                            sub_phase="デッキリスト";
                                            cursor=1;
                                            cursor2=0;

                                        }else if(cursor2==4){
                                            
                                            if(MAX_deck>=編集中デッキ.card_list.length){
                                                sub_phase="ACE保存確認";
                                            }else{
                                                sub_phase="ACE枚数エラー";
                                            }
                                            cursor2=0;
                                        }else if(cursor2==5){
                                            sub_phase="ACE保存しない";
                                            cursor2=0;
                                        }
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                        sub_phase="ACE編集";
                                    }
                                }else if(sub_phase=="デッキリスト"){
                                    if(key_input.charAt(i)=="↑"){
                                        if(cursor!=0){
                                            cursor-=1;
                                        }
                                    }else if(key_input.charAt(i)=="←"){
                                        if(cursor==1){
                                            cursor2-=1;
                                            if(cursor2==-1){
                                                cursor2=9;
                                            }
                                        }
                                    }else if(key_input.charAt(i)=="→"){
                                        if(cursor==1){
                                            cursor2+=1;
                                            if(cursor2==10){
                                                cursor2=0;
                                            }
                                        }
                                    }else if(key_input.charAt(i)=="↓"){
                                        if(cursor!=2){
                                            cursor+=1;
                                        }
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        if(cursor==0){
                                            保存デッキ[cursor2].card_list=[...編集中デッキ.card_list];//値渡し…もっといい方法ねえのか？
                                            保存デッキ[cursor2].ACE=[...編集中デッキ.ACE];
                                            保存デッキ[cursor2].TOP_ACE=[...編集中デッキ.TOP_ACE];
                                            保存デッキの保存();
                                        }else if(cursor==2){
                                            編集中デッキ.card_list=[...保存デッキ[cursor2].card_list];//値渡し…もっといい方法ねえのか？
                                            編集中デッキ.ACE=[...保存デッキ[cursor2].ACE];
                                            編集中デッキ.TOP_ACE=[...保存デッキ[cursor2].TOP_ACE];
                                            sub_phase="基本";
                                            scroll_x=0;
                                        }
                                        長押し阻止=1;
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        sub_phase="基本";
                                        長押し阻止=1;
                                    }
                                }else{
                                    if(key_input.charAt(i)=="↑"){
                                    }else if(key_input.charAt(i)=="←"){
                                    }else if(key_input.charAt(i)=="→"){
                                    }else if(key_input.charAt(i)=="↓"){
                                    }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }else if(key_input.charAt(i)=="×" && 長押し阻止==0){
                                        長押し阻止=1;
                                    }
                                }
                                
                            }
                            if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                key_input="";
                                key_interval=0;
                            }
                            
                        }else if(key_interval>0){
                            key_interval=key_interval-1;//カウントダウン
                        }

                        if(長押し阻止==1 && ( key_input.indexOf("×")==-1)){//×ボタンの長押し連打阻止。
                            長押し阻止=0; 
                        }


                        ctx.fillStyle="rgb(50,50,80)";
                        ctx.fillRect(0,0,1000,1000);

                        if(sub_phase=="基本" || sub_phase=="カード移動" || sub_phase=="メニュー" || sub_phase=="保存確認" || sub_phase=="保存しない" || sub_phase=="枚数エラー"){
                            //カード表示
                            for(let i=0;i<9;i++){
                                ctx.fillStyle="rgb(200,200,200)";
                                if((i+scroll_x-1)>=0 && (i+scroll_x-1)<編集中デッキ.card_list.length){
                                    ctx.fillRect(-130+140*i,10,140,220);
                                    ctx.drawImage(編集中デッキ.card_list[i+scroll_x-1].image,-125+140*i,20);
                                    if(編集中デッキ.TOP_ACE.indexOf(i+scroll_x-1)!=-1){
                                        ctx.fillStyle="rgb(255,0,0)";
                                        ctx.fillRect(-125+140*i-2,20,5,200);
                                        ctx.fillRect(-125+140*i+128,20,5,200);
                                        ctx.fillRect(-125+140*i,20,133,5);
                                        ctx.fillRect(-125+140*i,20+195,133,5);
                                    }
                                    if(編集中デッキ.ACE.indexOf(i+scroll_x-1)!=-1){
                                        ctx.fillStyle="rgb(255,255,0)";
                                        ctx.fillRect(-125+140*i-2,20,5,200);
                                        ctx.fillRect(-125+140*i+128,20,5,200);
                                        ctx.fillRect(-125+140*i,20,133,5);
                                        ctx.fillRect(-125+140*i,20+195,133,5);
                                    }
                                } 
                            }

                            ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            for(let i=0;i<14;i++){
                                if(i<所持カード.length-scroll_x2*2){
                                    if(i%2==0){
                                        ctx.drawImage(所持カード[i+scroll_x2*2][0].image,10+140*(i/2),320);
                                        if(所持カード[i+scroll_x2*2][0].state.indexOf("魔法")!=-1){//魔法じゃん）
                                            ctx.fillStyle="rgb(0,200,0)";   
                                            ctx.fillRect(10+140*(i/2),320+145,133,45);
                                            ctx.fillStyle="rgb(255,255,255)";
                                            ctx.fillText("魔法",10+140*(i/2) , 500);
                                        }else{
                                            ctx.fillStyle="rgb(150,50,0)";  
                                            ctx.fillRect(10+140*(i/2),320+145,133,45);
                                        }
                                        
                                        
                                        カードインデックス=編集中デッキ.card_list.indexOf(所持カード[i+scroll_x2*2][0]);
                                        if(カードインデックス!=-1){
                                            カードカウント=0;
                                            for(let j=カードインデックス;j<編集中デッキ.card_list.length;j++){
                                                if(編集中デッキ.card_list[j]==編集中デッキ.card_list[カードインデックス]){
                                                    カードカウント+=1;
                                                }else{
                                                    break;
                                                }
                                            }
                                            
                                            ctx.fillStyle="rgb(0,0,0)";
                                            ctx.fillRect(90+140*(i/2),420,50,50);
                                            ctx.fillStyle="rgb(255,255,255)";
                                            ctx.fillRect(95+140*(i/2),425,40,40);
                                            ctx.fillStyle="rgb(100,0,0)";
                                            if(カードカウント<10){
                                                ctx.fillText(カードカウント, 105+140*(i/2), 460,40);
                                            }else{
                                                ctx.fillText(カードカウント, 95+140*(i/2), 460,40);
                                            }
                                            
                                        }
                                        ctx.fillStyle="rgb(0,0,0)";
                                        ctx.fillRect(90+140*(i/2),470,50,50);
                                        ctx.fillStyle="rgb(155,155,205)";
                                        ctx.fillRect(95+140*(i/2),475,40,40);
                                        ctx.fillStyle="rgb(255,255,255)";
                                        if(所持カード[i+scroll_x2*2][1]<10){
                                            ctx.fillText(所持カード[i+scroll_x2*2][1], 105+140*(i/2), 510,40);
                                        }else{
                                            ctx.fillText(所持カード[i+scroll_x2*2][1], 95+140*(i/2), 510,40);
                                        }
                                    }else{
                                        ctx.drawImage(所持カード[i+scroll_x2*2][0].image,10+140*((i-1)/2),530);
                                        if(所持カード[i+scroll_x2*2][0].state.indexOf("魔法")!=-1){//魔法じゃん）
                                            ctx.fillStyle="rgb(0,200,0)";   
                                            ctx.fillRect(10+140*((i-1)/2),530+145,133,45);
                                            ctx.fillStyle="rgb(255,255,255)";
                                            ctx.fillText("魔法",10+140*((i-1)/2) , 710);
                                        }else{
                                            ctx.fillStyle="rgb(150,50,0)";  
                                            ctx.fillRect(10+140*((i-1)/2),530+145,133,45);
                                        }
                                        
                                        カードインデックス=編集中デッキ.card_list.indexOf(所持カード[i+scroll_x2*2][0]);
                                        if(カードインデックス!=-1){
                                            カードカウント=0;
                                            for(let j=カードインデックス;j<編集中デッキ.card_list.length;j++){
                                                if(編集中デッキ.card_list[j]==編集中デッキ.card_list[カードインデックス]){
                                                    カードカウント+=1;
                                                }else{
                                                    break;
                                                }
                                            }
                                            
                                            ctx.fillStyle="rgb(0,0,0)";
                                            ctx.fillRect(90+140*((i-1)/2),630,50,50);
                                            ctx.fillStyle="rgb(255,255,255)";
                                            ctx.fillRect(95+140*((i-1)/2),635,40,40);
                                            ctx.fillStyle="rgb(100,0,0)";
                                            if(カードカウント<10){
                                                ctx.fillText(カードカウント, 105+140*((i-1)/2), 670,40);
                                            }else{
                                                ctx.fillText(カードカウント, 95+140*((i-1)/2), 670,40);
                                            }
                                        }
                                        ctx.fillStyle="rgb(0,0,0)";
                                        ctx.fillRect(90+140*((i-1)/2),680,50,50);
                                        ctx.fillStyle="rgb(155,155,205)";
                                        ctx.fillRect(95+140*((i-1)/2),685,40,40);
                                        ctx.fillStyle="rgb(255,255,255)";
                                        if(所持カード[i+scroll_x2*2][1]<10){
                                            ctx.fillText(所持カード[i+scroll_x2*2][1], 105+140*((i-1)/2), 720,40);
                                        }else{
                                            ctx.fillText(所持カード[i+scroll_x2*2][1], 95+140*((i-1)/2), 720,40);
                                        }
                                    }
                                }
                            }

                            ctx.drawImage(yamahuda,5,250);
                            ctx.fillStyle="rgb(200,200,200)";
                            ctx.fillRect(80,250,400,60);
                            ctx.fillRect(520,245,450,70);
                            ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText(編集中デッキ.card_list.length+"枚(最大"+MAX_deck+"枚)", 100, 300);
                            ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("○：カード移動　×：メニュー", 530, 275);
                            
                            ctx.fillText("ACE:"+編集中デッキ.ACE.length+"/"+MAX_ACE+"枚　TOP_ACE:"+編集中デッキ.TOP_ACE.length+"/"+MAX_TOP_ACE+"枚", 530, 310);

                            //  スクロール？
                            ctx.fillStyle="rgb(100,100,100)";
                            ctx.fillRect(50,225,900,20);
                            ctx.fillRect(50,725,900,20);

                            ctx.fillStyle="rgb(255,255,255)";
                            
                            if(編集中デッキ.card_list.length>7){
                                ctx.fillRect(60+680*(scroll_x/(編集中デッキ.card_list.length-7)),227,200,16);
                            }else{
                                ctx.fillRect(60,227,880,16);
                            }
                            if(所持カード.length>14){
                                ctx.fillRect(60+680*(scroll_x2/( Math.ceil(所持カード.length/2)-7)),727,200,16);
                            }else{
                                ctx.fillRect(60,727,880,16);
                            }
                            

                            //  カーソル
                            if(cursor_y==0){
                                ctx.drawImage(yubi,20+cursor_x*140,150+4*Math.sin(time*Math.PI/8));
                            }else if(cursor_y==1){
                                ctx.drawImage(yubi,20+cursor_x*140,480+4*Math.sin(time*Math.PI/8));
                            }else if(cursor_y==2){
                                ctx.drawImage(yubi,20+cursor_x*140,690+4*Math.sin(time*Math.PI/8));
                            }
                            


                            
                            ctx.fillStyle="rgb(100,100,130)";
                            ctx.fillRect(0,740,1000,260);
                            ctx.fillStyle="rgb(55,55,55)";//詳細表示─
                            ctx.fillRect(5,745,990,250);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(10,750,980,240);
                            ctx.fillStyle="rgb(55,55,55)";
                            ctx.fillRect(550,755,5,230);
                            if(sub_phase=="基本"){
                                if(cursor_y==0){
                                    if(cursor_x+scroll_x<編集中デッキ.card_list.length){
                                        syousai_card=編集中デッキ.card_list[cursor_x+scroll_x];
                                    }else{
                                        syousai_card="";
                                    }
                                    
                                }else if(cursor_y==1 || cursor_y==2){
                                    if(cursor_x*2+cursor_y+scroll_x2*2-1<所持カード.length){
                                        syousai_card=所持カード[cursor_x*2+cursor_y+scroll_x2*2-1][0];
                                    }else{
                                        syousai_card="";
                                    }
                                }
                            }
                            
                            if(syousai_card!=""){
                                ctx.fillStyle="rgb(200,200,200)";
                                ctx.fillRect(15,755,490,50);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText(syousai_card.name, 20, 798,480);
                                

                                if(syousai_card.state.indexOf("モンスター")!=-1){
                                    ctx.drawImage(atk_plate,560,760);
                                    ctx.drawImage(def_plate,610,765);
                                    ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                    ctx.fillStyle="rgb(255,255,255)";
                                    if(syousai_card.ATK<10){
                                        ctx.fillText(syousai_card.ATK, 574, 802,42);
                                    }else{
                                        ctx.fillText(syousai_card.ATK, 564, 802,42);
                                    }
                                    if(syousai_card.HP<10){
                                        ctx.fillText(syousai_card.HP, 624, 802,42);
                                    }else{
                                        ctx.fillText(syousai_card.HP, 614, 802,42);
                                    }
                                }
                                ctx.fillStyle="rgb(0,0,0)";
                                text_kaigyou_hyouji(syousai_card.text, 20, 810,520,180,40,syousai_card.text_iro);//x,yは左上指定だから注意だ！
                            
                                syousai_state_color=[];
                                syousai_state="分類:";
                                for(let i=0;i<syousai_card.state.length;i++){
                                    if(syousai_card.state[i]=="TOP_ACE"){
                                        syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,7,"rgb(255,0,0)"];
                                    }else if(syousai_card.state[i]=="ACE"){
                                        syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,3,"rgb(200,200,0)"];
                                    }else if(syousai_card.state[i]=="毒:"){
                                        syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,1,"rgb(200,0,200)"];//デッキ編集画面で毒になるやつ何者だよ
                                    }else if(syousai_card.state[i]=="防御:"){
                                        syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,2,"rgb(0,0,200)"];
                                    }
                                    syousai_state+=" "+syousai_card.state[i];
                                }
                                text_kaigyou_hyouji(syousai_state, 560, 810,420,180,40,syousai_state_color);//x,yは左上指定だから注意だ！
                                
                                カードインデックス=編集中デッキ.card_list.indexOf(syousai_card);
                                カードカウント=0;
                                if(カードインデックス!=-1){
                                    カードインデックス
                                    for(let i=カードインデックス;i<編集中デッキ.card_list.length;i++){
                                        if(編集中デッキ.card_list[i]==編集中デッキ.card_list[カードインデックス]){
                                            カードカウント+=1;
                                        }else{
                                            break;
                                        }
                                    }
                                }
                                for(let i=0;i<所持カード.length;i++){
                                    if(所持カード[i][0]==syousai_card){
                                        ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                        ctx.fillStyle="rgb(0,0,0)";
                                        ctx.fillText("デッキ："+カードカウント+"枚", 695, 780);
                                        ctx.fillText("所持："+所持カード[i][1]+"枚", 700, 810);
                                        break;
                                    }
                                }
                            }
                            if(sub_phase=="カード移動"){//---------------------------------
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                ctx.fillRect(0,250,1000,490);

                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillRect(90,490,150,220);
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillRect(98,498,134,204);
                                ctx.drawImage(syousai_card.image,100,500);

                                

                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillRect(300,300,600,400);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText("デッキに入れる", 400, 370);
                                ctx.fillText("デッキからはずす", 400, 600);
                                ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                カードインデックス=編集中デッキ.card_list.indexOf(syousai_card);
                                カードカウント=0;
                                if(カードインデックス!=-1){
                                    カードインデックス
                                    for(let i=カードインデックス;i<編集中デッキ.card_list.length;i++){
                                        if(編集中デッキ.card_list[i]==編集中デッキ.card_list[カードインデックス]){
                                            カードカウント+=1;
                                        }else{
                                            break;
                                        }
                                    }
                                }
                                for(let i=0;i<所持カード.length;i++){
                                    if(所持カード[i][0]==syousai_card){
                                        ctx.fillText("デッキ："+カードカウント+"枚", 550, 450);
                                        ctx.fillText("所持："+所持カード[i][1]+"枚", 550, 500);
                                        これのデッキ枚数=カードカウント;
                                        これの所持枚数=所持カード[i][1];
                                        break;
                                    }
                                }
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("×：戻る", 750, 690);
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,290,-390+4*Math.sin(time*Math.PI/8));
                                }else{
                                    ctx.drawImage(yubi,520,-390+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                            }else if(sub_phase=="メニュー"){//---------------------------------
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillText("デッキ編集に戻る", 400, 200);
                                ctx.fillText("ACE編集", 400, 300);
                                ctx.fillText("デッキリスト", 400, 500);
                                ctx.fillText("ドロー枚数:", 400, 600);
                                ctx.fillText("◀ "+my_deck_pull_編集中+" ▶", 700, 600);
                                ctx.fillText("保存して終了", 400, 800);
                                ctx.fillText("保存せず終了", 400, 900);
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("×：戻る", 750, 950);

                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,120,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==1){
                                    ctx.drawImage(yubi,220,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==2){
                                    ctx.drawImage(yubi,420,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==3){
                                    ctx.drawImage(yubi,520,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==4){
                                    ctx.drawImage(yubi,720,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==5){
                                    ctx.drawImage(yubi,820,-390+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                            }else if(sub_phase=="保存確認"){
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillText("保存して終了", 400, 200);
                                ctx.fillText("デッキ編集に戻る", 400, 300);
                                
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,120,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==1){
                                    ctx.drawImage(yubi,220,-390+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                            }else if(sub_phase=="保存しない"){
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillText("保存しないの？", 300, 200);
                                ctx.fillText("しないよ", 400, 300);
                                ctx.fillText("デッキ編集に戻る", 400, 400);
                                
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,220,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==1){
                                    ctx.drawImage(yubi,320,-390+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                                
                            }else if(sub_phase=="枚数エラー"){
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillText("デッキ枚数多すぎ！", 300, 200);
                                ctx.fillText("はい", 400, 300);
                                ctx.fillText("はい", 400, 400);
                                
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,220,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==1){
                                    ctx.drawImage(yubi,320,-390+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                                
                            }


                        }else if(sub_phase=="ACE編集" || sub_phase=="deck選択" || sub_phase=="ACE選択" || sub_phase=="TOP_ACE選択" || sub_phase=="ACEメニュー" || sub_phase=="ACE保存確認" || sub_phase=="ACE保存しない" || sub_phase=="ACE枚数エラー"){
                            //カード表示
                            for(let i=0;i<9;i++){
                                ctx.fillStyle="rgb(200,200,200)";
                                if((i+scroll_x-1)>=0 && (i+scroll_x-1)<編集中デッキ.card_list.length){
                                    ctx.fillRect(-130+140*i,10,140,220);
                                    ctx.drawImage(編集中デッキ.card_list[i+scroll_x-1].image,-125+140*i,20);
                                    if(編集中デッキ.TOP_ACE.indexOf(i+scroll_x-1)!=-1){
                                        ctx.fillStyle="rgb(255,0,0)";
                                        ctx.fillRect(-125+140*i-2,20,5,200);
                                        ctx.fillRect(-125+140*i+128,20,5,200);
                                        ctx.fillRect(-125+140*i,20,133,5);
                                        ctx.fillRect(-125+140*i,20+195,133,5);
                                    }
                                    if(編集中デッキ.ACE.indexOf(i+scroll_x-1)!=-1){
                                        ctx.fillStyle="rgb(255,255,0)";
                                        ctx.fillRect(-125+140*i-2,20,5,200);
                                        ctx.fillRect(-125+140*i+128,20,5,200);
                                        ctx.fillRect(-125+140*i,20,133,5);
                                        ctx.fillRect(-125+140*i,20+195,133,5);
                                    }
                                } 
                            }

                            ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            for(let i=-1;i<8;i++){
                                if((i+scroll_x2)>=0 && (i+scroll_x2)<MAX_ACE){
                                    ctx.fillStyle="rgb(255,255,0)";
                                    ctx.fillRect(6+140*i,316,138,208);
                                    if(編集中デッキ.ACE.length>(i+scroll_x2)){
                                        ctx.drawImage(編集中デッキ.card_list[編集中デッキ.ACE[i+scroll_x2]].image,10+140*(i),320);
                                    }else{
                                        ctx.fillStyle="rgb(50,50,80)";
                                        ctx.fillRect(10+140*i,320,130,200);
                                    }
                                }
                                
                            }
                            for(let i=-1;i<8;i++){
                                if((i+scroll_x2)>=0 && (i+scroll_x2)<MAX_TOP_ACE){
                                    ctx.fillStyle="rgb(255,0,0)";
                                    ctx.fillRect(6+140*i,526,138,208);
                                    if(編集中デッキ.TOP_ACE.length>(i+scroll_x2)){
                                        ctx.drawImage(編集中デッキ.card_list[編集中デッキ.TOP_ACE[i+scroll_x2]].image,10+140*(i),530);
                                    }else{
                                        ctx.fillStyle="rgb(50,50,80)";
                                        ctx.fillRect(10+140*i,530,130,200);
                                    }
                                }
                            }


                            ctx.drawImage(yamahuda,5,250);
                            ctx.fillStyle="rgb(200,200,200)";
                            ctx.fillRect(80,250,400,60);
                            ctx.fillRect(520,245,450,70);
                            ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText(編集中デッキ.card_list.length+"枚(最大"+MAX_deck+"枚)", 100, 300);
                            ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("○：カード移動　×：メニュー", 530, 275);
                            
                            ctx.fillText("ACE:"+編集中デッキ.ACE.length+"/"+MAX_ACE+"枚　TOP_ACE:"+編集中デッキ.TOP_ACE.length+"/"+MAX_TOP_ACE+"枚", 530, 310);

                            //  スクロール？
                            ctx.fillStyle="rgb(100,100,100)";
                            ctx.fillRect(50,225,900,20);
                            ctx.fillRect(50,725,900,20);

                            ctx.fillStyle="rgb(255,255,255)";
                            
                            if(編集中デッキ.card_list.length>7){
                                ctx.fillRect(60+680*(scroll_x/(編集中デッキ.card_list.length-7)),227,200,16);
                            }else{
                                ctx.fillRect(60,227,880,16);
                            }
                            if(MAX_ACE>7 || MAX_TOP_ACE>7){
                                ctx.fillRect(60+680*(scroll_x2/( Math.ceil(Math.max(MAX_ACE,MAX_TOP_ACE))-7)),727,200,16);
                            }else{
                                ctx.fillRect(60,727,880,16);
                            }
                            

                            //  カーソル
                            if(cursor_y==0){
                                ctx.drawImage(yubi,20+cursor_x*140,150+4*Math.sin(time*Math.PI/8));
                            }else if(cursor_y==1){
                                ctx.drawImage(yubi,20+cursor_x*140,480+4*Math.sin(time*Math.PI/8));
                            }else if(cursor_y==2){
                                ctx.drawImage(yubi,20+cursor_x*140,690+4*Math.sin(time*Math.PI/8));
                            }

                            ctx.fillStyle="rgb(100,100,130)";
                            ctx.fillRect(0,740,1000,260);
                            ctx.fillStyle="rgb(55,55,55)";//詳細表示─
                            ctx.fillRect(5,745,990,250);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(10,750,980,240);
                            ctx.fillStyle="rgb(55,55,55)";
                            ctx.fillRect(550,755,5,230);
                            if(cursor_y==0){
                                if(cursor_x+scroll_x<編集中デッキ.card_list.length){
                                    syousai_card=編集中デッキ.card_list[cursor_x+scroll_x];
                                }else{
                                    syousai_card="";
                                }
                                
                            }else if(cursor_y==1){
                                if(scroll_x2+cursor_x<編集中デッキ.ACE.length){
                                    syousai_card=編集中デッキ.card_list[編集中デッキ.ACE[cursor_x+scroll_x2]];
                                }else{
                                    syousai_card="";
                                }
                            }else if(cursor_y==2){
                                if(scroll_x2+cursor_x<編集中デッキ.TOP_ACE.length){
                                    syousai_card=編集中デッキ.card_list[編集中デッキ.TOP_ACE[cursor_x+scroll_x2]];
                                }else{
                                    syousai_card="";
                                }
                            }
                            
                            
                            if(syousai_card!=""){
                                ctx.fillStyle="rgb(200,200,200)";
                                ctx.fillRect(15,755,490,50);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(0,0,0)";
                                ctx.fillText(syousai_card.name, 20, 798,480);
                                

                                if(syousai_card.state.indexOf("モンスター")!=-1){
                                    ctx.drawImage(atk_plate,560,760);
                                    ctx.drawImage(def_plate,610,765);
                                    ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                    ctx.fillStyle="rgb(255,255,255)";
                                    if(syousai_card.ATK<10){
                                        ctx.fillText(syousai_card.ATK, 574, 802,42);
                                    }else{
                                        ctx.fillText(syousai_card.ATK, 564, 802,42);
                                    }
                                    if(syousai_card.HP<10){
                                        ctx.fillText(syousai_card.HP, 624, 802,42);
                                    }else{
                                        ctx.fillText(syousai_card.HP, 614, 802,42);
                                    }
                                }
                                ctx.fillStyle="rgb(0,0,0)";
                                text_kaigyou_hyouji(syousai_card.text, 20, 810,520,180,40,syousai_card.text_iro);//x,yは左上指定だから注意だ！
                            
                                syousai_state_color=[];
                                syousai_state="分類:";
                                for(let i=0;i<syousai_card.state.length;i++){
                                    if(syousai_card.state[i]=="TOP_ACE"){
                                        syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,7,"rgb(255,0,0)"];
                                    }else if(syousai_card.state[i]=="ACE"){
                                        syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,3,"rgb(200,200,0)"];
                                    }else if(syousai_card.state[i]=="毒:"){
                                        syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,1,"rgb(200,0,200)"];
                                    }else if(syousai_card.state[i]=="防御:"){
                                        syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,2,"rgb(0,0,200)"];
                                    }
                                    syousai_state+=" "+syousai_card.state[i];
                                }
                                text_kaigyou_hyouji(syousai_state, 560, 810,420,180,40,syousai_state_color);//x,yは左上指定だから注意だ！
                                
                                カードインデックス=編集中デッキ.card_list.indexOf(syousai_card);
                                カードカウント=0;
                                if(カードインデックス!=-1){
                                    カードインデックス
                                    for(let i=カードインデックス;i<編集中デッキ.card_list.length;i++){
                                        if(編集中デッキ.card_list[i]==編集中デッキ.card_list[カードインデックス]){
                                            カードカウント+=1;
                                        }else{
                                            break;
                                        }
                                    }
                                }
                                for(let i=0;i<所持カード.length;i++){
                                    if(所持カード[i][0]==syousai_card){
                                        ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                        ctx.fillStyle="rgb(0,0,0)";
                                        ctx.fillText("デッキ："+カードカウント+"枚", 695, 780);
                                        ctx.fillText("所持："+所持カード[i][1]+"枚", 700, 810);
                                        break;
                                    }
                                }
                            }
                            if(sub_phase=="deck選択"){
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                if((scroll_x+7)<カードスワップ || scroll_x-1>カードスワップ){
                                    ctx.fillRect(0,0,1000,250);
                                }else if(scroll_x-1==カードスワップ){//左端にちょっとはみ出てる うげ！なんかきもいけどこれが単純明快な実装なのでヨシ
                                    ctx.fillRect(10,0,990,250);
                                }else{
                                    ctx.fillRect(0,0,10+140*(カードスワップ-scroll_x),250);
                                    ctx.fillRect(10+140*(カードスワップ-scroll_x+1),0,1000,250);
                                }
                                    
                                
                            }else if(sub_phase=="ACE選択"){
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                if((scroll_x2+7)<カードスワップ || scroll_x2-1>カードスワップ){
                                    ctx.fillRect(0,315,1000,210);
                                }else if(scroll_x2-1==カードスワップ){//左端にちょっとはみ出てる うげ！なんかきもいけどこれが単純明快な実装なのでヨシ
                                    ctx.fillRect(5,315,995,210);
                                }else{
                                    ctx.fillRect(0,315,5+140*(カードスワップ-scroll_x2),210);
                                    ctx.fillRect(5+140*(カードスワップ-scroll_x2+1),315,1000,210);
                                }

                            }else if(sub_phase=="TOP_ACE選択"){
                                ctx.fillStyle="rgb(0,0,0,0.3)";
                                
                                ctx.fillRect(0,315,1000,210);
                                ctx.fillRect(0,0,1000,250);

                                if((scroll_x2+7)<カードスワップ || scroll_x2-1>カードスワップ){//選択した物が画面外
                                    ctx.fillRect(0,525,1000,210);
                                }else{
                                    
                                    if(編集中デッキ.TOP_ACE.length>カードスワップ){
                                        ctx.fillRect(0,525,1000,210);
                                        ctx.fillStyle="rgb(0,0,0,0.8)";
                                        ctx.fillRect(6+140*(カードスワップ-scroll_x2),525,138,201);
                                        ctx.fillStyle="rgb(255,0,0)";
                                        ctx.fillRect(6+140*(カードスワップ-scroll_x2),526-50,138,208);
                                        ctx.drawImage(編集中デッキ.card_list[編集中デッキ.TOP_ACE[カードスワップ]].image,10+140*(カードスワップ-scroll_x2),530-50);
                                    }else{
                                        ctx.fillRect(0,525,5+140*(カードスワップ-scroll_x2),220);
                                        ctx.fillRect(5+140*(カードスワップ-scroll_x2+1),525,1000,220);
                                    }
                                    
                                    
                                }
                            }else if(sub_phase=="ACEメニュー"){//---------------------------------
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillText("デッキ編集に戻る", 400, 200);
                                ctx.fillText("ACE編集", 400, 300);
                                ctx.fillText("ACEをソート", 400, 500);
                                ctx.fillText("デッキリスト", 400, 600);
                                ctx.fillText("保存して終了", 400, 800);
                                ctx.fillText("保存せず終了", 400, 900);
                                ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("×：戻る", 750, 950);

                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,120,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==1){
                                    ctx.drawImage(yubi,220,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==2){
                                    ctx.drawImage(yubi,420,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==3){
                                    ctx.drawImage(yubi,520,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==4){
                                    ctx.drawImage(yubi,720,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==5){
                                    ctx.drawImage(yubi,820,-390+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                            }else if(sub_phase=="ACE保存確認"){
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillText("保存して終了", 400, 200);
                                ctx.fillText("デッキ編集に戻る", 400, 300);
                                
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,120,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==1){
                                    ctx.drawImage(yubi,220,-390+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                            }else if(sub_phase=="ACE保存しない"){
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillText("保存しないの？", 300, 200);
                                ctx.fillText("しないよ", 400, 300);
                                ctx.fillText("デッキ編集に戻る", 400, 400);
                                
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,220,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==1){
                                    ctx.drawImage(yubi,320,-390+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                                
                            }else if(sub_phase=="ACE枚数エラー"){
                                ctx.fillStyle="rgb(0,0,0,0.8)";
                                ctx.fillRect(0,0,1000,1000);
                                ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillText("デッキ枚数多すぎ！", 300, 200);
                                ctx.fillText("はい", 400, 300);
                                ctx.fillText("はい", 400, 400);
                                
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                if(cursor2==0){
                                    ctx.drawImage(yubi,220,-390+4*Math.sin(time*Math.PI/8));
                                }else if(cursor2==1){
                                    ctx.drawImage(yubi,320,-390+4*Math.sin(time*Math.PI/8));
                                }
                                ctx.restore();
                                
                            }

                        }else if(sub_phase=="デッキリスト"){
                            ctx.fillStyle="rgb(20,20,50)";
                            ctx.fillRect(0,0,1000,1000);
                            ctx.fillStyle="rgb(255,255,555)";
                            ctx.fillRect(5,5,810,990);
                            ctx.fillRect(875,465,70,70);
                            ctx.fillStyle="rgb(20,20,50)";
                            ctx.fillRect(10,10,800,980);
                            ctx.fillRect(880,470,60,60);
                            ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(255,255,555)";
                            ctx.fillText("▶", 970, 520);
                            ctx.fillText("◀", 830, 520);
                            ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            if(cursor2+1<10){
                                ctx.fillText(cursor2+1, 900, 520);
                            }else{
                                ctx.fillText(cursor2+1, 885, 520,80);
                            }
                            
                            ctx.fillText("読み込み", 820, 720,180);
                            ctx.fillText("上書き", 840, 300,140);
                            ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("×:戻る", 900, 950,100);
                            if(cursor==0){
                                ctx.drawImage(yubi,850,320+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==1){
                                ctx.drawImage(yubi,850,540+4*Math.sin(time*Math.PI/8));
                            }else if(cursor==2){
                                ctx.drawImage(yubi,850,740+4*Math.sin(time*Math.PI/8));
                            }
                            保存デッキ表示(保存デッキ[cursor2],15,15,780,960);
                        }

                        if(演出カウント<0 && 演出カウント>-5){
                            演出カウント-=1;
                            ctx.fillStyle="rgb(50,50,50)";
                            ctx.fillRect(0,0,1000+演出カウント*200,1000);
                        }
                        if(演出カウント>0){
                            演出カウント+=1;
                            ctx.fillStyle="rgb(50,50,50)";
                            ctx.fillRect(0,0,演出カウント*200,1000,);
                        }
                        if(演出カウント>5){
                            game_phase=next_phase;
                            cursor=2;
                            演出カウント=-11;
                        }

                    }else if(game_phase=="戦闘準備"){
                        my_deck=[];//初期化初期化ー！って初期化しなくて良いヤツも初期化してる気がする。まあいいか
                        teki_deck=[];
                        my_yamahuda=[];
                        teki_yamahuda=[];
                        my_tehuda=[];
                        teki_tehuda=[];
                        my_ba=["","","","",""];
                        teki_ba=["","","","",""];
                        death_my_ba=["","","","",""];//死亡時演出のためにカードを別の場所に移したい（場に残すとバグの温床になることは自明なので）
                        death_teki_ba=["","","","",""];
                        tukau_mahou=[];//魔法つかった瞬間に消えるのよくないと思った。

                        my_haka=[];
                        teki_haka=[];
                        
                        deck_initialize(deck_list,my_deck,my_yamahuda);
                        deck_initialize(teki_deck_list,teki_deck,teki_yamahuda);

                        for(let i=0;i<5;i++){
                            if(my_ba[i]!=""){
                                my_ba[i].card.effect("ターン開始",["自ターン",i]);
                            }
                        }

                        my_now_pull=my_deck_pull+my_stage_pull;//ステージドローを加算
                        pull_card(my_yamahuda,my_tehuda,my_now_pull);
                        一時的なドロー枚数=[my_now_pull,teki_pull];
                        game_phase="戦闘";

                        cursor=16;
                        cursor2=0;

                        duel_phase="自由";
                        aite_phase=0;//相手のターンに動かしたい。
                       
                        aite_delay=0;//お前高速で動きすぎ！

                        my_kougeki_sum=0;//AI用
                        teki_kougeki_sum=0;//降参にも使ってる

                        zuba=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]//zuba64を表示するタイマー
                        yamahuda_damage=[0,0,0,0];//左が俺へのダメージで、右が相手へのダメージ描写
                        
                        get_card="";
                        相手の降参=0;

                        atk_card="";
                        def_card="";

                        
                    }else if(game_phase=="戦闘"){
                        if(key_interval<=0 && key_input!="" && duel_phase!="相手"){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                            key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                            for(let i=0;i<key_input.length;i++){
                                if(key_input.charAt(i)=="↑"){
                                    if(duel_phase=="自由"){
                                        if(cursor<=2){
                                            cursor=16;
                                        }else if(cursor<=5){
                                            cursor=15;
                                        }else if(cursor==6){
                                            cursor=-1;
                                        }else if(cursor==11){
                                            cursor=5;
                                        }else if(cursor>=7 && cursor<=15){
                                            cursor-=1;
                                        }else if(cursor>=16){
                                            cursor=10;
                                        }
                                    }else if(duel_phase=="攻撃" && cursor_lock==0){
                                        if(cursor!=3){//山札への攻撃じゃないなら
                                            cursor-=1;
                                            if(cursor<=10){
                                                cursor=15;
                                            }
                                        }
                                    }else if(duel_phase=="召喚"){
                                        cursor-=1;
                                        if(cursor<=5){
                                            cursor=10;
                                        }
                                    }else if(duel_phase=="魔法発動確認" || duel_phase=="ターンエンド確認" || duel_phase=="降参"){
                                        cursor2=(cursor2+1)%2;
                                    }else if(duel_phase=="敵選択" || duel_phase=="味方選択"){
                                        cursor2-=1;
                                        if(cursor2<0){
                                            cursor2=4;
                                        }
                                    }
                                    
                                }else if(key_input.charAt(i)=="←"){
                                    if(duel_phase=="自由"){
                                        if(cursor==-1){
                                            cursor=5;
                                        }else if(cursor<=5){ 
                                        cursor-=1;
                                        }else if(cursor>=11 && cursor<=15){
                                            cursor-=5;
                                        }else if(cursor>=17){
                                            cursor-=1;
                                        }
                                    }
                                    
                                }else if(key_input.charAt(i)=="→"){
                                    if(duel_phase=="自由"){
                                        if(cursor<=4){
                                            cursor+=1;
                                        }else if(cursor==5){
                                            cursor=-1;
                                        }else if(cursor>=6 && cursor<=10){
                                            cursor+=5;
                                        }else if(cursor>=16 && cursor<=(my_tehuda.length+14)){
                                            cursor+=1;
                                        }
                                    }
                                    
                                }else if(key_input.charAt(i)=="↓"){
                                    if(duel_phase=="自由"){
                                        if(cursor<=2){
                                            cursor=6;
                                        }else if(cursor<=5){
                                            cursor=11;
                                        }else if(cursor<=9){
                                            cursor+=1;
                                        }else if(cursor==10){
                                            cursor=16;
                                        }else if(cursor<=15){
                                            cursor+=1;
                                        }else{
                                            cursor=-1;
                                        }
                                    }else if(duel_phase=="攻撃" && cursor_lock==0){
                                        if(cursor!=3){//山札への攻撃じゃないなら
                                            cursor+=1;
                                            if(cursor>=16){
                                                cursor=11;
                                            }
                                        }
                                    }else if(duel_phase=="召喚"){
                                        cursor+=1;
                                        if(cursor>=11){
                                            cursor=6;
                                        }
                                    }else if(duel_phase=="魔法発動確認" || duel_phase=="ターンエンド確認" || duel_phase=="降参"){
                                        cursor2=(cursor2+1)%2;
                                    }else if(duel_phase=="敵選択" || duel_phase=="味方選択"){
                                        cursor2+=1;
                                        if(cursor2>4){
                                            cursor2=0;
                                        }
                                    }
                                    
                                }else if(key_input.charAt(i)=="〇" && 長押し阻止==0){
                                    長押し阻止=1;
                                    if(duel_phase=="自由"){
                                        if(cursor==-1){
                                            cursor2=0;
                                            duel_phase="ターンエンド確認";
                                        }else if(cursor>=6 && cursor<=10 && my_ba[cursor-6]!=""){
                                            pre_cursor=cursor;//キャンセルしたときにここに戻してあげたいよね。
                                            atk_card=my_ba[cursor-6];//こちらの攻撃カード
                                            if(atk_card.can_ATK>=1){
                                                duel_phase="攻撃";
                                                cursor_lock=0;//特殊な敵がいるならカーソルをロックする。

                                                if(ba_mons_num(teki_ba)==0){
                                                    cursor=3;//敵がいない場合は山札にカーソル合わせてほしいな
                                                }else{
                                                    cursor=11;
                                                    for(let i=0;i<5;i++){//敵がいるところにカーソル合わせようぜ。
                                                        if(teki_ba[cursor-11]=="" || teki_ba[cursor-11].state.indexOf("ブロック")==-1){
                                                            cursor+=1;
                                                        }else{
                                                            cursor_lock=cursor;//変なモンスターがいたからロックさせてもらうぜ！
                                                            break;
                                                        }
                                                    }
                                                    if(cursor_lock==0){//変なモンスターはいなかったぜ！
                                                        cursor=11;
                                                        for(let i=0;i<5;i++){//敵がいるところにカーソル合わせようぜ。
                                                        if(teki_ba[cursor-11]==""){
                                                            cursor+=1;
                                                        }else{
                                                            break;
                                                        }
                                                    }

                                                    }
                                                    
                                                }
                                                
                                            }
                                            

                                        }else if(cursor>=16 && my_tehuda.length!=0){
                                            pre_cursor=cursor;//キャンセルしたときにここに戻してあげたいよね。
                                            tukau_card_num=cursor-16;
                                            if(my_tehuda[tukau_card_num].state.indexOf("モンスター")!=-1){//手札にあったモンスターカードを選んだな！
                                                if(ba_mons_num(my_ba)!=5){//場がいっぱいじゃないので、いや、生贄召喚系ならいっぱいでもいいのか
                                                    duel_phase="召喚";
                                                    cursor=10;
                                                    for(let i=0;i<5;i++){//カードがないところにカーソル合わせようぜ。
                                                        if(my_ba[cursor-6]!=""){
                                                            cursor-=1;
                                                        }else{
                                                            break;
                                                        }
                                                    }
                                                }
                                            }else if(my_tehuda[tukau_card_num].state.indexOf("魔法")!=-1){//たぶん魔法だぜ！
                                                if(my_tehuda[tukau_card_num].card.effect_req("手札から")){//発動条件確認！
                                                    if(my_tehuda[tukau_card_num].state.indexOf("敵選択")!=-1){
                                                        duel_phase="敵選択";
                                                        
                                                        for(let i=0;i<5;i++){//敵がいるところにカーソル合わせようぜ。
                                                            if(teki_ba[i]==""){
                                                            }else{
                                                                cursor2=i;
                                                                break;
                                                            }
                                                        }
                                                    }else if(my_tehuda[tukau_card_num].state.indexOf("味方選択")!=-1){
                                                        duel_phase="味方選択";
                                                        for(let i=0;i<5;i++){//味方いるところにカーソル合わせようぜ。
                                                            if(my_ba[i]==""){
                                                            }else{
                                                                cursor2=i;
                                                                break;
                                                            }
                                                        }
                                                    }else{//選択しないタイプだと…思う
                                                        duel_phase="魔法発動確認";
                                                        cursor2=0;
                                                    }
                                                }else{//使えなかったらなんかしてあげたいという気持ちがないといわけでもないが、とくにない

                                                }
                                                
                                            }
                                        }
                                    }else if(duel_phase=="攻撃"){
                                        if(cursor==3){//ダイレクトアタック！
                                            atk_yamahuda(atk_card.ATK,teki_yamahuda,teki_haka,teki_ba,teki_tehuda);
                                            atk_card.can_ATK-=1;//攻撃可能回数が1減る
                                            atk_card="";
                                            def_card="";
                                            my_ba[pre_cursor-6].move=-3;
                                            cursor=pre_cursor;
                                            zuba[3]=6;
                                            if(duel_phase=="攻撃"){//これが通らなかったらどっちかが負けてる
                                                duel_phase="自由";
                                            }
                                            
                                        }else if(teki_ba[cursor-11]!=""){//相手のいる場所を攻撃
                                            def_card=teki_ba[cursor-11];
                                            atk_mons();
                                            if(def_card.HP<=0){//倒した～
                                                teki_ba[cursor-11]=death_card(def_card,teki_haka,cursor-11);
                                                //teki_ba[cursor-11]="";になるよん
                                                //def_card="";ではだめ。参照はプロパティの場所しか渡せてないらしい、じゃあ渡せばいいじゃん！やだよバーカ！
                                            }
                                            atk_card.can_ATK-=1;//攻撃可能回数が1減る
                                            atk_card="";
                                            def_card="";
                                            my_ba[pre_cursor-6].move=-3;
                                            teki_ba[cursor-11].move=2;
                                            zuba[cursor]=6;
                                            cursor=pre_cursor;
                                            duel_phase="自由";
                                        }
                                    }else if(duel_phase=="召喚"){
                                        //生贄召喚とかほしいね、知らん。
                                        if(my_ba[cursor-6]==""){//あいてるじゃ～ん
                                            syoukan(my_tehuda[tukau_card_num],"my_ba",cursor-6);
                                            my_tehuda.splice(tukau_card_num,1);
                                            duel_phase="自由";
                                        }
                                        
                                    }else if(duel_phase=="魔法発動確認"){
                                        if(cursor2==0){//発動するってなら
                                            my_tehuda[tukau_card_num].card.effect("手札から");
                                            tukau_mahou[tukau_mahou.length]=[my_tehuda[tukau_card_num],50+card_kankaku*tukau_card_num,780,10];
                                            
                                            if(my_tehuda[tukau_card_num].state.indexOf("消滅")==-1){
                                                my_tehuda[tukau_card_num].position="my_haka";
                                                my_haka.push(my_tehuda[tukau_card_num]);
                                            }
                                            

                                            my_tehuda.splice(tukau_card_num,1);
                                            if(cursor!=16 && cursor==(my_tehuda.length+16)){
                                                cursor-=1;//カーソルがそのままだとはみ出るから…さ。
                                            }
                                        }
                                        
                                        duel_phase="自由";
                                    }else if(duel_phase=="敵選択" || duel_phase=="味方選択"){//発動するってなら
                                        if(my_tehuda[tukau_card_num].card.effect("手札から")){//効果がないときはfalseが返ってくるぜ！
                                            
                                            tukau_mahou[tukau_mahou.length]=[my_tehuda[tukau_card_num],50+card_kankaku*tukau_card_num,780,10];
                                            if(my_tehuda[tukau_card_num].state.indexOf("消滅")==-1){
                                                my_tehuda[tukau_card_num].position="my_haka";
                                                my_haka.push(my_tehuda[tukau_card_num]);
                                            }
                                            my_tehuda.splice(tukau_card_num,1);
                                            if(cursor!=16 && cursor==(my_tehuda.length+16)){
                                                cursor-=1;//カーソルがそのままだとはみ出るから…さ。
                                            }
                                            duel_phase="自由";
                                        }   
                                    }else if(duel_phase=="ターンエンド確認"){
                                        if(cursor2==0){//OK
                                            duel_phase="相手";
                                            aite_phase="始まり";
                                            cursor=16;
                                        }else{
                                            duel_phase="自由";
                                        }
                                    }else if(duel_phase=="俺勝ち"){
                                        next_phase="挑戦";
                                        演出カウント=1;
                                        cursor=0;
                                        cursor2=0;
                                        
                                    }else if(duel_phase=="敵勝ち"){
                                        if(stage==11){
                                            cursor=挑戦デッキ;
                                            next_phase="挑戦";
                                        }else{
                                            next_phase="ステージ選択";
                                            cursor=3;
                                        }
                                        演出カウント=1;
                                        
                                    }else if(duel_phase=="降参"){
                                        if(cursor2==0){//降参れす…
                                            if(stage==11){
                                                cursor=挑戦デッキ;
                                                next_phase="挑戦";
                                            }else{
                                                next_phase="ステージ選択";
                                                cursor=3;
                                            }
                                            演出カウント=1;
                                        }else{
                                            duel_phase="自由";
                                        }
                                    }
                                    
                                }else if(key_input.charAt(i)=="×"){
                                    if(duel_phase=="自由"){
                                        duel_phase="降参";
                                        cursor2=1;
                                    }else if(duel_phase=="攻撃"){
                                        duel_phase="自由";
                                        cursor=pre_cursor;
                                    }else if(duel_phase=="召喚"){
                                        duel_phase="自由";
                                        cursor=pre_cursor;
                                    }else if(duel_phase=="魔法発動確認" || duel_phase=="ターンエンド確認" || duel_phase=="敵選択" || duel_phase=="味方選択" || duel_phase=="降参"){
                                        duel_phase="自由";
                                    }
                                }
                            }
                            if(key_owarasete==1){//もうボタン押してない。押してないときはイベントくんで検知するんだけど、実行よりも先にイベントが呼ばれてたらしかたないのでこいつで止める
                                key_input="";
                                key_interval=0;
                            }
                            
                        }else if(key_interval>0){
                            key_interval=key_interval-1;//カウントダウン
                        }

                        if(長押し阻止==1 && key_input.indexOf("〇")==-1){//〇ボタンの長押し連打阻止。
                            長押し阻止=0; 
                        }
                        //相手ターン操作は下のほうに置いとくね。スクロールして

                        if(duel_phase=="相手"){
                            if(aite_delay>0){
                                aite_delay-=1;
                            }else if(aite_phase=="始まり"){//自ターンの終わり処理はここ
                                
                                for(let i=0;i<5;i++){
                                    if(my_ba[i]!=""){
                                        if(my_ba[i].state.indexOf("三回攻撃")!=-1){
                                            my_ba[i].can_ATK=3;
                                        }else if(my_ba[i].state.indexOf("二回攻撃")!=-1){
                                            my_ba[i].can_ATK=2;
                                        }else{
                                            my_ba[i].can_ATK=1;
                                        }
                                    }
                                }
                                for(let i=0;i<5;i++){
                                    if(my_ba[i]!=""){
                                        if(my_ba[i].card.effect_req("ターンエンド")){//発動条件確認！
                                            my_ba[i].card.effect("ターンエンド",["自ターン",i]);
                                        }
                                    }
                                }
                                for(let i=0;i<5;i++){
                                    if(my_ba[i]!=""){
                                        if(my_ba[i].state.indexOf("毒:")!=-1){
                                                if(my_ba[i].state.indexOf("毒回復")!=-1){
                                                    my_ba[i].HP+=Math.ceil(my_ba[i].state[my_ba[i].state.indexOf("毒:")+1]/3);
                                                }else{
                                                    my_ba[i].HP-=my_ba[i].state[my_ba[i].state.indexOf("毒:")+1];
                                                    my_ba[i].move=3;
                                                    if(my_ba[i].HP<=0){
                                                        my_ba[i]=death_card(my_ba[i],my_haka,i);
                                                    }
                                                } 
                                            }
                                    }
                                }
                                for(let i=0;i<5;i++){
                                    if(teki_ba[i]!=""){
                                        teki_ba[i].card.effect("ターン開始",["敵ターン",i]);
                                    }
                                }
                                if(一時的なドロー枚数[1]<0){//マイナスドロー禁止
                                    一時的なドロー枚数[1]=0;
                                }
                                pull_card(teki_yamahuda,teki_tehuda,一時的なドロー枚数[1]);//相手の手札枚数は右上のあそこに表示してあげるとやさしいと思うな。
                                一時的なドロー枚数[1]=teki_pull;
                                teki_siyou_tehuda=[];
                                aite_phase="攻撃";

                                相手の降参=1;//これが1のままなら、このターンなにもしていないとする。
                                
                            }else if(aite_phase=="攻撃"){
                                aite_nayami="悩むぜ！";
                                for(let i=0;i<teki_tehuda.length;i++){//攻撃する前に使うべき手札があったら使うぜ！
                                    if(teki_tehuda[i].state.indexOf("魔法")!=-1 && teki_tehuda[i].card.effect_req("手札から")){//魔法だね。&& //発動条件確認！
                                        if(teki_tehuda[i].state.indexOf("攻撃上昇")!=-1 || teki_tehuda[i].state.indexOf("敵ダメージ")!=-1 || teki_tehuda[i].state.indexOf("捕獲")!=-1 || teki_tehuda[i].card.name=="謁見"){
                                                if(teki_tehuda[i].card.AI("手札から")){//AI的な発動条件
                                                aite_phase="相手発動確認";
                                                aite_nayami="確認待ちだぜ！";
                                                tukau_card_num=i;
                                                break;        
                                                相手の降参=0;//このターン行動済み                                
                                            }
                                        }
                                    }
                                }
                                if(aite_nayami!="確認待ちだぜ！"){//攻撃するの？
                                    for(let i=0;i<5;i++){//攻撃力が一番高いやつを見つけるぜ！
                                        if(teki_ba[i]!=""){
                                            if(teki_ba[i].can_ATK>0){
                                                if(aite_nayami=="悩むぜ！"){
                                                    aite_nayami=i;
                                                }else if(teki_ba[aite_nayami].ATK+((teki_ba[aite_nayami].state.indexOf("防御破壊")!=-1)+(teki_ba[aite_nayami].state.indexOf("捕獲")!=-1))*100<teki_ba[i].ATK+((teki_ba[i].state.indexOf("防御破壊")!=-1)+(teki_ba[i].state.indexOf("捕獲")!=-1))*100){
                                                    //攻撃力が高いやつから攻撃しようぜ（これがいいのかは…知らん。）
                                                    //防御破壊持ってるやつが先に攻撃するようにしようぜ。
                                                    //捕獲持ちも優先して攻撃しようぜ
                                                    aite_nayami=i;
                                                }
                                            }
                                        }
                                    }
                                    if(aite_nayami=="悩むぜ！"){//攻撃できるカードがなかったぜ！
                                        aite_phase="召喚";
                                    }else{
                                        相手の降参=0;//このターン行動済み  
                                        teki_ba[aite_nayami].move=-3;
                                        aite_delay=10;
                                        atk_card=teki_ba[aite_nayami];
                                        aite_nayami="悩むぜ！";

                                        
                                        for(let i=0;i<5;i++){//ブロックモンスターとかいたらそいつをなぐるぜ！
                                            if(my_ba[i]!="" && my_ba[i].state.indexOf("ブロック")!=-1){
                                                aite_nayami=i;//特殊敵がいたから殺すぜ！
                                                break;
                                            }
                                        }
                                        if(aite_nayami=="悩むぜ！"){//特殊敵はいなかったぜ！
                                            if(atk_card.state.indexOf("貫通")!=-1){
                                                for(let i=0;i<5;i++){//貫通持ちで攻撃するなら死にそうなやつを殴るほうがいいぜ！え？みんな元気だったら？知らねーよボケ帰れ
                                                    if(my_ba[i]!=""){
                                                        if(aite_nayami=="悩むぜ！"){
                                                            aite_nayami=i;
                                                        }else if(my_ba[aite_nayami].HP>my_ba[i].HP){//お前より死にそうなヤツを探すぜ
                                                            aite_nayami=i;
                                                        }
                                                    }
                                                }
                                            }else if(atk_card.state.indexOf("捕獲")!=-1){
                                                for(let i=0;i<5;i++){//捕獲しやすいやつを殴りたいな、とくにいなければ体力がおおいやつを奪ってしまおう
                                                    if(my_ba[i]!=""){
                                                        if(aite_nayami=="悩むぜ！"){
                                                            aite_nayami=i;
                                                            if(my_ba[aite_nayami].state.indexOf("服従:")!=-1){
                                                                誰殴る=my_ba[aite_nayami].HP+my_ba[aite_nayami].ATK*0.1+(my_ba[aite_nayami].state[my_ba[aite_nayami].state.indexOf("服従:")+1])*10-(my_ba[aite_nayami].state.indexOf("ACE")!=-1)*100-(my_ba[aite_nayami].state.indexOf("TOP_ACE")!=-1)*100;
                                                            }else{
                                                                誰殴る=my_ba[aite_nayami].HP+my_ba[aite_nayami].ATK*0.1-(my_ba[aite_nayami].state.indexOf("ACE")!=-1)*100-(my_ba[aite_nayami].state.indexOf("TOP_ACE")!=-1)*100;
                                                            }
                                                            
                                                        }else{
                                                            if(my_ba[i].state.indexOf("服従:")!=-1){
                                                                if(誰殴る<my_ba[i].HP+my_ba[i].ATK*0.1+(my_ba[i].state[my_ba[i].state.indexOf("服従:")+1])*10-(my_ba[i].state.indexOf("ACE")!=-1)*100-(my_ba[i].state.indexOf("TOP_ACE")!=-1)*100){
                                                                    //次の攻撃で捕獲できる！とかそういう高度な話は？→ねえよぼけ
                                                                    //10以上は見ても意味なくない？→そうだよボケ
                                                                    aite_nayami=i;
                                                                }
                                                            }else{
                                                                if(誰殴る<my_ba[i].HP+my_ba[i].ATK*0.1-(my_ba[i].state.indexOf("ACE")!=-1)*100-(my_ba[i].state.indexOf("TOP_ACE")!=-1)*100){
                                                                    aite_nayami=i;
                                                                }
                                                            }
                                                            
                                                        }
                                                    }
                                                }
                                            }else{
                                                for(let i=0;i<5;i++){//体力とか攻撃力を加味して攻撃相手を決めたいぜ！
                                                    if(my_ba[i]!=""){
                                                        if(aite_nayami=="悩むぜ！"){
                                                            aite_nayami=i;
                                                        }else if(my_ba[aite_nayami].ATK/Math.ceil(my_ba[aite_nayami].HP/atk_card.ATK)<my_ba[i].ATK/Math.ceil(my_ba[i].HP/atk_card.ATK)){//なんか殺しやすくて強いやつを殴ろう
                                                            aite_nayami=i;
                                                        }
                                                    }
                                                }
                                            }
                                            
                                        }
                                        if(aite_nayami=="悩むぜ！"){//俺の場がガラ空きだぁ
                                            atk_yamahuda(atk_card.ATK,my_yamahuda,my_haka,my_ba,my_tehuda);
                                            if(duel_phase!="相手"){
                                                aite_phase="終わり";//どっちか負けたぞ
                                            }
                                            zuba[0]=6;
                                        }else{
                                            def_card=my_ba[aite_nayami];
                                            atk_mons();
                                            if(def_card.HP<=0){//倒した～
                                                my_ba[aite_nayami]=death_card(def_card,my_haka,aite_nayami);
                                                //my_ba[aite_nayami]="";になるよん
                                                //def_card="";ではだめ。参照はプロパティの場所しか渡せてないらしい、じゃあ渡せばいいじゃん！やだよバーカ！
                                            }
                                            my_ba[aite_nayami].move=2;
                                            zuba[aite_nayami+6]=6;
                                        }
                                        
                                        atk_card.can_ATK-=1;//攻撃したら…ね
                                        atk_card="";
                                        def_card="";
                                    }
                                }
                            }else if(aite_phase=="召喚"){//召喚…魔法発動もしてるぜ！
                                aite_nayami="悩むぜ！";
                                for(let i=0;i<teki_tehuda.length;i++){//手札使うぜ！    
                                    if(teki_tehuda[i].state.indexOf("モンスター")!=-1){//モンスターカードやんけ！
                                        for(let j=0;j<5;j++){
                                            if(teki_ba[j]!="" && teki_ba[j].state.indexOf("捕獲")!=-1){//捕獲モンスターが場にいる。
                                                if(ba_mons_num(teki_ba)==4){//モンスターが4体
                                                    aite_nayami="これ以上召喚しないほうがいいぜ！";
                                                    break;
                                                }
                                            }
                                            if(teki_ba[j]!="" && teki_ba[j].state.indexOf("ラスボス")!=-1){//ラスボスが場にいる。
                                                let しゅうくん数_ポン=0;
                                                for(let k=0;k<5;k++){
                                                    if(my_ba[k]!="" && my_ba[k].state.indexOf("しゅうくん")!=-1 &&my_ba[k].card.name!="しゅうくん"){
                                                        しゅうくん数_ポン+=1;
                                                    }
                                                }
                                                if(ba_mons_num(teki_ba)>=5-しゅうくん数_ポン){//モンスターが奪える
                                                    aite_nayami="これ以上召喚しないほうがいいぜ！";
                                                    break;
                                                }
                                            }
                                        }
                                        if(aite_nayami=="これ以上召喚しないほうがいいぜ！"){
                                            aite_nayami="悩むぜ！";
                                        }else{
                                            for(let j=0;j<5;j++){
                                                if(teki_ba[ba_haiti[j]]==""){//空いてる場所あるじゃん！
                                                    
                                                    syoukan(teki_tehuda[i],"teki_ba",ba_haiti[j]);
                                                    aite_delay=5;
                                                    teki_tehuda.splice(i,1);
                                                    aite_nayami="手札使ったよ";
                                                    相手の降参=0;//このターン行動済み  
                                                    break;//
                                                }
                                            }
                                        }
                                        
                                    }else if(teki_tehuda[i].state.indexOf("魔法")!=-1 && teki_tehuda[i].card.effect_req("手札から")){//魔法だね。&& //発動条件確認！
                                        if(teki_tehuda[i].card.AI("手札から")){//AI的な発動条件
                                            aite_phase="相手発動確認";
                                            aite_nayami="確認待ちだぜ！";
                                            tukau_card_num=i;
                                            相手の降参=0;//このターン行動済み  
                                            break;                                        
                                        }
                                        
                                    }

                                    if(aite_nayami=="手札使ったよ"){
                                        aite_phase="攻撃";//場が変化してそうだから攻撃検討しなおして
                                        break;//手札一枚使ったらループしなおしてきて
                                        
                                    }
                                }
                                if(aite_nayami=="悩むぜ！"){//やることなくなった？
                                    aite_phase="終わり";
                                    aite_delay=3;
                                }
                            
                            }else if(aite_phase=="終わり"){//敵ターンの終わり処理
                                duel_phase="自由";

                                for(let i=0;i<5;i++){
                                    if(teki_ba[i]!=""){
                                        if(teki_ba[i].state.indexOf("三回攻撃")!=-1){
                                            teki_ba[i].can_ATK=3;
                                        }else if(teki_ba[i].state.indexOf("二回攻撃")!=-1){
                                            teki_ba[i].can_ATK=2;
                                        }else{
                                            teki_ba[i].can_ATK=1;
                                        }
                                    }
                                }
                                for(let i=0;i<5;i++){
                                        if(teki_ba[i]!=""){
                                             if(teki_ba[i].card.effect_req("ターンエンド")){//発動条件確認！ …なんで見てんだろ
                                            teki_ba[i].card.effect("ターンエンド",["敵ターン",i]);
                                        }
                                    }
                                }
                                for(let i=0;i<5;i++){
                                    if(teki_ba[i]!=""){
                                        if(teki_ba[i].state.indexOf("毒:")!=-1){
                                            if(teki_ba[i].state.indexOf("毒回復")!=-1){
                                                teki_ba[i].HP+=Math.ceil(teki_ba[i].state[teki_ba[i].state.indexOf("毒:")+1]/3);
                                            }else{
                                                teki_ba[i].HP-=teki_ba[i].state[teki_ba[i].state.indexOf("毒:")+1];
                                                teki_ba[i].move=3;
                                                if(teki_ba[i].HP<=0){
                                                    teki_ba[i]=death_card(teki_ba[i],teki_haka,i);
                                                }
                                            }        
                                        }
                                    }
                                }

                                
                                for(let i=0;i<5;i++){
                                    if(my_ba[i]!=""){
                                        my_ba[i].card.effect("ターン開始",["自ターン",i]);
                                    }
                                }
                                
                                if(一時的なドロー枚数[0]<0){//マイナスドロー禁止
                                    一時的なドロー枚数[0]=0;
                                }
                                pull_card(my_yamahuda,my_tehuda, 一時的なドロー枚数[0]);
                                一時的なドロー枚数[0]=my_now_pull;

                                
                                if(teki_yamahuda.length==0){//もう山札ないじゃん…
                                    /*
                                    //場の攻撃力の合計を見て降参するのを実装していましたが、毒とか実装されたので攻撃力なくても戦えるしやめようというところになったのです。
                                    teki_kougeki_sum=0;
                                    for(let i=0;i<5;i++){//場の攻撃力が…
                                        if(teki_ba[i]!=""){
                                            teki_kougeki_sum+=teki_ba[i].ATK;
                                        }
                                    }
                                    
                                    if(teki_kougeki_sum==0){//攻撃力の合計も0！？これはもうダメみたいですね。
                                        duel_phase="俺勝ち";
                                        相手の降参=1;
                                    }
                                    */
                                    for(let i=0;i<5;i++){
                                        if(teki_ba[i]!="" && (teki_ba[i].state.indexOf("毒回復")!=-1 || teki_ba[i].state.indexOf("体力上昇")!=-1)){//耐久勝負の可能性
                                            相手の降参=0;
                                        }
                                    }
                                    for(let i=0;i<teki_tehuda.length;i++){
                                        if(teki_tehuda[i].state.indexOf("モンスター")!=-1){//手札にモンスターのこってマス
                                            相手の降参=0;
                                        }
                                    }
                                    if(相手の降参==1){//このターンなにもしてねえな…降参で。
                                        //相手の山札を0にして残ったモンスターも攻撃可能数を0にしたら勝ちにならない？
                                        //そこまで追い詰めたならもう勝ちでいいよ
                                        //うんちっち
                                        duel_phase="俺勝ち";
                                    }
                                }
                            
                            }
                            
                        }

                        
                        if(stage==2 && mini_stage>3){
                            ctx.fillStyle="rgb(130,10,0)";
                            ctx.fillRect(0,0,1000,1000);
                        }else if(stage==4){
                            ctx.drawImage(hujounomori_kakoi,0,0);
                        }else if(stage==8){
                            if(mini_stage<5){
                                ctx.fillStyle="rgb(150,230,255)";
                            }else if(mini_stage==5){
                                ctx.fillStyle="rgb(170,200,235)";
                            }else{
                                ctx.fillStyle="rgb(110,90,100)";
                            }

                            ctx.fillRect(0,0,1000,1000);
                        }else{
                            ctx.fillStyle="rgb(130,255,170)";
                            ctx.fillRect(0,0,1000,1000);
                        }
                        ctx.drawImage(card_basyo,0,0);
                        
                        

                        

                        //ここで自分のフィールドにカードを並べる
                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        for(let i=0;i<my_ba.length;i++){
                            if(my_ba[i]!=""){
                                card_draw(my_ba[i],105+135*i,-225+10*(Math.abs(2-i))+my_ba[i].move*50);
                            }
                            if(my_ba[i].move>0){
                                my_ba[i].move-=1;
                            }else if(my_ba[i].move<0){
                                my_ba[i].move+=1;
                            }
                        }
                        ctx.restore();
                                        

                        //ここで敵のフィールドにカードを並べる
                        ctx.save();
                        ctx.rotate(270 * Math.PI / 180);
                        for(let i=0;i<teki_ba.length;i++){
                            if(teki_ba[i]!=""){
                                card_draw(teki_ba[i],-235-135*i,775+10*(Math.abs(2-i))+teki_ba[i].move*50);
                            }
                            if(teki_ba[i].move>0){
                                teki_ba[i].move-=1;
                            }else if(teki_ba[i].move<0){
                                teki_ba[i].move+=1;
                            }
                        }
                        ctx.restore();

                        //自分カードの死
                        ctx.save();
                        ctx.rotate(90 * Math.PI / 180);
                        for(let i=0;i<5;i++){
                            if(death_my_ba[i]!=""){
                                card_draw(death_my_ba[i],105+135*i+(death_my_ba[i].move%2)*10,-225+(Math.abs(2-i)*10)+(10-death_my_ba[i].move)*30);

                                ctx.drawImage(def_plate,105+135*i+(death_my_ba[i].move%2)*10,-225+(Math.abs(2-i)*10)+(10-death_my_ba[i].move)*30+152);
                                ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillText(0, 105+135*i+(death_my_ba[i].move%2)*10+13, -225+(Math.abs(2-i)*10)+(10-death_my_ba[i].move)*30+188,42);
                            }
                            if(death_my_ba[i].move>0){
                                death_my_ba[i].move-=1;
                                if(death_my_ba[i].move==0){
                                    death_my_ba[i]="";
                                }
                            }
                        }
                        ctx.restore();

                        //相手カードの死
                        ctx.save();
                        ctx.rotate(270 * Math.PI / 180);
                        for(let i=0;i<5;i++){
                            if(death_teki_ba[i]!=""){
                                card_draw(death_teki_ba[i],-235-135*i+(death_teki_ba[i].move%2)*10,775+(Math.abs(2-i)*10)+(10-death_teki_ba[i].move)*30);
                             
                                ctx.drawImage(def_plate,-235-135*i+(death_teki_ba[i].move%2)*10,775+(Math.abs(2-i)*10)+(10-death_teki_ba[i].move)*30+152);
                                ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                ctx.fillText(0, -235-135*i+(death_teki_ba[i].move%2)*10+13, 775+(Math.abs(2-i)*10)+(10-death_teki_ba[i].move)*30+188,42);
                                       
                                    
                            }
                            if(death_teki_ba[i].move>0){
                                death_teki_ba[i].move-=1;
                                if(death_teki_ba[i].move==0){
                                    death_teki_ba[i]="";
                                }
                            }
                        }
                        ctx.restore();

                        if(cursor==1){
                            ctx.fillStyle="rgb(55,55,55)";
                            ctx.fillRect(240,110,520,670);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(250,120,500,650);
                            takusan_card_draw(my_haka,260,130,480,630);
                        }else if(cursor==4){
                            ctx.fillStyle="rgb(55,55,55)";
                            ctx.fillRect(240,110,520,670);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(250,120,500,650);
                            takusan_card_draw(teki_haka,260,130,480,630);
                        }

                        ctx.fillStyle="rgb(0,0,0)";//上のほうを描いてます。
                        ctx.fillRect(105,5,440,90);
                        ctx.fillRect(555,5,440,90);
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(110,10,430,80);
                        ctx.fillRect(560,10,430,80);
                        ctx.fillStyle="rgb(150,200,255)";
                        ctx.fillRect(388,12,150,76);
                        ctx.fillRect(838,12,150,76);
                        ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.drawImage(turn_end,5,5);
                        ctx.drawImage(yamahuda,110,20);
                        ctx.fillText(my_yamahuda.length+yamahuda_damage[0], 174, 70,70);
                        ctx.drawImage(yamahuda,560,20);
                        ctx.fillText(teki_yamahuda.length+yamahuda_damage[1], 624, 70,70);
                        ctx.drawImage(hakaba,250,20);
                        ctx.fillText(my_haka.length-yamahuda_damage[2], 308, 70,70);
                        ctx.drawImage(hakaba,700,20);
                        ctx.fillText(teki_haka.length-yamahuda_damage[3], 758, 70,70);
                        for (let i=0;i<4;i++){
                            if(yamahuda_damage[i]>0){
                                if(time%3==0){
                                    yamahuda_damage[i]-=1;
                                }
                            }
                        }

                        ctx.font = "32px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        if(my_tehuda.length>0){
                            ctx.drawImage(tehuda32,390,14);
                            ctx.fillText(my_tehuda.length, 425, 41);
                        }
                        if(teki_tehuda.length>0){
                            ctx.drawImage(tehuda32,840,14);
                            
                            ctx.fillText(teki_tehuda.length, 875, 41);
                        }
                        tokusyu_hyouji(390,46);
                        

                        ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                        ctx.fillStyle="rgb(0,0,0)";
                        ctx.fillRect(5,785,990,210);
                        ctx.fillStyle="rgb(255,255,255)";
                        ctx.fillRect(10,790,980,200);
                        if(my_tehuda.length!=0){//ここから手札-------------------
                            ctx.save();
                            tehuda_maisuu=my_tehuda.length;
                            if(tehuda_maisuu<7){
                                card_kankaku=130;
                            }else{
                                card_kankaku=850/tehuda_maisuu;
                            }
                            kakudo=25/tehuda_maisuu;
                            ctx.rotate(10 * Math.PI / 180);
                        for (let i=0;i<tehuda_maisuu;i++){                      
                                if((cursor-16)==i || ((pre_cursor-16)==i && duel_phase=="召喚")){
                                    card_draw(my_tehuda[i],(50+card_kankaku*i)*Math.cos((10+i*kakudo) * Math.PI / 180)+780*Math.sin((10+i*kakudo) * Math.PI / 180),780*Math.cos((10+i*kakudo) * Math.PI / 180)-(50+card_kankaku*i)*Math.sin((10+i*kakudo) * Math.PI / 180),-40);
                                }else{
                                    card_draw(my_tehuda[i],(50+card_kankaku*i)*Math.cos((10+i*kakudo) * Math.PI / 180)+780*Math.sin((10+i*kakudo) * Math.PI / 180),780*Math.cos((10+i*kakudo) * Math.PI / 180)-(50+card_kankaku*i)*Math.sin((10+i*kakudo) * Math.PI / 180));
                                }
                                ctx.rotate(kakudo * Math.PI / 180);
                            }
                            ctx.restore();
                        }
                        
                        
                        

                        for (let i=0;i<16;i++){ //攻撃時にzuba64を表示
                            if(zuba[i]!=0){
                                zuba[i]-=1;
                                if(i==0){
                                    ctx.drawImage(zuba64,110,20);
                                }else if(i==1){
                                }else if(i==2){
                                }else if(i==3){
                                    ctx.drawImage(zuba64,560,20);
                                }else if(i==4){
                                }else if(i==5){
                                }else if(i==6){
                                    ctx.drawImage(zuba64,20,100);
                                }else if(i==7){
                                    ctx.drawImage(zuba64,30,235);
                                }else if(i==8){
                                    ctx.drawImage(zuba64,40,370);
                                }else if(i==9){
                                    ctx.drawImage(zuba64,30,505);
                                }else if(i==10){
                                    ctx.drawImage(zuba64,20,640);
                                }else if(i==11){
                                    ctx.drawImage(zuba64,916,170);
                                }else if(i==12){
                                    ctx.drawImage(zuba64,906,305);
                                }else if(i==13){
                                    ctx.drawImage(zuba64,896,440);
                                }else if(i==14){
                                    ctx.drawImage(zuba64,906,575);
                                }else if(i==15){
                                    ctx.drawImage(zuba64,916,710);
                                }
                                
                            }
                        }
                        
                        
                        //カーソル表示…
                        if(cursor==-1){  ctx.drawImage(yubi,-10,80+4*Math.sin(time*Math.PI/8)); //左上 なんで-1から始まってるの？　それはね、設計ミスさ！
                        }else if(cursor==0){  ctx.drawImage(yubi,110,80+4*Math.sin(time*Math.PI/8)); 
                        }else if(cursor==1){  ctx.drawImage(yubi,260,80+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==2){  ctx.drawImage(yubi,400,80+4*Math.sin(time*Math.PI/8));

                        }else if(cursor==3){ ctx.drawImage(yubi,560,80+4*Math.sin(time*Math.PI/8));//右上
                        }else if(cursor==4){ctx.drawImage(yubi,710,80+4*Math.sin(time*Math.PI/8));
                        }else if(cursor==5){ctx.drawImage(yubi,850,80+4*Math.sin(time*Math.PI/8));


                        }else if(cursor==6){//左場
                            ctx.save();
                            ctx.rotate(90 * Math.PI / 180);
                            ctx.drawImage(yubi,105,-100+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(cursor==7){
                            ctx.save();
                            ctx.rotate(90 * Math.PI / 180);
                            ctx.drawImage(yubi,245,-110+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(cursor==8){
                            ctx.save();
                            ctx.rotate(90 * Math.PI / 180);
                            ctx.drawImage(yubi,375,-120+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(cursor==9){
                            ctx.save();
                            ctx.rotate(90 * Math.PI / 180);
                            ctx.drawImage(yubi,510,-110+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(cursor==10){
                            ctx.save();
                            ctx.rotate(90 * Math.PI / 180);
                            ctx.drawImage(yubi,645,-100+4*Math.sin(time*Math.PI/8));
                            ctx.restore();

                        }else if(cursor==11){//右ば
                            ctx.save();
                            ctx.rotate(270 * Math.PI / 180);
                            ctx.drawImage(yubi,-235,900+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(cursor==12){
                            ctx.save();
                            ctx.rotate(270 * Math.PI / 180);
                            ctx.drawImage(yubi,-370,890+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(cursor==13){
                            ctx.save();
                            ctx.rotate(270 * Math.PI / 180);
                            ctx.drawImage(yubi,-505,880+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(cursor==14){
                            ctx.save();
                            ctx.rotate(270 * Math.PI / 180);
                            ctx.drawImage(yubi,-640,890+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(cursor==15){
                            ctx.save();
                            ctx.rotate(270 * Math.PI / 180);
                            ctx.drawImage(yubi,-775,900+4*Math.sin(time*Math.PI/8));
                            ctx.restore();

                        }else{//手札でヤンス。
                            ctx.save();
                            ctx.rotate((10+kakudo*(cursor-16)) * Math.PI / 180);
                            ctx.drawImage(yubi,(50+card_kankaku*(cursor-16))*Math.cos((10+(cursor-16)*kakudo) * Math.PI / 180)+780*Math.sin((10+(cursor-16)*kakudo) * Math.PI / 180),100+4*Math.sin(time*Math.PI/8)+780*Math.cos((10+(cursor-16)*kakudo) * Math.PI / 180)-(50+card_kankaku*(cursor-16))*Math.sin((10+(cursor-16)*kakudo) * Math.PI / 180));
                            ctx.restore();
                        }
                        if(duel_phase=="敵選択"){
                            ctx.fillStyle="rgb(0,0,0,0.5)";
                            ctx.fillRect(0,780,1000,100);
                            ctx.fillRect(0,100,770,680);
                            ctx.fillRect(0,0,1000,100);
                            
                            ctx.fillStyle="rgb(0,150,0)";
                            ctx.fillRect(0,800,1000,200);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(200,825,600,150);
                            ctx.font = "80px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,200,0)";
                            ctx.fillText("魔法対象選択！", 225, 900);
                            ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("キャンセル：×", 570, 960);
                            if(cursor2==0){//右ば
                                ctx.save();
                                ctx.rotate(270 * Math.PI / 180);
                                ctx.drawImage(yubi,-235,900+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(cursor2==1){
                                ctx.save();
                                ctx.rotate(270 * Math.PI / 180);
                                ctx.drawImage(yubi,-370,890+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(cursor2==2){
                                ctx.save();
                                ctx.rotate(270 * Math.PI / 180);
                                ctx.drawImage(yubi,-505,880+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(cursor2==3){
                                ctx.save();
                                ctx.rotate(270 * Math.PI / 180);
                                ctx.drawImage(yubi,-640,890+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(cursor2==4){
                                ctx.save();
                                ctx.rotate(270 * Math.PI / 180);
                                ctx.drawImage(yubi,-775,900+4*Math.sin(time*Math.PI/8));
                                ctx.restore();

                            }
                        }else if(duel_phase=="味方選択"){
                            ctx.fillStyle="rgb(0,0,0,0.5)";
                            ctx.fillRect(0,780,1000,100);
                            ctx.fillRect(230,100,770,680);
                            ctx.fillRect(0,0,1000,100);
                            
                            ctx.fillStyle="rgb(0,150,0)";
                            ctx.fillRect(0,800,1000,200);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(200,825,600,150);
                            ctx.font = "80px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,200,0)";
                            ctx.fillText("魔法対象選択！", 225, 900);
                            ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("キャンセル：×", 570, 960);
                            if(cursor2==0){//左場
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,105,-100+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(cursor2==1){
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,245,-110+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(cursor2==2){
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,375,-120+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(cursor2==3){
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,510,-110+4*Math.sin(time*Math.PI/8));
                                ctx.restore();
                            }else if(cursor2==4){
                                ctx.save();
                                ctx.rotate(90 * Math.PI / 180);
                                ctx.drawImage(yubi,645,-100+4*Math.sin(time*Math.PI/8));
                                ctx.restore();

                            }
                        }else if(duel_phase=="魔法発動確認"){
                            ctx.fillStyle="rgb(0,0,0,0.5)";
                            ctx.fillRect(0,0,1000,1000);
                            ctx.fillStyle="rgb(55,55,55)";
                            ctx.fillRect(290,790,420,200);
                            ctx.fillStyle="rgb(200,255,200)";
                            ctx.fillRect(300,800,400,180);
                            ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText("使う", 500, 870);
                            ctx.fillText("やめる", 500, 950);
                            ctx.save();
                            ctx.rotate(90 * Math.PI / 180);
                            ctx.drawImage(yubi,790+cursor2*80,-480+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }

                        //カードの詳細表示
                        if((cursor>=6 &&cursor<=10 && (my_ba[cursor-6]!="")) || (cursor>=11 && cursor<=15 && (teki_ba[cursor-11]!="")) || (cursor>=16 && my_tehuda.length!=0)){//カード詳細を表示するときはカードがあるときだけだぜ！
                            ctx.fillStyle="rgb(55,55,55)";
                            ctx.fillRect(240,110,520,670);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(250,120,500,650);
                            if(cursor<=10){
                                syousai_card=my_ba[cursor-6];
                            }else if(cursor<=15){
                                syousai_card=teki_ba[cursor-11];
                            }else{
                                syousai_card=my_tehuda[cursor-16];
                            }
                            ctx.fillStyle="rgb(200,200,200)";
                            ctx.fillRect(255,125,490,50);
                            ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText(syousai_card.card.name, 260, 168,480);
                            ctx.drawImage(syousai_card.card.image,260,180);

                            if(syousai_card.state.indexOf("モンスター")!=-1){
                                ctx.drawImage(atk_plate,400,180);
                                ctx.drawImage(def_plate,450,185);
                                ctx.fillText("(", 570, 225);
                                ctx.drawImage(atk_plate,600,180);
                                ctx.drawImage(def_plate,650,185);
                                ctx.fillText(")", 704, 225);
                                ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillStyle="rgb(255,255,255)";
                                if(syousai_card.ATK<10){
                                    ctx.fillText(syousai_card.ATK, 414, 222,42);
                                }else{
                                    ctx.fillText(syousai_card.ATK, 404, 222,42);
                                }
                                if(syousai_card.HP<10){
                                    ctx.fillText(syousai_card.HP, 464, 222,42);
                                }else{
                                    ctx.fillText(syousai_card.HP, 454, 222,42);
                                }
                                if(syousai_card.card.ATK<10){
                                    ctx.fillText(syousai_card.card.ATK, 614, 222,42);
                                }else{
                                    ctx.fillText(syousai_card.card.ATK, 604, 222,42);
                                }
                                if(syousai_card.card.HP<10){
                                    ctx.fillText(syousai_card.card.HP, 664, 222,42);
                                }else{
                                    ctx.fillText(syousai_card.card.HP, 654, 222,42);
                                }
                            }
                            ctx.fillStyle="rgb(0,0,0)";
                            text_kaigyou_hyouji(syousai_card.card.text, 260, 380,480,240,40,syousai_card.card.text_iro);//x,yは左上指定だから注意だ！
                            ctx.fillRect(255,600,490,2);
                            syousai_state_color=[];
                            syousai_state="分類:";
                            for(let i=0;i<syousai_card.state.length;i++){
                                if(syousai_card.state[i]=="TOP_ACE"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,7,"rgb(255,0,0)"];
                                }else if(syousai_card.state[i]=="ACE"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,3,"rgb(200,200,0)"];
                                }else if(syousai_card.state[i]=="毒:"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,1,"rgb(200,0,200)"];
                                }else if(syousai_card.state[i]=="防御:"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,2,"rgb(0,0,200)"];
                                }
                                syousai_state+=" "+syousai_card.state[i];
                            }
                            text_kaigyou_hyouji(syousai_state, 260, 610,480,160,40,syousai_state_color);//x,yは左上指定だから注意だ！
                            
                        }

                        if(stage==4 || stage==8){
                            if(stage==4){
                                ctx.fillStyle="rgb(255,255,255,0.1)";
                                ctx.fillRect(0,0,1000,1000);//ぼんやりとした光
                                ctx.fillStyle="rgb(0,0,0,0.2)";
                                ctx.fillRect(0,0,1000,1000);//ぼんやりとした影
                            }
                            
                            
                            ctx.save();
                            ctx.scale(3,3);
                            for(let i=0;i<5;i++){
                                ctx.drawImage(kumo_mori[i],雲[i][0],雲[i][1]);
                                雲[i][0]-=雲[i][2];
                                if(雲[i][0]<-200){
                                    雲[i]=[Math.random()*300+334,Math.random()*330,Math.random()+0.5];
                                }
                            }
                            
                            ctx.restore();
                        }

                        if(duel_phase=="召喚"){//今なんの状態なんだよっていうお客様の声にお答えする形になった
                            ctx.save();
                            ctx.fillStyle="rgb(0,0,0,0.5)";
                            ctx.fillRect(0,0,230,100);
                            ctx.fillRect(0,780,230,220);
                            ctx.fillRect(230,0,770,1000);
                            ctx.rotate(45 * Math.PI / 180);
                            ctx.fillStyle="rgb(0,0,150)";
                            ctx.fillRect(200,-525,1000,200);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(400,-500,600,150);
                            ctx.font = "80px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,200)";
                            ctx.fillText("召喚場所選択！", 440, -400);
                            ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("キャンセル：×", 750, -360);
                            ctx.restore();
                        }else if(duel_phase=="攻撃"){
                            ctx.fillStyle="rgb(0,0,0,0.5)";
                            ctx.fillRect(0,780,1000,100);
                            ctx.fillRect(230,100,540,680);
                            ctx.fillRect(0,100,230,(pre_cursor-6)*135);
                            ctx.fillRect(0,105+(pre_cursor-5)*135,230,(10-pre_cursor)*135);
                            if(cursor==3){
                                ctx.fillRect(0,0,550,100);
                                ctx.fillRect(700,0,300,100);
                                ctx.fillRect(770,100,230,800);
                            }else{
                                ctx.fillRect(0,0,1000,100);
                            }
                            ctx.fillStyle="rgb(150,0,0)";
                            ctx.fillRect(0,800,1000,200);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(200,825,600,150);
                            ctx.font = "80px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(200,0,0)";
                            ctx.fillText("攻撃対象選択！", 225, 900);
                            ctx.drawImage(atk_circle,100+10*Math.sin(time*Math.PI/64),850+8*Math.sin(time*Math.PI/16));
                            ctx.drawImage(atk_circle,836+10*Math.sin(time*Math.PI/64),850+8*Math.sin(time*Math.PI/16));
                            ctx.font = "30px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("キャンセル：×", 570, 960);
                        }else if(duel_phase=="相手"){
                            ctx.fillStyle="rgb(0,0,0,0.5)";
                            ctx.fillRect(0,0,100,100);
                            ctx.fillRect(0,780,1000,220);
                            ctx.fillRect(0,100,15,680);
                            ctx.fillRect(985,0,15,780);
                            ctx.fillRect(100,0,885,15);
                            ctx.fillStyle="rgb(50,50,50)";
                            ctx.fillRect(230,100,540,680);
                            ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillText("相手ターン", 300, 300);
                            //ctx.fillText("召喚", 400, 400);
                        }else if(duel_phase=="俺勝ち"){
                            ctx.fillStyle="rgb(0,0,0,0.5)";
                            ctx.fillRect(0,0,1000,1000);
                            ctx.fillStyle="rgb(255,55,55)";
                            ctx.fillRect(150,100,700,700);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(200,150,600,600);

                            
                            ctx.fillStyle="rgb(0,0,0)";
                            if(相手の降参==0){
                                ctx.font = "80px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("勝った！", 250, 250);
                            }else{
                                ctx.font = "70px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                                ctx.fillText("相手が降参した！", 250, 250);
                            }
                            
                            ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("おめれと", 250, 350);
                            ctx.drawImage(kati_image,550,500);
                            
                            if(get_card==""){
                                card_count=0;
                                for(let i=0;i<teki_deck_list.card_list.length;i++){
                                    card_count+=teki_deck_list.card_list[i][1];
                                }
                               
                                card_count=Math.floor(Math.random()*card_count);
   
                                for(let i=0;i<teki_deck_list.card_list.length;i++){//ponya_list={card_list:[[ponya,5],[ponya_ace,2],[yakuso_3,3]],ACE:[ponya_ace,ponya_ace],TOP_ACE:[ponya]};
                                    card_count-=teki_deck_list.card_list[i][1];
                                    if(card_count<0){
                                        get_card={...teki_deck_list.card_list[i][0]};
                                        break;
                                    }
                                }
                                
                                カードゲット(get_card);
                                お金+=drop_gold;
                                localStorage.setItem('お金',お金);

                                if(stage==11){//なぜここに？　→　勝ったあとにブラウザ閉じると消えちゃうので、勝った後はなるはやで処理、保存
                                    クリア済み[挑戦デッキ]=1;
                                    localStorage.setItem('クリア済み',クリア済み);
                                }

                            }
                            ctx.fillText("入手カード：", 250, 450);
                            ctx.fillText(get_card.name, 350, 500,450);
                            ctx.drawImage(get_card.image,350,530);
                        }else if(duel_phase=="敵勝ち"){
                            ctx.fillStyle="rgb(0,0,0,0.5)";
                            ctx.fillRect(0,0,1000,1000);
                            ctx.fillStyle="rgb(55,55,255)";
                            ctx.fillRect(150,100,700,700);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(200,150,600,600);

                            ctx.font = "80px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText("負けた！", 250, 250);
                            ctx.font = "40px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillText("ぐえー", 250, 350);
                            ctx.drawImage(make_image,550,525);
                        }else if(duel_phase=="ターンエンド確認"){
                            ctx.fillStyle="rgb(0,0,0,0.5)";
                            ctx.fillRect(0,0,1000,1000);
                            ctx.fillStyle="rgb(200,100,55)";
                            ctx.fillRect(250,50,700,480);
                            ctx.fillStyle="rgb(255,220,200)";
                            ctx.fillRect(275,75,650,430);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(295,200,610,280);
                            ctx.font = "80px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText("ターンエンド", 400, 175);
                            ctx.drawImage(turn_end,300,100);
                            
                            ctx.fillText("OK", 450, 300);
                            ctx.fillText("キャンセル", 450, 430);
                            ctx.save();
                            ctx.rotate(90 * Math.PI / 180);
                            ctx.drawImage(yubi,200+cursor2*140,-430+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }else if(duel_phase=="降参"){
                            ctx.fillStyle="rgb(0,0,0,0.5)";
                            ctx.fillRect(0,0,1000,1000);
                            ctx.fillStyle="rgb(100,100,100)";
                            ctx.fillRect(150,50,700,480);
                            ctx.fillStyle="rgb(220,220,220)";
                            ctx.fillRect(175,75,650,430);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(195,200,610,280);
                            ctx.font = "80px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText("降参するの！？", 240, 175);
                            
                            ctx.fillText("降参です！", 350, 300);
                            ctx.fillText("キャンセル", 350, 430);
                            ctx.save();
                            ctx.rotate(90 * Math.PI / 180);
                            ctx.drawImage(yubi,200+cursor2*140,-330+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                        }

                        if(tukau_mahou.length!=0){                        
                            for(let i=tukau_mahou.length-1;i>=0;i--){
                                card_draw(tukau_mahou[i][0],tukau_mahou[i][1],tukau_mahou[i][2]-300+tukau_mahou[i][3]*tukau_mahou[i][3]*3);
                                tukau_mahou[i][3]-=1;
                                if(tukau_mahou[i][3]==0){
                                    tukau_mahou.splice(i,1);
                                }
                            }
                        }
                        
                        if(aite_phase=="相手発動確認"){
                            
                            ctx.fillStyle="rgb(55,55,55)";
                            ctx.fillRect(240,110,520,670);
                            ctx.fillStyle="rgb(255,255,255)";
                            ctx.fillRect(250,120,500,650);
                            syousai_card=teki_tehuda[tukau_card_num];
                            ctx.fillStyle="rgb(200,200,200)";
                            ctx.fillRect(255,125,490,50);
                            ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText(syousai_card.card.name, 260, 168,480);
                            ctx.drawImage(syousai_card.card.image,260,180);

                            ctx.fillStyle="rgb(0,0,0)";
                            text_kaigyou_hyouji(syousai_card.card.text, 260, 380,480,240,40,syousai_card.card.text_iro);//x,yは左上指定だから注意だ！
                            ctx.fillRect(255,600,490,2);
                            syousai_state_color=[];
                            syousai_state="分類:";
                            for(let i=0;i<syousai_card.state.length;i++){
                                if(syousai_card.state[i]=="TOP_ACE"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,7,"rgb(255,0,0)"];
                                }else if(syousai_card.state[i]=="ACE"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,3,"rgb(200,200,0)"];
                                }else if(syousai_card.state[i]=="毒:"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,1,"rgb(200,0,200)"];
                                }else if(syousai_card.state[i]=="防御:"){
                                    syousai_state_color[syousai_state_color.length]=[syousai_state.length+1,2,"rgb(0,0,200)"];
                                }
                                syousai_state+=" "+syousai_card.state[i];
                            }
                            text_kaigyou_hyouji(syousai_state, 260, 610,480,160,40,syousai_state_color);//x,yは左上指定だから注意だ！

                            ctx.fillStyle="rgb(55,55,55)";
                            ctx.fillRect(90,790,820,200);
                            ctx.fillStyle="rgb(200,255,200)";
                            ctx.fillRect(100,800,800,180);
                            ctx.font = "50px  'ＭＳ ゴシック'";//フォント設定。左のフォントがないと右のフォントを適用するらしい。
                            ctx.fillStyle="rgb(0,0,0)";
                            ctx.fillText("・発動されました！", 150, 870);
                            ctx.fillText("OK", 380, 950);
                            ctx.save();
                            ctx.rotate(90 * Math.PI / 180);
                            ctx.drawImage(yubi,870,-370+4*Math.sin(time*Math.PI/8));
                            ctx.restore();
                            if(key_interval<=0 && key_input!=""  && 長押し阻止==0){//キーが長押しされている場合はkey_intervalが0になってて、キー操作が飛んできたら
                                key_interval=5;//30*n/1000[s]の間、長押しでの連続入力を無効。
                                長押し阻止=1;
                                if(key_input.indexOf("〇")!=-1 || key_input.indexOf("×")!=-1){//なんでこんなとこにいるんだよ！

                                    
                                    teki_tehuda[tukau_card_num].card.effect("手札から");

                                    if(teki_tehuda[tukau_card_num].state.indexOf("消滅")==-1){
                                        teki_tehuda[tukau_card_num].position="teki_haka";
                                        teki_haka.push(teki_tehuda[tukau_card_num]);
                                    }
                                    
                                    aite_delay=5;
                                    teki_tehuda.splice(tukau_card_num,1);
                                    aite_phase="攻撃";
                                }
                            }
                        }
                        if(演出カウント<0 && 演出カウント>-5){
                            演出カウント-=1;
                            ctx.fillStyle="rgb(50,50,50)";
                            ctx.fillRect(0,0,1000,1000+演出カウント*200);
                        }
                        if(演出カウント>0){
                            演出カウント+=1;
                            ctx.fillStyle="rgb(50,50,50)";
                            ctx.fillRect(0,0,1000,演出カウント*200);
                        }
                        if(演出カウント>5){
                            game_phase=next_phase;
                            演出カウント=-1;
                        }
                    }
                },30);//30/1000[s]でくりかえすぞ！
                
            }
            
        </script>
    </head>
    <body>


        <div id="top"></div>
        <header id="header">
            <button onclick="html_link_btn()" id="html_link_btn"></button>
            <nav id="html_link_nav">
                <ul id="html_link_ul"></ul>
            </nav>
            <a href="../index.html">
                <img id="go_home" src="../images/site/omotyabako_deka.png" alt="トップページへ" height="1px"><!--ここで高さを入れておかないと、クソでかい画像が一瞬読み込まれてボタンの大きさが暴走する-->
            </a>
            <h1 id="title_h1">
                JUN汁ｗおもちゃばこ。
            </h1>
        </header>

        <div id="mannaka">

            <table border="5" bordercolor="#ffffff" align="center">
                <tr>
                    <td> キーボード</td> <td bgcolor="#005000">移動 : WASD,↑←→↓,KHLJ</td> <td bgcolor="#500000">〇 : Enter</td> <td bgcolor="#000050">× : Shift</td>
                </tr>
            </table> 
            
            <div id="parent_div">
                <canvas id="cnvs" height="1000px" width="1000px"><!--styleのheigthは見た目の大きさを変えているにすぎない。表示領域はcssじゃない。-->
                </canvas>
                <canvas id="cnvs_hidden" height="100px" width="100px"><!--styleのheigthは見た目の大きさを変えているにすぎない。表示領域はcssじゃない。-->
                </canvas>
            </div>
            <div id="buttons">
                <div id="button_left">
                    <div>
                        <input type="button" class="key_button" value="↑">
                    </div>
                    <div>
                        <input type="button" class="key_button" value="←">
                        <input type="button" class="key_button" value="→">
                    </div>
                    <div>
                        <input type="button" class="key_button" value="↓">
                    </div>
                    
                </div>
                <div id="button_right">
                    <input type="button" class="key_button" value="〇">
                    <input type="button" class="key_button" value="×">
                </div>
            </div>
            <div id="omake_div">
                <input id="download_button" type="button" value="デッキの画像が保存ができるすげえボタン">
            </div>
            

            <footer>
                <ul id="footul">
                    <li id="foot_tweet_li">
                        <a href="" id="foot_tweet_a"><!--onload_functions()でhrefを書き込んでるで！-->
                            <img src="../images/site/twitterbutton.gif" alt="ツイートボタン" id="tweet_img">
                        </a>
                    </li>
                    <li>
                        <a href="#top" id="totop"> 
                            ページ上部に移動
                        </a>
                    </li>
                    <li>
                        <label class="button_lable">
                            <input id="save_button" type="button" style="display:none;">
                            外部セーブ
                        </label>
                        
                    </li>
                    <li>
                        <label class="button_lable">
                            <input type="file" id="load_button" accept=".txt" style="display:none;">
                            外部ロード
                        </label>
                    </li>
                    <li>
                        <label class="button_lable">
                            <a href="../images/omocha/syuukun_card/しゅうくんカードセーブデータ初期データ.txt" download="しゅうくんカードセーブデータ初期データ.txt">最初から</a>
                        </label>
                    </li>
                </ul>
            </footer>
        </div>
    </body>
</html>
